!function(e){var t={};function s(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(i,n,function(t){return e[t]}.bind(null,n));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){(function(e){e.SIP=s(2);const t=s(3);console.log(t)}).call(this,s(1))},function(e,t){var s;s=function(){return this}();try{s=s||new Function("return this")()}catch(e){"object"==typeof window&&(s=window)}e.exports=s},function(e,t,s){
/*!
 * 
 *  SIP version 0.11.6
 *  Copyright (c) 2014-2018 Junction Networks, Inc <http://www.onsip.com>
 *  Homepage: https://sipjs.com
 *  License: https://sipjs.com/license/
 * 
 * 
 *  ~~~SIP.js contains substantial portions of JsSIP under the following license~~~
 *  Homepage: http://jssip.net
 *  Copyright (c) 2012-2013 José Luis Millán - Versatica <http://www.versatica.com>
 * 
 *  Permission is hereby granted, free of charge, to any person obtaining
 *  a copy of this software and associated documentation files (the
 *  "Software"), to deal in the Software without restriction, including
 *  without limitation the rights to use, copy, modify, merge, publish,
 *  distribute, sublicense, and/or sell copies of the Software, and to
 *  permit persons to whom the Software is furnished to do so, subject to
 *  the following conditions:
 * 
 *  The above copyright notice and this permission notice shall be
 *  included in all copies or substantial portions of the Software.
 * 
 *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 *  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 *  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 *  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 *  LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 *  OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 *  WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * 
 *  ~~~ end JsSIP license ~~~
 * 
 * 
 * 
 * 
 */
var i;i=function(){return function(e){var t={};function s(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(i,n,function(t){return e[t]}.bind(null,n));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";e.exports=s(1)(s(40))},function(e,t,s){"use strict";e.exports=function(e){var t=s(2),i=t.version,n=t.title,r=Object.defineProperties({},{version:{get:function(){return i}},name:{get:function(){return n}}});return s(3)(r,e),r.LoggerFactory=s(4)(e.console),r.EventEmitter=s(5)(),r.C=s(7)(r.name,r.version),r.Exceptions=s(8),r.Timers=s(9)(e.timers),r.Transport=s(10)(r),s(11)(r),s(12)(r),s(13)(r),s(14)(r),s(15)(r),s(16)(r),s(18)(r),s(19)(r),r.SessionDescriptionHandler=s(20)(r.EventEmitter),s(21)(r),s(22)(r),s(23)(r),s(25)(r),s(26)(r),s(27)(r,e),s(32)(r),r.DigestAuthentication=s(33)(r.Utils),r.Grammar=s(36)(r),r.Web={Modifiers:s(38)(r),Simple:s(39)(r)},r}},function(e){e.exports={name:"sip.js",title:"SIP.js",description:"A simple, intuitive, and powerful JavaScript signaling library",version:"0.11.6",main:"dist/sip.js",browser:{"./src/environment.js":"./src/environment_browser.js"},homepage:"https://sipjs.com",author:"OnSIP <developer@onsip.com> (https://sipjs.com/aboutus/)",contributors:[{url:"https://github.com/onsip/SIP.js/blob/master/THANKS.md"}],repository:{type:"git",url:"https://github.com/onsip/SIP.js.git"},keywords:["sip","websocket","webrtc","library","javascript"],devDependencies:{"awesome-typescript-loader":"^5.2.1",eslint:"^5.4.0","jasmine-core":"^3.2.1",karma:"^3.0.0","karma-chrome-launcher":"^2.2.0","karma-cli":"^1.0.1","karma-jasmine":"^1.1.0","karma-jasmine-html-reporter":"^1.3.1","karma-mocha-reporter":"^2.2.5","karma-webpack":"^3.0.0",pegjs:"^0.10.0","pegjs-loader":"^0.5.4",typescript:"^3.0.3",webpack:"^4.19.0","webpack-cli":"^3.0.8"},engines:{node:">=6.0"},license:"MIT",scripts:{prebuild:"eslint src/*.js src/**/*.js","build-dev":"webpack --progress --env.buildType dev","build-prod":"webpack --progress --env.buildType prod","copy-dist-files":"cp dist/sip.js dist/sip-$npm_package_version.js && cp dist/sip.min.js  dist/sip-$npm_package_version.min.js",build:"npm run build-dev && npm run build-prod && npm run copy-dist-files",browserTest:"sleep 2 && open http://0.0.0.0:9876/debug.html & karma start --reporters kjhtml --no-single-run",commandLineTest:"karma start --reporters mocha --browsers ChromeHeadless --single-run",buildAndTest:"npm run build && npm run commandLineTest",buildAndBrowserTest:"npm run build && npm run browserTest"},dependencies:{"crypto-js":"^3.1.9-1"},optionalDependencies:{promiscuous:"^0.6.0"}}},function(e,t,s){"use strict";e.exports=function(e,t){var s;s={Promise:t.Promise,defer:function(){var e={};return e.promise=new s.Promise((function(t,s){e.resolve=t,e.reject=s})),e},reducePromises:function(t,s){return t.reduce((function(e,t){return e=e.then(t)}),e.Utils.Promise.resolve(s))},augment:function(e,t,s,i){var n,r;for(n in r=t.prototype)(i||void 0===e[n])&&(e[n]=r[n]);t.apply(e,s)},defaultOptions:function(e,t){return e=e||{},t=t||{},Object.assign({},e,t)},optionsOverride:function(e,t,s,i,n,r){i&&e[s]&&n.warn(s+" is deprecated, please use "+t+" instead"),e[t]&&e[s]&&n.warn(t+" overriding "+s),e[t]=e[t]||e[s]||r},str_utf8_length:function(e){return encodeURIComponent(e).replace(/%[A-F\d]{2}/g,"U").length},generateFakeSDP:function(e){if(e){var t=e.indexOf("o="),s=e.indexOf("\r\n",t);return"v=0\r\n"+e.slice(t,s)+"\r\ns=-\r\nt=0 0\r\nc=IN IP4 0.0.0.0"}},isFunction:function(e){return void 0!==e&&"[object Function]"===Object.prototype.toString.call(e)},isDecimal:function(e){return!isNaN(e)&&parseFloat(e)===parseInt(e,10)},createRandomToken:function(e,t){var s,i="";for(t=t||32,s=0;s<e;s++)i+=(Math.random()*t|0).toString(t);return i},newTag:function(){return e.Utils.createRandomToken(e.UA.C.TAG_LENGTH)},newUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},hostType:function(t){if(t)return-1!==(t=e.Grammar.parse(t,"host"))?t.host_type:void 0},normalizeTarget:function(t,s){var i,n,r;if(t){if(t instanceof e.URI)return t;if("string"==typeof t){switch((i=t.split("@")).length){case 1:if(!s)return;n=t,r=s;break;case 2:n=i[0],r=i[1];break;default:n=i.slice(0,i.length-1).join("@"),r=i[i.length-1]}return n=n.replace(/^(sips?|tel):/i,""),/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(n)&&(n=n.replace(/[\-\.\(\)]/g,"")),t=e.C.SIP+":"+e.Utils.escapeUser(n)+"@"+r,e.URI.parse(t)}}},escapeUser:function(e){return encodeURIComponent(decodeURIComponent(e)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},headerize:function(e){var t,s={"Call-Id":"Call-ID",Cseq:"CSeq","Min-Se":"Min-SE",Rack:"RAck",Rseq:"RSeq","Www-Authenticate":"WWW-Authenticate"},i=e.toLowerCase().replace(/_/g,"-").split("-"),n="",r=i.length;for(t=0;t<r;t++)0!==t&&(n+="-"),n+=i[t].charAt(0).toUpperCase()+i[t].substring(1);return s[n]&&(n=s[n]),n},sipErrorCause:function(t){var s;for(s in e.C.SIP_ERROR_CAUSES)if(-1!==e.C.SIP_ERROR_CAUSES[s].indexOf(t))return e.C.causes[s];return e.C.causes.SIP_FAILURE_CODE},getReasonPhrase:function(t,s){return s||e.C.REASON_PHRASE[t]||""},getReasonHeaderValue:function(t,s){return"SIP;cause="+t+';text="'+(s=e.Utils.getReasonPhrase(t,s))+'"'},getCancelReason:function(t,s){if(t&&t<200||t>699)throw new TypeError("Invalid status_code: "+t);if(t)return e.Utils.getReasonHeaderValue(t,s)},buildStatusLine:function(e,t){if(t=t||null,!(e=e||null)||e<100||e>699)throw new TypeError("Invalid status_code: "+e);if(t&&"string"!=typeof t&&!(t instanceof String))throw new TypeError("Invalid reason_phrase: "+t);return"SIP/2.0 "+e+" "+(t=s.getReasonPhrase(e,t))+"\r\n"},getRandomTestNetIP:function(){return"192.0.2."+(e=1,t=254,Math.floor(Math.random()*(t-e+1)+e));var e,t}},e.Utils=s}},function(e,t,s){"use strict";var i={error:0,warn:1,log:2,debug:3};e.exports=function(e){var t=function(){var e,t=2,s=!0,n=null;this.loggers={},e=this.getLogger("sip.loggerfactory"),Object.defineProperties(this,{builtinEnabled:{get:function(){return s},set:function(t){"boolean"==typeof t?s=t:e.error('invalid "builtinEnabled" parameter value: '+JSON.stringify(t))}},level:{get:function(){return t},set:function(s){s>=0&&s<=3?t=s:s>3?t=3:i.hasOwnProperty(s)?t=i[s]:e.error('invalid "level" parameter value: '+JSON.stringify(s))}},connector:{get:function(){return n},set:function(t){null===t||""===t||void 0===t?n=null:"function"==typeof t?n=t:e.error('invalid "connector" parameter value: '+JSON.stringify(t))}}})};function s(e,t,s){this.logger=e,this.category=t,this.label=s}return t.prototype.print=function(t,s,i,n){if("string"==typeof n){var r=[new Date,s];i&&r.push(i),n=r.concat(n).join(" | ")}t.call(e,n)},Object.keys(i).forEach((function(n){s.prototype[n]=function(e){this.logger[n](this.category,this.label,e)},t.prototype[n]=function(t,s,r){this.level>=i[n]&&(this.builtinEnabled&&this.print(e[n],t,s,r),this.connector&&this.connector(n,t,s,r))}})),t.prototype.getLogger=function(e,t){var i;return t&&3===this.level?new s(this,e,t):this.loggers[e]?this.loggers[e]:(i=new s(this,e),this.loggers[e]=i,i)},t}},function(e,t,s){"use strict";var i=s(6).EventEmitter;e.exports=function(){function e(){i.call(this)}return e.prototype=Object.create(i.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),e}},function(e,t){function s(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function n(e){return"object"==typeof e&&null!==e}function r(e){return void 0===e}e.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._maxListeners=void 0,s.defaultMaxListeners=10,s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},s.prototype.emit=function(e){var t,s,o,a,c,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||n(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var h=new Error('Uncaught, unspecified "error" event. ('+t+")");throw h.context=t,h}if(r(s=this._events[e]))return!1;if(i(s))switch(arguments.length){case 1:s.call(this);break;case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),s.apply(this,a)}else if(n(s))for(a=Array.prototype.slice.call(arguments,1),o=(u=s.slice()).length,c=0;c<o;c++)u[c].apply(this,a);return!0},s.prototype.addListener=function(e,t){var o;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?n(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,n(this._events[e])&&!this._events[e].warned&&(o=r(this._maxListeners)?s.defaultMaxListeners:this._maxListeners)&&o>0&&this._events[e].length>o&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},s.prototype.on=s.prototype.addListener,s.prototype.once=function(e,t){if(!i(t))throw TypeError("listener must be a function");var s=!1;function n(){this.removeListener(e,n),s||(s=!0,t.apply(this,arguments))}return n.listener=t,this.on(e,n),this},s.prototype.removeListener=function(e,t){var s,r,o,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(s=this._events[e]).length,r=-1,s===t||i(s.listener)&&s.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(n(s)){for(a=o;a-- >0;)if(s[a]===t||s[a].listener&&s[a].listener===t){r=a;break}if(r<0)return this;1===s.length?(s.length=0,delete this._events[e]):s.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},s.prototype.removeAllListeners=function(e){var t,s;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i(s=this._events[e]))this.removeListener(e,s);else if(s)for(;s.length;)this.removeListener(e,s[s.length-1]);return delete this._events[e],this},s.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},s.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},s.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,s){"use strict";e.exports=function(e,t){return{USER_AGENT:e+"/"+t,SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",AUTHENTICATION_ERROR:"Authentication Error",DIALOG_ERROR:"Dialog Error",WEBRTC_NOT_SUPPORTED:"WebRTC Not Supported",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",NO_PRACK:"No PRACK",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},supported:{UNSUPPORTED:"none",SUPPORTED:"supported",REQUIRED:"required"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",PUBLISH:"PUBLISH",REFER:"REFER",PRACK:"PRACK",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},OPTION_TAGS:{"100rel":!0,199:!0,answermode:!0,"early-session":!0,eventlist:!0,explicitsub:!0,"from-change":!0,"geolocation-http":!0,"geolocation-sip":!0,gin:!0,gruu:!0,histinfo:!0,ice:!0,join:!0,"multiple-refer":!0,norefersub:!0,nosub:!0,outbound:!0,path:!0,policy:!0,precondition:!0,pref:!0,privacy:!0,"recipient-list-invite":!0,"recipient-list-message":!0,"recipient-list-subscribe":!0,replaces:!0,"resource-priority":!0,"sdp-anat":!0,"sec-agree":!0,tdialog:!0,timer:!0,uui:!0},dtmfType:{INFO:"info",RTP:"rtp"}}}},function(e,t,s){"use strict";var i;e.exports={ConfigurationError:(i=function(e,t){this.code=1,this.name="CONFIGURATION_ERROR",this.parameter=e,this.value=t,this.message=this.value?"Invalid value "+JSON.stringify(this.value)+' for parameter "'+this.parameter+'"':"Missing parameter: "+this.parameter},i.prototype=new Error,i),InvalidStateError:function(){var e=function(e){this.code=2,this.name="INVALID_STATE_ERROR",this.status=e,this.message="Invalid status: "+e};return e.prototype=new Error,e}(),NotSupportedError:function(){var e=function(e){this.code=3,this.name="NOT_SUPPORTED_ERROR",this.message=e};return e.prototype=new Error,e}(),GetDescriptionError:function(){var e=function(e){this.code=4,this.name="GET_DESCRIPTION_ERROR",this.message=e};return e.prototype=new Error,e}(),RenegotiationError:function(){var e=function(e){this.code=5,this.name="RENEGOTIATION_ERROR",this.message=e};return e.prototype=new Error,e}(),MethodParameterError:function(){var e=function(e,t,s){this.code=6,this.name="METHOD_PARAMETER_ERROR",this.method=e,this.parameter=t,this.value=s,this.message=this.value?"Invalid value "+JSON.stringify(this.value)+' for parameter "'+this.parameter+'"':"Missing parameter: "+this.parameter};return e.prototype=new Error,e}(),TransportError:function(){var e=function(e){this.code=7,this.name="TRANSPORT_ERROR",this.message=e};return e.prototype=new Error,e}(),SessionDescriptionHandlerError:function(){var e=function(e,t,s){this.code=8,this.name="SESSION_DESCRIPTION_HANDLER_ERROR",this.method=e,this.error=t,this.message=s||"Error with Session Description Handler"};return e.prototype=new Error,e}()}},function(e,t,s){"use strict";var i=500;e.exports=function(e){var t={T1:i,T2:4e3,T4:5e3,TIMER_B:32e3,TIMER_D:0,TIMER_F:32e3,TIMER_H:32e3,TIMER_I:0,TIMER_J:0,TIMER_K:0,TIMER_L:32e3,TIMER_M:32e3,TIMER_N:32e3,PROVISIONAL_RESPONSE_INTERVAL:6e4};return["setTimeout","clearTimeout","setInterval","clearInterval"].forEach((function(s){t[s]=function(){return e[s].apply(e,arguments)}})),t}},function(e,t,s){"use strict";e.exports=function(e){var t=function(e,t){};return t.prototype=Object.create(e.EventEmitter.prototype,{connect:{writable:!0,value:function(e){return e=e||{},this.connectPromise(e).then(function(e){!e.overrideEvent&&this.emit("connected")}.bind(this))}},connectPromise:{writable:!0,value:function(e){}},isConnected:{writable:!0,value:function(){}},send:{writable:!0,value:function(e,t){return t=t||{},this.sendPromise(e).then(function(e){!e.overrideEvent&&this.emit("messageSent",e.msg)}.bind(this))}},sendPromise:{writable:!0,value:function(e,t){}},onMessage:{writable:!0,value:function(e){}},disconnect:{writable:!0,value:function(e){return e=e||{},this.disconnectPromise(e).then(function(e){!e.overrideEvent&&this.emit("disconnected")}.bind(this))}},disconnectPromise:{writable:!0,value:function(e){}},afterConnected:{writable:!0,value:function(e){this.isConnected()?e():this.once("connected",e)}},waitForConnected:{writable:!0,value:function(){return console.warn("DEPRECATION WARNING Transport.waitForConnected(): use afterConnected() instead"),new e.Utils.Promise(function(e){this.afterConnected(e)}.bind(this))}}}),t}},function(e,t,s){"use strict";e.exports=function(e){var t;function s(e,t){var s=t,i=0,n=0;if(e.substring(s,s+2).match(/(^\r\n)/))return-2;for(;0===i;){if(-1===(n=e.indexOf("\r\n",s)))return n;!e.substring(n+2,n+4).match(/(^\r\n)/)&&e.charAt(n+2).match(/(^\s+)/)?s=n+2:i=n}return i}function i(t,s,i,n){var r,o,a,c,u=s.indexOf(":",i),h=s.substring(i,u).trim(),l=s.substring(u+1,n).trim();switch(h.toLowerCase()){case"via":case"v":t.addHeader("via",l),1===t.getHeaders("via").length?(c=t.parseHeader("Via"))&&(t.via=c,t.via_branch=c.branch):c=0;break;case"from":case"f":t.setHeader("from",l),(c=t.parseHeader("from"))&&(t.from=c,t.from_tag=c.getParam("tag"));break;case"to":case"t":t.setHeader("to",l),(c=t.parseHeader("to"))&&(t.to=c,t.to_tag=c.getParam("tag"));break;case"record-route":if(-1===(c=e.Grammar.parse(l,"Record_Route"))){c=void 0;break}for(a=c.length,o=0;o<a;o++)r=c[o],t.addHeader("record-route",l.substring(r.position,r.offset)),t.headers["Record-Route"][t.getHeaders("record-route").length-1].parsed=r.parsed;break;case"call-id":case"i":t.setHeader("call-id",l),(c=t.parseHeader("call-id"))&&(t.call_id=l);break;case"contact":case"m":if(-1===(c=e.Grammar.parse(l,"Contact"))){c=void 0;break}for(a=c.length,o=0;o<a;o++)r=c[o],t.addHeader("contact",l.substring(r.position,r.offset)),t.headers.Contact[t.getHeaders("contact").length-1].parsed=r.parsed;break;case"content-length":case"l":t.setHeader("content-length",l),c=t.parseHeader("content-length");break;case"content-type":case"c":t.setHeader("content-type",l),c=t.parseHeader("content-type");break;case"cseq":t.setHeader("cseq",l),(c=t.parseHeader("cseq"))&&(t.cseq=c.value),t instanceof e.IncomingResponse&&(t.method=c.method);break;case"max-forwards":t.setHeader("max-forwards",l),c=t.parseHeader("max-forwards");break;case"www-authenticate":t.setHeader("www-authenticate",l),c=t.parseHeader("www-authenticate");break;case"proxy-authenticate":t.setHeader("proxy-authenticate",l),c=t.parseHeader("proxy-authenticate");break;case"refer-to":case"r":t.setHeader("refer-to",l),(c=t.parseHeader("refer-to"))&&(t.refer_to=c);break;default:t.setHeader(h,l),c=0}return void 0!==c||{error:'error parsing header "'+h+'"'}}(t={}).parseMessage=function(t,n){var r,o,a,c,u,h=0,l=t.indexOf("\r\n"),d=n.getLogger("sip.parser");if(-1!==l){if(o=t.substring(0,l),-1!==(u=e.Grammar.parse(o,"Request_Response"))){for(u.status_code?((r=new e.IncomingResponse(n)).status_code=u.status_code,r.reason_phrase=u.reason_phrase):((r=new e.IncomingRequest(n)).method=u.method,r.ruri=u.uri),r.data=t,h=l+2;;){if(-2===(l=s(t,h))){c=h+2;break}if(-1===l)return void d.error("malformed message");if(!0!==(u=i(r,t,h,l)))return void d.error(u.error);h=l+2}return r.hasHeader("content-length")?(a=r.getHeader("content-length"),r.body=t.substr(c,a)):r.body=t.substring(c),r}d.warn('error parsing first line of SIP message: "'+o+'"')}else d.warn("no CRLF found, not a SIP message, discarded")},e.Parser=t}},function(e,t,s){"use strict";e.exports=function(e){var t,s,i,n;function r(t){var s=t.ua.configuration.hackAllowUnregisteredOptionTags,i=[],n={};return t.method===e.C.REGISTER?i.push("path","gruu"):t.method===e.C.INVITE&&(t.ua.contact.pub_gruu||t.ua.contact.temp_gruu)&&i.push("gruu"),t.ua.configuration.rel100===e.C.supported.SUPPORTED&&i.push("100rel"),t.ua.configuration.replaces===e.C.supported.SUPPORTED&&i.push("replaces"),i.push("outbound"),"Supported: "+(i=(i=i.concat(t.ua.configuration.extraSupported)).filter((function(t){var i=e.C.OPTION_TAGS[t],r=!n[t];return n[t]=!0,(i||s)&&r}))).join(", ")+"\r\n"}(t=function(t,s,i,n,r,o){var a,c,u,h,l,d;if(n=n||{},!t||!s||!i)return null;this.logger=i.getLogger("sip.sipmessage"),this.ua=i,this.headers={},this.method=t,this.ruri=s,this.body=o,this.extraHeaders=(r||[]).slice(),this.statusCode=n.status_code,this.reasonPhrase=n.reason_phrase,n.route_set?this.setHeader("route",n.route_set):i.configuration.usePreloadedRoute&&this.setHeader("route",i.transport.server.sip_uri),this.setHeader("via",""),this.setHeader("max-forwards",e.UA.C.MAX_FORWARDS),l=n.to_uri||s,a=n.to_displayName||0===n.to_displayName?'"'+n.to_displayName+'" ':"",a+="<"+(l&&l.toRaw?l.toRaw():l)+">",a+=n.to_tag?";tag="+n.to_tag:"",this.to=new e.NameAddrHeader.parse(a),this.setHeader("to",a),d=n.from_uri||i.configuration.uri,c=n.from_displayName||0===n.from_displayName?'"'+n.from_displayName+'" ':i.configuration.displayName?'"'+i.configuration.displayName+'" ':"",c+="<"+(d&&d.toRaw?d.toRaw():d)+">;tag=",c+=n.from_tag||e.Utils.newTag(),this.from=new e.NameAddrHeader.parse(c),this.setHeader("from",c),u=n.call_id||i.configuration.sipjsId+e.Utils.createRandomToken(15),this.call_id=u,this.setHeader("call-id",u),h=n.cseq||Math.floor(1e4*Math.random()),this.cseq=h,this.setHeader("cseq",h+" "+t)}).prototype={setHeader:function(t,s){this.headers[e.Utils.headerize(t)]=s instanceof Array?s:[s]},getHeader:function(t){var s,i,n=this.extraHeaders.length,r=this.headers[e.Utils.headerize(t)];if(r){if(r[0])return r[0]}else for(s=new RegExp("^\\s*"+t+"\\s*:","i"),i=0;i<n;i++)if(r=this.extraHeaders[i],s.test(r))return r.substring(r.indexOf(":")+1).trim()},getHeaders:function(t){var s,i,n,r=this.headers[e.Utils.headerize(t)],o=[];if(r){for(i=r.length,s=0;s<i;s++)o.push(r[s]);return o}for(i=this.extraHeaders.length,n=new RegExp("^\\s*"+t+"\\s*:","i"),s=0;s<i;s++)r=this.extraHeaders[s],n.test(r)&&o.push(r.substring(r.indexOf(":")+1).trim());return o},hasHeader:function(t){var s,i,n=this.extraHeaders.length;if(this.headers[e.Utils.headerize(t)])return!0;for(s=new RegExp("^\\s*"+t+"\\s*:","i"),i=0;i<n;i++)if(s.test(this.extraHeaders[i]))return!0;return!1},toString:function(){var t,s,i,n="";for(t in n+=this.method+" "+(this.ruri.toRaw?this.ruri.toRaw():this.ruri)+" SIP/2.0\r\n",this.headers)for(s=this.headers[t].length,i=0;i<s;i++)n+=t+": "+this.headers[t][i]+"\r\n";for(s=this.extraHeaders.length,i=0;i<s;i++)n+=this.extraHeaders[i].trim()+"\r\n";return n+=r(this),n+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",this.body?"string"==typeof this.body?(n+="Content-Length: "+(s=e.Utils.str_utf8_length(this.body))+"\r\n\r\n",n+=this.body):this.body.body&&this.body.contentType?(s=e.Utils.str_utf8_length(this.body.body),n+="Content-Type: "+this.body.contentType+"\r\n",n+="Content-Length: "+s+"\r\n\r\n",n+=this.body.body):n+="Content-Length: 0\r\n\r\n":n+="Content-Length: 0\r\n\r\n",n}},(s=function(){this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null}).prototype={addHeader:function(t,s){var i={raw:s};t=e.Utils.headerize(t),this.headers[t]?this.headers[t].push(i):this.headers[t]=[i]},getHeader:function(t){var s=this.headers[e.Utils.headerize(t)];if(s)return s[0]?s[0].raw:void 0},getHeaders:function(t){var s,i,n=this.headers[e.Utils.headerize(t)],r=[];if(!n)return[];for(i=n.length,s=0;s<i;s++)r.push(n[s].raw);return r},hasHeader:function(t){return!!this.headers[e.Utils.headerize(t)]},parseHeader:function(t,s){var i,n,r;if(t=e.Utils.headerize(t),s=s||0,this.headers[t]){if(!(s>=this.headers[t].length))return n=(i=this.headers[t][s]).raw,i.parsed?i.parsed:-1===(r=e.Grammar.parse(n,t.replace(/-/g,"_")))?(this.headers[t].splice(s,1),void this.logger.warn('error parsing "'+t+'" header field with value "'+n+'"')):(i.parsed=r,r);this.logger.log('not so many "'+t+'" headers present')}else this.logger.log('header "'+t+'" not present')},s:function(e,t){return this.parseHeader(e,t)},setHeader:function(t,s){var i={raw:s};this.headers[e.Utils.headerize(t)]=[i]},toString:function(){return this.data}},((i=function(e){this.logger=e.getLogger("sip.sipmessage"),this.ua=e,this.headers={},this.ruri=null,this.transport=null,this.server_transaction=null}).prototype=new s).reply=function(t,s,i,n,o,a){var c,u,h,l,d,p=this.getHeader("To"),g=0,f=0;if(d=e.Utils.buildStatusLine(t,s),i=(i||[]).slice(),this.method===e.C.INVITE&&t>100&&t<=200)for(h=(c=this.getHeaders("record-route")).length;g<h;g++)d+="Record-Route: "+c[g]+"\r\n";for(h=(u=this.getHeaders("via")).length;f<h;f++)d+="Via: "+u[f]+"\r\n";for(!this.to_tag&&t>100?p+=";tag="+e.Utils.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(p+=";tag="+this.to_tag),d+="To: "+p+"\r\n",d+="From: "+this.getHeader("From")+"\r\n",d+="Call-ID: "+this.call_id+"\r\n",d+="CSeq: "+this.cseq+" "+this.method+"\r\n",h=i.length,l=0;l<h;l++)d+=i[l].trim()+"\r\n";return d+=r(this),d+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",n?"string"==typeof n?(d+="Content-Type: application/sdp\r\n",d+="Content-Length: "+(h=e.Utils.str_utf8_length(n))+"\r\n\r\n",d+=n):n.body&&n.contentType?(h=e.Utils.str_utf8_length(n.body),d+="Content-Type: "+n.contentType+"\r\n",d+="Content-Length: "+h+"\r\n\r\n",d+=n.body):d+="Content-Length: 0\r\n\r\n":d+="Content-Length: 0\r\n\r\n",this.server_transaction.receiveResponse(t,d).then(o,a),d},i.prototype.reply_sl=function(t,s){var i,n,r=0,o=this.getHeaders("via"),a=o.length;for(n=e.Utils.buildStatusLine(t,s);r<a;r++)n+="Via: "+o[r]+"\r\n";i=this.getHeader("To"),!this.to_tag&&t>100?i+=";tag="+e.Utils.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(i+=";tag="+this.to_tag),n+="To: "+i+"\r\n",n+="From: "+this.getHeader("From")+"\r\n",n+="Call-ID: "+this.call_id+"\r\n",n+="CSeq: "+this.cseq+" "+this.method+"\r\n",n+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",n+="Content-Length: 0\r\n\r\n",this.transport.send(n)},(n=function(e){this.logger=e.getLogger("sip.sipmessage"),this.headers={},this.status_code=null,this.reason_phrase=null}).prototype=new s,e.OutgoingRequest=t,e.IncomingRequest=i,e.IncomingResponse=n}},function(e,t,s){"use strict";e.exports=function(e){var t;(t=function(t,s,i,n,r,o){var a,c,u,h;if(!i)throw new TypeError('missing or invalid "host" parameter');for(a in t=t||e.C.SIP,this.parameters={},this.headers={},r)this.setParam(a,r[a]);for(c in o)this.setHeader(c,o[c]);u={scheme:t,user:s,host:i,port:n},h={scheme:t.toLowerCase(),user:s,host:i.toLowerCase(),port:n},Object.defineProperties(this,{_normal:{get:function(){return h}},_raw:{get:function(){return u}},scheme:{get:function(){return h.scheme},set:function(e){u.scheme=e,h.scheme=e.toLowerCase()}},user:{get:function(){return h.user},set:function(e){h.user=u.user=e}},host:{get:function(){return h.host},set:function(e){u.host=e,h.host=e.toLowerCase()}},aor:{get:function(){return h.user+"@"+h.host}},port:{get:function(){return h.port},set:function(e){h.port=u.port=0===e?e:parseInt(e,10)||null}}})}).prototype={setParam:function(e,t){e&&(this.parameters[e.toLowerCase()]=null==t?null:t.toString())},getParam:function(e){if(e)return this.parameters[e.toLowerCase()]},hasParam:function(e){if(e)return!!this.parameters.hasOwnProperty(e.toLowerCase())},deleteParam:function(e){var t;if(e=e.toLowerCase(),this.parameters.hasOwnProperty(e))return t=this.parameters[e],delete this.parameters[e],t},clearParams:function(){this.parameters={}},setHeader:function(t,s){this.headers[e.Utils.headerize(t)]=s instanceof Array?s:[s]},getHeader:function(t){if(t)return this.headers[e.Utils.headerize(t)]},hasHeader:function(t){if(t)return!!this.headers.hasOwnProperty(e.Utils.headerize(t))},deleteHeader:function(t){var s;if(t=e.Utils.headerize(t),this.headers.hasOwnProperty(t))return s=this.headers[t],delete this.headers[t],s},clearHeaders:function(){this.headers={}},clone:function(){return new t(this._raw.scheme,this._raw.user,this._raw.host,this._raw.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))},toRaw:function(){return this._toString(this._raw)},toString:function(){return this._toString(this._normal)},_toString:function(t){var s,i,n,r,o=[];for(i in r=t.scheme+":",t.scheme.toLowerCase().match("^sips?$")||(r+="//"),t.user&&(r+=e.Utils.escapeUser(t.user)+"@"),r+=t.host,(t.port||0===t.port)&&(r+=":"+t.port),this.parameters)r+=";"+i,null!==this.parameters[i]&&(r+="="+this.parameters[i]);for(s in this.headers)for(n in this.headers[s])o.push(s+"="+this.headers[s][n]);return o.length>0&&(r+="?"+o.join("&")),r}},t.parse=function(t){return-1!==(t=e.Grammar.parse(t,"SIP_URI"))?t:void 0},e.URI=t}},function(e,t,s){"use strict";e.exports=function(e){var t;(t=function(t,s,i){var n;if(!(t&&t instanceof e.URI))throw new TypeError('missing or invalid "uri" parameter');for(n in this.uri=t,this.parameters={},i)this.setParam(n,i[n]);Object.defineProperties(this,{friendlyName:{get:function(){return this.displayName||t.aor}},displayName:{get:function(){return s},set:function(e){s=0===e?"0":e}}})}).prototype={setParam:function(e,t){e&&(this.parameters[e.toLowerCase()]=null==t?null:t.toString())},getParam:e.URI.prototype.getParam,hasParam:e.URI.prototype.hasParam,deleteParam:e.URI.prototype.deleteParam,clearParams:e.URI.prototype.clearParams,clone:function(){return new t(this.uri.clone(),this.displayName,JSON.parse(JSON.stringify(this.parameters)))},toString:function(){var e,t;for(t in e=this.displayName||0===this.displayName?'"'+this.displayName+'" ':"",e+="<"+this.uri.toString()+">",this.parameters)e+=";"+t,null!==this.parameters[t]&&(e+="="+this.parameters[t]);return e}},t.parse=function(t){return-1!==(t=e.Grammar.parse(t,"Name_Addr_Header"))?t:void 0},e.NameAddrHeader=t}},function(e,t,s){"use strict";e.exports=function(e){var t={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"};function s(e,t,s){var i;return i="SIP/2.0/"+(e.ua.configuration.hackViaTcp?"TCP":t.server.scheme),i+=" "+e.ua.configuration.viaHost+";branch="+s,e.ua.configuration.forceRport&&(i+=";rport"),i}var i=function(e,i,n){var r;this.type=t.NON_INVITE_CLIENT,this.transport=n,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=i,this.logger=e.ua.getLogger("sip.transaction.nict",this.id),r=s(e,n,this.id),this.request.setHeader("via",r),this.request_sender.ua.newTransaction(this)};(i.prototype=Object.create(e.EventEmitter.prototype)).stateChanged=function(e){this.state=e,this.emit("stateChanged")},i.prototype.send=function(){this.stateChanged(t.STATUS_TRYING),this.F=e.Timers.setTimeout(this.timer_F.bind(this),e.Timers.TIMER_F),this.transport.send(this.request).catch(function(){this.onTransportError()}.bind(this))},i.prototype.onTransportError=function(){this.logger.log("transport error occurred, deleting non-INVITE client transaction "+this.id),e.Timers.clearTimeout(this.F),e.Timers.clearTimeout(this.K),this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onTransportError()},i.prototype.timer_F=function(){this.logger.debug("Timer F expired for non-INVITE client transaction "+this.id),this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout()},i.prototype.timer_K=function(){this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},i.prototype.receiveResponse=function(s){var i=s.status_code;if(i<200)switch(this.state){case t.STATUS_TRYING:case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_PROCEEDING),this.request_sender.receiveResponse(s)}else switch(this.state){case t.STATUS_TRYING:case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_COMPLETED),e.Timers.clearTimeout(this.F),408===i?this.request_sender.onRequestTimeout():this.request_sender.receiveResponse(s),this.K=e.Timers.setTimeout(this.timer_K.bind(this),e.Timers.TIMER_K)}};var n=function(e,i,n){var r,o=this;this.type=t.INVITE_CLIENT,this.transport=n,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=i,this.logger=e.ua.getLogger("sip.transaction.ict",this.id),r=s(e,n,this.id),this.request.setHeader("via",r),this.request_sender.ua.newTransaction(this),this.request.cancel=function(e,t){for(var s=(t=(t||[]).slice()).length,i=null,n=0;n<s;n++)i=(i||"")+t[n].trim()+"\r\n";o.cancel_request(o,e,i)}};(n.prototype=Object.create(e.EventEmitter.prototype)).stateChanged=function(e){this.state=e,this.emit("stateChanged")},n.prototype.send=function(){this.stateChanged(t.STATUS_CALLING),this.B=e.Timers.setTimeout(this.timer_B.bind(this),e.Timers.TIMER_B),this.transport.send(this.request).catch(function(){this.onTransportError()}.bind(this))},n.prototype.onTransportError=function(){this.logger.log("transport error occurred, deleting INVITE client transaction "+this.id),e.Timers.clearTimeout(this.B),e.Timers.clearTimeout(this.D),e.Timers.clearTimeout(this.M),this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.state!==t.STATUS_ACCEPTED&&this.request_sender.onTransportError()},n.prototype.timer_M=function(){this.logger.debug("Timer M expired for INVITE client transaction "+this.id),this.state===t.STATUS_ACCEPTED&&(e.Timers.clearTimeout(this.B),this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this))},n.prototype.timer_B=function(){this.logger.debug("Timer B expired for INVITE client transaction "+this.id),this.state===t.STATUS_CALLING&&(this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout())},n.prototype.timer_D=function(){this.logger.debug("Timer D expired for INVITE client transaction "+this.id),e.Timers.clearTimeout(this.B),this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},n.prototype.sendACK=function(t){var s,i=this;t=t||{},s=this.response.getHeader("contact")?this.response.parseHeader("contact").uri:this.request.ruri;var n=new e.OutgoingRequest("ACK",s,this.request.ua,{cseq:this.response.cseq,call_id:this.response.call_id,from_uri:this.response.from.uri,from_tag:this.response.from_tag,to_uri:this.response.to.uri,to_tag:this.response.to_tag,route_set:this.response.getHeaders("record-route").reverse()},t.extraHeaders||[],t.body);return this.ackSender=new e.RequestSender({request:n,onRequestTimeout:this.request_sender.applicant.applicant?this.request_sender.applicant.applicant.onRequestTimeout:function(){i.logger.warn("ACK Request timed out")},onTransportError:this.request_sender.applicant.applicant?this.request_sender.applicant.applicant.onRequestTransportError:function(){i.logger.warn("ACK Request had a transport error")},receiveResponse:t.receiveResponse||function(){i.logger.warn("Received a response to an ACK which was unexpected. Dropping Response.")}},this.request.ua).send(),n},n.prototype.cancel_request=function(s,i,n){var r=s.request;this.cancel=e.C.CANCEL+" "+r.ruri+" SIP/2.0\r\n",this.cancel+="Via: "+r.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.cancel+="Route: "+r.headers.Route.toString()+"\r\n"),this.cancel+="To: "+r.headers.To.toString()+"\r\n",this.cancel+="From: "+r.headers.From.toString()+"\r\n",this.cancel+="Call-ID: "+r.headers["Call-ID"].toString()+"\r\n",this.cancel+="Max-Forwards: "+e.UA.C.MAX_FORWARDS+"\r\n",this.cancel+="CSeq: "+r.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n",i&&(this.cancel+="Reason: "+i+"\r\n"),n&&(this.cancel+=n),this.cancel+="Content-Length: 0\r\n\r\n",this.state===t.STATUS_PROCEEDING&&this.transport.send(this.cancel)},n.prototype.receiveResponse=function(s){var i=s.status_code;if(s.transaction=this,this.response&&this.response.status_code===s.status_code&&this.response.cseq===s.cseq)return this.logger.debug("ICT Received a retransmission for cseq: "+s.cseq),void(this.ackSender&&this.ackSender.send());if(this.response=s,i>=100&&i<=199)switch(this.state){case t.STATUS_CALLING:this.stateChanged(t.STATUS_PROCEEDING),this.request_sender.receiveResponse(s),this.cancel&&this.transport.send(this.cancel);break;case t.STATUS_PROCEEDING:this.request_sender.receiveResponse(s)}else if(i>=200&&i<=299)switch(this.state){case t.STATUS_CALLING:case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_ACCEPTED),this.M=e.Timers.setTimeout(this.timer_M.bind(this),e.Timers.TIMER_M),this.request_sender.receiveResponse(s);break;case t.STATUS_ACCEPTED:this.request_sender.receiveResponse(s)}else if(i>=300&&i<=699)switch(this.state){case t.STATUS_CALLING:case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_COMPLETED),this.sendACK(),this.request_sender.receiveResponse(s);break;case t.STATUS_COMPLETED:this.sendACK()}};var r=function(e,t,i){var n;this.transport=i,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=t,this.logger=e.ua.getLogger("sip.transaction.nict",this.id),n=s(e,i,this.id),this.request.setHeader("via",n)};(r.prototype=Object.create(e.EventEmitter.prototype)).send=function(){this.transport.send(this.request).catch(function(){this.onTransportError()}.bind(this))},r.prototype.onTransportError=function(){this.logger.log("transport error occurred, for an ACK client transaction "+this.id),this.request_sender.onTransportError()};var o=function(e,s){this.type=t.NON_INVITE_SERVER,this.id=e.via_branch,this.request=e,this.transport=s.transport,this.ua=s,this.last_response="",e.server_transaction=this,this.logger=s.getLogger("sip.transaction.nist",this.id),this.state=t.STATUS_TRYING,s.newTransaction(this)};(o.prototype=Object.create(e.EventEmitter.prototype)).stateChanged=function(e){this.state=e,this.emit("stateChanged")},o.prototype.timer_J=function(){this.logger.debug("Timer J expired for non-INVITE server transaction "+this.id),this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this)},o.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,this.logger.log("transport error occurred, deleting non-INVITE server transaction "+this.id),e.Timers.clearTimeout(this.J),this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this))},o.prototype.receiveResponse=function(s,i){var n=e.Utils.defer();if(100===s)switch(this.state){case t.STATUS_TRYING:this.stateChanged(t.STATUS_PROCEEDING),this.transport.send(i).catch(function(){this.onTransportError()}.bind(this));break;case t.STATUS_PROCEEDING:this.last_response=i,this.transport.send(i).then((function(){n.resolve()})).catch(function(){this.onTransportError(),n.reject()}.bind(this))}else if(s>=200&&s<=699)switch(this.state){case t.STATUS_TRYING:case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_COMPLETED),this.last_response=i,this.J=e.Timers.setTimeout(this.timer_J.bind(this),e.Timers.TIMER_J),this.transport.send(i).then((function(){n.resolve()})).catch(function(){this.onTransportError(),n.reject()}.bind(this))}return n.promise};var a=function(e,s){this.type=t.INVITE_SERVER,this.id=e.via_branch,this.request=e,this.transport=s.transport,this.ua=s,this.last_response="",e.server_transaction=this,this.logger=s.getLogger("sip.transaction.ist",this.id),this.state=t.STATUS_PROCEEDING,s.newTransaction(this),this.resendProvisionalTimer=null,e.reply(100)};(a.prototype=Object.create(e.EventEmitter.prototype)).stateChanged=function(e){this.state=e,this.emit("stateChanged")},a.prototype.timer_H=function(){this.logger.debug("Timer H expired for INVITE server transaction "+this.id),this.state===t.STATUS_COMPLETED&&this.logger.warn("transactions","ACK for INVITE server transaction was never received, call will be terminated"),this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this)},a.prototype.timer_I=function(){this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this)},a.prototype.timer_L=function(){this.logger.debug("Timer L expired for INVITE server transaction "+this.id),this.state===t.STATUS_ACCEPTED&&(this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this))},a.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,this.logger.log("transport error occurred, deleting INVITE server transaction "+this.id),null!==this.resendProvisionalTimer&&(e.Timers.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),e.Timers.clearTimeout(this.L),e.Timers.clearTimeout(this.H),e.Timers.clearTimeout(this.I),this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this))},a.prototype.resend_provisional=function(){this.transport.send(this.request).catch(function(){this.onTransportError()}.bind(this))},a.prototype.receiveResponse=function(s,i){var n=this,r=e.Utils.defer();if(s>=100&&s<=199)switch(this.state){case t.STATUS_PROCEEDING:this.transport.send(i).catch(function(){this.onTransportError()}.bind(this)),this.last_response=i}if(s>100&&s<=199&&this.state===t.STATUS_PROCEEDING)null===this.resendProvisionalTimer&&(this.resendProvisionalTimer=e.Timers.setInterval(n.resend_provisional.bind(n),e.Timers.PROVISIONAL_RESPONSE_INTERVAL));else if(s>=200&&s<=299)switch(this.state){case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_ACCEPTED),this.last_response=i,this.L=e.Timers.setTimeout(n.timer_L.bind(n),e.Timers.TIMER_L),null!==this.resendProvisionalTimer&&(e.Timers.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case t.STATUS_ACCEPTED:this.transport.send(i).then((function(){r.resolve()})).catch(function(e){this.logger.error(e),this.onTransportError(),r.reject()}.bind(this))}else if(s>=300&&s<=699)switch(this.state){case t.STATUS_PROCEEDING:null!==this.resendProvisionalTimer&&(e.Timers.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(i).then(function(){this.stateChanged(t.STATUS_COMPLETED),this.H=e.Timers.setTimeout(n.timer_H.bind(n),e.Timers.TIMER_H),r.resolve()}.bind(this)).catch(function(e){this.logger.error(e),this.onTransportError(),r.reject()}.bind(this))}return r.promise},e.Transactions={C:t,checkTransaction:function(s,i){var n;switch(i.method){case e.C.INVITE:if(n=s.transactions.ist[i.via_branch]){switch(n.state){case t.STATUS_PROCEEDING:n.transport.send(n.last_response)}return!0}break;case e.C.ACK:if(!(n=s.transactions.ist[i.via_branch]))return!1;if(n.state===t.STATUS_ACCEPTED)return!1;if(n.state===t.STATUS_COMPLETED)return n.stateChanged(t.STATUS_CONFIRMED),n.I=e.Timers.setTimeout(n.timer_I.bind(n),e.Timers.TIMER_I),!0;break;case e.C.CANCEL:return(n=s.transactions.ist[i.via_branch])?(i.reply_sl(200),n.state!==t.STATUS_PROCEEDING):(i.reply_sl(481),!0);default:if(n=s.transactions.nist[i.via_branch]){switch(n.state){case t.STATUS_TRYING:break;case t.STATUS_PROCEEDING:case t.STATUS_COMPLETED:n.transport.send(n.last_response)}return!0}}},NonInviteClientTransaction:i,InviteClientTransaction:n,AckClientTransaction:r,NonInviteServerTransaction:o,InviteServerTransaction:a}}},function(e,t,s){"use strict";e.exports=function(e){var t,i=s(17)(e),n={STATUS_EARLY:1,STATUS_CONFIRMED:2};(t=function(t,s,i,r){var o;if(this.uac_pending_reply=!1,this.uas_pending_reply=!1,!s.hasHeader("contact"))return{error:"unable to create a Dialog without Contact header field"};r=s instanceof e.IncomingResponse?s.status_code<200?n.STATUS_EARLY:n.STATUS_CONFIRMED:r||n.STATUS_CONFIRMED,o=s.parseHeader("contact"),"UAS"===i?(this.id={call_id:s.call_id,local_tag:s.to_tag,remote_tag:s.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=r,this.remote_seqnum=s.cseq,this.local_uri=s.parseHeader("to").uri,this.remote_uri=s.parseHeader("from").uri,this.remote_target=o.uri,this.route_set=s.getHeaders("record-route"),this.invite_seqnum=s.cseq,this.local_seqnum=s.cseq):"UAC"===i&&(this.id={call_id:s.call_id,local_tag:s.from_tag,remote_tag:s.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=r,this.invite_seqnum=s.cseq,this.local_seqnum=s.cseq,this.local_uri=s.parseHeader("from").uri,this.pracked=[],this.remote_uri=s.parseHeader("to").uri,this.remote_target=o.uri,this.route_set=s.getHeaders("record-route").reverse()),this.logger=t.ua.getLogger("sip.dialog",this.id.toString()),this.owner=t,t.ua.dialogs[this.id.toString()]=this,this.logger.log("new "+i+" dialog created with status "+(this.state===n.STATUS_EARLY?"EARLY":"CONFIRMED")),t.emit("dialog",this)}).prototype={update:function(e,t){this.state=n.STATUS_CONFIRMED,this.logger.log("dialog "+this.id.toString()+"  changed to CONFIRMED state"),"UAC"===t&&(this.route_set=e.getHeaders("record-route").reverse())},terminate:function(){this.logger.log("dialog "+this.id.toString()+" deleted"),this.sessionDescriptionHandler&&this.state!==n.STATUS_CONFIRMED&&this.sessionDescriptionHandler.close(),delete this.owner.ua.dialogs[this.id.toString()]},createRequest:function(t,s,i){var n,r;return s=(s||[]).slice(),this.local_seqnum||(this.local_seqnum=Math.floor(1e4*Math.random())),n=t===e.C.CANCEL||t===e.C.ACK?this.invite_seqnum:this.local_seqnum+=1,(r=new e.OutgoingRequest(t,this.remote_target,this.owner.ua,{cseq:n,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set},s,i)).dialog=this,r},checkInDialogRequest:function(t){var s=this;if(this.remote_seqnum){if(t.cseq<this.remote_seqnum)return t.method!==e.C.ACK&&t.reply(500),t.cseq===this.invite_seqnum}else this.remote_seqnum=t.cseq;switch(t.method){case e.C.INVITE:if(!0===this.uac_pending_reply)t.reply(491);else{if(!0===this.uas_pending_reply&&t.cseq>this.remote_seqnum){var i=1+(10*Math.random()|0);return t.reply(500,null,["Retry-After:"+i]),this.remote_seqnum=t.cseq,!1}this.uas_pending_reply=!0,t.server_transaction.on("stateChanged",(function t(){this.state!==e.Transactions.C.STATUS_ACCEPTED&&this.state!==e.Transactions.C.STATUS_COMPLETED&&this.state!==e.Transactions.C.STATUS_TERMINATED||(this.removeListener("stateChanged",t),s.uas_pending_reply=!1)}))}t.hasHeader("contact")&&t.server_transaction.on("stateChanged",(function(){this.state===e.Transactions.C.STATUS_ACCEPTED&&(s.remote_target=t.parseHeader("contact").uri)}));break;case e.C.NOTIFY:t.hasHeader("contact")&&t.server_transaction.on("stateChanged",(function(){this.state===e.Transactions.C.STATUS_COMPLETED&&(s.remote_target=t.parseHeader("contact").uri)}))}return t.cseq>this.remote_seqnum&&(this.remote_seqnum=t.cseq),!0},sendRequest:function(e,t,s){var n=((s=s||{}).extraHeaders||[]).slice(),r=null;s.body&&(s.body.body?r=s.body:((r={}).body=s.body,s.contentType&&(r.contentType=s.contentType)));var o=this.createRequest(t,n,r);return new i(this,e,o).send(),o},receiveRequest:function(e){this.checkInDialogRequest(e)&&this.owner.receiveRequest(e)}},t.C=n,e.Dialog=t}},function(e,t,s){"use strict";e.exports=function(e){var t;return(t=function(e,t,s){this.dialog=e,this.applicant=t,this.request=s,this.reattempt=!1,this.reattemptTimer=null}).prototype={send:function(){var t=this,s=new e.RequestSender(this,this.dialog.owner.ua);s.send(),this.request.method===e.C.INVITE&&s.clientTransaction.state!==e.Transactions.C.STATUS_TERMINATED&&(this.dialog.uac_pending_reply=!0,s.clientTransaction.on("stateChanged",(function s(){this.state!==e.Transactions.C.STATUS_ACCEPTED&&this.state!==e.Transactions.C.STATUS_COMPLETED&&this.state!==e.Transactions.C.STATUS_TERMINATED||(this.removeListener("stateChanged",s),t.dialog.uac_pending_reply=!1)})))},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(t){var s=this;408===t.status_code||481===t.status_code?this.applicant.onDialogError(t):t.method===e.C.INVITE&&491===t.status_code?this.reattempt?this.applicant.receiveResponse(t):(this.request.cseq.value=this.dialog.local_seqnum+=1,this.reattemptTimer=e.Timers.setTimeout((function(){s.applicant.owner.status!==e.Session.C.STATUS_TERMINATED&&(s.reattempt=!0,s.request_sender.send())}),this.getReattemptTimeout())):this.applicant.receiveResponse(t)}},t}},function(e,t,s){"use strict";e.exports=function(e){var t;(t=function(t,s){this.logger=s.getLogger("sip.requestsender"),this.ua=s,this.applicant=t,this.method=t.request.method,this.request=t.request,this.credentials=null,this.challenged=!1,this.staled=!1,s.status!==e.UA.C.STATUS_USER_CLOSED||this.method===e.C.BYE&&this.method===e.C.ACK||this.onTransportError()}).prototype={send:function(){switch(this.method){case"INVITE":this.clientTransaction=new e.Transactions.InviteClientTransaction(this,this.request,this.ua.transport);break;case"ACK":this.clientTransaction=new e.Transactions.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new e.Transactions.NonInviteClientTransaction(this,this.request,this.ua.transport)}return this.clientTransaction.send(),this.clientTransaction},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(t){var s,i,n,r=t.status_code;if(401===r||407===r){if(401===t.status_code?(i=t.parseHeader("www-authenticate"),n="authorization"):(i=t.parseHeader("proxy-authenticate"),n="proxy-authorization"),!i)return this.logger.warn(t.status_code+" with wrong or missing challenge, cannot authenticate"),void this.applicant.receiveResponse(t);if(!this.challenged||!this.staled&&!0===i.stale){if(this.credentials||(this.credentials=this.ua.configuration.authenticationFactory(this.ua)),!this.credentials.authenticate(this.request,i))return void this.applicant.receiveResponse(t);this.challenged=!0,i.stale&&(this.staled=!0),t.method===e.C.REGISTER?s=this.applicant.cseq+=1:this.request.dialog?s=this.request.dialog.local_seqnum+=1:(s=this.request.cseq+1,this.request.cseq=s),this.request.setHeader("cseq",s+" "+this.method),this.request.setHeader(n,this.credentials.toString()),this.send()}else this.applicant.receiveResponse(t)}else this.applicant.receiveResponse(t)}},e.RequestSender=t}},function(e,t,s){"use strict";e.exports=function(e){var t;(t=function(t){var s={};this.registrar=t.configuration.registrarServer,this.expires=t.configuration.registerExpires,this.contact=t.contact.toString(),this.contact+=";reg-id=1",this.contact+=';+sip.instance="<urn:uuid:'+t.configuration.instanceId+'>"',this.call_id=e.Utils.createRandomToken(22),this.cseq=Math.floor(1e4*Math.random()),this.to_uri=t.configuration.uri,s.to_uri=this.to_uri,s.to_displayName=t.configuration.displayName,s.call_id=this.call_id,s.cseq=this.cseq,e.Utils.augment(this,e.ClientContext,[t,"REGISTER",this.registrar,{params:s}]),this.registrationTimer=null,this.registrationExpiredTimer=null,this.registered=!1,this.logger=t.getLogger("sip.registercontext"),t.on("transportCreated",function(e){e.on("disconnected",this.onTransportDisconnected.bind(this))}.bind(this))}).prototype=Object.create({},{register:{writable:!0,value:function(t){var s,i=this;this.options=t||{},(s=(this.options.extraHeaders||[]).slice()).push("Contact: "+this.contact+";expires="+this.expires),s.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.closeHeaders=this.options.closeWithHeaders?(this.options.extraHeaders||[]).slice():[],this.receiveResponse=function(t){var s,n,r,o=t.getHeaders("contact").length;if(t.cseq===this.cseq)switch(null!==this.registrationTimer&&(e.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null),!0){case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",t);break;case/^2[0-9]{2}$/.test(t.status_code):if(this.emit("accepted",t),t.hasHeader("expires")&&(n=t.getHeader("expires")),null!==this.registrationExpiredTimer&&(e.Timers.clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=null),!o){this.logger.warn("no Contact header in response to REGISTER, response ignored");break}for(;o--;){if((s=t.parseHeader("contact",o)).uri.user===this.ua.contact.uri.user){n=s.getParam("expires");break}s=null}if(!s){this.logger.warn("no Contact header pointing to us, response ignored");break}n||(n=this.expires),this.registrationTimer=e.Timers.setTimeout((function(){i.registrationTimer=null,i.register(i.options)}),1e3*n-3e3),this.registrationExpiredTimer=e.Timers.setTimeout((function(){i.logger.warn("registration expired"),i.registered&&i.unregistered(null,e.C.causes.EXPIRES)}),1e3*n),s.hasParam("temp-gruu")&&(this.ua.contact.temp_gruu=e.URI.parse(s.getParam("temp-gruu").replace(/"/g,""))),s.hasParam("pub-gruu")&&(this.ua.contact.pub_gruu=e.URI.parse(s.getParam("pub-gruu").replace(/"/g,""))),this.registered=!0,this.emit("registered",t||null);break;case/^423$/.test(t.status_code):t.hasHeader("min-expires")?(this.expires=t.getHeader("min-expires"),this.register(this.options)):(this.logger.warn("423 response received for REGISTER without Min-Expires"),this.registrationFailure(t,e.C.causes.SIP_FAILURE_CODE));break;default:r=e.Utils.sipErrorCause(t.status_code),this.registrationFailure(t,r)}},this.onRequestTimeout=function(){this.registrationFailure(null,e.C.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.registrationFailure(null,e.C.causes.CONNECTION_ERROR)},this.cseq++,this.request.cseq=this.cseq,this.request.setHeader("cseq",this.cseq+" REGISTER"),this.request.extraHeaders=s,this.send()}},registrationFailure:{writable:!0,value:function(e,t){this.emit("failed",e||null,t||null)}},onTransportDisconnected:{writable:!0,value:function(){this.registered_before=this.registered,null!==this.registrationTimer&&(e.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null),null!==this.registrationExpiredTimer&&(e.Timers.clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=null),this.registered&&this.unregistered(null,e.C.causes.CONNECTION_ERROR)}},onTransportConnected:{writable:!0,value:function(){this.register(this.options)}},close:{writable:!0,value:function(){var e={all:!1,extraHeaders:this.closeHeaders};this.registered_before=this.registered,this.registered&&this.unregister(e)}},unregister:{writable:!0,value:function(t){var s;t=t||{},this.registered||t.all||this.logger.warn("Already unregistered, but sending an unregister anyways."),s=(t.extraHeaders||[]).slice(),this.registered=!1,null!==this.registrationTimer&&(e.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null),t.all?(s.push("Contact: *"),s.push("Expires: 0")):s.push("Contact: "+this.contact+";expires=0"),this.receiveResponse=function(t){var s;switch(!0){case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",t);break;case/^2[0-9]{2}$/.test(t.status_code):this.emit("accepted",t),null!==this.registrationExpiredTimer&&(e.Timers.clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=null),this.unregistered(t);break;default:s=e.Utils.sipErrorCause(t.status_code),this.unregistered(t,s)}},this.onRequestTimeout=function(){},this.cseq++,this.request.cseq=this.cseq,this.request.setHeader("cseq",this.cseq+" REGISTER"),this.request.extraHeaders=s,this.send()}},unregistered:{writable:!0,value:function(e,t){this.registered=!1,this.emit("unregistered",e||null,t||null)}}}),e.RegisterContext=t}},function(e,t,s){"use strict";e.exports=function(e){var t=function(){};return t.prototype=Object.create(e.prototype,{close:{value:function(){}},getDescription:{value:function(e,t){}},hasDescription:{value:function(e){}},holdModifier:{value:function(e){}},setDescription:{value:function(e,t,s){}},sendDtmf:{value:function(e,t){}},getDirection:{value:function(){}}}),t}},function(e,t,s){"use strict";e.exports=function(e){var t;((t=function(t,s,i,n){var r=i;if(void 0===i)throw new TypeError("Not enough arguments");if(this.ua=t,this.logger=t.getLogger("sip.clientcontext"),this.method=s,!(i=t.normalizeTarget(i)))throw new TypeError("Invalid target: "+r);(n=Object.create(n||Object.prototype)).extraHeaders=(n.extraHeaders||[]).slice(),this.request=new e.OutgoingRequest(this.method,i,this.ua,n.params,n.extraHeaders),n.body&&(this.body={},this.body.body=n.body,n.contentType&&(this.body.contentType=n.contentType),this.request.body=this.body),this.localIdentity=this.request.from,this.remoteIdentity=this.request.to,this.data={}}).prototype=Object.create(e.EventEmitter.prototype)).send=function(){return new e.RequestSender(this,this.ua).send(),this},t.prototype.cancel=function(t){(t=t||{}).extraHeaders=(t.extraHeaders||[]).slice();var s=e.Utils.getCancelReason(t.status_code,t.reason_phrase);this.request.cancel(s,t.extraHeaders),this.emit("cancel")},t.prototype.receiveResponse=function(t){var s=e.Utils.getReasonPhrase(t.status_code);switch(!0){case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",t,s);break;case/^2[0-9]{2}$/.test(t.status_code):this.ua.applicants[this]&&delete this.ua.applicants[this],this.emit("accepted",t,s);break;default:this.ua.applicants[this]&&delete this.ua.applicants[this],this.emit("rejected",t,s),this.emit("failed",t,s)}},t.prototype.onRequestTimeout=function(){this.emit("failed",null,e.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){this.emit("failed",null,e.C.causes.CONNECTION_ERROR)},e.ClientContext=t}},function(e,t,s){"use strict";e.exports=function(e){var t;((t=function(t,s){this.ua=t,this.logger=t.getLogger("sip.servercontext"),this.request=s,s.method===e.C.INVITE?this.transaction=new e.Transactions.InviteServerTransaction(s,t):this.transaction=new e.Transactions.NonInviteServerTransaction(s,t),s.body&&(this.body=s.body),s.hasHeader("Content-Type")&&(this.contentType=s.getHeader("Content-Type")),this.method=s.method,this.data={},this.localIdentity=s.to,this.remoteIdentity=s.from,s.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=new e.NameAddrHeader.parse(s.getHeader("P-Asserted-Identity")))}).prototype=Object.create(e.EventEmitter.prototype)).progress=function(e){return(e=Object.create(e||Object.prototype)).statusCode||(e.statusCode=180),e.minCode=100,e.maxCode=199,e.events=["progress"],this.reply(e)},t.prototype.accept=function(e){return(e=Object.create(e||Object.prototype)).statusCode||(e.statusCode=200),e.minCode=200,e.maxCode=299,e.events=["accepted"],this.reply(e)},t.prototype.reject=function(e){return(e=Object.create(e||Object.prototype)).statusCode||(e.statusCode=480),e.minCode=300,e.maxCode=699,e.events=["rejected","failed"],this.reply(e)},t.prototype.reply=function(t){var s,i=(t=t||{}).statusCode||100,n=t.minCode||100,r=t.maxCode||699,o=e.Utils.getReasonPhrase(i,t.reasonPhrase),a=t.extraHeaders||[],c=t.body,u=t.events||[];if(i<n||i>r)throw new TypeError("Invalid statusCode: "+i);return s=this.request.reply(i,o,a,c),u.forEach((function(e){this.emit(e,s,o)}),this),this},t.prototype.onRequestTimeout=function(){this.emit("failed",null,e.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){this.emit("failed",null,e.C.causes.CONNECTION_ERROR)},e.ServerContext=t}},function(e,t,s){"use strict";e.exports=function(e){var t,i,n,r,o,a=s(24)(e),c={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_PRACK:6,STATUS_WAITING_FOR_ACK:7,STATUS_CANCELED:8,STATUS_TERMINATED:9,STATUS_ANSWERED_WAITING_FOR_PRACK:10,STATUS_EARLY_MEDIA:11,STATUS_CONFIRMED:12};(t=function(t){if(this.status=c.STATUS_NULL,this.dialog=null,this.pendingReinvite=!1,this.earlyDialogs={},!t)throw new e.Exceptions.SessionDescriptionHandlerMissing("A session description handler is required for the session to function");this.sessionDescriptionHandlerFactory=t,this.hasOffer=!1,this.hasAnswer=!1,this.timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null,rel1xxTimer:null,prackTimer:null},this.startTime=null,this.endTime=null,this.tones=null,this.local_hold=!1,this.early_sdp=null,this.rel100=e.C.supported.UNSUPPORTED}).prototype={dtmf:function(t,s){var i=[],n=this,r=this.ua.configuration.dtmfType;if(s=s||{},void 0===t)throw new TypeError("Not enough arguments");if(this.status!==c.STATUS_CONFIRMED&&this.status!==c.STATUS_WAITING_FOR_ACK)throw new e.Exceptions.InvalidStateError(this.status);if("string"!=typeof t&&"number"!=typeof t||!t.toString().match(/^[0-9A-D#*,]+$/i))throw new TypeError("Invalid tones: "+t);var o=function(){var t,i;if(n.status===c.STATUS_TERMINATED||!n.tones||0===n.tones.length)return n.tones=null,this;(t=n.tones.shift()).on("failed",(function(){n.tones=null})),t.send(s),i=t.duration+t.interToneGap,e.Timers.setTimeout(o,i)};if(t=t.toString(),r===e.C.dtmfType.RTP&&(this.sessionDescriptionHandler.sendDtmf(t,s)||(this.logger.warn("Attempt to use dtmfType 'RTP' has failed, falling back to INFO packet method"),r=e.C.dtmfType.INFO)),r===e.C.dtmfType.INFO){for(t=t.split("");t.length>0;)i.push(new a(this,t.shift(),s));if(this.tones)return this.tones=this.tones.concat(i),this;this.tones=i,o()}return this},bye:function(t){var s=(t=Object.create(t||Object.prototype)).statusCode;if(this.status===c.STATUS_TERMINATED)return this.logger.error("Error: Attempted to send BYE in a terminated session."),this;if(this.logger.log("terminating Session"),s&&(s<200||s>=700))throw new TypeError("Invalid statusCode: "+s);return t.receiveResponse=function(){},this.sendRequest(e.C.BYE,t).terminated()},refer:function(t,s){if(s=s||{},this.status!==c.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);this.referContext=new e.ReferClientContext(this.ua,this,t,s),this.emit("referRequested",this.referContext),this.referContext.refer(s)},sendRequest:function(t,s){s=s||{};var i=this,n=new e.OutgoingRequest(t,this.dialog.remote_target,this.ua,{cseq:s.cseq||(this.dialog.local_seqnum+=1),call_id:this.dialog.id.call_id,from_uri:this.dialog.local_uri,from_tag:this.dialog.id.local_tag,to_uri:this.dialog.remote_uri,to_tag:this.dialog.id.remote_tag,route_set:this.dialog.route_set,statusCode:s.statusCode,reasonPhrase:s.reasonPhrase},s.extraHeaders||[],s.body);return new e.RequestSender({request:n,onRequestTimeout:function(){i.onRequestTimeout()},onTransportError:function(){i.onTransportError()},receiveResponse:s.receiveResponse||function(e){i.receiveNonInviteResponse(e)}},this.ua).send(),this.emit(t.toLowerCase(),n),this},close:function(){var t;if(this.status===c.STATUS_TERMINATED)return this;for(t in this.logger.log("closing INVITE session "+this.id),this.sessionDescriptionHandler&&this.sessionDescriptionHandler.close(),this.timers)e.Timers.clearTimeout(this.timers[t]);for(t in this.dialog&&(this.dialog.terminate(),delete this.dialog),this.earlyDialogs)this.earlyDialogs[t].terminate(),delete this.earlyDialogs[t];return this.status=c.STATUS_TERMINATED,this.ua.transport.removeListener("transportError",this.errorListener),delete this.ua.sessions[this.id],this},createDialog:function(t,s,i){var n,r,o=t["UAS"===s?"to_tag":"from_tag"],a=t["UAS"===s?"from_tag":"to_tag"],c=t.call_id+o+a;if(r=this.earlyDialogs[c],i)return!!r||((r=new e.Dialog(this,t,s,e.Dialog.C.STATUS_EARLY)).error?(this.logger.error(r.error),this.failed(t,e.C.causes.INTERNAL_ERROR),!1):(this.earlyDialogs[c]=r,!0));if(r){for(var u in r.update(t,s),this.dialog=r,delete this.earlyDialogs[c],this.earlyDialogs)this.earlyDialogs[u].terminate(),delete this.earlyDialogs[u];return!0}return(n=new e.Dialog(this,t,s)).error?(this.logger.error(n.error),this.failed(t,e.C.causes.INTERNAL_ERROR),!1):(this.to_tag=t.to_tag,this.dialog=n,!0)},hold:function(t,s){if(this.status!==c.STATUS_WAITING_FOR_ACK&&this.status!==c.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);this.local_hold?this.logger.log("Session is already on hold, cannot put it on hold again"):((t=t||{}).modifiers=s||[],t.modifiers.push(this.sessionDescriptionHandler.holdModifier),this.local_hold=!0,this.sendReinvite(t))},unhold:function(t,s){if(this.status!==c.STATUS_WAITING_FOR_ACK&&this.status!==c.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);this.local_hold?(t=t||{},s&&(t.modifiers=s),this.local_hold=!1,this.sendReinvite(t)):this.logger.log("Session is not on hold, cannot unhold it")},reinvite:function(e,t){return e=e||{},t&&(e.modifiers=t),this.sendReinvite(e)},receiveReinvite:function(t){var s,i=this;if(i.emit("reinvite",this),t.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=new e.NameAddrHeader.parse(t.getHeader("P-Asserted-Identity"))),"0"!==t.getHeader("Content-Length")||t.getHeader("Content-Type")){if(!this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type")))return t.reply(415),void this.emit("reinviteFailed",i);s=this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(this.sessionDescriptionHandler.getDescription.bind(this.sessionDescriptionHandler,this.sessionDescriptionHandlerOptions,this.modifiers))}else s=this.sessionDescriptionHandler.getDescription(this.sessionDescriptionHandlerOptions,this.modifiers);this.receiveRequest=function(t){t.method===e.C.ACK&&this.status===c.STATUS_WAITING_FOR_ACK?this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type"))?(this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){e.Timers.clearTimeout(this.timers.ackTimer),e.Timers.clearTimeout(this.timers.invite2xxTimer),this.status=c.STATUS_CONFIRMED,this.emit("confirmed",t)}.bind(this))):(e.Timers.clearTimeout(this.timers.ackTimer),e.Timers.clearTimeout(this.timers.invite2xxTimer),this.status=c.STATUS_CONFIRMED,this.emit("confirmed",t)):e.Session.prototype.receiveRequest.apply(this,[t])}.bind(this),s.catch((function(s){var n;throw s instanceof e.Exceptions.SessionDescriptionHandlerError?n=500:s instanceof e.Exceptions.RenegotiationError?(i.emit("renegotiationError",s),i.logger.warn(s),n=488):(i.logger.error(s),n=488),t.reply(n),i.emit("reinviteFailed",i),s})).then((function(e){var s=["Contact: "+i.contact];t.reply(200,null,s,e,(function(){i.status=c.STATUS_WAITING_FOR_ACK,i.setACKTimer(),i.emit("reinviteAccepted",i)}))}))},sendReinvite:function(t){if(this.pendingReinvite)this.logger.warn("Reinvite in progress. Please wait until complete, then try again.");else{this.pendingReinvite=!0,(t=t||{}).modifiers=t.modifiers||[];var s=this,i=(t.extraHeaders||[]).slice();i.push("Contact: "+this.contact),i.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.sessionDescriptionHandler.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers).then((function(t){s.sendRequest(e.C.INVITE,{extraHeaders:i,body:t,receiveResponse:s.receiveReinviteResponse.bind(s)})})).catch((function(t){if(t instanceof e.Exceptions.RenegotiationError)return s.pendingReinvite=!1,s.emit("renegotiationError",t),s.logger.warn("Renegotiation Error"),void s.logger.warn(t);s.logger.error("sessionDescriptionHandler error"),s.logger.error(t)}))}},receiveRequest:function(t){switch(t.method){case e.C.BYE:t.reply(200),this.status===c.STATUS_CONFIRMED&&(this.emit("bye",t),this.terminated(t,e.C.causes.BYE));break;case e.C.INVITE:this.status===c.STATUS_CONFIRMED&&(this.logger.log("re-INVITE received"),this.receiveReinvite(t));break;case e.C.INFO:if(this.status===c.STATUS_CONFIRMED||this.status===c.STATUS_WAITING_FOR_ACK){if(this.onInfo)return this.onInfo(t);var s,i,n,r=t.getHeader("content-type"),o=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,u=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;r&&(r.match(/^application\/dtmf-relay/i)?(t.body&&2===(s=t.body.split("\r\n",2)).length&&(o.test(s[0])&&(i=s[0].replace(o,"$2")),u.test(s[1])&&(n=parseInt(s[1].replace(u,"$2"),10))),new a(this,i,{duration:n}).init_incoming(t)):t.reply(415,null,["Accept: application/dtmf-relay"]))}break;case e.C.REFER:if(this.status===c.STATUS_CONFIRMED)if(this.logger.log("REFER received"),this.referContext=new e.ReferServerContext(this.ua,t),this.listeners("referRequested").length)this.emit("referRequested",this.referContext);else{this.logger.log("No referRequested listeners, automatically accepting and following the refer");var h={followRefer:!0};this.passedOptions&&(h.inviteOptions=this.passedOptions),this.referContext.accept(h,this.modifiers)}break;case e.C.NOTIFY:if(this.referContext&&this.referContext instanceof e.ReferClientContext&&t.hasHeader("event")&&/^refer(;.*)?$/.test(t.getHeader("event")))return void this.referContext.receiveNotify(t);t.reply(200,"OK"),this.emit("notify",t)}},receiveReinviteResponse:function(t){var s=this;if(this.status!==c.STATUS_TERMINATED)if(this.pendingReinvite)switch(!0){case/^1[0-9]{2}$/.test(t.status_code):break;case/^2[0-9]{2}$/.test(t.status_code):if(this.status=c.STATUS_CONFIRMED,this.emit("ack",t.transaction.sendACK()),this.pendingReinvite=!1,e.Timers.clearTimeout(s.timers.invite2xxTimer),!this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type"))){this.logger.error("2XX response received to re-invite but did not have a description"),this.emit("reinviteFailed",s),this.emit("renegotiationError",new e.Exceptions.RenegotiationError("2XX response received to re-invite but did not have a description"));break}this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).catch((function(t){s.logger.error("Could not set the description in 2XX response"),s.logger.error(t),s.emit("reinviteFailed",s),s.emit("renegotiationError",t),s.sendRequest(e.C.BYE,{extraHeaders:["Reason: "+e.Utils.getReasonHeaderValue(488,"Not Acceptable Here")]}),s.terminated(null,e.C.causes.INCOMPATIBLE_SDP)})).then((function(){s.emit("reinviteAccepted",s)}));break;default:this.pendingReinvite=!1,this.logger.log("Received a non 1XX or 2XX response to a re-invite"),this.emit("reinviteFailed",s),this.emit("renegotiationError",new e.Exceptions.RenegotiationError("Invalid response to a re-invite"))}else this.logger.error("Received reinvite response, but have no pending reinvite");else this.logger.error("Received reinvite response, but in STATUS_TERMINATED")},acceptAndTerminate:function(t,s,i){var n=[];return s&&n.push("Reason: "+e.Utils.getReasonHeaderValue(s,i)),(this.dialog||this.createDialog(t,"UAC"))&&(this.emit("ack",t.transaction.sendACK()),this.sendRequest(e.C.BYE,{extraHeaders:n})),this},setInvite2xxTimer:function(t,s){var i=this,n=e.Timers.T1;this.timers.invite2xxTimer=e.Timers.setTimeout((function r(){if(i.status===c.STATUS_WAITING_FOR_ACK){i.logger.log("no ACK received, attempting to retransmit OK");var o=["Contact: "+i.contact];t.reply(200,null,o,s),n=Math.min(2*n,e.Timers.T2),i.timers.invite2xxTimer=e.Timers.setTimeout(r,n)}}),n)},setACKTimer:function(){var t=this;this.timers.ackTimer=e.Timers.setTimeout((function(){t.status===c.STATUS_WAITING_FOR_ACK&&(t.logger.log("no ACK received for an extended period of time, terminating the call"),e.Timers.clearTimeout(t.timers.invite2xxTimer),t.sendRequest(e.C.BYE),t.terminated(null,e.C.causes.NO_ACK))}),e.Timers.TIMER_H)},onTransportError:function(){this.status!==c.STATUS_CONFIRMED&&this.status!==c.STATUS_TERMINATED&&this.failed(null,e.C.causes.CONNECTION_ERROR)},onRequestTimeout:function(){this.status===c.STATUS_CONFIRMED?this.terminated(null,e.C.causes.REQUEST_TIMEOUT):this.status!==c.STATUS_TERMINATED&&(this.failed(null,e.C.causes.REQUEST_TIMEOUT),this.terminated(null,e.C.causes.REQUEST_TIMEOUT))},onDialogError:function(t){this.status===c.STATUS_CONFIRMED?this.terminated(t,e.C.causes.DIALOG_ERROR):this.status!==c.STATUS_TERMINATED&&(this.failed(t,e.C.causes.DIALOG_ERROR),this.terminated(t,e.C.causes.DIALOG_ERROR))},failed:function(e,t){return this.status===c.STATUS_TERMINATED||this.emit("failed",e||null,t||null),this},rejected:function(e,t){return this.emit("rejected",e||null,t||null),this},canceled:function(){return this.sessionDescriptionHandler&&this.sessionDescriptionHandler.close(),this.emit("cancel"),this},accepted:function(t,s){return s=e.Utils.getReasonPhrase(t&&t.status_code,s),this.startTime=new Date,this.replacee&&(this.replacee.emit("replaced",this),this.replacee.terminate()),this.emit("accepted",t,s),this},terminated:function(e,t){return this.status===c.STATUS_TERMINATED||(this.endTime=new Date,this.close(),this.emit("terminated",e||null,t||null)),this},connecting:function(e){return this.emit("connecting",{request:e}),this}},t.C=c,e.Session=t,(i=function(t,s){var i,n=this,r=s.getHeader("Content-Type"),o=s.parseHeader("Content-Disposition");function a(e,t){s.hasHeader(e)&&s.getHeader(e).toLowerCase().indexOf("100rel")>=0&&(n.rel100=t)}if(e.Utils.augment(this,e.ServerContext,[t,s]),e.Utils.augment(this,e.Session,[t.configuration.sessionDescriptionHandlerFactory]),o&&"render"===o.type&&(this.renderbody=s.body,this.rendertype=r),this.status=c.STATUS_INVITE_RECEIVED,this.from_tag=s.from_tag,this.id=s.call_id+this.from_tag,this.request=s,this.contact=this.ua.contact.toString(),this.receiveNonInviteResponse=function(){},this.logger=t.getLogger("sip.inviteservercontext",this.id),this.ua.sessions[this.id]=this,s.hasHeader("expires")&&(i=1e3*s.getHeader("expires")),a("require",e.C.supported.REQUIRED),a("supported",e.C.supported.SUPPORTED),s.to_tag=e.Utils.newTag(),this.createDialog(s,"UAS",!0)){var u={extraHeaders:["Contact: "+n.contact]};n.rel100!==e.C.supported.REQUIRED&&n.progress(u),n.status=c.STATUS_WAITING_FOR_ANSWER,n.timers.userNoAnswerTimer=e.Timers.setTimeout((function(){s.reply(408),n.failed(s,e.C.causes.NO_ANSWER),n.terminated(s,e.C.causes.NO_ANSWER)}),n.ua.configuration.noAnswerTimeout),i&&(n.timers.expiresTimer=e.Timers.setTimeout((function(){n.status===c.STATUS_WAITING_FOR_ANSWER&&(s.reply(487),n.failed(s,e.C.causes.EXPIRES),n.terminated(s,e.C.causes.EXPIRES))}),i)),this.errorListener=this.onTransportError.bind(this),t.transport.on("transportError",this.errorListener)}else s.reply(500,"Missing Contact header field")}).prototype=Object.create({},{reject:{writable:!0,value:function(t){if(this.status===c.STATUS_TERMINATED)throw new e.Exceptions.InvalidStateError(this.status);return this.logger.log("rejecting RTCSession"),e.ServerContext.prototype.reject.call(this,t),this.terminated()}},terminate:{writable:!0,value:function(t){var s,i=((t=t||{}).extraHeaders||[]).slice(),n=t.body,r=this;return this.status===c.STATUS_WAITING_FOR_ACK&&this.request.server_transaction.state!==e.Transactions.C.STATUS_TERMINATED?(s=this.dialog,this.receiveRequest=function(t){t.method===e.C.ACK&&(this.sendRequest(e.C.BYE,{extraHeaders:i,body:n}),s.terminate())},this.request.server_transaction.on("stateChanged",(function(){this.state===e.Transactions.C.STATUS_TERMINATED&&this.dialog&&(this.request=new e.OutgoingRequest(e.C.BYE,this.dialog.remote_target,this.ua,{cseq:this.dialog.local_seqnum+=1,call_id:this.dialog.id.call_id,from_uri:this.dialog.local_uri,from_tag:this.dialog.id.local_tag,to_uri:this.dialog.remote_uri,to_tag:this.dialog.id.remote_tag,route_set:this.dialog.route_set},i,n),new e.RequestSender({request:this.request,onRequestTimeout:function(){r.onRequestTimeout()},onTransportError:function(){r.onTransportError()},receiveResponse:function(){}},this.ua).send(),s.terminate())})),this.emit("bye",this.request),this.terminated(),this.dialog=s,this.ua.dialogs[s.id.toString()]=s):this.status===c.STATUS_CONFIRMED?this.bye(t):this.reject(t),this}},progress:{writable:!0,value:function(t){var s,i=(t=t||{}).statusCode||180,n=t.reasonPhrase,r=(t.extraHeaders||[]).slice(),o=t.body;if(i<100||i>199)throw new TypeError("Invalid statusCode: "+i);if(this.isCanceled||this.status===c.STATUS_TERMINATED)return this;function a(){i=t.statusCode||183,this.status=c.STATUS_WAITING_FOR_PRACK,r.push("Contact: "+this.contact),r.push("Require: 100rel"),r.push("RSeq: "+Math.floor(1e4*Math.random())),this.sessionDescriptionHandler.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers).then(function(t){if(!this.isCanceled&&this.status!==c.STATUS_TERMINATED){this.early_sdp=t.body,this[this.hasOffer?"hasAnswer":"hasOffer"]=!0;var o=e.Timers.T1;this.timers.rel1xxTimer=e.Timers.setTimeout(function s(){this.request.reply(i,null,r,t),o*=2,this.timers.rel1xxTimer=e.Timers.setTimeout(s.bind(this),o)}.bind(this),o),this.timers.prackTimer=e.Timers.setTimeout(function(){this.status===c.STATUS_WAITING_FOR_PRACK&&(this.logger.log("no PRACK received, rejecting the call"),e.Timers.clearTimeout(this.timers.rel1xxTimer),this.request.reply(504),this.terminated(null,e.C.causes.NO_PRACK))}.bind(this),64*e.Timers.T1),s=this.request.reply(i,n,r,t),this.emit("progress",s,n)}}.bind(this),function(){this.request.reply(480),this.failed(null,e.C.causes.WEBRTC_ERROR),this.terminated(null,e.C.causes.WEBRTC_ERROR)}.bind(this))}return 100!==t.statusCode&&(this.rel100===e.C.supported.REQUIRED||this.rel100===e.C.supported.SUPPORTED&&t.rel100||this.rel100===e.C.supported.SUPPORTED&&this.ua.configuration.rel100===e.C.supported.REQUIRED)?(this.sessionDescriptionHandler=this.setupSessionDescriptionHandler(),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),this.sessionDescriptionHandler.hasDescription(this.request.getHeader("Content-Type"))?(this.hasOffer=!0,this.sessionDescriptionHandler.setDescription(this.request.body,t.sessionDescriptionHandlerOptions,t.modifiers).then(a.apply(this)).catch(function(t){this.logger.warn("invalid description"),this.logger.warn(t),this.failed(null,e.C.causes.WEBRTC_ERROR),this.terminated(null,e.C.causes.WEBRTC_ERROR)}.bind(this))):a.apply(this)):function(){s=this.request.reply(i,n,r,o),this.emit("progress",s,n)}.apply(this),this}},accept:{writable:!0,value:function(t){t=t||{},this.onInfo=t.onInfo;var s=this,i=this.request,n=(t.extraHeaders||[]).slice(),r=function(t){var r;n.push("Contact: "+s.contact),n.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),s.hasOffer?s.hasAnswer=!0:s.hasOffer=!0,r=i.reply(200,null,n,t,(function(){s.status=c.STATUS_WAITING_FOR_ACK,s.setInvite2xxTimer(i,t),s.setACKTimer()}),(function(){s.failed(null,e.C.causes.CONNECTION_ERROR),s.terminated(null,e.C.causes.CONNECTION_ERROR)})),s.status!==c.STATUS_TERMINATED&&s.accepted(r,e.Utils.getReasonPhrase(200))},o=function(t){t instanceof e.Exceptions.SessionDescriptionHandlerError&&(s.logger.log(t.message),s.logger.log(t.error)),s.status!==c.STATUS_TERMINATED&&(s.request.reply(480),s.failed(null,e.C.causes.WEBRTC_ERROR),s.terminated(null,e.C.causes.WEBRTC_ERROR))};if(this.status===c.STATUS_WAITING_FOR_PRACK)return this.status=c.STATUS_ANSWERED_WAITING_FOR_PRACK,this;if(this.status===c.STATUS_WAITING_FOR_ANSWER)this.status=c.STATUS_ANSWERED;else if(this.status!==c.STATUS_EARLY_MEDIA)throw new e.Exceptions.InvalidStateError(this.status);if(!this.createDialog(i,"UAS"))return i.reply(500,"Missing Contact header field"),this;if(e.Timers.clearTimeout(this.timers.userNoAnswerTimer),this.status===c.STATUS_EARLY_MEDIA)r({});else if(this.sessionDescriptionHandler=this.setupSessionDescriptionHandler(),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),"0"!==this.request.getHeader("Content-Length")||this.request.getHeader("Content-Type")){if(!this.sessionDescriptionHandler.hasDescription(this.request.getHeader("Content-Type")))return void this.request.reply(415);this.hasOffer=!0,this.sessionDescriptionHandler.setDescription(this.request.body,t.sessionDescriptionHandlerOptions,t.modifiers).then(function(){return this.sessionDescriptionHandler.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers)}.bind(this)).catch(o).then(r)}else this.sessionDescriptionHandler.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers).catch(o).then(r);return this}},receiveRequest:{writable:!0,value:function(s){function i(){var t,i;e.Timers.clearTimeout(this.timers.ackTimer),e.Timers.clearTimeout(this.timers.invite2xxTimer),this.status=c.STATUS_CONFIRMED,t=s.getHeader("Content-Type"),(i=s.getHeader("Content-Disposition"))&&"render"===i.type&&(this.renderbody=s.body,this.rendertype=t),this.emit("confirmed",s)}switch(s.method){case e.C.CANCEL:this.status!==c.STATUS_WAITING_FOR_ANSWER&&this.status!==c.STATUS_WAITING_FOR_PRACK&&this.status!==c.STATUS_ANSWERED_WAITING_FOR_PRACK&&this.status!==c.STATUS_EARLY_MEDIA&&this.status!==c.STATUS_ANSWERED||(this.status=c.STATUS_CANCELED,this.request.reply(487),this.canceled(s),this.rejected(s,e.C.causes.CANCELED),this.failed(s,e.C.causes.CANCELED),this.terminated(s,e.C.causes.CANCELED));break;case e.C.ACK:this.status===c.STATUS_WAITING_FOR_ACK&&(this.sessionDescriptionHandler.hasDescription(s.getHeader("Content-Type"))?(this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(s.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(i.bind(this),function(t){this.logger.warn(t),this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(s,e.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(s,e.C.causes.BAD_MEDIA_DESCRIPTION)}.bind(this))):i.apply(this));break;case e.C.PRACK:this.status===c.STATUS_WAITING_FOR_PRACK||this.status===c.STATUS_ANSWERED_WAITING_FOR_PRACK?this.hasAnswer?(e.Timers.clearTimeout(this.timers.rel1xxTimer),e.Timers.clearTimeout(this.timers.prackTimer),s.reply(200),this.status===c.STATUS_ANSWERED_WAITING_FOR_PRACK&&(this.status=c.STATUS_EARLY_MEDIA,this.accept()),this.status=c.STATUS_EARLY_MEDIA):(this.sessionDescriptionHandler=this.setupSessionDescriptionHandler(),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),this.sessionDescriptionHandler.hasDescription(s.getHeader("Content-Type"))?(this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(s.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){e.Timers.clearTimeout(this.timers.rel1xxTimer),e.Timers.clearTimeout(this.timers.prackTimer),s.reply(200),this.status===c.STATUS_ANSWERED_WAITING_FOR_PRACK&&(this.status=c.STATUS_EARLY_MEDIA,this.accept()),this.status=c.STATUS_EARLY_MEDIA}.bind(this),function(t){this.logger.warn(t),this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(s,e.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(s,e.C.causes.BAD_MEDIA_DESCRIPTION)}.bind(this))):(this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(s,e.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(s,e.C.causes.BAD_MEDIA_DESCRIPTION))):this.status===c.STATUS_EARLY_MEDIA&&s.reply(200);break;default:t.prototype.receiveRequest.apply(this,[s])}}},setupSessionDescriptionHandler:{writable:!0,value:function(){return this.sessionDescriptionHandler?this.sessionDescriptionHandler:this.sessionDescriptionHandlerFactory(this,this.ua.configuration.sessionDescriptionHandlerFactoryOptions)}},onTransportError:{writable:!0,value:function(){this.status!==c.STATUS_CONFIRMED&&this.status!==c.STATUS_TERMINATED&&this.failed(null,e.C.causes.CONNECTION_ERROR)}},onRequestTimeout:{writable:!0,value:function(){this.status===c.STATUS_CONFIRMED?this.terminated(null,e.C.causes.REQUEST_TIMEOUT):this.status!==c.STATUS_TERMINATED&&(this.failed(null,e.C.causes.REQUEST_TIMEOUT),this.terminated(null,e.C.causes.REQUEST_TIMEOUT))}}}),e.InviteServerContext=i,(n=function(t,s,i,n){i=i||{},this.passedOptions=i,i.params=Object.create(i.params||Object.prototype);var r=(i.extraHeaders||[]).slice(),o=t.configuration.sessionDescriptionHandlerFactory;if(this.sessionDescriptionHandlerFactoryOptions=t.configuration.sessionDescriptionHandlerFactoryOptions||{},this.sessionDescriptionHandlerOptions=i.sessionDescriptionHandlerOptions||{},this.modifiers=n,this.inviteWithoutSdp=i.inviteWithoutSdp||!1,this.anonymous=i.anonymous||!1,this.renderbody=i.renderbody||null,this.rendertype=i.rendertype||"text/plain",this.from_tag=e.Utils.newTag(),i.params.from_tag=this.from_tag,this.contact=t.contact.toString({anonymous:this.anonymous,outbound:this.anonymous?!t.contact.temp_gruu:!t.contact.pub_gruu}),this.anonymous&&(i.params.from_displayName="Anonymous",i.params.from_uri="sip:anonymous@anonymous.invalid",r.push("P-Preferred-Identity: "+t.configuration.uri.toString()),r.push("Privacy: id")),r.push("Contact: "+this.contact),r.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.inviteWithoutSdp&&this.renderbody&&(r.push("Content-Type: "+this.rendertype),r.push("Content-Disposition: render;handling=optional")),t.configuration.rel100===e.C.supported.REQUIRED&&r.push("Require: 100rel"),t.configuration.replaces===e.C.supported.REQUIRED&&r.push("Require: replaces"),i.extraHeaders=r,e.Utils.augment(this,e.ClientContext,[t,e.C.INVITE,s,i]),e.Utils.augment(this,e.Session,[o]),this.status!==c.STATUS_NULL)throw new e.Exceptions.InvalidStateError(this.status);this.isCanceled=!1,this.received_100=!1,this.method=e.C.INVITE,this.receiveNonInviteResponse=this.receiveResponse,this.receiveResponse=this.receiveInviteResponse,this.logger=t.getLogger("sip.inviteclientcontext"),t.applicants[this]=this,this.id=this.request.call_id+this.from_tag,this.onInfo=i.onInfo,this.errorListener=this.onTransportError.bind(this),t.transport.on("transportError",this.errorListener)}).prototype=Object.create({},{invite:{writable:!0,value:function(){var t=this;return this.ua.sessions[this.id]=this,e.Utils.Promise.resolve().then(function(){this.inviteWithoutSdp?(this.request.body=t.renderbody,this.status=c.STATUS_INVITE_SENT,this.send()):(this.sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.sessionDescriptionHandlerFactoryOptions),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),this.sessionDescriptionHandler.getDescription(this.sessionDescriptionHandlerOptions,this.modifiers).then((function(e){t.isCanceled||t.status===c.STATUS_TERMINATED||(t.hasOffer=!0,t.request.body=e,t.status=c.STATUS_INVITE_SENT,t.send())}),(function(s){s instanceof e.Exceptions.SessionDescriptionHandlerError&&(t.logger.log(s.message),t.logger.log(s.error)),t.status!==c.STATUS_TERMINATED&&(t.failed(null,e.C.causes.WEBRTC_ERROR),t.terminated(null,e.C.causes.WEBRTC_ERROR))})))}.bind(this)),this}},receiveInviteResponse:{writable:!0,value:function(t){var s,i=this,n=t.call_id+t.from_tag+t.to_tag,r=[],o={};if(this.status!==c.STATUS_TERMINATED&&t.method===e.C.INVITE){if(this.dialog&&t.status_code>=200&&t.status_code<=299){if(n!==this.dialog.id.toString()){if(!this.createDialog(t,"UAC",!0))return;return this.emit("ack",t.transaction.sendACK({body:e.Utils.generateFakeSDP(t.body)})),this.earlyDialogs[n].sendRequest(this,e.C.BYE),void(this.status!==c.STATUS_CONFIRMED&&(this.failed(t,e.C.causes.WEBRTC_ERROR),this.terminated(t,e.C.causes.WEBRTC_ERROR)))}if(this.status===c.STATUS_CONFIRMED)return void this.emit("ack",t.transaction.sendACK());if(!this.hasAnswer)return}if(this.dialog&&t.status_code<200){if(-1!==this.dialog.pracked.indexOf(t.getHeader("rseq"))||this.dialog.pracked[this.dialog.pracked.length-1]>=t.getHeader("rseq")&&this.dialog.pracked.length>0)return;if(!this.earlyDialogs[n]&&!this.createDialog(t,"UAC",!0))return;if(-1!==this.earlyDialogs[n].pracked.indexOf(t.getHeader("rseq"))||this.earlyDialogs[n].pracked[this.earlyDialogs[n].pracked.length-1]>=t.getHeader("rseq")&&this.earlyDialogs[n].pracked.length>0)return;return r.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq")),this.earlyDialogs[n].pracked.push(t.getHeader("rseq")),void this.earlyDialogs[n].sendRequest(this,e.C.PRACK,{extraHeaders:r,body:e.Utils.generateFakeSDP(t.body)})}if(this.isCanceled)t.status_code>=100&&t.status_code<200?(this.request.cancel(this.cancelReason,r),this.canceled(null)):t.status_code>=200&&t.status_code<299?(this.acceptAndTerminate(t),this.emit("bye",this.request)):t.status_code>=300&&(s=e.C.REASON_PHRASE[t.status_code]||e.C.causes.CANCELED,this.rejected(t,s),this.failed(t,s),this.terminated(t,s));else switch(!0){case/^100$/.test(t.status_code):this.received_100=!0,this.emit("progress",t);break;case/^1[0-9]{2}$/.test(t.status_code):if(!t.to_tag){this.logger.warn("1xx response received without to tag");break}if(t.hasHeader("contact")&&!this.createDialog(t,"UAC",!0))break;if(this.status=c.STATUS_1XX_RECEIVED,t.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=new e.NameAddrHeader.parse(t.getHeader("P-Asserted-Identity"))),t.hasHeader("require")&&-1!==t.getHeader("require").indexOf("100rel")){if(this.dialog||!this.earlyDialogs[n])break;if(-1!==this.earlyDialogs[n].pracked.indexOf(t.getHeader("rseq"))||this.earlyDialogs[n].pracked[this.earlyDialogs[n].pracked.length-1]>=t.getHeader("rseq")&&this.earlyDialogs[n].pracked.length>0)return;if(this.sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.sessionDescriptionHandlerFactoryOptions),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type")))if(this.hasOffer){if(!this.createDialog(t,"UAC"))break;this.hasAnswer=!0,this.dialog.pracked.push(t.getHeader("rseq")),this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then((function(){r.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq")),i.sendRequest(e.C.PRACK,{extraHeaders:r,receiveResponse:function(){}}),i.status=c.STATUS_EARLY_MEDIA,i.emit("progress",t)}),(function(s){i.logger.warn(s),i.acceptAndTerminate(t,488,"Not Acceptable Here"),i.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION)}))}else{var a=this.earlyDialogs[n],u=a.sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.sessionDescriptionHandlerFactoryOptions);this.emit("SessionDescriptionHandler-created",u),a.pracked.push(t.getHeader("rseq")),u.setDescription(t.body,i.sessionDescriptionHandlerOptions,i.modifers).then(u.getDescription.bind(u,i.sessionDescriptionHandlerOptions,i.modifiers)).then((function(s){r.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq")),a.sendRequest(i,e.C.PRACK,{extraHeaders:r,body:s}),i.status=c.STATUS_EARLY_MEDIA,i.emit("progress",t)})).catch((function(s){if(s instanceof e.Exceptions.SessionDescriptionHandlerError){if(a.pracked.push(t.getHeader("rseq")),i.status===c.STATUS_TERMINATED)return;i.failed(null,e.C.causes.WEBRTC_ERROR),i.terminated(null,e.C.causes.WEBRTC_ERROR)}else a.pracked.splice(a.pracked.indexOf(t.getHeader("rseq")),1),i.logger.warn("invalid description"),i.logger.warn(s)}))}else r.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq")),this.earlyDialogs[n].pracked.push(t.getHeader("rseq")),this.earlyDialogs[n].sendRequest(this,e.C.PRACK,{extraHeaders:r}),this.emit("progress",t)}else this.emit("progress",t);break;case/^2[0-9]{2}$/.test(t.status_code):if(this.request.cseq+" "+this.request.method!==t.getHeader("cseq"))break;if(t.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=new e.NameAddrHeader.parse(t.getHeader("P-Asserted-Identity"))),this.status===c.STATUS_EARLY_MEDIA&&this.dialog){this.status=c.STATUS_CONFIRMED,o={},this.renderbody&&(r.push("Content-Type: "+this.rendertype),o.extraHeaders=r,o.body=this.renderbody),this.emit("ack",t.transaction.sendACK(o)),this.accepted(t);break}if(this.dialog)break;if(this.hasOffer)if(this.hasAnswer)this.renderbody&&(r.push("Content-Type: "+i.rendertype),o.extraHeaders=r,o.body=this.renderbody),this.emit("ack",t.transaction.sendACK(o));else{if(!this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type"))){this.acceptAndTerminate(t,400,"Missing session description"),this.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(t,"UAC"))break;this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then((function(){var e={};i.status=c.STATUS_CONFIRMED,i.renderbody&&(r.push("Content-Type: "+i.rendertype),e.extraHeaders=r,e.body=i.renderbody),i.emit("ack",t.transaction.sendACK(e)),i.accepted(t)}),(function(s){i.logger.warn(s),i.acceptAndTerminate(t,488,"Not Acceptable Here"),i.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION)}))}else if(this.earlyDialogs[n]&&this.earlyDialogs[n].sessionDescriptionHandler){if(this.hasOffer=!0,this.hasAnswer=!0,this.sessionDescriptionHandler=this.earlyDialogs[n].sessionDescriptionHandler,!this.createDialog(t,"UAC"))break;this.status=c.STATUS_CONFIRMED,this.emit("ack",t.transaction.sendACK()),this.accepted(t)}else{if(this.sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.sessionDescriptionHandlerFactoryOptions),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),!this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type"))){this.acceptAndTerminate(t,400,"Missing session description"),this.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(t,"UAC"))break;this.hasOffer=!0,this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(this.sessionDescriptionHandler.getDescription.bind(this.sessionDescriptionHandler,this.sessionDescriptionHandlerOptions,this.modifiers)).then((function(e){i.isCanceled||i.status===c.STATUS_TERMINATED||(i.status=c.STATUS_CONFIRMED,i.hasAnswer=!0,i.emit("ack",t.transaction.sendACK({body:e})),i.accepted(t))})).catch((function(s){s instanceof e.Exceptions.SessionDescriptionHandlerError&&(i.logger.warn("invalid description"),i.logger.warn(s),i.acceptAndTerminate(t,488,"Invalid session description"),i.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION))}))}break;default:s=e.Utils.sipErrorCause(t.status_code),this.rejected(t,s),this.failed(t,s),this.terminated(t,s)}}}},cancel:{writable:!0,value:function(t){if((t=t||{}).extraHeaders=(t.extraHeaders||[]).slice(),this.isCanceled)throw new e.Exceptions.InvalidStateError("CANCELED");if(this.status===c.STATUS_TERMINATED||this.status===c.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);this.logger.log("canceling RTCSession"),this.isCanceled=!0;var s=e.Utils.getCancelReason(t.status_code,t.reason_phrase);return this.status===c.STATUS_NULL||this.status===c.STATUS_INVITE_SENT&&!this.received_100?this.cancelReason=s:this.status!==c.STATUS_INVITE_SENT&&this.status!==c.STATUS_1XX_RECEIVED&&this.status!==c.STATUS_EARLY_MEDIA||this.request.cancel(s,t.extraHeaders),this.canceled()}},terminate:{writable:!0,value:function(e){return this.status===c.STATUS_TERMINATED||(this.status===c.STATUS_WAITING_FOR_ACK||this.status===c.STATUS_CONFIRMED?this.bye(e):this.cancel(e)),this}},receiveRequest:{writable:!0,value:function(s){return s.method,e.C.CANCEL,s.method===e.C.ACK&&this.status===c.STATUS_WAITING_FOR_ACK&&(e.Timers.clearTimeout(this.timers.ackTimer),e.Timers.clearTimeout(this.timers.invite2xxTimer),this.status=c.STATUS_CONFIRMED,this.accepted()),t.prototype.receiveRequest.apply(this,[s])}},onTransportError:{writable:!0,value:function(){this.status!==c.STATUS_CONFIRMED&&this.status!==c.STATUS_TERMINATED&&this.failed(null,e.C.causes.CONNECTION_ERROR)}},onRequestTimeout:{writable:!0,value:function(){this.status===c.STATUS_CONFIRMED?this.terminated(null,e.C.causes.REQUEST_TIMEOUT):this.status!==c.STATUS_TERMINATED&&(this.failed(null,e.C.causes.REQUEST_TIMEOUT),this.terminated(null,e.C.causes.REQUEST_TIMEOUT))}}}),e.InviteClientContext=n,(o=function(t,s,i,n){if(this.options=n||{},this.extraHeaders=(this.options.extraHeaders||[]).slice(),void 0===t||void 0===s||void 0===i)throw new TypeError("Not enough arguments");if(e.Utils.augment(this,e.ClientContext,[t,e.C.REFER,s.remoteIdentity.uri.toString(),n]),this.applicant=s,i instanceof e.InviteServerContext||i instanceof e.InviteClientContext)this.target='"'+i.remoteIdentity.friendlyName+'" <'+i.dialog.remote_target.toString()+"?Replaces="+i.dialog.id.call_id+"%3Bto-tag%3D"+i.dialog.id.remote_tag+"%3Bfrom-tag%3D"+i.dialog.id.local_tag+">";else{try{this.target=e.Grammar.parse(i,"Refer_To").uri||i}catch(e){this.logger.debug(".refer() cannot parse Refer_To from",i),this.logger.debug("...falling through to normalizeTarget()")}if(this.target=this.ua.normalizeTarget(this.target),!this.target)throw new TypeError("Invalid target: "+i)}this.ua&&this.extraHeaders.push("Referred-By: <"+this.ua.configuration.uri+">"),this.extraHeaders.push("Contact: "+s.contact),this.extraHeaders.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.extraHeaders.push("Refer-To: "+this.target),this.errorListener=this.onTransportError.bind(this),t.transport.on("transportError",this.errorListener)}).prototype=Object.create({},{refer:{writable:!0,value:function(t){t=t||{};var s=(this.extraHeaders||[]).slice();return t.extraHeaders&&s.concat(t.extraHeaders),this.applicant.sendRequest(e.C.REFER,{extraHeaders:this.extraHeaders,receiveResponse:function(e){/^1[0-9]{2}$/.test(e.status_code)?this.emit("referRequestProgress",this):/^2[0-9]{2}$/.test(e.status_code)?this.emit("referRequestAccepted",this):/^[4-6][0-9]{2}$/.test(e.status_code)&&this.emit("referRequestRejected",this),t.receiveResponse&&t.receiveResponse(e)}.bind(this)}),this}},receiveNotify:{writable:!0,value:function(t){if(t.hasHeader("Content-Type")&&-1!==t.getHeader("Content-Type").search(/^message\/sipfrag/)){var s=e.Grammar.parse(t.body,"sipfrag");if(-1===s)return void t.reply(489,"Bad Event");switch(!0){case/^1[0-9]{2}$/.test(s.status_code):this.emit("referProgress",this);break;case/^2[0-9]{2}$/.test(s.status_code):this.emit("referAccepted",this),!this.options.activeAfterTransfer&&this.applicant.terminate&&this.applicant.terminate();break;default:this.emit("referRejected",this)}return t.reply(200),void this.emit("notify",t)}t.reply(489,"Bad Event")}}}),e.ReferClientContext=o,(r=function(t,s){if(e.Utils.augment(this,e.ServerContext,[t,s]),this.ua=t,this.status=c.STATUS_INVITE_RECEIVED,this.from_tag=s.from_tag,this.id=s.call_id+this.from_tag,this.request=s,this.contact=this.ua.contact.toString(),this.logger=t.getLogger("sip.referservercontext",this.id),!this.request.hasHeader("refer-to"))return this.logger.warn("Invalid REFER packet. A refer-to header is required. Rejecting refer."),void this.reject();this.referTo=this.request.parseHeader("refer-to"),this.referredSession=this.ua.findSession(s),this.cseq=Math.floor(1e4*Math.random()),this.call_id=this.request.call_id,this.from_uri=this.request.to.uri,this.from_tag=this.request.to.parameters.tag,this.remote_target=this.request.headers.Contact[0].parsed.uri,this.to_uri=this.request.from.uri,this.to_tag=this.request.from_tag,this.route_set=this.request.getHeaders("record-route"),this.receiveNonInviteResponse=function(){},this.request.hasHeader("referred-by")&&(this.referredBy=this.request.getHeader("referred-by")),this.referTo.uri.hasHeader("replaces")&&(this.replaces=this.referTo.uri.getHeader("replaces")),this.errorListener=this.onTransportError.bind(this),t.transport.on("transportError",this.errorListener),this.status=c.STATUS_WAITING_FOR_ANSWER}).prototype=Object.create({},{progress:{writable:!0,value:function(){if(this.status!==c.STATUS_WAITING_FOR_ANSWER)throw new e.Exceptions.InvalidStateError(this.status);this.request.reply(100)}},reject:{writable:!0,value:function(t){if(this.status===c.STATUS_TERMINATED)throw new e.Exceptions.InvalidStateError(this.status);this.logger.log("Rejecting refer"),this.status=c.STATUS_TERMINATED,e.ServerContext.prototype.reject.call(this,t),this.emit("referRequestRejected",this)}},accept:{writable:!0,value:function(t,s){if(t=t||{},this.status!==c.STATUS_WAITING_FOR_ANSWER)throw new e.Exceptions.InvalidStateError(this.status);if(this.status=c.STATUS_ANSWERED,this.request.reply(202,"Accepted"),this.emit("referRequestAccepted",this),t.followRefer){this.logger.log("Accepted refer, attempting to automatically follow it");var i=this.referTo.uri;if(!i.scheme.match("^sips?$"))return this.logger.error("SIP.js can only automatically follow SIP refer target"),void this.reject();var n=t.inviteOptions||{},r=(n.extraHeaders||[]).slice();this.replaces&&r.push("Replaces: "+decodeURIComponent(this.replaces)),this.referredBy&&r.push("Referred-By: "+this.referredBy),n.extraHeaders=r,i.clearHeaders(),this.targetSession=this.ua.invite(i,n,s),this.emit("referInviteSent",this),this.targetSession.once("progress",function(){this.sendNotify("SIP/2.0 100 Trying"),this.emit("referProgress",this),this.referredSession&&this.referredSession.emit("referProgress",this)}.bind(this)),this.targetSession.once("accepted",function(){this.logger.log("Successfully followed the refer"),this.sendNotify("SIP/2.0 200 OK"),this.emit("referAccepted",this),this.referredSession&&this.referredSession.emit("referAccepted",this)}.bind(this));var o=function(e){if(this.status!==c.STATUS_TERMINATED){if(this.logger.log("Refer was not successful. Resuming session"),e&&429===e.status_code)return this.logger.log("Alerting referrer that identity is required."),void this.sendNotify("SIP/2.0 429 Provide Referrer Identity");this.sendNotify("SIP/2.0 603 Declined"),this.status=c.STATUS_TERMINATED,this.emit("referRejected",this),this.referredSession&&this.referredSession.emit("referRejected")}};this.targetSession.once("rejected",o.bind(this)),this.targetSession.once("failed",o.bind(this))}else this.logger.log("Accepted refer, but did not automatically follow it"),this.sendNotify("SIP/2.0 200 OK"),this.emit("referAccepted",this),this.referredSession&&this.referredSession.emit("referAccepted",this)}},sendNotify:{writable:!0,value:function(t){if(this.status!==c.STATUS_ANSWERED)throw new e.Exceptions.InvalidStateError(this.status);if(-1===e.Grammar.parse(t,"sipfrag"))throw new Error("sipfrag body is required to send notify for refer");var s=new e.OutgoingRequest(e.C.NOTIFY,this.remote_target,this.ua,{cseq:this.cseq+=1,call_id:this.call_id,from_uri:this.from_uri,from_tag:this.from_tag,to_uri:this.to_uri,to_tag:this.to_tag,route_set:this.route_set},["Event: refer","Subscription-State: terminated","Content-Type: message/sipfrag"],t);new e.RequestSender({request:s,onRequestTimeout:function(){},onTransportError:function(){},receiveResponse:function(){}},this.ua).send()}}}),e.ReferServerContext=r}},function(e,t,s){"use strict";e.exports=function(e){var t;return(t=function(s,i,n){var r,o;if(void 0===i)throw new TypeError("Not enough arguments");if(this.logger=s.ua.getLogger("sip.invitecontext.dtmf",s.id),this.owner=s,this.direction=null,r=(n=n||{}).duration||null,o=n.interToneGap||null,"string"==typeof i)i=i.toUpperCase();else{if("number"!=typeof i)throw new TypeError("Invalid tone: "+i);i=i.toString()}if(!i.match(/^[0-9A-D#*]$/))throw new TypeError("Invalid tone: "+i);if(this.tone=i,r&&!e.Utils.isDecimal(r))throw new TypeError("Invalid tone duration: "+r);if(r?r<t.C.MIN_DURATION?(this.logger.warn('"duration" value is lower than the minimum allowed, setting it to '+t.C.MIN_DURATION+" milliseconds"),r=t.C.MIN_DURATION):r>t.C.MAX_DURATION?(this.logger.warn('"duration" value is greater than the maximum allowed, setting it to '+t.C.MAX_DURATION+" milliseconds"),r=t.C.MAX_DURATION):r=Math.abs(r):r=t.C.DEFAULT_DURATION,this.duration=r,o&&!e.Utils.isDecimal(o))throw new TypeError("Invalid interToneGap: "+o);o?o<t.C.MIN_INTER_TONE_GAP?(this.logger.warn('"interToneGap" value is lower than the minimum allowed, setting it to '+t.C.MIN_INTER_TONE_GAP+" milliseconds"),o=t.C.MIN_INTER_TONE_GAP):o=Math.abs(o):o=t.C.DEFAULT_INTER_TONE_GAP,this.interToneGap=o}).prototype=Object.create(e.EventEmitter.prototype),t.prototype.send=function(t){var s,i={};if(this.direction="outgoing",this.owner.status!==e.Session.C.STATUS_CONFIRMED&&this.owner.status!==e.Session.C.STATUS_WAITING_FOR_ACK)throw new e.Exceptions.InvalidStateError(this.owner.status);s=(t=t||{}).extraHeaders?t.extraHeaders.slice():[],i.contentType="application/dtmf-relay",i.body="Signal= "+this.tone+"\r\n",i.body+="Duration= "+this.duration,this.request=this.owner.dialog.sendRequest(this,e.C.INFO,{extraHeaders:s,body:i}),this.owner.emit("dtmf",this.request,this)},t.prototype.receiveResponse=function(t){var s;switch(!0){case/^1[0-9]{2}$/.test(t.status_code):break;case/^2[0-9]{2}$/.test(t.status_code):this.emit("succeeded",{originator:"remote",response:t});break;default:s=e.Utils.sipErrorCause(t.status_code),this.emit("failed",t,s)}},t.prototype.onRequestTimeout=function(){this.emit("failed",null,e.C.causes.REQUEST_TIMEOUT),this.owner.onRequestTimeout()},t.prototype.onTransportError=function(){this.emit("failed",null,e.C.causes.CONNECTION_ERROR),this.owner.onTransportError()},t.prototype.onDialogError=function(t){this.emit("failed",t,e.C.causes.DIALOG_ERROR),this.owner.onDialogError(t)},t.prototype.init_incoming=function(e){this.direction="incoming",this.request=e,e.reply(200),this.tone&&this.duration?this.owner.emit("dtmf",e,this):this.logger.warn("invalid INFO DTMF received, discarded")},t.C={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500},t}},function(e,t,s){"use strict";e.exports=function(e){e.Subscription=function(t,s,i,n){if(n=Object.create(n||Object.prototype),this.extraHeaders=n.extraHeaders=(n.extraHeaders||[]).slice(),this.id=null,this.state="init",!i)throw new TypeError("Event necessary to create a subscription.");this.event=i,"number"!=typeof n.expires?(t.logger.warn("expires must be a number. Using default of 3600."),this.expires=3600):this.expires=n.expires,this.requestedExpires=this.expires,n.extraHeaders.push("Event: "+this.event),n.extraHeaders.push("Expires: "+this.expires),n.body&&(this.body=n.body),this.contact=t.contact.toString(),n.extraHeaders.push("Contact: "+this.contact),n.extraHeaders.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),e.Utils.augment(this,e.ClientContext,[t,e.C.SUBSCRIBE,s,n]),this.logger=t.getLogger("sip.subscription"),this.dialog=null,this.timers={N:null,sub_duration:null},this.errorCodes=[404,405,410,416,480,481,482,483,484,485,489,501,604]},e.Subscription.prototype={subscribe:function(){return"active"===this.state?(this.refresh(),this):("notify_wait"===this.state||(e.Timers.clearTimeout(this.timers.sub_duration),e.Timers.clearTimeout(this.timers.N),this.timers.N=e.Timers.setTimeout(this.timer_fire.bind(this),e.Timers.TIMER_N),this.ua.earlySubscriptions[this.request.call_id+this.request.from.parameters.tag+this.event]=this,this.send(),this.state="notify_wait"),this)},refresh:function(){"terminated"!==this.state&&"pending"!==this.state&&"notify_wait"!==this.state&&this.dialog.sendRequest(this,e.C.SUBSCRIBE,{extraHeaders:this.extraHeaders,body:this.body})},receiveResponse:function(t){var s,i=e.Utils.getReasonPhrase(t.status_code);"notify_wait"===this.state&&t.status_code>=300||"notify_wait"!==this.state&&-1!==this.errorCodes.indexOf(t.status_code)?this.failed(t,null):/^2[0-9]{2}$/.test(t.status_code)?(this.emit("accepted",t,i),(s=t.getHeader("Expires"))&&s<=this.requestedExpires?(this.expires=s,this.timers.sub_duration=e.Timers.setTimeout(this.refresh.bind(this),900*s)):s?(this.logger.warn("Expires header in a 200-class response to SUBSCRIBE with a higher value than the one in the request"),this.failed(t,e.C.INVALID_EXPIRES_HEADER)):(this.logger.warn("Expires header missing in a 200-class response to SUBSCRIBE"),this.failed(t,e.C.EXPIRES_HEADER_MISSING))):t.statusCode>300&&(this.emit("failed",t,i),this.emit("rejected",t,i))},unsubscribe:function(){var t=[];this.state="terminated",t.push("Event: "+this.event),t.push("Expires: 0"),t.push("Contact: "+this.contact),t.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.receiveResponse=function(){},this.dialog.sendRequest(this,this.method,{extraHeaders:t,body:this.body}),e.Timers.clearTimeout(this.timers.sub_duration),e.Timers.clearTimeout(this.timers.N),this.timers.N=e.Timers.setTimeout(this.timer_fire.bind(this),e.Timers.TIMER_N)},timer_fire:function(){"terminated"===this.state?(this.terminateDialog(),e.Timers.clearTimeout(this.timers.N),e.Timers.clearTimeout(this.timers.sub_duration),delete this.ua.subscriptions[this.id]):"notify_wait"===this.state||"pending"===this.state?this.close():this.refresh()},close:function(){"notify_wait"===this.state?(this.state="terminated",e.Timers.clearTimeout(this.timers.N),e.Timers.clearTimeout(this.timers.sub_duration),this.receiveResponse=function(){},delete this.ua.earlySubscriptions[this.request.call_id+this.request.from.parameters.tag+this.event]):"terminated"!==this.state&&this.unsubscribe()},createConfirmedDialog:function(t,s){var i;return this.terminateDialog(),(i=new e.Dialog(this,t,s)).invite_seqnum=this.request.cseq,i.local_seqnum=this.request.cseq,!i.error&&(this.dialog=i,!0)},terminateDialog:function(){this.dialog&&(delete this.ua.subscriptions[this.id],this.dialog.terminate(),delete this.dialog)},receiveRequest:function(t){var s,i=this;function n(){s.expires&&(e.Timers.clearTimeout(i.timers.sub_duration),s.expires=Math.min(i.expires,Math.max(s.expires,0)),i.timers.sub_duration=e.Timers.setTimeout(i.refresh.bind(i),900*s.expires))}if(this.matchEvent(t))if(this.dialog||this.createConfirmedDialog(t,"UAS")&&(this.id=this.dialog.id.toString(),delete this.ua.earlySubscriptions[this.request.call_id+this.request.from.parameters.tag+this.event],this.ua.subscriptions[this.id]=this),s=t.parseHeader("Subscription-State"),t.reply(200,e.C.REASON_200),e.Timers.clearTimeout(this.timers.N),this.emit("notify",{request:t}),"terminated"!==this.state)switch(s.state){case"active":this.state="active",n();break;case"pending":"notify_wait"===this.state&&n(),this.state="pending";break;case"terminated":if(e.Timers.clearTimeout(this.timers.sub_duration),s.reason)switch(this.logger.log("terminating subscription with reason "+s.reason),s.reason){case"deactivated":case"timeout":return void this.subscribe();case"probation":case"giveup":return void(s.params&&s.params["retry-after"]?this.timers.sub_duration=e.Timers.setTimeout(i.subscribe.bind(i),s.params["retry-after"]):this.subscribe())}this.close()}else"terminated"===s.state&&(this.terminateDialog(),e.Timers.clearTimeout(this.timers.N),e.Timers.clearTimeout(this.timers.sub_duration),delete this.ua.subscriptions[this.id]);else t.reply(489)},failed:function(e,t){return this.close(),this.emit("failed",e,t),this.emit("rejected",e,t),this},onDialogError:function(t){this.failed(t,e.C.causes.DIALOG_ERROR)},matchEvent:function(e){var t;return e.hasHeader("Event")?e.hasHeader("Subscription-State")?(t=e.parseHeader("event").event,this.event===t||(this.logger.warn("event match failed"),e.reply(481,"Event Match Failed"),!1)):(this.logger.warn("missing Subscription-State header"),!1):(this.logger.warn("missing Event header"),!1)}}}},function(e,t,s){"use strict";e.exports=function(e){var t;((t=function(t,s,i,n){if(this.options=n=n||{},this.options.extraHeaders=(n.extraHeaders||[]).slice(),this.options.contentType=n.contentType||"text/plain","number"!=typeof n.expires||n.expires%1!=0?this.options.expires=3600:this.options.expires=Number(n.expires),"boolean"!=typeof n.unpublishOnClose?this.options.unpublishOnClose=!0:this.options.unpublishOnClose=n.unpublishOnClose,null==s||""===s)throw new e.Exceptions.MethodParameterError("Publish","Target",s);if(this.target=t.normalizeTarget(s),null==i||""===i)throw new e.Exceptions.MethodParameterError("Publish","Event",i);this.event=i,e.ClientContext.call(this,t,e.C.PUBLISH,this.target,this.options),this.logger=this.ua.getLogger("sip.publish"),this.pubRequestBody=null,this.pubRequestExpires=this.options.expires,this.pubRequestEtag=null,this.publish_refresh_timer=null,t.on("transportCreated",function(e){e.on("transportError",this.onTransportError.bind(this))}.bind(this))}).prototype=Object.create(e.ClientContext.prototype)).constructor=t,t.prototype.publish=function(t){if(this.request=null,e.Timers.clearTimeout(this.publish_refresh_timer),null!=t&&""!==t)this.options.body=t,this.pubRequestBody=this.options.body,0===this.pubRequestExpires&&(this.pubRequestExpires=this.options.expires,this.pubRequestEtag=null),this.ua.publishers[this.target.toString()+":"+this.event]||(this.ua.publishers[this.target.toString()+":"+this.event]=this);else{if(this.pubRequestBody=null,null===this.pubRequestEtag)throw new e.Exceptions.MethodParameterError("Publish","Body",t);if(0===this.pubRequestExpires)throw new e.Exceptions.MethodParameterError("Publish","Expire",this.pubRequestExpires)}this.sendPublishRequest()},t.prototype.unpublish=function(){this.request=null,e.Timers.clearTimeout(this.publish_refresh_timer),this.pubRequestBody=null,this.pubRequestExpires=0,null!==this.pubRequestEtag&&this.sendPublishRequest()},t.prototype.close=function(){this.options.unpublishOnClose?this.unpublish():(this.request=null,e.Timers.clearTimeout(this.publish_refresh_timer),this.pubRequestBody=null,this.pubRequestExpires=0,this.pubRequestEtag=null),this.ua.publishers[this.target.toString()+":"+this.event]&&delete this.ua.publishers[this.target.toString()+":"+this.event]},t.prototype.sendPublishRequest=function(){var t;(t=Object.create(this.options||Object.prototype)).extraHeaders=(this.options.extraHeaders||[]).slice(),t.extraHeaders.push("Event: "+this.event),t.extraHeaders.push("Expires: "+this.pubRequestExpires),null!==this.pubRequestEtag&&t.extraHeaders.push("SIP-If-Match: "+this.pubRequestEtag),this.request=new e.OutgoingRequest(e.C.PUBLISH,this.target,this.ua,this.options.params,t.extraHeaders),null!==this.pubRequestBody&&(this.request.body={},this.request.body.body=this.pubRequestBody,this.request.body.contentType=this.options.contentType),this.send()},t.prototype.receiveResponse=function(t){var s,i,n=e.Utils.getReasonPhrase(t.status_code);switch(!0){case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",t,n);break;case/^2[0-9]{2}$/.test(t.status_code):t.hasHeader("SIP-ETag")?this.pubRequestEtag=t.getHeader("SIP-ETag"):this.logger.warn("SIP-ETag header missing in a 200-class response to PUBLISH"),t.hasHeader("Expires")?"number"==typeof(s=Number(t.getHeader("Expires")))&&s>=0&&s<=this.pubRequestExpires?this.pubRequestExpires=s:this.logger.warn("Bad Expires header in a 200-class response to PUBLISH"):this.logger.warn("Expires header missing in a 200-class response to PUBLISH"),0!==this.pubRequestExpires?(this.publish_refresh_timer=e.Timers.setTimeout(this.publish.bind(this),900*this.pubRequestExpires),this.emit("published",t,n)):this.emit("unpublished",t,n);break;case/^412$/.test(t.status_code):null!==this.pubRequestEtag&&0!==this.pubRequestExpires?(this.logger.warn("412 response to PUBLISH, recovering"),this.pubRequestEtag=null,this.emit("progress",t,n),this.publish(this.options.body)):(this.logger.warn("412 response to PUBLISH, recovery failed"),this.pubRequestExpires=0,this.emit("failed",t,n),this.emit("unpublished",t,n));break;case/^423$/.test(t.status_code):0!==this.pubRequestExpires&&t.hasHeader("Min-Expires")?"number"==typeof(i=Number(t.getHeader("Min-Expires")))||i>this.pubRequestExpires?(this.logger.warn("423 code in response to PUBLISH, adjusting the Expires value and trying to recover"),this.pubRequestExpires=i,this.emit("progress",t,n),this.publish(this.options.body)):(this.logger.warn("Bad 423 response Min-Expires header received for PUBLISH"),this.pubRequestExpires=0,this.emit("failed",t,n),this.emit("unpublished",t,n)):(this.logger.warn("423 response to PUBLISH, recovery failed"),this.pubRequestExpires=0,this.emit("failed",t,n),this.emit("unpublished",t,n));break;default:this.pubRequestExpires=0,this.emit("failed",t,n),this.emit("unpublished",t,n)}0===this.pubRequestExpires&&(e.Timers.clearTimeout(this.publish_refresh_timer),this.pubRequestBody=null,this.pubRequestEtag=null)},t.prototype.onRequestTimeout=function(){e.ClientContext.prototype.onRequestTimeout.call(this),this.emit("unpublished",null,e.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){e.ClientContext.prototype.onTransportError.call(this),this.emit("unpublished",null,e.C.causes.CONNECTION_ERROR)},e.PublishContext=t}},function(e,t,s){"use strict";(function(t){e.exports=function(e,i){var n,r={STATUS_INIT:0,STATUS_STARTING:1,STATUS_READY:2,STATUS_USER_CLOSED:3,STATUS_NOT_READY:4,CONFIGURATION_ERROR:1,NETWORK_ERROR:2,ALLOWED_METHODS:["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"],ACCEPTED_BODY_TYPES:["application/sdp","application/dtmf-relay"],MAX_FORWARDS:70,TAG_LENGTH:10};function o(t){if(t instanceof Function)return t.initialize||(t.initialize=function(){return e.Utils.Promise.resolve()}),t}((n=function(t){var s=this;function i(e){return s.emit.bind(s,e)}r.ACCEPTED_BODY_TYPES=r.ACCEPTED_BODY_TYPES.toString(),this.log=new e.LoggerFactory,this.logger=this.getLogger("sip.ua"),this.cache={credentials:{}},this.configuration={},this.dialogs={},this.applicants={},this.data={},this.sessions={},this.subscriptions={},this.earlySubscriptions={},this.publishers={},this.transport=null,this.contact=null,this.status=r.STATUS_INIT,this.error=null,this.transactions={nist:{},nict:{},ist:{},ict:{}},Object.defineProperties(this,{transactionsCount:{get:function(){var e,t=["nist","nict","ist","ict"],s=0;for(e in t)s+=Object.keys(this.transactions[t[e]]).length;return s}},nictTransactionsCount:{get:function(){return Object.keys(this.transactions.nict).length}},nistTransactionsCount:{get:function(){return Object.keys(this.transactions.nist).length}},ictTransactionsCount:{get:function(){return Object.keys(this.transactions.ict).length}},istTransactionsCount:{get:function(){return Object.keys(this.transactions.ist).length}}}),void 0===t?t={}:("string"==typeof t||t instanceof String)&&(t={uri:t}),t.log&&(t.log.hasOwnProperty("builtinEnabled")&&(this.log.builtinEnabled=t.log.builtinEnabled),t.log.hasOwnProperty("level")&&(this.log.level=t.log.level),t.log.hasOwnProperty("connector")&&(this.log.connector=t.log.connector));try{this.loadConfig(t)}catch(e){throw this.status=r.STATUS_NOT_READY,this.error=r.CONFIGURATION_ERROR,e}this.registerContext=new e.RegisterContext(this),this.registerContext.on("failed",i("registrationFailed")),this.registerContext.on("registered",i("registered")),this.registerContext.on("unregistered",i("unregistered")),this.configuration.autostart&&this.start()}).prototype=Object.create(e.EventEmitter.prototype)).register=function(e){return this.configuration.register=!0,this.registerContext.register(e),this},n.prototype.unregister=function(e){this.configuration.register=!1;var t=this.registerContext;return this.transport.afterConnected(t.unregister.bind(t,e)),this},n.prototype.isRegistered=function(){return this.registerContext.registered},n.prototype.invite=function(t,s,i){var n=new e.InviteClientContext(this,t,s,i);return this.transport.afterConnected(function(){n.invite(),this.emit("inviteSent",n)}.bind(this)),n},n.prototype.subscribe=function(t,s,i){var n=new e.Subscription(this,t,s,i);return this.transport.afterConnected(n.subscribe.bind(n)),n},n.prototype.publish=function(t,s,i,n){var r=new e.PublishContext(this,t,s,n);return this.transport.afterConnected(r.publish.bind(r,i)),r},n.prototype.message=function(t,s,i){if(void 0===s)throw new TypeError("Not enough arguments");return(i=Object.create(i||Object.prototype)).contentType||(i.contentType="text/plain"),i.body=s,this.request(e.C.MESSAGE,t,i)},n.prototype.request=function(t,s,i){var n=new e.ClientContext(this,t,s,i);return this.transport.afterConnected(n.send.bind(n)),n},n.prototype.stop=function(){var e,s,n,o,a=this;if(this.logger.log("user requested closure..."),this.status===r.STATUS_USER_CLOSED)return this.logger.warn("UA already closed"),this;for(e in this.logger.log("closing registerContext"),this.registerContext.close(),this.sessions)this.logger.log("closing session "+e),this.sessions[e].terminate();for(s in this.subscriptions)this.logger.log("unsubscribing from subscription "+s),this.subscriptions[s].close();for(s in this.earlySubscriptions)this.logger.log("unsubscribing from early subscription "+s),this.earlySubscriptions[s].close();for(o in this.publishers)this.logger.log("unpublish "+o),this.publishers[o].close();for(n in this.applicants)this.applicants[n].close();return this.status=r.STATUS_USER_CLOSED,0===this.nistTransactionsCount&&0===this.nictTransactionsCount?this.transport.disconnect():this.on("transactionDestroyed",(function e(){0===a.nistTransactionsCount&&0===a.nictTransactionsCount&&(a.removeListener("transactionDestroyed",e),a.transport.disconnect())})),"function"==typeof i.removeEventListener&&(t.chrome&&t.chrome.app&&t.chrome.app.runtime||i.removeEventListener("unload",this.environListener)),this},n.prototype.start=function(){if(this.logger.log("user requested startup..."),this.status===r.STATUS_INIT){if(this.status=r.STATUS_STARTING,!this.configuration.transportConstructor)throw new e.Exceptions.TransportError("Transport constructor not set");this.transport=new this.configuration.transportConstructor(this.getLogger("sip.transport"),this.configuration.transportOptions),this.setTransportListeners(),this.emit("transportCreated",this.transport),this.transport.connect()}else this.status===r.STATUS_USER_CLOSED?(this.logger.log("resuming"),this.status=r.STATUS_READY,this.transport.connect()):this.status===r.STATUS_STARTING?this.logger.log("UA is in STARTING status, not opening new connection"):this.status===r.STATUS_READY?this.logger.log("UA is in READY status, not resuming"):this.logger.error("Connection is down. Auto-Recovery system is trying to connect");return this.configuration.autostop&&"function"==typeof i.addEventListener&&(t.chrome&&t.chrome.app&&t.chrome.app.runtime||(this.environListener=this.stop.bind(this),i.addEventListener("unload",this.environListener))),this},n.prototype.normalizeTarget=function(t){return e.Utils.normalizeTarget(t,this.configuration.hostportParams)},n.prototype.saveCredentials=function(e){return this.cache.credentials[e.realm]=this.cache.credentials[e.realm]||{},this.cache.credentials[e.realm][e.uri]=e,this},n.prototype.getCredentials=function(e){var t,s;return t=e.ruri.host,this.cache.credentials[t]&&this.cache.credentials[t][e.ruri]&&((s=this.cache.credentials[t][e.ruri]).method=e.method),s},n.prototype.getLogger=function(e,t){return this.log.getLogger(e,t)},n.prototype.onTransportError=function(){this.status!==r.STATUS_USER_CLOSED&&(this.error&&this.error===r.NETWORK_ERROR||(this.status=r.STATUS_NOT_READY,this.error=r.NETWORK_ERROR))},n.prototype.setTransportListeners=function(){this.transport.on("connected",this.onTransportConnected.bind(this)),this.transport.on("message",this.onTransportReceiveMsg.bind(this)),this.transport.on("transportError",this.onTransportError.bind(this))},n.prototype.onTransportConnected=function(){this.configuration.register&&this.configuration.authenticationFactory.initialize().then(function(){this.registerContext.onTransportConnected()}.bind(this))},n.prototype.onTransportReceiveMsg=function(t){var s;if(t=e.Parser.parseMessage(t,this),this.status===e.UA.C.STATUS_USER_CLOSED&&t instanceof e.IncomingRequest)this.logger.warn("UA received message when status = USER_CLOSED - aborting");else if(e.sanityCheck(t,this,this.transport))if(t instanceof e.IncomingRequest)t.transport=this.transport,this.receiveRequest(t);else if(t instanceof e.IncomingResponse)switch(t.method){case e.C.INVITE:(s=this.transactions.ict[t.via_branch])&&s.receiveResponse(t);break;case e.C.ACK:break;default:(s=this.transactions.nict[t.via_branch])&&s.receiveResponse(t)}},n.prototype.newTransaction=function(e){this.transactions[e.type][e.id]=e,this.emit("newTransaction",{transaction:e})},n.prototype.destroyTransaction=function(e){delete this.transactions[e.type][e.id],this.emit("transactionDestroyed",{transaction:e})},n.prototype.receiveRequest=function(t){var s,i,n,o,a,c,u=t.method;function h(e){return e&&e.user===t.ruri.user}if(!(h(this.configuration.uri)||h(this.contact.uri)||h(this.contact.pub_gruu)||h(this.contact.temp_gruu)))return this.logger.warn("Request-URI does not point to us"),void(t.method!==e.C.ACK&&t.reply_sl(404));if(t.ruri.scheme!==e.C.SIPS){if(!e.Transactions.checkTransaction(this,t))if(u===e.C.OPTIONS?(new e.Transactions.NonInviteServerTransaction(t,this),t.reply(200,null,["Allow: "+e.UA.C.ALLOWED_METHODS.toString(),"Accept: "+r.ACCEPTED_BODY_TYPES])):u===e.C.MESSAGE?((n=new e.ServerContext(this,t)).body=t.body,n.content_type=t.getHeader("Content-Type")||"text/plain",t.reply(200,null),this.emit("message",n)):u!==e.C.INVITE&&u!==e.C.ACK&&new e.ServerContext(this,t),t.to_tag)(s=this.findDialog(t))?(u===e.C.INVITE&&new e.Transactions.InviteServerTransaction(t,this),s.receiveRequest(t)):u===e.C.NOTIFY?(i=this.findSession(t),o=this.findEarlySubscription(t),i?i.receiveRequest(t):o?o.receiveRequest(t):(this.logger.warn("received NOTIFY request for a non existent session or subscription"),t.reply(481,"Subscription does not exist"))):u!==e.C.ACK&&t.reply(481);else switch(u){case e.C.INVITE:if(a=this.configuration.replaces!==e.C.supported.UNSUPPORTED&&t.parseHeader("replaces")){if(!(c=this.dialogs[a.call_id+a.replaces_to_tag+a.replaces_from_tag]))return void t.reply_sl(481,null);if(c.owner.status===e.Session.C.STATUS_TERMINATED)return void t.reply_sl(603,null);if(c.state===e.Dialog.C.STATUS_CONFIRMED&&a.early_only)return void t.reply_sl(486,null)}(i=new e.InviteServerContext(this,t)).replacee=c&&c.owner,this.emit("invite",i);break;case e.C.BYE:t.reply(481);break;case e.C.CANCEL:(i=this.findSession(t))?i.receiveRequest(t):this.logger.warn("received CANCEL request for a non existent session");break;case e.C.ACK:break;case e.C.NOTIFY:this.configuration.allowLegacyNotifications&&this.listeners("notify").length>0?(t.reply(200,null),this.emit("notify",{request:t})):t.reply(481,"Subscription does not exist");break;case e.C.REFER:if(this.logger.log("Received an out of dialog refer"),this.configuration.allowOutOfDialogRefers){this.logger.log("Allow out of dialog refers is enabled on the UA");var l=new e.ReferServerContext(this,t);this.listeners("outOfDialogReferRequested").length?this.emit("outOfDialogReferRequested",l):(this.logger.log("No outOfDialogReferRequest listeners, automatically accepting and following the out of dialog refer"),l.accept({followRefer:!0}));break}t.reply(405);break;default:t.reply(405)}}else t.reply_sl(416)},n.prototype.findSession=function(e){return this.sessions[e.call_id+e.from_tag]||this.sessions[e.call_id+e.to_tag]||null},n.prototype.findDialog=function(e){return this.dialogs[e.call_id+e.from_tag+e.to_tag]||this.dialogs[e.call_id+e.to_tag+e.from_tag]||null},n.prototype.findEarlySubscription=function(e){return this.earlySubscriptions[e.call_id+e.to_tag+e.getHeader("event")]||null},n.prototype.loadConfig=function(t){var i,n,r,a,c,u={viaHost:e.Utils.createRandomToken(12)+".invalid",uri:new e.URI("sip","anonymous."+e.Utils.createRandomToken(6),"anonymous.invalid",null,null),custom:{},displayName:"",password:null,registerExpires:600,register:!0,registrarServer:null,transportConstructor:s(29)(e),transportOptions:{},userAgentString:e.C.USER_AGENT,noAnswerTimeout:60,hackViaTcp:!1,hackIpInContact:!1,hackWssInTransport:!1,hackAllowUnregisteredOptionTags:!1,sessionDescriptionHandlerFactoryOptions:{constraints:{},peerConnectionOptions:{}},contactName:e.Utils.createRandomToken(8),contactTransport:"ws",forceRport:!1,autostart:!0,autostop:!0,rel100:e.C.supported.UNSUPPORTED,dtmfType:e.C.dtmfType.INFO,replaces:e.C.supported.UNSUPPORTED,sessionDescriptionHandlerFactory:s(30)(e).defaultFactory,authenticationFactory:o((function(t){return new e.DigestAuthentication(t)})),allowLegacyNotifications:!1,allowOutOfDialogRefers:!1};function h(e,s){var i=e.replace(/([a-z][A-Z])/g,(function(e){return e[0]+"_"+e[1].toLowerCase()}));if(e!==i){var n=t.hasOwnProperty(e);t.hasOwnProperty(i)&&(s.warn(i+" is deprecated, please use "+e),n&&s.warn(e+" overriding "+i)),t[e]=n?t[e]:t[i]}}var l=this.getConfigurationCheck();for(i in l.mandatory){if(h(i,this.logger),!t.hasOwnProperty(i))throw new e.Exceptions.ConfigurationError(i);if(n=t[i],void 0===(r=l.mandatory[i](n)))throw new e.Exceptions.ConfigurationError(i,n);u[i]=r}for(i in l.optional)if(h(i,this.logger),t.hasOwnProperty(i)){if((n=t[i])instanceof Array&&0===n.length)continue;if(null===n||""===n||void 0===n)continue;if("number"==typeof n&&isNaN(n))continue;if(void 0===(r=l.optional[i](n)))throw new e.Exceptions.ConfigurationError(i,n);u[i]=r}0===u.displayName&&(u.displayName="0"),u.instanceId||(u.instanceId=e.Utils.newUUID()),u.sipjsId=e.Utils.createRandomToken(5),(a=u.uri.clone()).user=null,u.hostportParams=a.toRaw().replace(/^sip:/i,""),u.authorizationUser||(u.authorizationUser=u.uri.user),u.registrarServer||((c=u.uri.clone()).user=null,u.registrarServer=c),u.noAnswerTimeout=1e3*u.noAnswerTimeout,u.hackIpInContact&&("boolean"==typeof u.hackIpInContact?u.viaHost=e.Utils.getRandomTestNetIP():"string"==typeof u.hackIpInContact&&(u.viaHost=u.hackIpInContact)),u.hackWssInTransport&&(u.contactTransport="wss"),this.contact={pub_gruu:null,temp_gruu:null,uri:new e.URI("sip",u.contactName,u.viaHost,null,{transport:u.contactTransport}),toString:function(e){var t=(e=e||{}).anonymous||null,s=e.outbound||null,i="<";return i+=t?(this.temp_gruu||"sip:anonymous@anonymous.invalid;transport="+u.contactTransport).toString():(this.pub_gruu||this.uri).toString(),s&&(i+=";ob"),i+=">"}};var d={};for(i in u)d[i]=u[i];for(i in Object.assign(this.configuration,d),this.logger.log("configuration parameters after validation:"),u)switch(i){case"uri":case"registrarServer":case"sessionDescriptionHandlerFactory":this.logger.log("· "+i+": "+u[i]);break;case"password":this.logger.log("· "+i+": NOT SHOWN");break;case"transportConstructor":this.logger.log("· "+i+": "+u[i].name);break;default:this.logger.log("· "+i+": "+JSON.stringify(u[i]))}},n.prototype.getConfigurationCheck=function(){return{mandatory:{},optional:{uri:function(t){var s;return/^sip:/i.test(t)||(t=e.C.SIP+":"+t),(s=e.URI.parse(t))&&s.user?s:void 0},transportConstructor:function(e){if(e instanceof Function)return e},transportOptions:function(e){if("object"==typeof e)return e},authorizationUser:function(t){return-1===e.Grammar.parse('"'+t+'"',"quoted_string")?void 0:t},displayName:function(t){return-1===e.Grammar.parse('"'+t+'"',"displayName")?void 0:t},dtmfType:function(t){switch(t){case e.C.dtmfType.RTP:return e.C.dtmfType.RTP;case e.C.dtmfType.INFO:default:return e.C.dtmfType.INFO}},hackViaTcp:function(e){if("boolean"==typeof e)return e},hackIpInContact:function(t){return"boolean"==typeof t||"string"==typeof t&&-1!==e.Grammar.parse(t,"host")?t:void 0},hackWssInTransport:function(e){if("boolean"==typeof e)return e},hackAllowUnregisteredOptionTags:function(e){if("boolean"==typeof e)return e},contactTransport:function(e){if("string"==typeof e)return e},forceRport:function(e){if("boolean"==typeof e)return e},instanceId:function(t){if("string"==typeof t)return/^uuid:/i.test(t)&&(t=t.substr(5)),-1===e.Grammar.parse(t,"uuid")?void 0:t},noAnswerTimeout:function(t){var s;if(e.Utils.isDecimal(t)&&(s=Number(t))>0)return s},password:function(e){return String(e)},rel100:function(t){return t===e.C.supported.REQUIRED?e.C.supported.REQUIRED:t===e.C.supported.SUPPORTED?e.C.supported.SUPPORTED:e.C.supported.UNSUPPORTED},replaces:function(t){return t===e.C.supported.REQUIRED?e.C.supported.REQUIRED:t===e.C.supported.SUPPORTED?e.C.supported.SUPPORTED:e.C.supported.UNSUPPORTED},register:function(e){if("boolean"==typeof e)return e},registerExpires:function(t){var s;if(e.Utils.isDecimal(t)&&(s=Number(t))>0)return s},registrarServer:function(t){var s;if("string"==typeof t)return/^sip:/i.test(t)||(t=e.C.SIP+":"+t),(s=e.URI.parse(t))?s.user?void 0:s:void 0},userAgentString:function(e){if("string"==typeof e)return e},autostart:function(e){if("boolean"==typeof e)return e},autostop:function(e){if("boolean"==typeof e)return e},sessionDescriptionHandlerFactory:function(e){if(e instanceof Function)return e},sessionDescriptionHandlerFactoryOptions:function(e){if("object"==typeof e)return e},authenticationFactory:o,allowLegacyNotifications:function(e){if("boolean"==typeof e)return e},custom:function(e){if("object"==typeof e)return e},contactName:function(e){if("string"==typeof e)return e}}}},n.C=r,e.UA=n}}).call(this,s(28))},function(e,t){var s;s=function(){return this}();try{s=s||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(s=window)}e.exports=s},function(e,t,s){"use strict";(function(t){e.exports=function(e){var s,i={STATUS_CONNECTING:0,STATUS_OPEN:1,STATUS_CLOSING:2,STATUS_CLOSED:3},n=(t.window||t).WebSocket;return(s=function(t,s){s=e.Utils.defaultOptions({},s),this.logger=t,this.ws=null,this.server=null,this.connectionPromise=null,this.connectDeferredResolve=null,this.connectionTimeout=null,this.disconnectionPromise=null,this.disconnectDeferredResolve=null,this.boundOnOpen=null,this.boundOnMessage=null,this.boundOnClose=null,this.boundOnError=null,this.reconnectionAttempts=0,this.reconnectTimer=null,this.keepAliveInterval=null,this.keepAliveDebounceTimeout=null,this.status=i.STATUS_CONNECTING,this.configuration={},this.loadConfig(s)}).prototype=Object.create(e.Transport.prototype,{isConnected:{writable:!0,value:function(){return this.status===i.STATUS_OPEN}},sendPromise:{writable:!0,value:function(t,s){if(s=s||{},!this.statusAssert(i.STATUS_OPEN,s.force))return this.onError("unable to send message - WebSocket not open"),e.Utils.Promise.reject();var n=t.toString();return this.ws?(!0===this.configuration.traceSip&&this.logger.log("sending WebSocket message:\n\n"+n+"\n"),this.ws.send(n),e.Utils.Promise.resolve({msg:n})):(this.onError("unable to send message - WebSocket does not exist"),e.Utils.Promise.reject())}},disconnectPromise:{writable:!0,value:function(t){return this.disconnectionPromise?this.disconnectionPromise:(t=t||{},this.statusTransition(i.STATUS_CLOSING,t.force)?(this.disconnectionPromise=new e.Utils.Promise(function(s,i){this.disconnectDeferredResolve=s,this.reconnectTimer&&(e.Timers.clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.ws?(this.stopSendingKeepAlives(),this.logger.log("closing WebSocket "+this.server.ws_uri),this.ws.close(t.code,t.reason)):i("Attempted to disconnect but the websocket doesn't exist")}.bind(this)),this.disconnectionPromise):e.Utils.Promise.reject("Failed status transition - attempted to disconnect a socket that was not open"))}},connectPromise:{writable:!0,value:function(t){return this.connectionPromise||(t=t||{},this.server=this.server||this.getNextWsServer(t.force),this.connectionPromise=new e.Utils.Promise(function(s,r){if((this.status===i.STATUS_OPEN||this.status===i.STATUS_CLOSING)&&!t.force)return this.logger.warn("WebSocket "+this.server.ws_uri+" is already connected"),void r("Failed status check - attempted to open a connection but already open/closing");this.connectDeferredResolve=s,this.status=i.STATUS_CONNECTING,this.logger.log("connecting to WebSocket "+this.server.ws_uri),this.disposeWs();try{this.ws=new n(this.server.ws_uri,"sip")}catch(e){return this.ws=null,this.status=i.STATUS_CLOSED,this.onError("error connecting to WebSocket "+this.server.ws_uri+":"+e),void r("Failed to create a websocket")}this.ws?(this.connectionTimeout=e.Timers.setTimeout(function(){this.onError("took too long to connect - exceeded time set in configuration.connectionTimeout: "+this.configuration.connectionTimeout+"s")}.bind(this),1e3*this.configuration.connectionTimeout),this.boundOnOpen=this.onOpen.bind(this),this.boundOnMessage=this.onMessage.bind(this),this.boundOnClose=this.onClose.bind(this),this.boundOnError=this.onError.bind(this),this.ws.addEventListener("open",this.boundOnOpen),this.ws.addEventListener("message",this.boundOnMessage),this.ws.addEventListener("close",this.boundOnClose),this.ws.addEventListener("error",this.boundOnError)):r("Unexpected instance websocket not set")}.bind(this))),this.connectionPromise}},onOpen:{writable:!0,value:function(){this.status=i.STATUS_OPEN,this.emit("connected"),e.Timers.clearTimeout(this.connectionTimeout),this.logger.log("WebSocket "+this.server.ws_uri+" connected"),null!==this.reconnectTimer&&(e.Timers.clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.reconnectionAttempts=0,this.disconnectionPromise=null,this.disconnectDeferredResolve=null,this.startSendingKeepAlives(),this.connectDeferredResolve?this.connectDeferredResolve({overrideEvent:!0}):this.logger.warn("Unexpected websocket.onOpen with no connectDeferredResolve")}},onClose:{writable:!0,value:function(t){if(this.logger.log("WebSocket disconnected (code: "+t.code+(t.reason?"| reason: "+t.reason:"")+")"),this.emit("disconnected",{code:t.code,reason:t.reason}),this.status!==i.STATUS_CLOSING&&(this.logger.warn("WebSocket abrupt disconnection"),this.emit("transportError")),this.stopSendingKeepAlives(),e.Timers.clearTimeout(this.connectionTimeout),this.connectionTimeout=null,this.connectionPromise=null,this.connectDeferredResolve=null,this.disconnectDeferredResolve)return this.disconnectDeferredResolve({overrideEvent:!0}),this.statusTransition(i.STATUS_CLOSED),void(this.disconnectDeferredResolve=null);this.status=i.STATUS_CLOSED,this.reconnect()}},disposeWs:{writable:!0,value:function(){this.ws&&(this.ws.removeEventListener("open",this.boundOnOpen),this.ws.removeEventListener("message",this.boundOnMessage),this.ws.removeEventListener("close",this.boundOnClose),this.ws.removeEventListener("error",this.boundOnError),this.boundOnOpen=null,this.boundOnMessage=null,this.boundOnClose=null,this.boundOnError=null,this.ws=null)}},onMessage:{writable:!0,value:function(e){var t=e.data;if(/^(\r\n)+$/.test(t))return this.clearKeepAliveTimeout(),void(!0===this.configuration.traceSip&&this.logger.log("received WebSocket message with CRLF Keep Alive response"));if(t){if("string"!=typeof t){try{t=String.fromCharCode.apply(null,new Uint8Array(t))}catch(e){return void this.logger.warn("received WebSocket binary message failed to be converted into string, message discarded")}!0===this.configuration.traceSip&&this.logger.log("received WebSocket binary message:\n\n"+t+"\n")}else!0===this.configuration.traceSip&&this.logger.log("received WebSocket text message:\n\n"+t+"\n");this.emit("message",t)}else this.logger.warn("received empty message, message discarded")}},onError:{writable:!0,value:function(e){this.logger.warn("Transport error: "+e),this.emit("transportError")}},reconnect:{writable:!0,value:function(){if(this.reconnectionAttempts>0&&this.logger.log("Reconnection attempt "+this.reconnectionAttempts+" failed"),this.noAvailableServers())return this.logger.warn("no available ws servers left - going to closed state"),this.status=i.STATUS_CLOSED,this.emit("closed"),void this.resetServerErrorStatus();this.isConnected()&&(this.logger.warn("attempted to reconnect while connected - forcing disconnect"),this.disconnect({force:!0})),this.reconnectionAttempts+=1,this.reconnectionAttempts>this.configuration.maxReconnectionAttempts?(this.logger.warn("maximum reconnection attempts for WebSocket "+this.server.ws_uri),this.logger.log("transport "+this.server.ws_uri+" failed | connection state set to 'error'"),this.server.isError=!0,this.emit("transportError"),this.server=this.getNextWsServer(),this.reconnectionAttempts=0,this.reconnect()):(this.logger.log("trying to reconnect to WebSocket "+this.server.ws_uri+" (reconnection attempt "+this.reconnectionAttempts+")"),this.reconnectTimer=e.Timers.setTimeout(function(){this.connect(),this.reconnectTimer=null}.bind(this),1===this.reconnectionAttempts?0:1e3*this.configuration.reconnectionTimeout))}},resetServerErrorStatus:{writable:!0,value:function(){var e,t=this.configuration.wsServers.length;for(e=0;e<t;e++)this.configuration.wsServers[e].isError=!1}},getNextWsServer:{writable:!0,value:function(e){if(!this.noAvailableServers()){var t,s,i,n=[];for(s=this.configuration.wsServers.length,t=0;t<s;t++)(i=this.configuration.wsServers[t]).isError&&!e||(0===n.length?n.push(i):i.weight>n[0].weight?n=[i]:i.weight===n[0].weight&&n.push(i));return n[t=Math.floor(Math.random()*n.length)]}this.logger.warn("attempted to get next ws server but there are no available ws servers left")}},noAvailableServers:{writable:!0,value:function(){var e;for(e in this.configuration.wsServers)if(!this.configuration.wsServers[e].isError)return!1;return!0}},sendKeepAlive:{writable:!0,value:function(){if(!this.keepAliveDebounceTimeout)return this.keepAliveDebounceTimeout=e.Timers.setTimeout(function(){this.emit("keepAliveDebounceTimeout"),this.clearKeepAliveTimeout()}.bind(this),1e3*this.configuration.keepAliveDebounce),this.send("\r\n\r\n")}},clearKeepAliveTimeout:{writable:!0,value:function(){e.Timers.clearTimeout(this.keepAliveDebounceTimeout),this.keepAliveDebounceTimeout=null}},startSendingKeepAlives:{writable:!0,value:function(){var t,s;this.configuration.keepAliveInterval&&!this.keepAliveInterval&&(this.keepAliveInterval=e.Timers.setInterval(function(){this.sendKeepAlive(),this.startSendingKeepAlives()}.bind(this),(t=this.configuration.keepAliveInterval,s=.8*t,1e3*(Math.random()*(t-s)+s))))}},stopSendingKeepAlives:{writable:!0,value:function(){e.Timers.clearInterval(this.keepAliveInterval),e.Timers.clearTimeout(this.keepAliveDebounceTimeout),this.keepAliveInterval=null,this.keepAliveDebounceTimeout=null}},statusAssert:{writable:!0,value:function(e,t){return e===this.status||(t?(this.logger.warn("Attempted to assert "+Object.keys(i)[this.status]+" as "+Object.keys(i)[e]+"- continuing with option: 'force'"),!0):(this.logger.warn("Tried to assert "+Object.keys(i)[e]+" but is currently "+Object.keys(i)[this.status]),!1))}},statusTransition:{writable:!0,value:function(e,t){return this.logger.log("Attempting to transition status from "+Object.keys(i)[this.status]+" to "+Object.keys(i)[e]),e===i.STATUS_OPEN&&this.statusAssert(i.STATUS_CONNECTING,t)||e===i.STATUS_CLOSING&&this.statusAssert(i.STATUS_OPEN,t)||e===i.STATUS_CLOSED&&this.statusAssert(i.STATUS_CLOSING,t)?(this.status=e,!0):(this.logger.warn("Status transition failed - result: no-op - reason: either gave an nonexistent status or attempted illegal transition"),!1)}},loadConfig:{writable:!0,value:function(t){var s,i,n,r={wsServers:[{scheme:"WSS",sip_uri:"<sip:edge.sip.onsip.com;transport=ws;lr>",weight:0,ws_uri:"wss://edge.sip.onsip.com",isError:!1}],connectionTimeout:5,maxReconnectionAttempts:3,reconnectionTimeout:4,keepAliveInterval:0,keepAliveDebounce:10,traceSip:!1};function o(e,s){var i=e.replace(/([a-z][A-Z])/g,(function(e){return e[0]+"_"+e[1].toLowerCase()}));if(e!==i){var n=t.hasOwnProperty(e);t.hasOwnProperty(i)&&(s.warn(i+" is deprecated, please use "+e),n&&s.warn(e+" overriding "+i)),t[e]=n?t[e]:t[i]}}var a=this.getConfigurationCheck();for(s in a.mandatory){if(o(s,this.logger),!t.hasOwnProperty(s))throw new e.Exceptions.ConfigurationError(s);if(i=t[s],void 0===(n=a.mandatory[s](i)))throw new e.Exceptions.ConfigurationError(s,i);r[s]=n}for(s in a.optional)if(o(s,this.logger),t.hasOwnProperty(s)){if((i=t[s])instanceof Array&&0===i.length)continue;if(null===i||""===i||void 0===i)continue;if("number"==typeof i&&isNaN(i))continue;if(void 0===(n=a.optional[s](i)))throw new e.Exceptions.ConfigurationError(s,i);r[s]=n}var c={};for(s in r)c[s]={value:r[s]};for(s in Object.defineProperties(this.configuration,c),this.logger.log("configuration parameters after validation:"),r)this.logger.log("· "+s+": "+JSON.stringify(r[s]))}},getConfigurationCheck:{writable:!0,value:function(){return{mandatory:{},optional:{wsServers:function(t){var s,i,n;if("string"==typeof t)t=[{ws_uri:t}];else{if(!(t instanceof Array))return;for(i=t.length,s=0;s<i;s++)"string"==typeof t[s]&&(t[s]={ws_uri:t[s]})}if(0===t.length)return!1;for(i=t.length,s=0;s<i;s++){if(!t[s].ws_uri)return;if(t[s].weight&&!Number(t[s].weight))return;if(-1===(n=e.Grammar.parse(t[s].ws_uri,"absoluteURI")))return;if(["wss","ws","udp"].indexOf(n.scheme)<0)return;t[s].sip_uri="<sip:"+n.host+(n.port?":"+n.port:"")+";transport="+n.scheme.replace(/^wss$/i,"ws")+";lr>",t[s].weight||(t[s].weight=0),t[s].isError=!1,t[s].scheme=n.scheme.toUpperCase()}return t},keepAliveInterval:function(t){var s;if(e.Utils.isDecimal(t)&&(s=Number(t))>0)return s},keepAliveDebounce:function(t){var s;if(e.Utils.isDecimal(t)&&(s=Number(t))>0)return s},traceSip:function(e){if("boolean"==typeof e)return e},connectionTimeout:function(t){var s;if(e.Utils.isDecimal(t)&&(s=Number(t))>0)return s},maxReconnectionAttempts:function(t){var s;if(e.Utils.isDecimal(t)&&(s=Number(t))>=0)return s},reconnectionTimeout:function(t){var s;if(e.Utils.isDecimal(t)&&(s=Number(t))>0)return s}}}}}}),s.C=i,e.Web.Transport=s,s}}).call(this,s(28))},function(e,t,s){"use strict";(function(t){e.exports=function(e){var i=function(e,s,i){this.options=i||{},this.logger=e,this.observer=s,this.dtmfSender=null,this.shouldAcquireMedia=!0,this.CONTENT_TYPE="application/sdp",this.C={},this.C.DIRECTION={NULL:null,SENDRECV:"sendrecv",SENDONLY:"sendonly",RECVONLY:"recvonly",INACTIVE:"inactive"},this.logger.log("SessionDescriptionHandlerOptions: "+JSON.stringify(this.options)),this.direction=this.C.DIRECTION.NULL,this.modifiers=this.options.modifiers||[],Array.isArray(this.modifiers)||(this.modifiers=[this.modifiers]);var n=t.window||t;this.WebRTC={MediaStream:n.MediaStream,getUserMedia:n.navigator.mediaDevices.getUserMedia.bind(n.navigator.mediaDevices),RTCPeerConnection:n.RTCPeerConnection},this.iceGatheringDeferred=null,this.iceGatheringTimeout=!1,this.iceGatheringTimer=null,this.initPeerConnection(this.options.peerConnectionOptions),this.constraints=this.checkAndDefaultConstraints(this.options.constraints)};return i.defaultFactory=function(e,t){var n=e.ua.getLogger("sip.invitecontext.sessionDescriptionHandler",e.id),r=new(s(31))(e,t);return new i(n,r,t)},i.prototype=Object.create(e.SessionDescriptionHandler.prototype,{close:{writable:!0,value:function(){this.logger.log("closing PeerConnection"),this.peerConnection&&"closed"!==this.peerConnection.signalingState&&(this.peerConnection.getSenders?this.peerConnection.getSenders().forEach((function(e){e.track&&e.track.stop()})):(this.logger.warn("Using getLocalStreams which is deprecated"),this.peerConnection.getLocalStreams().forEach((function(e){e.getTracks().forEach((function(e){e.stop()}))}))),this.peerConnection.getReceivers?this.peerConnection.getReceivers().forEach((function(e){e.track&&e.track.stop()})):(this.logger.warn("Using getRemoteStreams which is deprecated"),this.peerConnection.getRemoteStreams().forEach((function(e){e.getTracks().forEach((function(e){e.stop()}))}))),this.resetIceGatheringComplete(),this.peerConnection.close())}},getDescription:{writable:!0,value:function(t,s){(t=t||{}).peerConnectionOptions&&this.initPeerConnection(t.peerConnectionOptions);var i=Object.assign({},this.constraints,t.constraints);return i=this.checkAndDefaultConstraints(i),JSON.stringify(i)!==JSON.stringify(this.constraints)&&(this.constraints=i,this.shouldAcquireMedia=!0),s=s||[],Array.isArray(s)||(s=[s]),s=s.concat(this.modifiers),e.Utils.Promise.resolve().then(function(){if(this.shouldAcquireMedia)return this.acquire(this.constraints).then(function(){this.shouldAcquireMedia=!1}.bind(this))}.bind(this)).then(function(){return this.createOfferOrAnswer(t.RTCOfferOptions,s)}.bind(this)).then(function(e){return this.emit("getDescription",e),{body:e.sdp,contentType:this.CONTENT_TYPE}}.bind(this))}},hasDescription:{writable:!0,value:function(e){return e===this.CONTENT_TYPE}},holdModifier:{writable:!0,value:function(t){return/a=(sendrecv|sendonly|recvonly|inactive)/.test(t.sdp)?(t.sdp=t.sdp.replace(/a=sendrecv\r\n/g,"a=sendonly\r\n"),t.sdp=t.sdp.replace(/a=recvonly\r\n/g,"a=inactive\r\n")):t.sdp=t.sdp.replace(/(m=[^\r]*\r\n)/g,"$1a=sendonly\r\n"),e.Utils.Promise.resolve(t)}},setDescription:{writable:!0,value:function(t,s,i){var n=this,r=this;(s=s||{}).peerConnectionOptions&&this.initPeerConnection(s.peerConnectionOptions),i=i||[],Array.isArray(i)||(i=[i]),i=i.concat(this.modifiers);var o={type:this.hasOffer("local")?"answer":"offer",sdp:t};return e.Utils.Promise.resolve().then(function(){if(this.shouldAcquireMedia&&this.options.alwaysAcquireMediaFirst)return this.acquire(this.constraints).then(function(){this.shouldAcquireMedia=!1}.bind(this))}.bind(this)).then((function(){return e.Utils.reducePromises(i,o)})).catch((function(t){if(t instanceof e.Exceptions.SessionDescriptionHandlerError)throw t;var s=new e.Exceptions.SessionDescriptionHandlerError("setDescription",t,"The modifiers did not resolve successfully");throw n.logger.error(s.message),r.emit("peerConnection-setRemoteDescriptionFailed",s),s})).then((function(e){return r.emit("setDescription",e),r.peerConnection.setRemoteDescription(e)})).catch((function(r){if(r instanceof e.Exceptions.SessionDescriptionHandlerError)throw r;if(/^m=video.+$/gm.test(t)&&!s.disableAudioFallback)return s.disableAudioFallback=!0,n.setDescription(t,s,[e.Web.Modifiers.stripVideo].concat(i));var o=new e.Exceptions.SessionDescriptionHandlerError("setDescription",r);throw n.logger.error(o.error),n.emit("peerConnection-setRemoteDescriptionFailed",o),o})).then((function(){r.peerConnection.getReceivers?r.emit("setRemoteDescription",r.peerConnection.getReceivers()):r.emit("setRemoteDescription",r.peerConnection.getRemoteStreams()),r.emit("confirmed",r)}))}},sendDtmf:{writable:!0,value:function(e,t){if(!this.dtmfSender&&this.hasBrowserGetSenderSupport()){var s=this.peerConnection.getSenders();s.length>0&&(this.dtmfSender=s[0].dtmf)}if(!this.dtmfSender&&this.hasBrowserTrackSupport()){var i=this.peerConnection.getLocalStreams();if(i.length>0){var n=i[0].getAudioTracks();n.length>0&&(this.dtmfSender=this.peerConnection.createDTMFSender(n[0]))}}if(!this.dtmfSender)return!1;try{this.dtmfSender.insertDTMF(e,t.duration,t.interToneGap)}catch(e){if("InvalidStateError"===e.type||"InvalidCharacterError"===e.type)return this.logger.error(e),!1;throw e}return this.logger.log("DTMF sent via RTP: "+e.toString()),!0}},getDirection:{writable:!0,value:function(){return this.direction}},createOfferOrAnswer:{writable:!0,value:function(t,s){var i,n=this,r=this,o=this.peerConnection;return t=t||{},i=r.hasOffer("remote")?"createAnswer":"createOffer",o[i](t).catch((function(t){if(t instanceof e.Exceptions.SessionDescriptionHandlerError)throw t;var s=new e.Exceptions.SessionDescriptionHandlerError("createOfferOrAnswer",t,"peerConnection-"+i+"Failed");throw n.emit("peerConnection-"+i+"Failed",s),s})).then((function(t){return e.Utils.reducePromises(s,r.createRTCSessionDescriptionInit(t))})).then((function(e){return r.resetIceGatheringComplete(),o.setLocalDescription(e)})).catch((function(t){if(t instanceof e.Exceptions.SessionDescriptionHandlerError)throw t;var s=new e.Exceptions.SessionDescriptionHandlerError("createOfferOrAnswer",t,"peerConnection-SetLocalDescriptionFailed");throw n.emit("peerConnection-SetLocalDescriptionFailed",s),s})).then((function(){return r.waitForIceGatheringComplete()})).then((function(){var t=r.createRTCSessionDescriptionInit(r.peerConnection.localDescription);return e.Utils.reducePromises(s,t)})).then((function(e){return r.setDirection(e.sdp),e})).catch((function(t){if(t instanceof e.Exceptions.SessionDescriptionHandlerError)throw t;var s=new e.Exceptions.SessionDescriptionHandlerError("createOfferOrAnswer",t);throw n.logger.error(s),s}))}},createRTCSessionDescriptionInit:{writable:!0,value:function(e){return{type:e.type,sdp:e.sdp}}},addDefaultIceCheckingTimeout:{writable:!0,value:function(e){return void 0===e.iceCheckingTimeout&&(e.iceCheckingTimeout=5e3),e}},addDefaultIceServers:{writable:!0,value:function(e){return e.iceServers||(e.iceServers=[{urls:"stun:stun.l.google.com:19302"}]),e}},checkAndDefaultConstraints:{writable:!0,value:function(e){var t={audio:!0,video:!this.options.alwaysAcquireMediaFirst};return e=e||t,0===Object.keys(e).length&&e.constructor===Object?t:e}},hasBrowserTrackSupport:{writable:!0,value:function(){return Boolean(this.peerConnection.addTrack)}},hasBrowserGetSenderSupport:{writable:!0,value:function(){return Boolean(this.peerConnection.getSenders)}},initPeerConnection:{writable:!0,value:function(t){var s=this;t=t||{},(t=this.addDefaultIceCheckingTimeout(t)).rtcConfiguration=t.rtcConfiguration||{},t.rtcConfiguration=this.addDefaultIceServers(t.rtcConfiguration),this.logger.log("initPeerConnection"),this.peerConnection&&(this.logger.log("Already have a peer connection for this session. Tearing down."),this.resetIceGatheringComplete(),this.peerConnection.close()),this.peerConnection=new this.WebRTC.RTCPeerConnection(t.rtcConfiguration),this.logger.log("New peer connection created"),"ontrack"in this.peerConnection?this.peerConnection.addEventListener("track",(function(e){s.logger.log("track added"),s.observer.trackAdded(),s.emit("addTrack",e)})):(this.logger.warn("Using onaddstream which is deprecated"),this.peerConnection.onaddstream=function(e){s.logger.log("stream added"),s.emit("addStream",e)}),this.peerConnection.onicecandidate=function(e){s.emit("iceCandidate",e),e.candidate?s.logger.log("ICE candidate received: "+(null===e.candidate.candidate?null:e.candidate.candidate.trim())):null===e.candidate&&(s.logger.log("ICE candidate gathering complete"),s.triggerIceGatheringComplete())},this.peerConnection.onicegatheringstatechange=function(){switch(s.logger.log("RTCIceGatheringState changed: "+this.iceGatheringState),this.iceGatheringState){case"gathering":s.emit("iceGathering",this),!s.iceGatheringTimer&&t.iceCheckingTimeout&&(s.iceGatheringTimeout=!1,s.iceGatheringTimer=e.Timers.setTimeout((function(){s.logger.log("RTCIceChecking Timeout Triggered after "+t.iceCheckingTimeout+" milliseconds"),s.iceGatheringTimeout=!0,s.triggerIceGatheringComplete()}),t.iceCheckingTimeout));break;case"complete":s.triggerIceGatheringComplete()}},this.peerConnection.oniceconnectionstatechange=function(){var e;switch(this.iceConnectionState){case"new":e="iceConnection";break;case"checking":e="iceConnectionChecking";break;case"connected":e="iceConnectionConnected";break;case"completed":e="iceConnectionCompleted";break;case"failed":e="iceConnectionFailed";break;case"disconnected":e="iceConnectionDisconnected";break;case"closed":e="iceConnectionClosed";break;default:return void s.logger.warn("Unknown iceConnection state:",this.iceConnectionState)}s.emit(e,this)}}},acquire:{writable:!0,value:function(t){var s=this;return t=this.checkAndDefaultConstraints(t),new e.Utils.Promise(function(e,s){this.logger.log("acquiring local media"),this.emit("userMediaRequest",t),t.audio||t.video?this.WebRTC.getUserMedia(t).then(function(t){this.observer.trackAdded(),this.emit("userMedia",t),e(t)}.bind(this)).catch(function(e){this.emit("userMediaFailed",e),s(e)}.bind(this)):e([])}.bind(this)).catch((function(t){if(t instanceof e.Exceptions.SessionDescriptionHandlerError)throw t;var i=new e.Exceptions.SessionDescriptionHandlerError("acquire",t,"unable to acquire streams");throw s.logger.error(i.message),s.logger.error(i.error),i})).then(function(t){this.logger.log("acquired local media streams");try{return this.peerConnection.removeTrack&&this.peerConnection.getSenders().forEach((function(e){this.peerConnection.removeTrack(e)}),this),t}catch(t){return e.Utils.Promise.reject(t)}}.bind(this)).catch((function(t){if(t instanceof e.Exceptions.SessionDescriptionHandlerError)throw t;var i=new e.Exceptions.SessionDescriptionHandlerError("acquire",t,"error removing streams");throw s.logger.error(i.message),s.logger.error(i.error),i})).then(function(t){try{(t=[].concat(t)).forEach((function(e){this.peerConnection.addTrack?e.getTracks().forEach((function(t){this.peerConnection.addTrack(t,e)}),this):this.peerConnection.addStream(e)}),this)}catch(t){return e.Utils.Promise.reject(t)}return e.Utils.Promise.resolve()}.bind(this)).catch((function(t){if(t instanceof e.Exceptions.SessionDescriptionHandlerError)throw t;var i=new e.Exceptions.SessionDescriptionHandlerError("acquire",t,"error adding stream");throw s.logger.error(i.message),s.logger.error(i.error),i}))}},hasOffer:{writable:!0,value:function(e){var t="have-"+e+"-offer";return this.peerConnection.signalingState===t}},isIceGatheringComplete:{writable:!0,value:function(){return"complete"===this.peerConnection.iceGatheringState||this.iceGatheringTimeout}},resetIceGatheringComplete:{writable:!0,value:function(){this.iceGatheringTimeout=!1,this.iceGatheringTimer&&(e.Timers.clearTimeout(this.iceGatheringTimer),this.iceGatheringTimer=null),this.iceGatheringDeferred&&(this.iceGatheringDeferred.reject(),this.iceGatheringDeferred=null)}},setDirection:{writable:!0,value:function(e){var t=e.match(/a=(sendrecv|sendonly|recvonly|inactive)/);if(null===t)return this.direction=this.C.DIRECTION.NULL,void this.observer.directionChanged();var s=t[1];switch(s){case this.C.DIRECTION.SENDRECV:case this.C.DIRECTION.SENDONLY:case this.C.DIRECTION.RECVONLY:case this.C.DIRECTION.INACTIVE:this.direction=s;break;default:this.direction=this.C.DIRECTION.NULL}this.observer.directionChanged()}},triggerIceGatheringComplete:{writable:!0,value:function(){this.isIceGatheringComplete()&&(this.emit("iceGatheringComplete",this),this.iceGatheringTimer&&(e.Timers.clearTimeout(this.iceGatheringTimer),this.iceGatheringTimer=null),this.iceGatheringDeferred&&(this.iceGatheringDeferred.resolve(),this.iceGatheringDeferred=null))}},waitForIceGatheringComplete:{writable:!0,value:function(){return this.isIceGatheringComplete()?e.Utils.Promise.resolve():(this.isIceGatheringDeferred||(this.iceGatheringDeferred=e.Utils.defer()),this.iceGatheringDeferred.promise)}}}),i}}).call(this,s(28))},function(e,t,s){"use strict";var i=function(e,t){this.session=e||{},this.options=t||{}};i.prototype={trackAdded:function(){this.session.emit("trackAdded")},directionChanged:function(){this.session.emit("directionChanged")}},e.exports=i},function(e,t,s){"use strict";e.exports=function(e){var t,s=[],i=[],n=[];function r(t,s,i){for(var n,r=e.Utils.buildStatusLine(t),o=s.getHeaders("via"),a=o.length,c=0;c<a;c++)r+="Via: "+o[c]+"\r\n";n=s.getHeader("To"),s.to_tag||(n+=";tag="+e.Utils.newTag()),r+="To: "+n+"\r\n",r+="From: "+s.getHeader("From")+"\r\n",r+="Call-ID: "+s.call_id+"\r\n",r+="CSeq: "+s.cseq+" "+s.method+"\r\n",r+="\r\n",i.send(r)}s.push((function(e,t,s){if(!e.ruri||"sip"!==e.ruri.scheme)return r(416,e,s),!1})),s.push((function(e,t,s){if(!e.to_tag&&e.call_id.substr(0,5)===t.configuration.sipjsId)return r(482,e,s),!1})),s.push((function(t,s,i){if(e.Utils.str_utf8_length(t.body)<t.getHeader("content-length"))return r(400,t,i),!1})),s.push((function(t,s,i){var n,o,a=t.from_tag,c=t.call_id,u=t.cseq;if(!t.to_tag)if(t.method===e.C.INVITE){if(n=s.transactions.ist[t.via_branch])return;for(o in s.transactions.ist)if((n=s.transactions.ist[o]).request.from_tag===a&&n.request.call_id===c&&n.request.cseq===u)return r(482,t,i),!1}else{if(n=s.transactions.nist[t.via_branch])return;for(o in s.transactions.nist)if((n=s.transactions.nist[o]).request.from_tag===a&&n.request.call_id===c&&n.request.cseq===u)return r(482,t,i),!1}})),i.push((function(e,t){if(e.getHeaders("via").length>1)return t.getLogger("sip.sanitycheck").warn("More than one Via header field present in the response. Dropping the response"),!1})),i.push((function(e,t){var s=t.configuration.viaHost;if(e.via.host!==s||void 0!==e.via.port)return t.getLogger("sip.sanitycheck").warn("Via sent-by in the response does not match UA Via host value. Dropping the response"),!1})),i.push((function(t,s){if(e.Utils.str_utf8_length(t.body)<t.getHeader("content-length"))return s.getLogger("sip.sanitycheck").warn("Message body length is lower than the value in Content-Length header field. Dropping the response"),!1})),n.push((function(e,t){for(var s=["from","to","call_id","cseq","via"],i=s.length;i--;)if(!e.hasHeader(s[i]))return t.getLogger("sip.sanitycheck").warn("Missing mandatory header field : "+s[i]+". Dropping the response"),!1})),t=function(t,r,o){var a;for(a=n.length;a--;)if(!1===n[a](t,r,o))return!1;if(t instanceof e.IncomingRequest){for(a=s.length;a--;)if(!1===s[a](t,r,o))return!1}else if(t instanceof e.IncomingResponse)for(a=i.length;a--;)if(!1===i[a](t,r,o))return!1;return!0},e.sanityCheck=t}},function(e,t,s){"use strict";var i=s(34);e.exports=function(e){var t;return(t=function(e){this.logger=e.getLogger("sipjs.digestauthentication"),this.username=e.configuration.authorizationUser,this.password=e.configuration.password,this.cnonce=null,this.nc=0,this.ncHex="00000000",this.response=null}).prototype.authenticate=function(t,s){if(this.algorithm=s.algorithm,this.realm=s.realm,this.nonce=s.nonce,this.opaque=s.opaque,this.stale=s.stale,this.algorithm){if("MD5"!==this.algorithm)return this.logger.warn('challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this.algorithm="MD5";if(!this.realm)return this.logger.warn("challenge without Digest realm, authentication aborted"),!1;if(!this.nonce)return this.logger.warn("challenge without Digest nonce, authentication aborted"),!1;if(s.qop)if(s.qop.indexOf("auth")>-1)this.qop="auth";else{if(!(s.qop.indexOf("auth-int")>-1))return this.logger.warn('challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;this.qop="auth-int"}else this.qop=null;return this.method=t.method,this.uri=t.ruri,this.cnonce=e.createRandomToken(12),this.nc+=1,this.updateNcHex(),4294967296===this.nc&&(this.nc=1,this.ncHex="00000001"),this.calculateResponse(),!0},t.prototype.calculateResponse=function(){var e,t;e=i(this.username+":"+this.realm+":"+this.password),"auth"===this.qop?(t=i(this.method+":"+this.uri),this.response=i(e+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+t)):"auth-int"===this.qop?(t=i(this.method+":"+this.uri+":"+i(this.body?this.body:"")),this.response=i(e+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+t)):null===this.qop&&(t=i(this.method+":"+this.uri),this.response=i(e+":"+this.nonce+":"+t))},t.prototype.toString=function(){var e=[];if(!this.response)throw new Error("response field does not exist, cannot generate Authorization header");return e.push("algorithm="+this.algorithm),e.push('username="'+this.username+'"'),e.push('realm="'+this.realm+'"'),e.push('nonce="'+this.nonce+'"'),e.push('uri="'+this.uri+'"'),e.push('response="'+this.response+'"'),this.opaque&&e.push('opaque="'+this.opaque+'"'),this.qop&&(e.push("qop="+this.qop),e.push('cnonce="'+this.cnonce+'"'),e.push("nc="+this.ncHex)),"Digest "+e.join(", ")},t.prototype.updateNcHex=function(){var e=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-e.length)+e},t}},function(e,t,s){var i;e.exports=(i=s(35),function(e){var t=i,s=t.lib,n=s.WordArray,r=s.Hasher,o=t.algo,a=[];!function(){for(var t=0;t<64;t++)a[t]=4294967296*e.abs(e.sin(t+1))|0}();var c=o.MD5=r.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var s=0;s<16;s++){var i=t+s,n=e[i];e[i]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8)}var r=this._hash.words,o=e[t+0],c=e[t+1],p=e[t+2],g=e[t+3],f=e[t+4],T=e[t+5],m=e[t+6],S=e[t+7],_=e[t+8],E=e[t+9],I=e[t+10],v=e[t+11],R=e[t+12],C=e[t+13],A=e[t+14],y=e[t+15],b=r[0],N=r[1],D=r[2],O=r[3];b=u(b,N,D,O,o,7,a[0]),O=u(O,b,N,D,c,12,a[1]),D=u(D,O,b,N,p,17,a[2]),N=u(N,D,O,b,g,22,a[3]),b=u(b,N,D,O,f,7,a[4]),O=u(O,b,N,D,T,12,a[5]),D=u(D,O,b,N,m,17,a[6]),N=u(N,D,O,b,S,22,a[7]),b=u(b,N,D,O,_,7,a[8]),O=u(O,b,N,D,E,12,a[9]),D=u(D,O,b,N,I,17,a[10]),N=u(N,D,O,b,v,22,a[11]),b=u(b,N,D,O,R,7,a[12]),O=u(O,b,N,D,C,12,a[13]),D=u(D,O,b,N,A,17,a[14]),b=h(b,N=u(N,D,O,b,y,22,a[15]),D,O,c,5,a[16]),O=h(O,b,N,D,m,9,a[17]),D=h(D,O,b,N,v,14,a[18]),N=h(N,D,O,b,o,20,a[19]),b=h(b,N,D,O,T,5,a[20]),O=h(O,b,N,D,I,9,a[21]),D=h(D,O,b,N,y,14,a[22]),N=h(N,D,O,b,f,20,a[23]),b=h(b,N,D,O,E,5,a[24]),O=h(O,b,N,D,A,9,a[25]),D=h(D,O,b,N,g,14,a[26]),N=h(N,D,O,b,_,20,a[27]),b=h(b,N,D,O,C,5,a[28]),O=h(O,b,N,D,p,9,a[29]),D=h(D,O,b,N,S,14,a[30]),b=l(b,N=h(N,D,O,b,R,20,a[31]),D,O,T,4,a[32]),O=l(O,b,N,D,_,11,a[33]),D=l(D,O,b,N,v,16,a[34]),N=l(N,D,O,b,A,23,a[35]),b=l(b,N,D,O,c,4,a[36]),O=l(O,b,N,D,f,11,a[37]),D=l(D,O,b,N,S,16,a[38]),N=l(N,D,O,b,I,23,a[39]),b=l(b,N,D,O,C,4,a[40]),O=l(O,b,N,D,o,11,a[41]),D=l(D,O,b,N,g,16,a[42]),N=l(N,D,O,b,m,23,a[43]),b=l(b,N,D,O,E,4,a[44]),O=l(O,b,N,D,R,11,a[45]),D=l(D,O,b,N,y,16,a[46]),b=d(b,N=l(N,D,O,b,p,23,a[47]),D,O,o,6,a[48]),O=d(O,b,N,D,S,10,a[49]),D=d(D,O,b,N,A,15,a[50]),N=d(N,D,O,b,T,21,a[51]),b=d(b,N,D,O,R,6,a[52]),O=d(O,b,N,D,g,10,a[53]),D=d(D,O,b,N,I,15,a[54]),N=d(N,D,O,b,c,21,a[55]),b=d(b,N,D,O,_,6,a[56]),O=d(O,b,N,D,y,10,a[57]),D=d(D,O,b,N,m,15,a[58]),N=d(N,D,O,b,C,21,a[59]),b=d(b,N,D,O,f,6,a[60]),O=d(O,b,N,D,v,10,a[61]),D=d(D,O,b,N,p,15,a[62]),N=d(N,D,O,b,E,21,a[63]),r[0]=r[0]+b|0,r[1]=r[1]+N|0,r[2]=r[2]+D|0,r[3]=r[3]+O|0},_doFinalize:function(){var t=this._data,s=t.words,i=8*this._nDataBytes,n=8*t.sigBytes;s[n>>>5]|=128<<24-n%32;var r=e.floor(i/4294967296),o=i;s[15+(n+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),s[14+(n+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),t.sigBytes=4*(s.length+1),this._process();for(var a=this._hash,c=a.words,u=0;u<4;u++){var h=c[u];c[u]=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8)}return a},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});function u(e,t,s,i,n,r,o){var a=e+(t&s|~t&i)+n+o;return(a<<r|a>>>32-r)+t}function h(e,t,s,i,n,r,o){var a=e+(t&i|s&~i)+n+o;return(a<<r|a>>>32-r)+t}function l(e,t,s,i,n,r,o){var a=e+(t^s^i)+n+o;return(a<<r|a>>>32-r)+t}function d(e,t,s,i,n,r,o){var a=e+(s^(t|~i))+n+o;return(a<<r|a>>>32-r)+t}t.MD5=r._createHelper(c),t.HmacMD5=r._createHmacHelper(c)}(Math),i.MD5)},function(e,t,s){var i;e.exports=i=i||function(e,t){var s=Object.create||function(){function e(){}return function(t){var s;return e.prototype=t,s=new e,e.prototype=null,s}}(),i={},n=i.lib={},r=n.Base={extend:function(e){var t=s(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=n.WordArray=r.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,s=e.words,i=this.sigBytes,n=e.sigBytes;if(this.clamp(),i%4)for(var r=0;r<n;r++){var o=s[r>>>2]>>>24-r%4*8&255;t[i+r>>>2]|=o<<24-(i+r)%4*8}else for(r=0;r<n;r+=4)t[i+r>>>2]=s[r>>>2];return this.sigBytes+=n,this},clamp:function(){var t=this.words,s=this.sigBytes;t[s>>>2]&=4294967295<<32-s%4*8,t.length=e.ceil(s/4)},clone:function(){var e=r.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var s,i=[],n=function(t){t=t;var s=987654321,i=4294967295;return function(){var n=((s=36969*(65535&s)+(s>>16)&i)<<16)+(t=18e3*(65535&t)+(t>>16)&i)&i;return n/=4294967296,(n+=.5)*(e.random()>.5?1:-1)}},r=0;r<t;r+=4){var a=n(4294967296*(s||e.random()));s=987654071*a(),i.push(4294967296*a()|0)}return new o.init(i,t)}}),a=i.enc={},c=a.Hex={stringify:function(e){for(var t=e.words,s=e.sigBytes,i=[],n=0;n<s;n++){var r=t[n>>>2]>>>24-n%4*8&255;i.push((r>>>4).toString(16)),i.push((15&r).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,s=[],i=0;i<t;i+=2)s[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new o.init(s,t/2)}},u=a.Latin1={stringify:function(e){for(var t=e.words,s=e.sigBytes,i=[],n=0;n<s;n++){var r=t[n>>>2]>>>24-n%4*8&255;i.push(String.fromCharCode(r))}return i.join("")},parse:function(e){for(var t=e.length,s=[],i=0;i<t;i++)s[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new o.init(s,t)}},h=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},l=n.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var s=this._data,i=s.words,n=s.sigBytes,r=this.blockSize,a=n/(4*r),c=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*r,u=e.min(4*c,n);if(c){for(var h=0;h<c;h+=r)this._doProcessBlock(i,h);var l=i.splice(0,c);s.sigBytes-=u}return new o.init(l,u)},clone:function(){var e=r.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),d=(n.Hasher=l.extend({cfg:r.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,s){return new e.init(s).finalize(t)}},_createHmacHelper:function(e){return function(t,s){return new d.HMAC.init(e,s).finalize(t)}}}),i.algo={});return i}(Math)},function(e,t,s){"use strict";var i=s(37);e.exports=function(e){return{parse:function(t,s){var n={startRule:s,SIP:e};try{i.parse(t,n)}catch(e){n.data=-1}return n.data}}}},function(e,t,s){"use strict";function i(e,t,s,n){this.message=e,this.expected=t,this.found=s,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,i)}!function(e,t){function s(){this.constructor=e}s.prototype=t.prototype,e.prototype=new s}(i,Error),i.buildMessage=function(e,t){var s={literal:function(e){return'"'+n(e.text)+'"'},class:function(e){var t,s="";for(t=0;t<e.parts.length;t++)s+=e.parts[t]instanceof Array?r(e.parts[t][0])+"-"+r(e.parts[t][1]):r(e.parts[t]);return"["+(e.inverted?"^":"")+s+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function i(e){return e.charCodeAt(0).toString(16).toUpperCase()}function n(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}function r(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}return"Expected "+function(e){var t,i,n,r=new Array(e.length);for(t=0;t<e.length;t++)r[t]=(n=e[t],s[n.type](n));if(r.sort(),r.length>0){for(t=1,i=1;t<r.length;t++)r[t-1]!==r[t]&&(r[i]=r[t],i++);r.length=i}switch(r.length){case 1:return r[0];case 2:return r[0]+" or "+r[1];default:return r.slice(0,-1).join(", ")+", or "+r[r.length-1]}}(e)+" but "+function(e){return e?'"'+n(e)+'"':"end of input"}(t)+" found."},e.exports={SyntaxError:i,parse:function(e,t){t=void 0!==t?t:{};var s,n={},r={Contact:119,Name_Addr_Header:156,Record_Route:176,Request_Response:81,SIP_URI:45,Subscription_State:186,Supported:191,Require:182,Via:194,absoluteURI:84,Call_ID:118,Content_Disposition:130,Content_Length:135,Content_Type:136,CSeq:146,displayName:122,Event:149,From:151,host:52,Max_Forwards:154,Min_SE:213,Proxy_Authenticate:157,quoted_string:40,Refer_To:178,Replaces:179,Session_Expires:210,stun_URI:217,To:192,turn_URI:223,uuid:226,WWW_Authenticate:209,challenge:158,sipfrag:230,Referred_By:231},o=119,a=["\r\n",m("\r\n",!1),/^[0-9]/,S([["0","9"]],!1,!1),/^[a-zA-Z]/,S([["a","z"],["A","Z"]],!1,!1),/^[0-9a-fA-F]/,S([["0","9"],["a","f"],["A","F"]],!1,!1),/^[\0-\xFF]/,S([["\0","ÿ"]],!1,!1),/^["]/,S(['"'],!1,!1)," ",m(" ",!1),"\t",m("\t",!1),/^[a-zA-Z0-9]/,S([["a","z"],["A","Z"],["0","9"]],!1,!1),";",m(";",!1),"/",m("/",!1),"?",m("?",!1),":",m(":",!1),"@",m("@",!1),"&",m("&",!1),"=",m("=",!1),"+",m("+",!1),"$",m("$",!1),",",m(",",!1),"-",m("-",!1),"_",m("_",!1),".",m(".",!1),"!",m("!",!1),"~",m("~",!1),"*",m("*",!1),"'",m("'",!1),"(",m("(",!1),")",m(")",!1),"%",m("%",!1),function(){return" "},function(){return":"},/^[!-~]/,S([["!","~"]],!1,!1),/^[\x80-\uFFFF]/,S([["","￿"]],!1,!1),/^[\x80-\xBF]/,S([["","¿"]],!1,!1),/^[a-f]/,S([["a","f"]],!1,!1),"`",m("`",!1),"<",m("<",!1),">",m(">",!1),"\\",m("\\",!1),"[",m("[",!1),"]",m("]",!1),"{",m("{",!1),"}",m("}",!1),function(){return"*"},function(){return"/"},function(){return"="},function(){return"("},function(){return")"},function(){return">"},function(){return"<"},function(){return","},function(){return";"},function(){return":"},function(){return'"'},/^[!-']/,S([["!","'"]],!1,!1),/^[*-[]/,S([["*","["]],!1,!1),/^[\]-~]/,S([["]","~"]],!1,!1),function(e){return e},/^[#-[]/,S([["#","["]],!1,!1),/^[\0-\t]/,S([["\0","\t"]],!1,!1),/^[\x0B-\f]/,S([["\v","\f"]],!1,!1),/^[\x0E-\x7F]/,S([["",""]],!1,!1),function(){t.data.uri=new t.SIP.URI(t.data.scheme,t.data.user,t.data.host,t.data.port),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port},function(){t.data.uri=new t.SIP.URI(t.data.scheme,t.data.user,t.data.host,t.data.port,t.data.uri_params,t.data.uri_headers),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port,delete t.data.uri_params,"SIP_URI"===t.startRule&&(t.data=t.data.uri)},"sips",m("sips",!0),"sip",m("sip",!0),function(e){t.data.scheme=e},function(){t.data.user=decodeURIComponent(f().slice(0,-1))},function(){t.data.password=f()},function(){return t.data.host=f(),t.data.host},function(){return t.data.host_type="domain",f()},/^[a-zA-Z0-9_\-]/,S([["a","z"],["A","Z"],["0","9"],"_","-"],!1,!1),/^[a-zA-Z0-9\-]/,S([["a","z"],["A","Z"],["0","9"],"-"],!1,!1),function(){return t.data.host_type="IPv6",f()},"::",m("::",!1),function(){return t.data.host_type="IPv6",f()},function(){return t.data.host_type="IPv4",f()},"25",m("25",!1),/^[0-5]/,S([["0","5"]],!1,!1),"2",m("2",!1),/^[0-4]/,S([["0","4"]],!1,!1),"1",m("1",!1),/^[1-9]/,S([["1","9"]],!1,!1),function(e){return e=parseInt(e.join("")),t.data.port=e,e},"transport=",m("transport=",!0),"udp",m("udp",!0),"tcp",m("tcp",!0),"sctp",m("sctp",!0),"tls",m("tls",!0),function(e){t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.transport=e.toLowerCase()},"user=",m("user=",!0),"phone",m("phone",!0),"ip",m("ip",!0),function(e){t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.user=e.toLowerCase()},"method=",m("method=",!0),function(e){t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.method=e},"ttl=",m("ttl=",!0),function(e){t.data.params||(t.data.params={}),t.data.params.ttl=e},"maddr=",m("maddr=",!0),function(e){t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.maddr=e},"lr",m("lr",!0),function(){t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.lr=void 0},function(e,s){t.data.uri_params||(t.data.uri_params={}),s=null===s?void 0:s[1],t.data.uri_params[e.toLowerCase()]=s},function(e,s){e=e.join("").toLowerCase(),s=s.join(""),t.data.uri_headers||(t.data.uri_headers={}),t.data.uri_headers[e]?t.data.uri_headers[e].push(s):t.data.uri_headers[e]=[s]},function(){"Refer_To"===t.startRule&&(t.data.uri=new t.SIP.URI(t.data.scheme,t.data.user,t.data.host,t.data.port,t.data.uri_params,t.data.uri_headers),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port,delete t.data.uri_params)},"//",m("//",!1),function(){t.data.scheme=f()},m("SIP",!0),function(){t.data.sip_version=f()},"INVITE",m("INVITE",!1),"ACK",m("ACK",!1),"VXACH",m("VXACH",!1),"OPTIONS",m("OPTIONS",!1),"BYE",m("BYE",!1),"CANCEL",m("CANCEL",!1),"REGISTER",m("REGISTER",!1),"SUBSCRIBE",m("SUBSCRIBE",!1),"NOTIFY",m("NOTIFY",!1),"REFER",m("REFER",!1),"PUBLISH",m("PUBLISH",!1),function(){return t.data.method=f(),t.data.method},function(e){t.data.status_code=parseInt(e.join(""))},function(){t.data.reason_phrase=f()},function(){t.data=f()},function(){var e,s;for(s=t.data.multi_header.length,e=0;e<s;e++)if(null===t.data.multi_header[e].parsed){t.data=null;break}null!==t.data?t.data=t.data.multi_header:t.data=-1},function(){var e;t.data.multi_header||(t.data.multi_header=[]);try{e=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),delete t.data.uri,delete t.data.displayName,delete t.data.params}catch(t){e=null}t.data.multi_header.push({position:u,offset:T().start.offset,parsed:e})},function(e){'"'===(e=f().trim())[0]&&(e=e.substring(1,e.length-1)),t.data.displayName=e},"q",m("q",!0),function(e){t.data.params||(t.data.params={}),t.data.params.q=e},"expires",m("expires",!0),function(e){t.data.params||(t.data.params={}),t.data.params.expires=e},function(e){return parseInt(e.join(""))},"0",m("0",!1),function(){return parseFloat(f())},function(e,s){t.data.params||(t.data.params={}),s=null===s?void 0:s[1],t.data.params[e.toLowerCase()]=s},"render",m("render",!0),"session",m("session",!0),"icon",m("icon",!0),"alert",m("alert",!0),function(){"Content_Disposition"===t.startRule&&(t.data.type=f().toLowerCase())},"handling",m("handling",!0),"optional",m("optional",!0),"required",m("required",!0),function(e){t.data=parseInt(e.join(""))},function(){t.data=f()},"text",m("text",!0),"image",m("image",!0),"audio",m("audio",!0),"video",m("video",!0),"application",m("application",!0),"message",m("message",!0),"multipart",m("multipart",!0),"x-",m("x-",!0),function(e){t.data.value=parseInt(e.join(""))},function(e){t.data=e},function(e){t.data.event=e.toLowerCase()},function(){var e=t.data.tag;t.data=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),e&&t.data.setParam("tag",e)},"tag",m("tag",!0),function(e){t.data.tag=e},function(e){t.data=parseInt(e.join(""))},function(e){t.data=e},function(){t.data=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params)},"digest",m("Digest",!0),"realm",m("realm",!0),function(e){t.data.realm=e},"domain",m("domain",!0),"nonce",m("nonce",!0),function(e){t.data.nonce=e},"opaque",m("opaque",!0),function(e){t.data.opaque=e},"stale",m("stale",!0),"true",m("true",!0),function(){t.data.stale=!0},"false",m("false",!0),function(){t.data.stale=!1},"algorithm",m("algorithm",!0),"md5",m("MD5",!0),"md5-sess",m("MD5-sess",!0),function(e){t.data.algorithm=e.toUpperCase()},"qop",m("qop",!0),"auth-int",m("auth-int",!0),"auth",m("auth",!0),function(e){t.data.qop||(t.data.qop=[]),t.data.qop.push(e.toLowerCase())},function(e){t.data.value=parseInt(e.join(""))},function(){var e,s;for(s=t.data.multi_header.length,e=0;e<s;e++)if(null===t.data.multi_header[e].parsed){t.data=null;break}null!==t.data?t.data=t.data.multi_header:t.data=-1},function(){var e;t.data.multi_header||(t.data.multi_header=[]);try{e=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),delete t.data.uri,delete t.data.displayName,delete t.data.params}catch(t){e=null}t.data.multi_header.push({position:u,offset:T().start.offset,parsed:e})},function(){t.data=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params)},function(){t.data.replaces_from_tag&&t.data.replaces_to_tag||(t.data=-1)},function(){t.data={call_id:t.data}},"from-tag",m("from-tag",!0),function(e){t.data.replaces_from_tag=e},"to-tag",m("to-tag",!0),function(e){t.data.replaces_to_tag=e},"early-only",m("early-only",!0),function(){t.data.early_only=!0},function(e,t){return t},function(e,t){return function(e,t){return[e].concat(t)}(e,t)},function(e){"Require"===t.startRule&&(t.data=e||[])},function(e){t.data.value=parseInt(e.join(""))},"active",m("active",!0),"pending",m("pending",!0),"terminated",m("terminated",!0),function(){t.data.state=f()},"reason",m("reason",!0),function(e){void 0!==e&&(t.data.reason=e)},function(e){void 0!==e&&(t.data.expires=e)},"retry_after",m("retry_after",!0),function(e){void 0!==e&&(t.data.retry_after=e)},"deactivated",m("deactivated",!0),"probation",m("probation",!0),"rejected",m("rejected",!0),"timeout",m("timeout",!0),"giveup",m("giveup",!0),"noresource",m("noresource",!0),"invariant",m("invariant",!0),function(e){"Supported"===t.startRule&&(t.data=e||[])},function(){var e=t.data.tag;t.data=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),e&&t.data.setParam("tag",e)},"ttl",m("ttl",!0),function(e){t.data.ttl=e},"maddr",m("maddr",!0),function(e){t.data.maddr=e},"received",m("received",!0),function(e){t.data.received=e},"branch",m("branch",!0),function(e){t.data.branch=e},"rport",m("rport",!0),function(){"undefined"!=typeof response_port&&(t.data.rport=response_port.join(""))},function(e){t.data.protocol=e},m("UDP",!0),m("TCP",!0),m("TLS",!0),m("SCTP",!0),function(e){t.data.transport=e},function(){t.data.host=f()},function(e){t.data.port=parseInt(e.join(""))},function(e){return parseInt(e.join(""))},function(e){"Session_Expires"===t.startRule&&(t.data.deltaSeconds=e)},"refresher",m("refresher",!1),"uas",m("uas",!1),"uac",m("uac",!1),function(e){"Session_Expires"===t.startRule&&(t.data.refresher=e)},function(e){"Min_SE"===t.startRule&&(t.data=e)},"stuns",m("stuns",!0),"stun",m("stun",!0),function(e){t.data.scheme=e},function(e){t.data.host=e},"?transport=",m("?transport=",!1),"turns",m("turns",!0),"turn",m("turn",!0),function(){t.data.transport=transport},function(){t.data=f()},"Referred-By",m("Referred-By",!1),"b",m("b",!1),"cid",m("cid",!1)],c=[R('2 ""6 7!'),R('4"""5!7#'),R('4$""5!7%'),R('4&""5!7\''),R(";'.# &;("),R('4(""5!7)'),R('4*""5!7+'),R('2,""6,7-'),R('2.""6.7/'),R('40""5!71'),R('22""6273. &24""6475.} &26""6677.q &28""6879.e &2:""6:7;.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E'),R(";).# &;,"),R('2F""6F7G.} &2H""6H7I.q &2J""6J7K.e &2L""6L7M.Y &2N""6N7O.M &2P""6P7Q.A &2R""6R7S.5 &2T""6T7U.) &2V""6V7W'),R('%%2X""6X7Y/5#;#/,$;#/#$+#)(#\'#("\'#&\'#/"!&,)'),R('%%$;$0#*;$&/,#; /#$+")("\'#&\'#." &"/=#$;$/&#0#*;$&&&#/\'$8":Z" )("\'#&\'#'),R(';.." &"'),R("%$;'.# &;(0)*;'.# &;(&/?#28\"\"6879/0$;//'$8#:[# )(#'#(\"'#&'#"),R('%%$;2/&#0#*;2&&&#/g#$%$;.0#*;.&/,#;2/#$+")("\'#&\'#0=*%$;.0#*;.&/,#;2/#$+")("\'#&\'#&/#$+")("\'#&\'#/"!&,)'),R('4\\""5!7].# &;3'),R('4^""5!7_'),R('4`""5!7a'),R(';!.) &4b""5!7c'),R('%$;). &2F""6F7G. &2J""6J7K.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O/#0*;). &2F""6F7G. &2J""6J7K.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O&&&#/"!&,)'),R('%$;). &2F""6F7G.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O/#0*;). &2F""6F7G.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O&&&#/"!&,)'),R('2T""6T7U.ã &2V""6V7W.× &2f""6f7g.Ë &2h""6h7i.¿ &2:""6:7;.³ &2D""6D7E.§ &22""6273. &28""6879. &2j""6j7k. &;&.} &24""6475.q &2l""6l7m.e &2n""6n7o.Y &26""6677.M &2>""6>7?.A &2p""6p7q.5 &2r""6r7s.) &;\'.# &;('),R('%$;).ī &2F""6F7G.ğ &2J""6J7K.ē &2L""6L7M.ć &2X""6X7Y.û &2P""6P7Q.ï &2H""6H7I.ã &2@""6@7A.× &2d""6d7e.Ë &2R""6R7S.¿ &2N""6N7O.³ &2T""6T7U.§ &2V""6V7W. &2f""6f7g. &2h""6h7i. &28""6879.w &2j""6j7k.k &;&.e &24""6475.Y &2l""6l7m.M &2n""6n7o.A &26""6677.5 &2p""6p7q.) &2r""6r7s/Ĵ#0ı*;).ī &2F""6F7G.ğ &2J""6J7K.ē &2L""6L7M.ć &2X""6X7Y.û &2P""6P7Q.ï &2H""6H7I.ã &2@""6@7A.× &2d""6d7e.Ë &2R""6R7S.¿ &2N""6N7O.³ &2T""6T7U.§ &2V""6V7W. &2f""6f7g. &2h""6h7i. &28""6879.w &2j""6j7k.k &;&.e &24""6475.Y &2l""6l7m.M &2n""6n7o.A &26""6677.5 &2p""6p7q.) &2r""6r7s&&&#/"!&,)'),R("%;//?#2P\"\"6P7Q/0$;//'$8#:t# )(#'#(\"'#&'#"),R("%;//?#24\"\"6475/0$;//'$8#:u# )(#'#(\"'#&'#"),R("%;//?#2>\"\"6>7?/0$;//'$8#:v# )(#'#(\"'#&'#"),R("%;//?#2T\"\"6T7U/0$;//'$8#:w# )(#'#(\"'#&'#"),R("%;//?#2V\"\"6V7W/0$;//'$8#:x# )(#'#(\"'#&'#"),R('%2h""6h7i/0#;//\'$8":y" )("\'#&\'#'),R('%;//6#2f""6f7g/\'$8":z" )("\'#&\'#'),R("%;//?#2D\"\"6D7E/0$;//'$8#:{# )(#'#(\"'#&'#"),R("%;//?#22\"\"6273/0$;//'$8#:|# )(#'#(\"'#&'#"),R("%;//?#28\"\"6879/0$;//'$8#:}# )(#'#(\"'#&'#"),R("%;//0#;&/'$8\":~\" )(\"'#&'#"),R("%;&/0#;//'$8\":~\" )(\"'#&'#"),R("%;=/T#$;G.) &;K.# &;F0/*;G.) &;K.# &;F&/,$;>/#$+#)(#'#(\"'#&'#"),R('4""5!7.A &4""5!7.5 &4""5!7.) &;3.# &;.'),R("%%;//Q#;&/H$$;J.# &;K0)*;J.# &;K&/,$;&/#$+$)($'#(#'#(\"'#&'#/\"!&,)"),R("%;//]#;&/T$%$;J.# &;K0)*;J.# &;K&/\"!&,)/1$;&/($8$:$!!)($'#(#'#(\"'#&'#"),R(';..G &2L""6L7M.; &4""5!7./ &4""5!7.# &;3'),R('%2j""6j7k/J#4""5!7.5 &4""5!7.) &4""5!7/#$+")("\'#&\'#'),R("%;N/M#28\"\"6879/>$;O.\" &\"/0$;S/'$8$:$ )($'#(#'#(\"'#&'#"),R("%;N/d#28\"\"6879/U$;O.\" &\"/G$;S/>$;_/5$;l.\" &\"/'$8&:& )(&'#(%'#($'#(#'#(\"'#&'#"),R('%3""5$7.) &3""5#7/\' 8!:!! )'),R('%;P/]#%28""6879/,#;R/#$+")("\'#&\'#." &"/6$2:""6:7;/\'$8#:# )(#\'#("\'#&\'#'),R("$;+.) &;-.# &;Q/2#0/*;+.) &;-.# &;Q&&&#"),R('2<""6<7=.q &2>""6>7?.e &2@""6@7A.Y &2B""6B7C.M &2D""6D7E.A &22""6273.5 &26""6677.) &24""6475'),R('%$;+._ &;-.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E0e*;+._ &;-.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E&/& 8!:! )'),R('%;T/J#%28""6879/,#;^/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),R("%;U.) &;\\.# &;X/& 8!:! )"),R('%$%;V/2#2J""6J7K/#$+")("\'#&\'#0<*%;V/2#2J""6J7K/#$+")("\'#&\'#&/D#;W/;$2J""6J7K." &"/\'$8#:# )(#\'#("\'#&\'#'),R('$4""5!7/,#0)*4""5!7&&&#'),R('%4$""5!7%/?#$4""5!70)*4""5!7&/#$+")("\'#&\'#'),R('%2l""6l7m/?#;Y/6$2n""6n7o/\'$8#:# )(#\'#("\'#&\'#'),R('%%;Z/³#28""6879/¤$;Z/$28""6879/$;Z/$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+-)(-\'#(,\'#(+\'#(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ސ &%2""67/¤#;Z/$28""6879/$;Z/$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+,)(,\'#(+\'#(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.۹ &%2""67/#;Z/$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+*)(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ٺ &%2""67/t#;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ؓ &%2""67/\\#;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+&)(&\'#(%\'#($\'#(#\'#("\'#&\'#.ׄ &%2""67/D#;Z/;$28""6879/,$;[/#$+$)($\'#(#\'#("\'#&\'#.֍ &%2""67/,#;[/#$+")("\'#&\'#.ծ &%2""67/,#;Z/#$+")("\'#&\'#.Տ &%;Z/#2""67/$;Z/$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$++)(+\'#(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.Ӈ &%;Z/ª#%28""6879/,#;Z/#$+")("\'#&\'#." &"/$2""67/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+*)(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.а &%;Z/¹#%28""6879/,#;Z/#$+")("\'#&\'#." &"/$%28""6879/,#;Z/#$+")("\'#&\'#." &"/k$2""67/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+))()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.Ί &%;Z/È#%28""6879/,#;Z/#$+")("\'#&\'#." &"/¡$%28""6879/,#;Z/#$+")("\'#&\'#." &"/z$%28""6879/,#;Z/#$+")("\'#&\'#." &"/S$2""67/D$;Z/;$28""6879/,$;[/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.˕ &%;Z/×#%28""6879/,#;Z/#$+")("\'#&\'#." &"/°$%28""6879/,#;Z/#$+")("\'#&\'#." &"/$%28""6879/,#;Z/#$+")("\'#&\'#." &"/b$%28""6879/,#;Z/#$+")("\'#&\'#." &"/;$2""67/,$;[/#$+\')(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ȑ &%;Z/þ#%28""6879/,#;Z/#$+")("\'#&\'#." &"/×$%28""6879/,#;Z/#$+")("\'#&\'#." &"/°$%28""6879/,#;Z/#$+")("\'#&\'#." &"/$%28""6879/,#;Z/#$+")("\'#&\'#." &"/b$%28""6879/,#;Z/#$+")("\'#&\'#." &"/;$2""67/,$;Z/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.Ħ &%;Z/Ĝ#%28""6879/,#;Z/#$+")("\'#&\'#." &"/õ$%28""6879/,#;Z/#$+")("\'#&\'#." &"/Î$%28""6879/,#;Z/#$+")("\'#&\'#." &"/§$%28""6879/,#;Z/#$+")("\'#&\'#." &"/$%28""6879/,#;Z/#$+")("\'#&\'#." &"/Y$%28""6879/,#;Z/#$+")("\'#&\'#." &"/2$2""67/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#/& 8!: ! )'),R('%;#/M#;#." &"/?$;#." &"/1$;#." &"/#$+$)($\'#(#\'#("\'#&\'#'),R("%;Z/;#28\"\"6879/,$;Z/#$+#)(#'#(\"'#&'#.# &;\\"),R("%;]/o#2J\"\"6J7K/`$;]/W$2J\"\"6J7K/H$;]/?$2J\"\"6J7K/0$;]/'$8':¡' )(''#(&'#(%'#($'#(#'#(\"'#&'#"),R('%2¢""6¢7£/2#4¤""5!7¥/#$+")("\'#&\'#. &%2¦""6¦7§/;#4¨""5!7©/,$;!/#$+#)(#\'#("\'#&\'#.j &%2ª""6ª7«/5#;!/,$;!/#$+#)(#\'#("\'#&\'#.B &%4¬""5!7­/,#;!/#$+")("\'#&\'#.# &;!'),R('%%;!." &"/[#;!." &"/M$;!." &"/?$;!." &"/1$;!." &"/#$+%)(%\'#($\'#(#\'#("\'#&\'#/\' 8!:®!! )'),R('$%22""6273/,#;`/#$+")("\'#&\'#0<*%22""6273/,#;`/#$+")("\'#&\'#&'),R(";a.A &;b.; &;c.5 &;d./ &;e.) &;f.# &;g"),R('%3¯""5*7°/a#3±""5#7².G &3³""5#7´.; &3µ""5$7¶./ &3·""5#7¸.# &;6/($8":¹"! )("\'#&\'#'),R('%3º""5%7»/I#3¼""5%7½./ &3¾""5"7¿.# &;6/($8":À"! )("\'#&\'#'),R('%3Á""5\'7Â/1#;/($8":Ã"! )("\'#&\'#'),R('%3Ä""5$7Å/1#;ð/($8":Æ"! )("\'#&\'#'),R('%3Ç""5&7È/1#;T/($8":É"! )("\'#&\'#'),R('%3Ê""5"7Ë/N#%2>""6>7?/,#;6/#$+")("\'#&\'#." &"/\'$8":Ì" )("\'#&\'#'),R('%;h/P#%2>""6>7?/,#;i/#$+")("\'#&\'#." &"/)$8":Í""! )("\'#&\'#'),R('%$;j/&#0#*;j&&&#/"!&,)'),R('%$;j/&#0#*;j&&&#/"!&,)'),R(";k.) &;+.# &;-"),R('2l""6l7m.e &2n""6n7o.Y &24""6475.M &28""6879.A &2<""6<7=.5 &2@""6@7A.) &2B""6B7C'),R('%26""6677/n#;m/e$$%2<""6<7=/,#;m/#$+")("\'#&\'#0<*%2<""6<7=/,#;m/#$+")("\'#&\'#&/#$+#)(#\'#("\'#&\'#'),R('%;n/A#2>""6>7?/2$;o/)$8#:Î#"" )(#\'#("\'#&\'#'),R("$;p.) &;+.# &;-/2#0/*;p.) &;+.# &;-&&&#"),R("$;p.) &;+.# &;-0/*;p.) &;+.# &;-&"),R('2l""6l7m.e &2n""6n7o.Y &24""6475.M &26""6677.A &28""6879.5 &2@""6@7A.) &2B""6B7C'),R(";.# &;r"),R("%;/G#;'/>$;s/5$;'/,$;/#$+%)(%'#($'#(#'#(\"'#&'#"),R(";M.# &;t"),R("%;/E#28\"\"6879/6$;u.# &;x/'$8#:Ï# )(#'#(\"'#&'#"),R('%;v.# &;w/J#%26""6677/,#;/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),R('%2Ð""6Ð7Ñ/:#;/1$;w." &"/#$+#)(#\'#("\'#&\'#'),R('%24""6475/,#;{/#$+")("\'#&\'#'),R("%;z/3#$;y0#*;y&/#$+\")(\"'#&'#"),R(";*.) &;+.# &;-"),R(';+. &;-. &22""6273.} &26""6677.q &28""6879.e &2:""6:7;.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E'),R('%;|/e#$%24""6475/,#;|/#$+")("\'#&\'#0<*%24""6475/,#;|/#$+")("\'#&\'#&/#$+")("\'#&\'#'),R('%$;~0#*;~&/e#$%22""6273/,#;}/#$+")("\'#&\'#0<*%22""6273/,#;}/#$+")("\'#&\'#&/#$+")("\'#&\'#'),R("$;~0#*;~&"),R(';+.w &;-.q &28""6879.e &2:""6:7;.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E'),R('%%;"/#$;".G &;!.A &2@""6@7A.5 &2F""6F7G.) &2J""6J7K0M*;".G &;!.A &2@""6@7A.5 &2F""6F7G.) &2J""6J7K&/#$+")("\'#&\'#/& 8!:Ò! )'),R(";.# &;"),R('%%;O/2#2:""6:7;/#$+")("\'#&\'#." &"/,#;S/#$+")("\'#&\'#." &"'),R('$;+. &;-.} &2B""6B7C.q &2D""6D7E.e &22""6273.Y &28""6879.M &2:""6:7;.A &2<""6<7=.5 &2>""6>7?.) &2@""6@7A/#0*;+. &;-.} &2B""6B7C.q &2D""6D7E.e &22""6273.Y &28""6879.M &2:""6:7;.A &2<""6<7=.5 &2>""6>7?.) &2@""6@7A&&&#'),R("$;y0#*;y&"),R('%3""5#7Ó/q#24""6475/b$$;!/&#0#*;!&&&#/L$2J""6J7K/=$$;!/&#0#*;!&&&#/\'$8%:Ô% )(%\'#($\'#(#\'#("\'#&\'#'),R('2Õ""6Õ7Ö'),R('2×""6×7Ø'),R('2Ù""6Ù7Ú'),R('2Û""6Û7Ü'),R('2Ý""6Ý7Þ'),R('2ß""6ß7à'),R('2á""6á7â'),R('2ã""6ã7ä'),R('2å""6å7æ'),R('2ç""6ç7è'),R('2é""6é7ê'),R("%;.Y &;.S &;.M &;.G &;.A &;.; &;.5 &;./ &;.) &;.# &;6/& 8!:ë! )"),R("%;/G#;'/>$;/5$;'/,$;/#$+%)(%'#($'#(#'#(\"'#&'#"),R("%;/' 8!:ì!! )"),R("%;!/5#;!/,$;!/#$+#)(#'#(\"'#&'#"),R("%$;*.A &;+.; &;-.5 &;3./ &;4.) &;'.# &;(0G*;*.A &;+.; &;-.5 &;3./ &;4.) &;'.# &;(&/& 8!:í! )"),R("%;¶/Y#$%;A/,#;¶/#$+\")(\"'#&'#06*%;A/,#;¶/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),R('%;9/N#%2:""6:7;/,#;9/#$+")("\'#&\'#." &"/\'$8":î" )("\'#&\'#'),R("%;:.c &%;/Y#$%;A/,#;/#$+\")(\"'#&'#06*%;A/,#;/#$+\")(\"'#&'#&/#$+\")(\"'#&'#/& 8!:ï! )"),R("%;L.# &;/]#$%;B/,#;/#$+\")(\"'#&'#06*%;B/,#;/#$+\")(\"'#&'#&/'$8\":ð\" )(\"'#&'#"),R("%;.\" &\"/>#;@/5$;M/,$;?/#$+$)($'#(#'#(\"'#&'#"),R("%%;6/Y#$%;./,#;6/#$+\")(\"'#&'#06*%;./,#;6/#$+\")(\"'#&'#&/#$+\")(\"'#&'#.# &;H/' 8!:ñ!! )"),R(";.) &;.# &; "),R("%3ò\"\"5!7ó/:#;</1$;/($8#:ô#! )(#'#(\"'#&'#"),R("%3õ\"\"5'7ö/:#;</1$;/($8#:÷#! )(#'#(\"'#&'#"),R("%$;!/&#0#*;!&&&#/' 8!:ø!! )"),R('%2ù""6ù7ú/o#%2J""6J7K/M#;!." &"/?$;!." &"/1$;!." &"/#$+$)($\'#(#\'#("\'#&\'#." &"/\'$8":û" )("\'#&\'#'),R('%;6/J#%;</,#;¡/#$+")("\'#&\'#." &"/)$8":ü""! )("\'#&\'#'),R(";6.) &;T.# &;H"),R("%;£/Y#$%;B/,#;¤/#$+\")(\"'#&'#06*%;B/,#;¤/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),R('%3ý""5&7þ.G &3ÿ""5\'7Ā.; &3ā""5$7Ă./ &3ă""5%7Ą.# &;6/& 8!:ą! )'),R(";¥.# &; "),R('%3Ć""5(7ć/M#;</D$3Ĉ""5(7ĉ./ &3Ċ""5(7ċ.# &;6/#$+#)(#\'#("\'#&\'#'),R("%;6/Y#$%;A/,#;6/#$+\")(\"'#&'#06*%;A/,#;6/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),R("%$;!/&#0#*;!&&&#/' 8!:Č!! )"),R("%;©/& 8!:č! )"),R("%;ª/k#;;/b$;¯/Y$$%;B/,#;°/#$+\")(\"'#&'#06*%;B/,#;°/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#"),R(";«.# &;¬"),R('3Ď""5$7ď.S &3Đ""5%7đ.G &3Ē""5%7ē.; &3Ĕ""5%7ĕ./ &3Ė""5+7ė.# &;­'),R('3Ę""5\'7ę./ &3Ě""5)7ě.# &;­'),R(";6.# &;®"),R('%3Ĝ""5"7ĝ/,#;6/#$+")("\'#&\'#'),R(";­.# &;6"),R("%;6/5#;</,$;±/#$+#)(#'#(\"'#&'#"),R(";6.# &;H"),R("%;³/5#;./,$;/#$+#)(#'#(\"'#&'#"),R("%$;!/&#0#*;!&&&#/' 8!:Ğ!! )"),R("%;/' 8!:ğ!! )"),R('%;¶/^#$%;B/,#; /#$+")("\'#&\'#06*%;B/,#; /#$+")("\'#&\'#&/($8":Ġ"!!)("\'#&\'#'),R('%%;7/e#$%2J""6J7K/,#;7/#$+")("\'#&\'#0<*%2J""6J7K/,#;7/#$+")("\'#&\'#&/#$+")("\'#&\'#/"!&,)'),R("%;L.# &;/]#$%;B/,#;¸/#$+\")(\"'#&'#06*%;B/,#;¸/#$+\")(\"'#&'#&/'$8\":ġ\" )(\"'#&'#"),R(";¹.# &; "),R("%3Ģ\"\"5#7ģ/:#;</1$;6/($8#:Ĥ#! )(#'#(\"'#&'#"),R("%$;!/&#0#*;!&&&#/' 8!:ĥ!! )"),R("%;/' 8!:Ħ!! )"),R("%$;0#*;&/x#;@/o$;M/f$;?/]$$%;B/,#; /#$+\")(\"'#&'#06*%;B/,#; /#$+\")(\"'#&'#&/'$8%:ħ% )(%'#($'#(#'#(\"'#&'#"),R(";¾"),R("%3Ĩ\"\"5&7ĩ/k#;./b$;Á/Y$$%;A/,#;Á/#$+\")(\"'#&'#06*%;A/,#;Á/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#.# &;¿"),R("%;6/k#;./b$;À/Y$$%;A/,#;À/#$+\")(\"'#&'#06*%;A/,#;À/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#"),R("%;6/;#;</2$;6.# &;H/#$+#)(#'#(\"'#&'#"),R(";Â.G &;Ä.A &;Æ.; &;È.5 &;É./ &;Ê.) &;Ë.# &;À"),R("%3Ī\"\"5%7ī/5#;</,$;Ã/#$+#)(#'#(\"'#&'#"),R("%;I/' 8!:Ĭ!! )"),R("%3ĭ\"\"5&7Į/#;</$;D/$;Å/|$$%$;'/&#0#*;'&&&#/,#;Å/#$+\")(\"'#&'#0C*%$;'/&#0#*;'&&&#/,#;Å/#$+\")(\"'#&'#&/,$;E/#$+&)(&'#(%'#($'#(#'#(\"'#&'#"),R(";t.# &;w"),R("%3į\"\"5%7İ/5#;</,$;Ç/#$+#)(#'#(\"'#&'#"),R("%;I/' 8!:ı!! )"),R("%3Ĳ\"\"5&7ĳ/:#;</1$;I/($8#:Ĵ#! )(#'#(\"'#&'#"),R('%3ĵ""5%7Ķ/]#;</T$%3ķ""5$7ĸ/& 8!:Ĺ! ).4 &%3ĺ""5%7Ļ/& 8!:ļ! )/#$+#)(#\'#("\'#&\'#'),R('%3Ľ""5)7ľ/R#;</I$3Ŀ""5#7ŀ./ &3Ł""5(7ł.# &;6/($8#:Ń#! )(#\'#("\'#&\'#'),R('%3ń""5#7Ņ/#;</$;D/$%;Ì/e#$%2D""6D7E/,#;Ì/#$+")("\'#&\'#0<*%2D""6D7E/,#;Ì/#$+")("\'#&\'#&/#$+")("\'#&\'#/,$;E/#$+%)(%\'#($\'#(#\'#("\'#&\'#'),R('%3ņ""5(7Ň./ &3ň""5$7ŉ.# &;6/\' 8!:Ŋ!! )'),R("%;6/Y#$%;A/,#;6/#$+\")(\"'#&'#06*%;A/,#;6/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),R("%;Ï/G#;./>$;Ï/5$;./,$;/#$+%)(%'#($'#(#'#(\"'#&'#"),R("%$;!/&#0#*;!&&&#/' 8!:ŋ!! )"),R("%;Ñ/]#$%;A/,#;Ñ/#$+\")(\"'#&'#06*%;A/,#;Ñ/#$+\")(\"'#&'#&/'$8\":Ō\" )(\"'#&'#"),R("%;/]#$%;B/,#; /#$+\")(\"'#&'#06*%;B/,#; /#$+\")(\"'#&'#&/'$8\":ō\" )(\"'#&'#"),R('%;L.O &;.I &%;@." &"/:#;t/1$;?." &"/#$+#)(#\'#("\'#&\'#/]#$%;B/,#; /#$+")("\'#&\'#06*%;B/,#; /#$+")("\'#&\'#&/\'$8":Ŏ" )("\'#&\'#'),R("%;Ô/]#$%;B/,#;Õ/#$+\")(\"'#&'#06*%;B/,#;Õ/#$+\")(\"'#&'#&/'$8\":ŏ\" )(\"'#&'#"),R("%;/& 8!:Ő! )"),R('%3ő""5(7Œ/:#;</1$;6/($8#:œ#! )(#\'#("\'#&\'#.g &%3Ŕ""5&7ŕ/:#;</1$;6/($8#:Ŗ#! )(#\'#("\'#&\'#.: &%3ŗ""5*7Ř/& 8!:ř! ).# &; '),R('%%;6/k#$%;A/2#;6/)$8":Ś""$ )("\'#&\'#0<*%;A/2#;6/)$8":Ś""$ )("\'#&\'#&/)$8":ś""! )("\'#&\'#." &"/\' 8!:Ŝ!! )'),R("%;Ø/Y#$%;A/,#;Ø/#$+\")(\"'#&'#06*%;A/,#;Ø/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),R("%;/Y#$%;B/,#; /#$+\")(\"'#&'#06*%;B/,#; /#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),R("%$;!/&#0#*;!&&&#/' 8!:ŝ!! )"),R("%;Û/Y#$%;B/,#;Ü/#$+\")(\"'#&'#06*%;B/,#;Ü/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),R('%3Ş""5&7ş.; &3Š""5\'7š./ &3Ţ""5*7ţ.# &;6/& 8!:Ť! )'),R("%3ť\"\"5&7Ŧ/:#;</1$;Ý/($8#:ŧ#! )(#'#(\"'#&'#.} &%3õ\"\"5'7ö/:#;</1$;/($8#:Ũ#! )(#'#(\"'#&'#.P &%3ũ\"\"5+7Ū/:#;</1$;/($8#:ū#! )(#'#(\"'#&'#.# &; "),R('3Ŭ""5+7ŭ.k &3Ů""5)7ů._ &3Ű""5(7ű.S &3Ų""5\'7ų.G &3Ŵ""5&7ŵ.; &3Ŷ""5*7ŷ./ &3Ÿ""5)7Ź.# &;6'),R(';1." &"'),R('%%;6/k#$%;A/2#;6/)$8":Ś""$ )("\'#&\'#0<*%;A/2#;6/)$8":Ś""$ )("\'#&\'#&/)$8":ś""! )("\'#&\'#." &"/\' 8!:ź!! )'),R("%;L.# &;/]#$%;B/,#;á/#$+\")(\"'#&'#06*%;B/,#;á/#$+\")(\"'#&'#&/'$8\":Ż\" )(\"'#&'#"),R(";¹.# &; "),R("%;ã/Y#$%;A/,#;ã/#$+\")(\"'#&'#06*%;A/,#;ã/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),R("%;ê/k#;./b$;í/Y$$%;B/,#;ä/#$+\")(\"'#&'#06*%;B/,#;ä/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#"),R(";å.; &;æ.5 &;ç./ &;è.) &;é.# &; "),R("%3ż\"\"5#7Ž/:#;</1$;ð/($8#:ž#! )(#'#(\"'#&'#"),R("%3ſ\"\"5%7ƀ/:#;</1$;T/($8#:Ɓ#! )(#'#(\"'#&'#"),R("%3Ƃ\"\"5(7ƃ/F#;</=$;\\.) &;Y.# &;X/($8#:Ƅ#! )(#'#(\"'#&'#"),R("%3ƅ\"\"5&7Ɔ/:#;</1$;6/($8#:Ƈ#! )(#'#(\"'#&'#"),R('%3ƈ""5%7Ɖ/O#%;</3#$;!0#*;!&/#$+")("\'#&\'#." &"/\'$8":Ɗ" )("\'#&\'#'),R("%;ë/G#;;/>$;6/5$;;/,$;ì/#$+%)(%'#($'#(#'#(\"'#&'#"),R('%3""5#7Ó.# &;6/\' 8!:Ƌ!! )'),R('%3±""5#7ƌ.G &3³""5#7ƍ.; &3·""5#7Ǝ./ &3µ""5$7Ə.# &;6/\' 8!:Ɛ!! )'),R('%;î/D#%;C/,#;ï/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),R("%;U.) &;\\.# &;X/& 8!:Ƒ! )"),R('%%;!." &"/[#;!." &"/M$;!." &"/?$;!." &"/1$;!." &"/#$+%)(%\'#($\'#(#\'#("\'#&\'#/\' 8!:ƒ!! )'),R('%%;!/?#;!." &"/1$;!." &"/#$+#)(#\'#("\'#&\'#/\' 8!:Ɠ!! )'),R(";¾"),R('%;/^#$%;B/,#;ó/#$+")("\'#&\'#06*%;B/,#;ó/#$+")("\'#&\'#&/($8":Ɣ"!!)("\'#&\'#'),R(";ô.# &; "),R('%2ƕ""6ƕ7Ɩ/L#;</C$2Ɨ""6Ɨ7Ƙ.) &2ƙ""6ƙ7ƚ/($8#:ƛ#! )(#\'#("\'#&\'#'),R('%;/^#$%;B/,#; /#$+")("\'#&\'#06*%;B/,#; /#$+")("\'#&\'#&/($8":Ɯ"!!)("\'#&\'#'),R("%;6/5#;0/,$;÷/#$+#)(#'#(\"'#&'#"),R("$;2.) &;4.# &;.0/*;2.) &;4.# &;.&"),R("$;%0#*;%&"),R("%;ú/;#28\"\"6879/,$;û/#$+#)(#'#(\"'#&'#"),R('%3Ɲ""5%7ƞ.) &3Ɵ""5$7Ơ/\' 8!:ơ!! )'),R('%;ü/J#%28""6879/,#;^/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),R("%;\\.) &;X.# &;/' 8!:Ƣ!! )"),R(';".S &;!.M &2F""6F7G.A &2J""6J7K.5 &2H""6H7I.) &2N""6N7O'),R('2L""6L7M. &2B""6B7C. &2<""6<7=.} &2R""6R7S.q &2T""6T7U.e &2V""6V7W.Y &2P""6P7Q.M &2@""6@7A.A &2D""6D7E.5 &22""6273.) &2>""6>7?'),R('%;Ā/b#28""6879/S$;û/J$%2ƣ""6ƣ7Ƥ/,#;ì/#$+")("\'#&\'#." &"/#$+$)($\'#(#\'#("\'#&\'#'),R('%3ƥ""5%7Ʀ.) &3Ƨ""5$7ƨ/\' 8!:ơ!! )'),R('%;ì/O#3±""5#7².6 &3³""5#7´.* &$;+0#*;+&/\'$8":Ʃ" )("\'#&\'#'),R("%;Ą/#2F\"\"6F7G/x$;ă/o$2F\"\"6F7G/`$;ă/W$2F\"\"6F7G/H$;ă/?$2F\"\"6F7G/0$;ą/'$8):ƪ) )()'#(('#(''#(&'#(%'#($'#(#'#(\"'#&'#"),R("%;#/>#;#/5$;#/,$;#/#$+$)($'#(#'#(\"'#&'#"),R("%;ă/,#;ă/#$+\")(\"'#&'#"),R("%;ă/5#;ă/,$;ă/#$+#)(#'#(\"'#&'#"),R("%;/U#;'/L$;/C$;'/:$;/1$; .\" &\"/#$+&)(&'#(%'#($'#(#'#(\"'#&'#"),R('%2ƫ""6ƫ7Ƭ.) &2ƭ""6ƭ7Ʈ/w#;0/n$;Ĉ/e$$%;B/2#;ĉ.# &; /#$+")("\'#&\'#0<*%;B/2#;ĉ.# &; /#$+")("\'#&\'#&/#$+$)($\'#(#\'#("\'#&\'#'),R(";.# &;L"),R("%2Ư\"\"6Ư7ư/5#;</,$;Ċ/#$+#)(#'#(\"'#&'#"),R("%;D/S#;,/J$2:\"\"6:7;/;$;,.# &;T/,$;E/#$+%)(%'#($'#(#'#(\"'#&'#")],u=0,h=0,l=[{line:1,column:1}],d=0,p=[],g=0;if("startRule"in t){if(!(t.startRule in r))throw new Error("Can't start parsing from rule \""+t.startRule+'".');o=r[t.startRule]}function f(){return e.substring(h,u)}function T(){return E(h,u)}function m(e,t){return{type:"literal",text:e,ignoreCase:t}}function S(e,t,s){return{type:"class",parts:e,inverted:t,ignoreCase:s}}function _(t){var s,i=l[t];if(i)return i;for(s=t-1;!l[s];)s--;for(i={line:(i=l[s]).line,column:i.column};s<t;)10===e.charCodeAt(s)?(i.line++,i.column=1):i.column++,s++;return l[t]=i,i}function E(e,t){var s=_(e),i=_(t);return{start:{offset:e,line:s.line,column:s.column},end:{offset:t,line:i.line,column:i.column}}}function I(e){u<d||(u>d&&(d=u,p=[]),p.push(e))}function v(e,t,s){return new i(i.buildMessage(e,t),e,t,s)}function R(e){var t,s=new Array(e.length);for(t=0;t<e.length;t++)s[t]=e.charCodeAt(t)-32;return s}if(t.data={},(s=function t(s){for(var i,r,o=c[s],l=0,d=[],p=o.length,f=[],T=[];;){for(;l<p;)switch(o[l]){case 0:T.push(a[o[l+1]]),l+=2;break;case 1:T.push(void 0),l++;break;case 2:T.push(null),l++;break;case 3:T.push(n),l++;break;case 4:T.push([]),l++;break;case 5:T.push(u),l++;break;case 6:T.pop(),l++;break;case 7:u=T.pop(),l++;break;case 8:T.length-=o[l+1],l+=2;break;case 9:T.splice(-2,1),l++;break;case 10:T[T.length-2].push(T.pop()),l++;break;case 11:T.push(T.splice(T.length-o[l+1],o[l+1])),l+=2;break;case 12:T.push(e.substring(T.pop(),u)),l++;break;case 13:f.push(p),d.push(l+3+o[l+1]+o[l+2]),T[T.length-1]?(p=l+3+o[l+1],l+=3):(p=l+3+o[l+1]+o[l+2],l+=3+o[l+1]);break;case 14:f.push(p),d.push(l+3+o[l+1]+o[l+2]),T[T.length-1]===n?(p=l+3+o[l+1],l+=3):(p=l+3+o[l+1]+o[l+2],l+=3+o[l+1]);break;case 15:f.push(p),d.push(l+3+o[l+1]+o[l+2]),T[T.length-1]!==n?(p=l+3+o[l+1],l+=3):(p=l+3+o[l+1]+o[l+2],l+=3+o[l+1]);break;case 16:T[T.length-1]!==n?(f.push(p),d.push(l),p=l+2+o[l+1],l+=2):l+=2+o[l+1];break;case 17:f.push(p),d.push(l+3+o[l+1]+o[l+2]),e.length>u?(p=l+3+o[l+1],l+=3):(p=l+3+o[l+1]+o[l+2],l+=3+o[l+1]);break;case 18:f.push(p),d.push(l+4+o[l+2]+o[l+3]),e.substr(u,a[o[l+1]].length)===a[o[l+1]]?(p=l+4+o[l+2],l+=4):(p=l+4+o[l+2]+o[l+3],l+=4+o[l+2]);break;case 19:f.push(p),d.push(l+4+o[l+2]+o[l+3]),e.substr(u,a[o[l+1]].length).toLowerCase()===a[o[l+1]]?(p=l+4+o[l+2],l+=4):(p=l+4+o[l+2]+o[l+3],l+=4+o[l+2]);break;case 20:f.push(p),d.push(l+4+o[l+2]+o[l+3]),a[o[l+1]].test(e.charAt(u))?(p=l+4+o[l+2],l+=4):(p=l+4+o[l+2]+o[l+3],l+=4+o[l+2]);break;case 21:T.push(e.substr(u,o[l+1])),u+=o[l+1],l+=2;break;case 22:T.push(a[o[l+1]]),u+=a[o[l+1]].length,l+=2;break;case 23:T.push(n),0===g&&I(a[o[l+1]]),l+=2;break;case 24:h=T[T.length-1-o[l+1]],l+=2;break;case 25:h=u,l++;break;case 26:for(i=o.slice(l+4,l+4+o[l+3]),r=0;r<o[l+3];r++)i[r]=T[T.length-1-i[r]];T.splice(T.length-o[l+2],o[l+2],a[o[l+1]].apply(null,i)),l+=4+o[l+3];break;case 27:T.push(t(o[l+1])),l+=2;break;case 28:g++,l++;break;case 29:g--,l++;break;default:throw new Error("Invalid opcode: "+o[l]+".")}if(!(f.length>0))break;p=f.pop(),l=d.pop()}return T[0]}(o))!==n&&u===e.length)return s;throw s!==n&&u<e.length&&I({type:"end"}),v(p,d<e.length?e.charAt(d):null,d<e.length?E(d,d+1):E(d,d))}}},function(e,t,s){"use strict";e.exports=function(e){function t(e,t){var s,i,n=[],r=e.split(/\r\n/);for(s=0;s<r.length;){var o=r[s];if(/^m=(?:audio|video)/.test(o))i={index:s,stripped:[]},n.push(i);else if(i){var a=/^a=rtpmap:(\d+) ([^/]+)\//.exec(o);if(a&&t===a[2]){r.splice(s,1),i.stripped.push(a[1]);continue}}s++}for(s=0;s<n.length;s++){for(var c=r[n[s].index].split(" "),u=3;u<c.length;)-1===n[s].stripped.indexOf(c[u])?u++:c.splice(u,1);r[n[s].index]=c.join(" ")}return r.join("\r\n")}return{stripTcpCandidates:function(t){return t.sdp=t.sdp.replace(/^a=candidate:\d+ \d+ tcp .*?\r\n/gim,""),e.Utils.Promise.resolve(t)},stripTelephoneEvent:function(s){return s.sdp=t(s.sdp,"telephone-event"),e.Utils.Promise.resolve(s)},cleanJitsiSdpImageattr:function(t){return t.sdp=t.sdp.replace(/^(a=imageattr:.*?)(x|y)=\[0-/gm,"$1$2=[1:"),e.Utils.Promise.resolve(t)},stripG722:function(s){return s.sdp=t(s.sdp,"G722"),e.Utils.Promise.resolve(s)},stripRtpPayload:function(s){return function(i){return i.sdp=t(i.sdp,s),e.Utils.Promise.resolve(i)}},stripVideo:function(t){return t.sdp=function(e,t){var s=new RegExp("m="+t+".*$","gm"),i=new RegExp("^a=group:.*$","gm");if(s.test(e)){var n,r=(e=e.split(/^m=/gm).filter((function(e){return e.substr(0,t.length)!==t||((n=e.match(/^a=mid:.*$/gm))&&(n=n[0].match(/:.+$/g)[0].substr(1)),!1)})).join("m=")).match(i);if(r&&1===r.length){r=r[0];var o=new RegExp(" *"+n+"[^ ]*","g");r=r.replace(o,""),e=e.split(i).join(r)}}return e}(t.sdp,"video"),e.Utils.Promise.resolve(t)},addMidLines:function(t){var s=t.sdp;if(-1===s.search(/^a=mid.*$/gm)){var i=s.match(/^m=.*$/gm);s=s.split(/^m=.*$/gm),i.forEach((function(e,t){i[t]=e+"\na=mid:"+t})),s.forEach((function(e,t){i[t]&&(s[t]=e+i[t])})),s=s.join(""),t.sdp=s}return e.Utils.Promise.resolve(t)}}}},function(e,t,s){"use strict";(function(t){e.exports=function(e){var s={STATUS_NULL:0,STATUS_NEW:1,STATUS_CONNECTING:2,STATUS_CONNECTED:3,STATUS_COMPLETED:4},i=function(i){if(i.media.remote.video?this.video=!0:this.video=!1,i.media.remote.audio?this.audio=!0:this.audio=!1,!this.audio&&!this.video)throw new Error("At least one remote audio or video element is required for Simple.");this.options=i;var n=t.navigator.userAgent.toLowerCase(),r=!1,o=!1;n.indexOf("safari")>-1&&n.indexOf("chrome")<0?r=!0:n.indexOf("firefox")>-1&&n.indexOf("chrome")<0&&(o=!0);var a={};return r&&(a.modifiers=[e.Web.Modifiers.stripG722]),o&&(a.alwaysAcquireMediaFirst=!0),this.options.ua.uri||(this.anonymous=!0),this.ua=new e.UA({uri:this.options.ua.uri,authorizationUser:this.options.ua.authorizationUser,password:this.options.ua.password,displayName:this.options.ua.displayName,userAgentString:this.options.ua.userAgentString,register:!0,sessionDescriptionHandlerFactoryOptions:a,transportOptions:{traceSip:this.options.ua.traceSip,wsServers:this.options.ua.wsServers}}),this.state=s.STATUS_NULL,this.logger=this.ua.getLogger("sip.simple"),this.ua.on("registered",function(){this.emit("registered",this.ua)}.bind(this)),this.ua.on("unregistered",function(){this.emit("unregistered",this.ua)}.bind(this)),this.ua.on("failed",function(){this.emit("unregistered",this.ua)}.bind(this)),this.ua.on("invite",function(e){if(this.state!==s.STATUS_NULL&&this.state!==s.STATUS_COMPLETED)return this.logger.warn("Rejecting incoming call. Simple only supports 1 call at a time"),void e.reject();this.session=e,this.setupSession(),this.emit("ringing",this.session)}.bind(this)),this.ua.on("message",function(e){this.emit("message",e)}.bind(this)),this};return i.prototype=Object.create(e.EventEmitter.prototype),i.C=s,i.prototype.call=function(e){if(this.ua&&this.checkRegistration()){if(this.state===s.STATUS_NULL||this.state===s.STATUS_COMPLETED)return this.options.media.remote.audio&&(this.options.media.remote.audio.autoplay=!0),this.options.media.remote.video&&(this.options.media.remote.video.autoplay=!0),this.options.media.local&&this.options.media.local.video&&(this.options.media.local.video.autoplay=!0,this.options.media.local.video.volume=0),this.session=this.ua.invite(e,{sessionDescriptionHandlerOptions:{constraints:{audio:this.audio,video:this.video}}}),this.setupSession(),this.session;this.logger.warn("Cannot make more than a single call with Simple")}else this.logger.warn("A registered UA is required for calling")},i.prototype.answer=function(){if(this.state===s.STATUS_NEW||this.state===s.STATUS_CONNECTING)return this.options.media.remote.audio&&(this.options.media.remote.audio.autoplay=!0),this.options.media.remote.video&&(this.options.media.remote.video.autoplay=!0),this.session.accept({sessionDescriptionHandlerOptions:{constraints:{audio:this.audio,video:this.video}}});this.logger.warn("No call to answer")},i.prototype.reject=function(){if(this.state===s.STATUS_NEW||this.state===s.STATUS_CONNECTING)return this.session.reject();this.logger.warn("Call is already answered")},i.prototype.hangup=function(){if(this.state===s.STATUS_CONNECTED||this.state===s.STATUS_CONNECTING||this.state===s.STATUS_NEW)return this.state!==s.STATUS_CONNECTED?this.session.cancel():this.session.bye();this.logger.warn("No active call to hang up on")},i.prototype.hold=function(){if(this.state===s.STATUS_CONNECTED&&!this.session.local_hold)return this.mute(),this.logger.log("Placing session on hold"),this.session.hold();this.logger.warn("Cannot put call on hold")},i.prototype.unhold=function(){if(this.state===s.STATUS_CONNECTED&&this.session.local_hold)return this.unmute(),this.logger.log("Placing call off hold"),this.session.unhold();this.logger.warn("Cannot unhold a call that is not on hold")},i.prototype.mute=function(){this.state===s.STATUS_CONNECTED?(this.logger.log("Muting Audio"),this.toggleMute(!0),this.emit("mute",this)):this.logger.warn("An acitve call is required to mute audio")},i.prototype.unmute=function(){this.state===s.STATUS_CONNECTED?(this.logger.log("Unmuting Audio"),this.toggleMute(!1),this.emit("unmute",this)):this.logger.warn("An active call is required to unmute audio")},i.prototype.sendDTMF=function(e){this.state===s.STATUS_CONNECTED?(this.logger.log("Sending DTMF tone: "+e),this.session.dtmf(e)):this.logger.warn("An active call is required to send a DTMF tone")},i.prototype.message=function(e,t){this.ua&&this.checkRegistration()?e&&t?this.ua.message(e,t):this.logger.warn("A destination and message are required to send a message"):this.logger.warn("A registered UA is required to send a message")},i.prototype.checkRegistration=function(){return this.anonymous||this.ua&&this.ua.isRegistered()},i.prototype.setupRemoteMedia=function(){var e,s=this.session.sessionDescriptionHandler.peerConnection;s.getReceivers?(e=new t.window.MediaStream,s.getReceivers().forEach((function(t){var s=t.track;s&&e.addTrack(s)}))):e=s.getRemoteStreams()[0],this.video?(this.options.media.remote.video.srcObject=e,this.options.media.remote.video.play().catch(function(){this.logger.log("play was rejected")}.bind(this))):this.audio&&(this.options.media.remote.audio.srcObject=e,this.options.media.remote.audio.play().catch(function(){this.logger.log("play was rejected")}.bind(this)))},i.prototype.setupLocalMedia=function(){if(this.video&&this.options.media.local&&this.options.media.local.video){var e,s=this.session.sessionDescriptionHandler.peerConnection;s.getSenders?(e=new t.window.MediaStream,s.getSenders().forEach((function(t){var s=t.track;s&&"video"===s.kind&&e.addTrack(s)}))):e=s.getLocalStreams()[0],this.options.media.local.video.srcObject=e,this.options.media.local.video.volume=0,this.options.media.local.video.play()}},i.prototype.cleanupMedia=function(){this.video&&(this.options.media.remote.video.srcObject=null,this.options.media.remote.video.pause(),this.options.media.local&&this.options.media.local.video&&(this.options.media.local.video.srcObject=null,this.options.media.local.video.pause())),this.audio&&(this.options.media.remote.audio.srcObject=null,this.options.media.remote.audio.pause())},i.prototype.setupSession=function(){this.state=s.STATUS_NEW,this.emit("new",this.session),this.session.on("progress",this.onProgress.bind(this)),this.session.on("accepted",this.onAccepted.bind(this)),this.session.on("rejected",this.onEnded.bind(this)),this.session.on("failed",this.onFailed.bind(this)),this.session.on("terminated",this.onEnded.bind(this))},i.prototype.destroyMedia=function(){this.session.sessionDescriptionHandler.close()},i.prototype.toggleMute=function(e){var t=this.session.sessionDescriptionHandler.peerConnection;t.getSenders?t.getSenders().forEach((function(t){t.track&&(t.track.enabled=!e)})):t.getLocalStreams().forEach((function(t){t.getAudioTracks().forEach((function(t){t.enabled=!e})),t.getVideoTracks().forEach((function(t){t.enabled=!e}))}))},i.prototype.onAccepted=function(){this.state=s.STATUS_CONNECTED,this.emit("connected",this.session),this.setupLocalMedia(),this.setupRemoteMedia(),this.session.sessionDescriptionHandler.on("addTrack",function(){this.logger.log("A track has been added, triggering new remoteMedia setup"),this.setupRemoteMedia()}.bind(this)),this.session.sessionDescriptionHandler.on("addStream",function(){this.logger.log("A stream has been added, trigger new remoteMedia setup"),this.setupRemoteMedia()}.bind(this)),this.session.on("hold",function(){this.emit("hold",this.session)}.bind(this)),this.session.on("unhold",function(){this.emit("unhold",this.session)}.bind(this)),this.session.on("dtmf",function(e){this.emit("dtmf",e)}.bind(this)),this.session.on("bye",this.onEnded.bind(this))},i.prototype.onProgress=function(){this.state=s.STATUS_CONNECTING,this.emit("connecting",this.session)},i.prototype.onFailed=function(){this.onEnded()},i.prototype.onEnded=function(){this.state=s.STATUS_COMPLETED,this.emit("ended",this.session),this.cleanupMedia()},i}}).call(this,s(28))},function(e,t,s){"use strict";(function(t){var i=t.window||t;function n(e,t){if(null!=e){var s=t.charAt(0).toUpperCase()+t.slice(1),i=[t,"webkit"+s,"moz"+s];for(var n in i){var r=e[i[n]];if(r)return r.bind(e)}}}e.exports={WebSocket:i.WebSocket,Transport:s(10),open:i.open,Promise:i.Promise,timers:i,console:i.console||{debug:function(){},log:function(){},warn:function(){},error:function(){}},addEventListener:n(i,"addEventListener"),removeEventListener:n(i,"removeEventListener")}}).call(this,s(28))}])},e.exports=i()},function(e,t,s){var i;/*! @engage-voice/agent-library - v3.0.18 - 2020-03-06 */
!function e(t,s,i){function n(o,a){if(!s[o]){if(!t[o]){if(r)return r(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var u=s[o]={exports:{}};t[o][0].call(u.exports,(function(e){var s=t[o][1][e];return n(s||e)}),u,u.exports,e,t,s,i)}return s[o].exports}for(var r=!1,o=0;o<i.length;o++)n(i[o]);return n}({1:[function(e,t,s){"use strict";e("./index").polyfill()},{"./index":2}],2:[function(e,t,s){"use strict";function i(e,t){if(null==e)throw new TypeError("Cannot convert first argument to object");for(var s=Object(e),i=1;i<arguments.length;i++){var n=arguments[i];if(null!=n)for(var r=Object.keys(Object(n)),o=0,a=r.length;o<a;o++){var c=r[o],u=Object.getOwnPropertyDescriptor(n,c);void 0!==u&&u.enumerable&&(s[c]=n[c])}}return s}t.exports={assign:i,polyfill:function(){Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:i})}}},{}]},{},[1]),e.exports=function(e){var t={};function s(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(i,n,function(t){return e[t]}.bind(null,n));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=2)}([function(e,t){var s;s=function(){return this}();try{s=s||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(s=window)}e.exports=s},function(e,t,s){"use strict";e.exports=function(e){var t=function(e,t){};return t.prototype=Object.create(e.EventEmitter.prototype,{connect:{writable:!0,value:function(e){return e=e||{},this.connectPromise(e).then(function(e){!e.overrideEvent&&this.emit("connected")}.bind(this))}},connectPromise:{writable:!0,value:function(e){}},isConnected:{writable:!0,value:function(){}},send:{writable:!0,value:function(e,t){return t=t||{},this.sendPromise(e).then(function(e){!e.overrideEvent&&this.emit("messageSent",e.msg)}.bind(this))}},sendPromise:{writable:!0,value:function(e,t){}},onMessage:{writable:!0,value:function(e){}},disconnect:{writable:!0,value:function(e){return e=e||{},this.disconnectPromise(e).then(function(e){!e.overrideEvent&&this.emit("disconnected")}.bind(this))}},disconnectPromise:{writable:!0,value:function(e){}},afterConnected:{writable:!0,value:function(e){this.isConnected()?e():this.once("connected",e)}},waitForConnected:{writable:!0,value:function(){return console.warn("DEPRECATION WARNING Transport.waitForConnected(): use afterConnected() instead"),new e.Utils.Promise(function(e){this.afterConnected(e)}.bind(this))}}}),t}},function(e,t,s){"use strict";e.exports=s(3)(s(40))},function(e,t,s){"use strict";e.exports=function(e){var t=s(4),i=t.version,n=t.title,r=Object.defineProperties({},{version:{get:function(){return i}},name:{get:function(){return n}}});return s(5)(r,e),r.LoggerFactory=s(6)(e.console),r.EventEmitter=s(7)(),r.C=s(9)(r.name,r.version),r.Exceptions=s(10),r.Timers=s(11)(e.timers),r.Transport=s(1)(r),s(12)(r),s(13)(r),s(14)(r),s(15)(r),s(16)(r),s(17)(r),s(19)(r),s(20)(r),r.SessionDescriptionHandler=s(21)(r.EventEmitter),s(22)(r),s(23)(r),s(24)(r),s(26)(r),s(27)(r),s(28)(r,e),s(32)(r),r.DigestAuthentication=s(33)(r.Utils),r.Grammar=s(36)(r),r.Web={Modifiers:s(38)(r),Simple:s(39)(r)},r}},function(e){e.exports={name:"sip.js",title:"SIP.js",description:"A simple, intuitive, and powerful JavaScript signaling library",version:"0.11.6",main:"dist/sip.js",browser:{"./src/environment.js":"./src/environment_browser.js"},homepage:"https://sipjs.com",author:"OnSIP <developer@onsip.com> (https://sipjs.com/aboutus/)",contributors:[{url:"https://github.com/onsip/SIP.js/blob/master/THANKS.md"}],repository:{type:"git",url:"https://github.com/onsip/SIP.js.git"},keywords:["sip","websocket","webrtc","library","javascript"],devDependencies:{"awesome-typescript-loader":"^5.2.1",eslint:"^5.4.0","jasmine-core":"^3.2.1",karma:"^3.0.0","karma-chrome-launcher":"^2.2.0","karma-cli":"^1.0.1","karma-jasmine":"^1.1.0","karma-jasmine-html-reporter":"^1.3.1","karma-mocha-reporter":"^2.2.5","karma-webpack":"^3.0.0",pegjs:"^0.10.0","pegjs-loader":"^0.5.4",typescript:"^3.0.3",webpack:"^4.19.0","webpack-cli":"^3.0.8"},engines:{node:">=6.0"},license:"MIT",scripts:{prebuild:"eslint src/*.js src/**/*.js","build-dev":"webpack --progress --env.buildType dev","build-prod":"webpack --progress --env.buildType prod","copy-dist-files":"cp dist/sip.js dist/sip-$npm_package_version.js && cp dist/sip.min.js  dist/sip-$npm_package_version.min.js",build:"npm run build-dev && npm run build-prod && npm run copy-dist-files",browserTest:"sleep 2 && open http://0.0.0.0:9876/debug.html & karma start --reporters kjhtml --no-single-run",commandLineTest:"karma start --reporters mocha --browsers ChromeHeadless --single-run",buildAndTest:"npm run build && npm run commandLineTest",buildAndBrowserTest:"npm run build && npm run browserTest"},dependencies:{"crypto-js":"^3.1.9-1"},optionalDependencies:{promiscuous:"^0.6.0"}}},function(e,t,s){"use strict";e.exports=function(e,t){var s;s={Promise:t.Promise,defer:function(){var e={};return e.promise=new s.Promise((function(t,s){e.resolve=t,e.reject=s})),e},reducePromises:function(t,s){return t.reduce((function(e,t){return e.then(t)}),e.Utils.Promise.resolve(s))},augment:function(e,t,s,i){var n,r;for(n in r=t.prototype)(i||void 0===e[n])&&(e[n]=r[n]);t.apply(e,s)},defaultOptions:function(e,t){return e=e||{},t=t||{},Object.assign({},e,t)},optionsOverride:function(e,t,s,i,n,r){i&&e[s]&&n.warn(s+" is deprecated, please use "+t+" instead"),e[t]&&e[s]&&n.warn(t+" overriding "+s),e[t]=e[t]||e[s]||r},str_utf8_length:function(e){return encodeURIComponent(e).replace(/%[A-F\d]{2}/g,"U").length},generateFakeSDP:function(e){if(e){var t=e.indexOf("o="),s=e.indexOf("\r\n",t);return"v=0\r\n"+e.slice(t,s)+"\r\ns=-\r\nt=0 0\r\nc=IN IP4 0.0.0.0"}},isFunction:function(e){return void 0!==e&&"[object Function]"===Object.prototype.toString.call(e)},isDecimal:function(e){return!isNaN(e)&&parseFloat(e)===parseInt(e,10)},createRandomToken:function(e,t){var s,i="";for(t=t||32,s=0;s<e;s++)i+=(Math.random()*t|0).toString(t);return i},newTag:function(){return e.Utils.createRandomToken(e.UA.C.TAG_LENGTH)},newUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},hostType:function(t){if(t)return-1!==(t=e.Grammar.parse(t,"host"))?t.host_type:void 0},normalizeTarget:function(t,s){var i,n,r;if(t){if(t instanceof e.URI)return t;if("string"==typeof t){switch((i=t.split("@")).length){case 1:if(!s)return;n=t,r=s;break;case 2:n=i[0],r=i[1];break;default:n=i.slice(0,i.length-1).join("@"),r=i[i.length-1]}return n=n.replace(/^(sips?|tel):/i,""),/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(n)&&(n=n.replace(/[\-\.\(\)]/g,"")),t=e.C.SIP+":"+e.Utils.escapeUser(n)+"@"+r,e.URI.parse(t)}}},escapeUser:function(e){return encodeURIComponent(decodeURIComponent(e)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},headerize:function(e){var t,s={"Call-Id":"Call-ID",Cseq:"CSeq","Min-Se":"Min-SE",Rack:"RAck",Rseq:"RSeq","Www-Authenticate":"WWW-Authenticate"},i=e.toLowerCase().replace(/_/g,"-").split("-"),n="",r=i.length;for(t=0;t<r;t++)0!==t&&(n+="-"),n+=i[t].charAt(0).toUpperCase()+i[t].substring(1);return s[n]&&(n=s[n]),n},sipErrorCause:function(t){var s;for(s in e.C.SIP_ERROR_CAUSES)if(-1!==e.C.SIP_ERROR_CAUSES[s].indexOf(t))return e.C.causes[s];return e.C.causes.SIP_FAILURE_CODE},getReasonPhrase:function(t,s){return s||e.C.REASON_PHRASE[t]||""},getReasonHeaderValue:function(t,s){return"SIP;cause="+t+';text="'+(s=e.Utils.getReasonPhrase(t,s))+'"'},getCancelReason:function(t,s){if(t&&t<200||t>699)throw new TypeError("Invalid status_code: "+t);if(t)return e.Utils.getReasonHeaderValue(t,s)},buildStatusLine:function(e,t){if(t=t||null,!(e=e||null)||e<100||e>699)throw new TypeError("Invalid status_code: "+e);if(t&&"string"!=typeof t&&!(t instanceof String))throw new TypeError("Invalid reason_phrase: "+t);return"SIP/2.0 "+e+" "+(t=s.getReasonPhrase(e,t))+"\r\n"},getRandomTestNetIP:function(){return"192.0.2."+Math.floor(254*Math.random()+1)}},e.Utils=s}},function(e,t,s){"use strict";var i={error:0,warn:1,log:2,debug:3};e.exports=function(e){var t=function(){var e,t=2,s=!0,n=null;this.loggers={},e=this.getLogger("sip.loggerfactory"),Object.defineProperties(this,{builtinEnabled:{get:function(){return s},set:function(t){"boolean"==typeof t?s=t:e.error('invalid "builtinEnabled" parameter value: '+JSON.stringify(t))}},level:{get:function(){return t},set:function(s){s>=0&&s<=3?t=s:s>3?t=3:i.hasOwnProperty(s)?t=i[s]:e.error('invalid "level" parameter value: '+JSON.stringify(s))}},connector:{get:function(){return n},set:function(t){null===t||""===t||void 0===t?n=null:"function"==typeof t?n=t:e.error('invalid "connector" parameter value: '+JSON.stringify(t))}}})};function s(e,t,s){this.logger=e,this.category=t,this.label=s}return t.prototype.print=function(t,s,i,n){if("string"==typeof n){var r=[new Date,s];i&&r.push(i),n=r.concat(n).join(" | ")}t.call(e,n)},Object.keys(i).forEach((function(n){s.prototype[n]=function(e){this.logger[n](this.category,this.label,e)},t.prototype[n]=function(t,s,r){this.level>=i[n]&&(this.builtinEnabled&&this.print(e[n],t,s,r),this.connector&&this.connector(n,t,s,r))}})),t.prototype.getLogger=function(e,t){var i;return t&&3===this.level?new s(this,e,t):this.loggers[e]?this.loggers[e]:(i=new s(this,e),this.loggers[e]=i,i)},t}},function(e,t,s){"use strict";var i=s(8).EventEmitter;e.exports=function(){function e(){i.call(this)}return e.prototype=Object.create(i.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),e}},function(e,t){function s(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function n(e){return"object"==typeof e&&null!==e}function r(e){return void 0===e}e.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._maxListeners=void 0,s.defaultMaxListeners=10,s.prototype.setMaxListeners=function(e){if(!function(e){return"number"==typeof e}(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},s.prototype.emit=function(e){var t,s,o,a,c,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||n(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var h=new Error('Uncaught, unspecified "error" event. ('+t+")");throw h.context=t,h}if(r(s=this._events[e]))return!1;if(i(s))switch(arguments.length){case 1:s.call(this);break;case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),s.apply(this,a)}else if(n(s))for(a=Array.prototype.slice.call(arguments,1),o=(u=s.slice()).length,c=0;c<o;c++)u[c].apply(this,a);return!0},s.prototype.addListener=function(e,t){var o;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?n(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,n(this._events[e])&&!this._events[e].warned&&(o=r(this._maxListeners)?s.defaultMaxListeners:this._maxListeners)&&o>0&&this._events[e].length>o&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},s.prototype.on=s.prototype.addListener,s.prototype.once=function(e,t){if(!i(t))throw TypeError("listener must be a function");var s=!1;function n(){this.removeListener(e,n),s||(s=!0,t.apply(this,arguments))}return n.listener=t,this.on(e,n),this},s.prototype.removeListener=function(e,t){var s,r,o,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(s=this._events[e]).length,r=-1,s===t||i(s.listener)&&s.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(n(s)){for(a=o;a-- >0;)if(s[a]===t||s[a].listener&&s[a].listener===t){r=a;break}if(r<0)return this;1===s.length?(s.length=0,delete this._events[e]):s.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},s.prototype.removeAllListeners=function(e){var t,s;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i(s=this._events[e]))this.removeListener(e,s);else if(s)for(;s.length;)this.removeListener(e,s[s.length-1]);return delete this._events[e],this},s.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},s.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},s.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,s){"use strict";e.exports=function(e,t){return{USER_AGENT:e+"/"+t,SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",AUTHENTICATION_ERROR:"Authentication Error",DIALOG_ERROR:"Dialog Error",WEBRTC_NOT_SUPPORTED:"WebRTC Not Supported",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",NO_PRACK:"No PRACK",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},supported:{UNSUPPORTED:"none",SUPPORTED:"supported",REQUIRED:"required"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",PUBLISH:"PUBLISH",REFER:"REFER",PRACK:"PRACK",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},OPTION_TAGS:{"100rel":!0,199:!0,answermode:!0,"early-session":!0,eventlist:!0,explicitsub:!0,"from-change":!0,"geolocation-http":!0,"geolocation-sip":!0,gin:!0,gruu:!0,histinfo:!0,ice:!0,join:!0,"multiple-refer":!0,norefersub:!0,nosub:!0,outbound:!0,path:!0,policy:!0,precondition:!0,pref:!0,privacy:!0,"recipient-list-invite":!0,"recipient-list-message":!0,"recipient-list-subscribe":!0,replaces:!0,"resource-priority":!0,"sdp-anat":!0,"sec-agree":!0,tdialog:!0,timer:!0,uui:!0},dtmfType:{INFO:"info",RTP:"rtp"}}}},function(e,t,s){"use strict";e.exports={ConfigurationError:function(){var e=function(e,t){this.code=1,this.name="CONFIGURATION_ERROR",this.parameter=e,this.value=t,this.message=this.value?"Invalid value "+JSON.stringify(this.value)+' for parameter "'+this.parameter+'"':"Missing parameter: "+this.parameter};return e.prototype=new Error,e}(),InvalidStateError:function(){var e=function(e){this.code=2,this.name="INVALID_STATE_ERROR",this.status=e,this.message="Invalid status: "+e};return e.prototype=new Error,e}(),NotSupportedError:function(){var e=function(e){this.code=3,this.name="NOT_SUPPORTED_ERROR",this.message=e};return e.prototype=new Error,e}(),GetDescriptionError:function(){var e=function(e){this.code=4,this.name="GET_DESCRIPTION_ERROR",this.message=e};return e.prototype=new Error,e}(),RenegotiationError:function(){var e=function(e){this.code=5,this.name="RENEGOTIATION_ERROR",this.message=e};return e.prototype=new Error,e}(),MethodParameterError:function(){var e=function(e,t,s){this.code=6,this.name="METHOD_PARAMETER_ERROR",this.method=e,this.parameter=t,this.value=s,this.message=this.value?"Invalid value "+JSON.stringify(this.value)+' for parameter "'+this.parameter+'"':"Missing parameter: "+this.parameter};return e.prototype=new Error,e}(),TransportError:function(){var e=function(e){this.code=7,this.name="TRANSPORT_ERROR",this.message=e};return e.prototype=new Error,e}(),SessionDescriptionHandlerError:function(){var e=function(e,t,s){this.code=8,this.name="SESSION_DESCRIPTION_HANDLER_ERROR",this.method=e,this.error=t,this.message=s||"Error with Session Description Handler"};return e.prototype=new Error,e}()}},function(e,t,s){"use strict";e.exports=function(e){var t={T1:500,T2:4e3,T4:5e3,TIMER_B:32e3,TIMER_D:0,TIMER_F:32e3,TIMER_H:32e3,TIMER_I:0,TIMER_J:0,TIMER_K:0,TIMER_L:32e3,TIMER_M:32e3,TIMER_N:32e3,PROVISIONAL_RESPONSE_INTERVAL:6e4};return["setTimeout","clearTimeout","setInterval","clearInterval"].forEach((function(s){t[s]=function(){return e[s].apply(e,arguments)}})),t}},function(e,t,s){"use strict";e.exports=function(e){var t;function s(e,t){var s=t,i=0,n=0;if(e.substring(s,s+2).match(/(^\r\n)/))return-2;for(;0===i;){if(-1===(n=e.indexOf("\r\n",s)))return n;!e.substring(n+2,n+4).match(/(^\r\n)/)&&e.charAt(n+2).match(/(^\s+)/)?s=n+2:i=n}return i}function i(t,s,i,n){var r,o,a,c,u=s.indexOf(":",i),h=s.substring(i,u).trim(),l=s.substring(u+1,n).trim();switch(h.toLowerCase()){case"via":case"v":t.addHeader("via",l),1===t.getHeaders("via").length?(c=t.parseHeader("Via"))&&(t.via=c,t.via_branch=c.branch):c=0;break;case"from":case"f":t.setHeader("from",l),(c=t.parseHeader("from"))&&(t.from=c,t.from_tag=c.getParam("tag"));break;case"to":case"t":t.setHeader("to",l),(c=t.parseHeader("to"))&&(t.to=c,t.to_tag=c.getParam("tag"));break;case"record-route":if(-1===(c=e.Grammar.parse(l,"Record_Route"))){c=void 0;break}for(a=c.length,o=0;o<a;o++)r=c[o],t.addHeader("record-route",l.substring(r.position,r.offset)),t.headers["Record-Route"][t.getHeaders("record-route").length-1].parsed=r.parsed;break;case"call-id":case"i":t.setHeader("call-id",l),(c=t.parseHeader("call-id"))&&(t.call_id=l);break;case"contact":case"m":if(-1===(c=e.Grammar.parse(l,"Contact"))){c=void 0;break}for(a=c.length,o=0;o<a;o++)r=c[o],t.addHeader("contact",l.substring(r.position,r.offset)),t.headers.Contact[t.getHeaders("contact").length-1].parsed=r.parsed;break;case"content-length":case"l":t.setHeader("content-length",l),c=t.parseHeader("content-length");break;case"content-type":case"c":t.setHeader("content-type",l),c=t.parseHeader("content-type");break;case"cseq":t.setHeader("cseq",l),(c=t.parseHeader("cseq"))&&(t.cseq=c.value),t instanceof e.IncomingResponse&&(t.method=c.method);break;case"max-forwards":t.setHeader("max-forwards",l),c=t.parseHeader("max-forwards");break;case"www-authenticate":t.setHeader("www-authenticate",l),c=t.parseHeader("www-authenticate");break;case"proxy-authenticate":t.setHeader("proxy-authenticate",l),c=t.parseHeader("proxy-authenticate");break;case"refer-to":case"r":t.setHeader("refer-to",l),(c=t.parseHeader("refer-to"))&&(t.refer_to=c);break;default:t.setHeader(h,l),c=0}return void 0!==c||{error:'error parsing header "'+h+'"'}}(t={}).parseMessage=function(t,n){var r,o,a,c,u,h=0,l=t.indexOf("\r\n"),d=n.getLogger("sip.parser");if(-1!==l){if(o=t.substring(0,l),-1!==(u=e.Grammar.parse(o,"Request_Response"))){for(u.status_code?((r=new e.IncomingResponse(n)).status_code=u.status_code,r.reason_phrase=u.reason_phrase):((r=new e.IncomingRequest(n)).method=u.method,r.ruri=u.uri),r.data=t,h=l+2;;){if(-2===(l=s(t,h))){c=h+2;break}if(-1===l)return void d.error("malformed message");if(!0!==(u=i(r,t,h,l)))return void d.error(u.error);h=l+2}return r.hasHeader("content-length")?(a=r.getHeader("content-length"),r.body=t.substr(c,a)):r.body=t.substring(c),r}d.warn('error parsing first line of SIP message: "'+o+'"')}else d.warn("no CRLF found, not a SIP message, discarded")},e.Parser=t}},function(e,t,s){"use strict";e.exports=function(e){var t,s,i,n;function r(t){var s=t.ua.configuration.hackAllowUnregisteredOptionTags,i=[],n={};return t.method===e.C.REGISTER?i.push("path","gruu"):t.method===e.C.INVITE&&(t.ua.contact.pub_gruu||t.ua.contact.temp_gruu)&&i.push("gruu"),t.ua.configuration.rel100===e.C.supported.SUPPORTED&&i.push("100rel"),t.ua.configuration.replaces===e.C.supported.SUPPORTED&&i.push("replaces"),i.push("outbound"),"Supported: "+(i=(i=i.concat(t.ua.configuration.extraSupported)).filter((function(t){var i=e.C.OPTION_TAGS[t],r=!n[t];return n[t]=!0,(i||s)&&r}))).join(", ")+"\r\n"}(t=function(t,s,i,n,r,o){var a,c,u,h,l,d;if(n=n||{},!t||!s||!i)return null;this.logger=i.getLogger("sip.sipmessage"),this.ua=i,this.headers={},this.method=t,this.ruri=s,this.body=o,this.extraHeaders=(r||[]).slice(),this.statusCode=n.status_code,this.reasonPhrase=n.reason_phrase,n.route_set?this.setHeader("route",n.route_set):i.configuration.usePreloadedRoute&&this.setHeader("route",i.transport.server.sip_uri),this.setHeader("via",""),this.setHeader("max-forwards",e.UA.C.MAX_FORWARDS),l=n.to_uri||s,a=n.to_displayName||0===n.to_displayName?'"'+n.to_displayName+'" ':"",a+="<"+(l&&l.toRaw?l.toRaw():l)+">",a+=n.to_tag?";tag="+n.to_tag:"",this.to=new e.NameAddrHeader.parse(a),this.setHeader("to",a),d=n.from_uri||i.configuration.uri,c=n.from_displayName||0===n.from_displayName?'"'+n.from_displayName+'" ':i.configuration.displayName?'"'+i.configuration.displayName+'" ':"",c+="<"+(d&&d.toRaw?d.toRaw():d)+">;tag=",c+=n.from_tag||e.Utils.newTag(),this.from=new e.NameAddrHeader.parse(c),this.setHeader("from",c),u=n.call_id||i.configuration.sipjsId+e.Utils.createRandomToken(15),this.call_id=u,this.setHeader("call-id",u),h=n.cseq||Math.floor(1e4*Math.random()),this.cseq=h,this.setHeader("cseq",h+" "+t)}).prototype={setHeader:function(t,s){this.headers[e.Utils.headerize(t)]=s instanceof Array?s:[s]},getHeader:function(t){var s,i,n=this.extraHeaders.length,r=this.headers[e.Utils.headerize(t)];if(r){if(r[0])return r[0]}else for(s=new RegExp("^\\s*"+t+"\\s*:","i"),i=0;i<n;i++)if(r=this.extraHeaders[i],s.test(r))return r.substring(r.indexOf(":")+1).trim()},getHeaders:function(t){var s,i,n,r=this.headers[e.Utils.headerize(t)],o=[];if(r){for(i=r.length,s=0;s<i;s++)o.push(r[s]);return o}for(i=this.extraHeaders.length,n=new RegExp("^\\s*"+t+"\\s*:","i"),s=0;s<i;s++)r=this.extraHeaders[s],n.test(r)&&o.push(r.substring(r.indexOf(":")+1).trim());return o},hasHeader:function(t){var s,i,n=this.extraHeaders.length;if(this.headers[e.Utils.headerize(t)])return!0;for(s=new RegExp("^\\s*"+t+"\\s*:","i"),i=0;i<n;i++)if(s.test(this.extraHeaders[i]))return!0;return!1},toString:function(){var t,s,i,n="";for(t in n+=this.method+" "+(this.ruri.toRaw?this.ruri.toRaw():this.ruri)+" SIP/2.0\r\n",this.headers)for(s=this.headers[t].length,i=0;i<s;i++)n+=t+": "+this.headers[t][i]+"\r\n";for(s=this.extraHeaders.length,i=0;i<s;i++)n+=this.extraHeaders[i].trim()+"\r\n";return n+=r(this),n+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",this.body?"string"==typeof this.body?(n+="Content-Length: "+(s=e.Utils.str_utf8_length(this.body))+"\r\n\r\n",n+=this.body):this.body.body&&this.body.contentType?(s=e.Utils.str_utf8_length(this.body.body),n+="Content-Type: "+this.body.contentType+"\r\n",n+="Content-Length: "+s+"\r\n\r\n",n+=this.body.body):n+="Content-Length: 0\r\n\r\n":n+="Content-Length: 0\r\n\r\n",n}},(s=function(){this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null}).prototype={addHeader:function(t,s){var i={raw:s};t=e.Utils.headerize(t),this.headers[t]?this.headers[t].push(i):this.headers[t]=[i]},getHeader:function(t){var s=this.headers[e.Utils.headerize(t)];if(s)return s[0]?s[0].raw:void 0},getHeaders:function(t){var s,i,n=this.headers[e.Utils.headerize(t)],r=[];if(!n)return[];for(i=n.length,s=0;s<i;s++)r.push(n[s].raw);return r},hasHeader:function(t){return!!this.headers[e.Utils.headerize(t)]},parseHeader:function(t,s){var i,n,r;if(t=e.Utils.headerize(t),s=s||0,this.headers[t]){if(!(s>=this.headers[t].length))return n=(i=this.headers[t][s]).raw,i.parsed?i.parsed:-1===(r=e.Grammar.parse(n,t.replace(/-/g,"_")))?(this.headers[t].splice(s,1),void this.logger.warn('error parsing "'+t+'" header field with value "'+n+'"')):(i.parsed=r,r);this.logger.log('not so many "'+t+'" headers present')}else this.logger.log('header "'+t+'" not present')},s:function(e,t){return this.parseHeader(e,t)},setHeader:function(t,s){var i={raw:s};this.headers[e.Utils.headerize(t)]=[i]},toString:function(){return this.data}},((i=function(e){this.logger=e.getLogger("sip.sipmessage"),this.ua=e,this.headers={},this.ruri=null,this.transport=null,this.server_transaction=null}).prototype=new s).reply=function(t,s,i,n,o,a){var c,u,h,l,d,p=this.getHeader("To"),g=0,f=0;if(d=e.Utils.buildStatusLine(t,s),i=(i||[]).slice(),this.method===e.C.INVITE&&t>100&&t<=200)for(h=(c=this.getHeaders("record-route")).length;g<h;g++)d+="Record-Route: "+c[g]+"\r\n";for(h=(u=this.getHeaders("via")).length;f<h;f++)d+="Via: "+u[f]+"\r\n";for(!this.to_tag&&t>100?p+=";tag="+e.Utils.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(p+=";tag="+this.to_tag),d+="To: "+p+"\r\n",d+="From: "+this.getHeader("From")+"\r\n",d+="Call-ID: "+this.call_id+"\r\n",d+="CSeq: "+this.cseq+" "+this.method+"\r\n",h=i.length,l=0;l<h;l++)d+=i[l].trim()+"\r\n";return d+=r(this),d+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",n?"string"==typeof n?(d+="Content-Type: application/sdp\r\n",d+="Content-Length: "+(h=e.Utils.str_utf8_length(n))+"\r\n\r\n",d+=n):n.body&&n.contentType?(h=e.Utils.str_utf8_length(n.body),d+="Content-Type: "+n.contentType+"\r\n",d+="Content-Length: "+h+"\r\n\r\n",d+=n.body):d+="Content-Length: 0\r\n\r\n":d+="Content-Length: 0\r\n\r\n",this.server_transaction.receiveResponse(t,d).then(o,a),d},i.prototype.reply_sl=function(t,s){var i,n,r=0,o=this.getHeaders("via"),a=o.length;for(n=e.Utils.buildStatusLine(t,s);r<a;r++)n+="Via: "+o[r]+"\r\n";i=this.getHeader("To"),!this.to_tag&&t>100?i+=";tag="+e.Utils.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(i+=";tag="+this.to_tag),n+="To: "+i+"\r\n",n+="From: "+this.getHeader("From")+"\r\n",n+="Call-ID: "+this.call_id+"\r\n",n+="CSeq: "+this.cseq+" "+this.method+"\r\n",n+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",n+="Content-Length: 0\r\n\r\n",this.transport.send(n)},(n=function(e){this.logger=e.getLogger("sip.sipmessage"),this.headers={},this.status_code=null,this.reason_phrase=null}).prototype=new s,e.OutgoingRequest=t,e.IncomingRequest=i,e.IncomingResponse=n}},function(e,t,s){"use strict";e.exports=function(e){var t;(t=function(t,s,i,n,r,o){var a,c,u,h;if(!i)throw new TypeError('missing or invalid "host" parameter');for(a in t=t||e.C.SIP,this.parameters={},this.headers={},r)this.setParam(a,r[a]);for(c in o)this.setHeader(c,o[c]);u={scheme:t,user:s,host:i,port:n},h={scheme:t.toLowerCase(),user:s,host:i.toLowerCase(),port:n},Object.defineProperties(this,{_normal:{get:function(){return h}},_raw:{get:function(){return u}},scheme:{get:function(){return h.scheme},set:function(e){u.scheme=e,h.scheme=e.toLowerCase()}},user:{get:function(){return h.user},set:function(e){h.user=u.user=e}},host:{get:function(){return h.host},set:function(e){u.host=e,h.host=e.toLowerCase()}},aor:{get:function(){return h.user+"@"+h.host}},port:{get:function(){return h.port},set:function(e){h.port=u.port=0===e?e:parseInt(e,10)||null}}})}).prototype={setParam:function(e,t){e&&(this.parameters[e.toLowerCase()]=null==t?null:t.toString())},getParam:function(e){if(e)return this.parameters[e.toLowerCase()]},hasParam:function(e){if(e)return!!this.parameters.hasOwnProperty(e.toLowerCase())},deleteParam:function(e){var t;if(e=e.toLowerCase(),this.parameters.hasOwnProperty(e))return t=this.parameters[e],delete this.parameters[e],t},clearParams:function(){this.parameters={}},setHeader:function(t,s){this.headers[e.Utils.headerize(t)]=s instanceof Array?s:[s]},getHeader:function(t){if(t)return this.headers[e.Utils.headerize(t)]},hasHeader:function(t){if(t)return!!this.headers.hasOwnProperty(e.Utils.headerize(t))},deleteHeader:function(t){var s;if(t=e.Utils.headerize(t),this.headers.hasOwnProperty(t))return s=this.headers[t],delete this.headers[t],s},clearHeaders:function(){this.headers={}},clone:function(){return new t(this._raw.scheme,this._raw.user,this._raw.host,this._raw.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))},toRaw:function(){return this._toString(this._raw)},toString:function(){return this._toString(this._normal)},_toString:function(t){var s,i,n,r,o=[];for(i in r=t.scheme+":",t.scheme.toLowerCase().match("^sips?$")||(r+="//"),t.user&&(r+=e.Utils.escapeUser(t.user)+"@"),r+=t.host,(t.port||0===t.port)&&(r+=":"+t.port),this.parameters)r+=";"+i,null!==this.parameters[i]&&(r+="="+this.parameters[i]);for(s in this.headers)for(n in this.headers[s])o.push(s+"="+this.headers[s][n]);return o.length>0&&(r+="?"+o.join("&")),r}},t.parse=function(t){return-1!==(t=e.Grammar.parse(t,"SIP_URI"))?t:void 0},e.URI=t}},function(e,t,s){"use strict";e.exports=function(e){var t;(t=function(t,s,i){var n;if(!(t&&t instanceof e.URI))throw new TypeError('missing or invalid "uri" parameter');for(n in this.uri=t,this.parameters={},i)this.setParam(n,i[n]);Object.defineProperties(this,{friendlyName:{get:function(){return this.displayName||t.aor}},displayName:{get:function(){return s},set:function(e){s=0===e?"0":e}}})}).prototype={setParam:function(e,t){e&&(this.parameters[e.toLowerCase()]=null==t?null:t.toString())},getParam:e.URI.prototype.getParam,hasParam:e.URI.prototype.hasParam,deleteParam:e.URI.prototype.deleteParam,clearParams:e.URI.prototype.clearParams,clone:function(){return new t(this.uri.clone(),this.displayName,JSON.parse(JSON.stringify(this.parameters)))},toString:function(){var e,t;for(t in e=this.displayName||0===this.displayName?'"'+this.displayName+'" ':"",e+="<"+this.uri.toString()+">",this.parameters)e+=";"+t,null!==this.parameters[t]&&(e+="="+this.parameters[t]);return e}},t.parse=function(t){return-1!==(t=e.Grammar.parse(t,"Name_Addr_Header"))?t:void 0},e.NameAddrHeader=t}},function(e,t,s){"use strict";e.exports=function(e){var t={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"};function s(e,t,s){var i;return i="SIP/2.0/"+(e.ua.configuration.hackViaTcp?"TCP":t.server.scheme),i+=" "+e.ua.configuration.viaHost+";branch="+s,e.ua.configuration.forceRport&&(i+=";rport"),i}var i=function(e,i,n){var r;this.type=t.NON_INVITE_CLIENT,this.transport=n,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=i,this.logger=e.ua.getLogger("sip.transaction.nict",this.id),r=s(e,n,this.id),this.request.setHeader("via",r),this.request_sender.ua.newTransaction(this)};(i.prototype=Object.create(e.EventEmitter.prototype)).stateChanged=function(e){this.state=e,this.emit("stateChanged")},i.prototype.send=function(){this.stateChanged(t.STATUS_TRYING),this.F=e.Timers.setTimeout(this.timer_F.bind(this),e.Timers.TIMER_F),this.transport.send(this.request).catch(function(){this.onTransportError()}.bind(this))},i.prototype.onTransportError=function(){this.logger.log("transport error occurred, deleting non-INVITE client transaction "+this.id),e.Timers.clearTimeout(this.F),e.Timers.clearTimeout(this.K),this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onTransportError()},i.prototype.timer_F=function(){this.logger.debug("Timer F expired for non-INVITE client transaction "+this.id),this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout()},i.prototype.timer_K=function(){this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},i.prototype.receiveResponse=function(s){var i=s.status_code;if(i<200)switch(this.state){case t.STATUS_TRYING:case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_PROCEEDING),this.request_sender.receiveResponse(s)}else switch(this.state){case t.STATUS_TRYING:case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_COMPLETED),e.Timers.clearTimeout(this.F),408===i?this.request_sender.onRequestTimeout():this.request_sender.receiveResponse(s),this.K=e.Timers.setTimeout(this.timer_K.bind(this),e.Timers.TIMER_K)}};var n=function(e,i,n){var r,o=this;this.type=t.INVITE_CLIENT,this.transport=n,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=i,this.logger=e.ua.getLogger("sip.transaction.ict",this.id),r=s(e,n,this.id),this.request.setHeader("via",r),this.request_sender.ua.newTransaction(this),this.request.cancel=function(e,t){for(var s=(t=(t||[]).slice()).length,i=null,n=0;n<s;n++)i=(i||"")+t[n].trim()+"\r\n";o.cancel_request(o,e,i)}};(n.prototype=Object.create(e.EventEmitter.prototype)).stateChanged=function(e){this.state=e,this.emit("stateChanged")},n.prototype.send=function(){this.stateChanged(t.STATUS_CALLING),this.B=e.Timers.setTimeout(this.timer_B.bind(this),e.Timers.TIMER_B),this.transport.send(this.request).catch(function(){this.onTransportError()}.bind(this))},n.prototype.onTransportError=function(){this.logger.log("transport error occurred, deleting INVITE client transaction "+this.id),e.Timers.clearTimeout(this.B),e.Timers.clearTimeout(this.D),e.Timers.clearTimeout(this.M),this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.state!==t.STATUS_ACCEPTED&&this.request_sender.onTransportError()},n.prototype.timer_M=function(){this.logger.debug("Timer M expired for INVITE client transaction "+this.id),this.state===t.STATUS_ACCEPTED&&(e.Timers.clearTimeout(this.B),this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this))},n.prototype.timer_B=function(){this.logger.debug("Timer B expired for INVITE client transaction "+this.id),this.state===t.STATUS_CALLING&&(this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout())},n.prototype.timer_D=function(){this.logger.debug("Timer D expired for INVITE client transaction "+this.id),e.Timers.clearTimeout(this.B),this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},n.prototype.sendACK=function(t){var s,i=this;t=t||{},s=this.response.getHeader("contact")?this.response.parseHeader("contact").uri:this.request.ruri;var n=new e.OutgoingRequest("ACK",s,this.request.ua,{cseq:this.response.cseq,call_id:this.response.call_id,from_uri:this.response.from.uri,from_tag:this.response.from_tag,to_uri:this.response.to.uri,to_tag:this.response.to_tag,route_set:this.response.getHeaders("record-route").reverse()},t.extraHeaders||[],t.body);return this.ackSender=new e.RequestSender({request:n,onRequestTimeout:this.request_sender.applicant.applicant?this.request_sender.applicant.applicant.onRequestTimeout:function(){i.logger.warn("ACK Request timed out")},onTransportError:this.request_sender.applicant.applicant?this.request_sender.applicant.applicant.onRequestTransportError:function(){i.logger.warn("ACK Request had a transport error")},receiveResponse:t.receiveResponse||function(){i.logger.warn("Received a response to an ACK which was unexpected. Dropping Response.")}},this.request.ua).send(),n},n.prototype.cancel_request=function(s,i,n){var r=s.request;this.cancel=e.C.CANCEL+" "+r.ruri+" SIP/2.0\r\n",this.cancel+="Via: "+r.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.cancel+="Route: "+r.headers.Route.toString()+"\r\n"),this.cancel+="To: "+r.headers.To.toString()+"\r\n",this.cancel+="From: "+r.headers.From.toString()+"\r\n",this.cancel+="Call-ID: "+r.headers["Call-ID"].toString()+"\r\n",this.cancel+="Max-Forwards: "+e.UA.C.MAX_FORWARDS+"\r\n",this.cancel+="CSeq: "+r.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n",i&&(this.cancel+="Reason: "+i+"\r\n"),n&&(this.cancel+=n),this.cancel+="Content-Length: 0\r\n\r\n",this.state===t.STATUS_PROCEEDING&&this.transport.send(this.cancel)},n.prototype.receiveResponse=function(s){var i=s.status_code;if(s.transaction=this,this.response&&this.response.status_code===s.status_code&&this.response.cseq===s.cseq)return this.logger.debug("ICT Received a retransmission for cseq: "+s.cseq),void(this.ackSender&&this.ackSender.send());if(this.response=s,i>=100&&i<=199)switch(this.state){case t.STATUS_CALLING:this.stateChanged(t.STATUS_PROCEEDING),this.request_sender.receiveResponse(s),this.cancel&&this.transport.send(this.cancel);break;case t.STATUS_PROCEEDING:this.request_sender.receiveResponse(s)}else if(i>=200&&i<=299)switch(this.state){case t.STATUS_CALLING:case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_ACCEPTED),this.M=e.Timers.setTimeout(this.timer_M.bind(this),e.Timers.TIMER_M),this.request_sender.receiveResponse(s);break;case t.STATUS_ACCEPTED:this.request_sender.receiveResponse(s)}else if(i>=300&&i<=699)switch(this.state){case t.STATUS_CALLING:case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_COMPLETED),this.sendACK(),this.request_sender.receiveResponse(s);break;case t.STATUS_COMPLETED:this.sendACK()}};var r=function(e,t,i){var n;this.transport=i,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=t,this.logger=e.ua.getLogger("sip.transaction.nict",this.id),n=s(e,i,this.id),this.request.setHeader("via",n)};(r.prototype=Object.create(e.EventEmitter.prototype)).send=function(){this.transport.send(this.request).catch(function(){this.onTransportError()}.bind(this))},r.prototype.onTransportError=function(){this.logger.log("transport error occurred, for an ACK client transaction "+this.id),this.request_sender.onTransportError()};var o=function(e,s){this.type=t.NON_INVITE_SERVER,this.id=e.via_branch,this.request=e,this.transport=s.transport,this.ua=s,this.last_response="",e.server_transaction=this,this.logger=s.getLogger("sip.transaction.nist",this.id),this.state=t.STATUS_TRYING,s.newTransaction(this)};(o.prototype=Object.create(e.EventEmitter.prototype)).stateChanged=function(e){this.state=e,this.emit("stateChanged")},o.prototype.timer_J=function(){this.logger.debug("Timer J expired for non-INVITE server transaction "+this.id),this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this)},o.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,this.logger.log("transport error occurred, deleting non-INVITE server transaction "+this.id),e.Timers.clearTimeout(this.J),this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this))},o.prototype.receiveResponse=function(s,i){var n=e.Utils.defer();if(100===s)switch(this.state){case t.STATUS_TRYING:this.stateChanged(t.STATUS_PROCEEDING),this.transport.send(i).catch(function(){this.onTransportError()}.bind(this));break;case t.STATUS_PROCEEDING:this.last_response=i,this.transport.send(i).then((function(){n.resolve()})).catch(function(){this.onTransportError(),n.reject()}.bind(this))}else if(s>=200&&s<=699)switch(this.state){case t.STATUS_TRYING:case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_COMPLETED),this.last_response=i,this.J=e.Timers.setTimeout(this.timer_J.bind(this),e.Timers.TIMER_J),this.transport.send(i).then((function(){n.resolve()})).catch(function(){this.onTransportError(),n.reject()}.bind(this))}return n.promise};var a=function(e,s){this.type=t.INVITE_SERVER,this.id=e.via_branch,this.request=e,this.transport=s.transport,this.ua=s,this.last_response="",e.server_transaction=this,this.logger=s.getLogger("sip.transaction.ist",this.id),this.state=t.STATUS_PROCEEDING,s.newTransaction(this),this.resendProvisionalTimer=null,e.reply(100)};(a.prototype=Object.create(e.EventEmitter.prototype)).stateChanged=function(e){this.state=e,this.emit("stateChanged")},a.prototype.timer_H=function(){this.logger.debug("Timer H expired for INVITE server transaction "+this.id),this.state===t.STATUS_COMPLETED&&this.logger.warn("transactions","ACK for INVITE server transaction was never received, call will be terminated"),this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this)},a.prototype.timer_I=function(){this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this)},a.prototype.timer_L=function(){this.logger.debug("Timer L expired for INVITE server transaction "+this.id),this.state===t.STATUS_ACCEPTED&&(this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this))},a.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,this.logger.log("transport error occurred, deleting INVITE server transaction "+this.id),null!==this.resendProvisionalTimer&&(e.Timers.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),e.Timers.clearTimeout(this.L),e.Timers.clearTimeout(this.H),e.Timers.clearTimeout(this.I),this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this))},a.prototype.resend_provisional=function(){this.transport.send(this.request).catch(function(){this.onTransportError()}.bind(this))},a.prototype.receiveResponse=function(s,i){var n=this,r=e.Utils.defer();if(s>=100&&s<=199)switch(this.state){case t.STATUS_PROCEEDING:this.transport.send(i).catch(function(){this.onTransportError()}.bind(this)),this.last_response=i}if(s>100&&s<=199&&this.state===t.STATUS_PROCEEDING)null===this.resendProvisionalTimer&&(this.resendProvisionalTimer=e.Timers.setInterval(n.resend_provisional.bind(n),e.Timers.PROVISIONAL_RESPONSE_INTERVAL));else if(s>=200&&s<=299)switch(this.state){case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_ACCEPTED),this.last_response=i,this.L=e.Timers.setTimeout(n.timer_L.bind(n),e.Timers.TIMER_L),null!==this.resendProvisionalTimer&&(e.Timers.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case t.STATUS_ACCEPTED:this.transport.send(i).then((function(){r.resolve()})).catch(function(e){this.logger.error(e),this.onTransportError(),r.reject()}.bind(this))}else if(s>=300&&s<=699)switch(this.state){case t.STATUS_PROCEEDING:null!==this.resendProvisionalTimer&&(e.Timers.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(i).then(function(){this.stateChanged(t.STATUS_COMPLETED),this.H=e.Timers.setTimeout(n.timer_H.bind(n),e.Timers.TIMER_H),r.resolve()}.bind(this)).catch(function(e){this.logger.error(e),this.onTransportError(),r.reject()}.bind(this))}return r.promise},e.Transactions={C:t,checkTransaction:function(s,i){var n;switch(i.method){case e.C.INVITE:if(n=s.transactions.ist[i.via_branch]){switch(n.state){case t.STATUS_PROCEEDING:n.transport.send(n.last_response)}return!0}break;case e.C.ACK:if(!(n=s.transactions.ist[i.via_branch]))return!1;if(n.state===t.STATUS_ACCEPTED)return!1;if(n.state===t.STATUS_COMPLETED)return n.stateChanged(t.STATUS_CONFIRMED),n.I=e.Timers.setTimeout(n.timer_I.bind(n),e.Timers.TIMER_I),!0;break;case e.C.CANCEL:return(n=s.transactions.ist[i.via_branch])?(i.reply_sl(200),n.state!==t.STATUS_PROCEEDING):(i.reply_sl(481),!0);default:if(n=s.transactions.nist[i.via_branch]){switch(n.state){case t.STATUS_TRYING:break;case t.STATUS_PROCEEDING:case t.STATUS_COMPLETED:n.transport.send(n.last_response)}return!0}}},NonInviteClientTransaction:i,InviteClientTransaction:n,AckClientTransaction:r,NonInviteServerTransaction:o,InviteServerTransaction:a}}},function(e,t,s){"use strict";e.exports=function(e){var t,i=s(18)(e),n={STATUS_EARLY:1,STATUS_CONFIRMED:2};(t=function(t,s,i,r){var o;if(this.uac_pending_reply=!1,this.uas_pending_reply=!1,!s.hasHeader("contact"))return{error:"unable to create a Dialog without Contact header field"};r=s instanceof e.IncomingResponse?s.status_code<200?n.STATUS_EARLY:n.STATUS_CONFIRMED:r||n.STATUS_CONFIRMED,o=s.parseHeader("contact"),"UAS"===i?(this.id={call_id:s.call_id,local_tag:s.to_tag,remote_tag:s.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=r,this.remote_seqnum=s.cseq,this.local_uri=s.parseHeader("to").uri,this.remote_uri=s.parseHeader("from").uri,this.remote_target=o.uri,this.route_set=s.getHeaders("record-route"),this.invite_seqnum=s.cseq,this.local_seqnum=s.cseq):"UAC"===i&&(this.id={call_id:s.call_id,local_tag:s.from_tag,remote_tag:s.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=r,this.invite_seqnum=s.cseq,this.local_seqnum=s.cseq,this.local_uri=s.parseHeader("from").uri,this.pracked=[],this.remote_uri=s.parseHeader("to").uri,this.remote_target=o.uri,this.route_set=s.getHeaders("record-route").reverse()),this.logger=t.ua.getLogger("sip.dialog",this.id.toString()),this.owner=t,t.ua.dialogs[this.id.toString()]=this,this.logger.log("new "+i+" dialog created with status "+(this.state===n.STATUS_EARLY?"EARLY":"CONFIRMED")),t.emit("dialog",this)}).prototype={update:function(e,t){this.state=n.STATUS_CONFIRMED,this.logger.log("dialog "+this.id.toString()+"  changed to CONFIRMED state"),"UAC"===t&&(this.route_set=e.getHeaders("record-route").reverse())},terminate:function(){this.logger.log("dialog "+this.id.toString()+" deleted"),this.sessionDescriptionHandler&&this.state!==n.STATUS_CONFIRMED&&this.sessionDescriptionHandler.close(),delete this.owner.ua.dialogs[this.id.toString()]},createRequest:function(t,s,i){var n,r;return s=(s||[]).slice(),this.local_seqnum||(this.local_seqnum=Math.floor(1e4*Math.random())),n=t===e.C.CANCEL||t===e.C.ACK?this.invite_seqnum:this.local_seqnum+=1,(r=new e.OutgoingRequest(t,this.remote_target,this.owner.ua,{cseq:n,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set},s,i)).dialog=this,r},checkInDialogRequest:function(t){var s=this;if(this.remote_seqnum){if(t.cseq<this.remote_seqnum)return t.method!==e.C.ACK&&t.reply(500),t.cseq===this.invite_seqnum}else this.remote_seqnum=t.cseq;switch(t.method){case e.C.INVITE:if(!0===this.uac_pending_reply)t.reply(491);else{if(!0===this.uas_pending_reply&&t.cseq>this.remote_seqnum){var i=1+(10*Math.random()|0);return t.reply(500,null,["Retry-After:"+i]),this.remote_seqnum=t.cseq,!1}this.uas_pending_reply=!0,t.server_transaction.on("stateChanged",(function t(){this.state!==e.Transactions.C.STATUS_ACCEPTED&&this.state!==e.Transactions.C.STATUS_COMPLETED&&this.state!==e.Transactions.C.STATUS_TERMINATED||(this.removeListener("stateChanged",t),s.uas_pending_reply=!1)}))}t.hasHeader("contact")&&t.server_transaction.on("stateChanged",(function(){this.state===e.Transactions.C.STATUS_ACCEPTED&&(s.remote_target=t.parseHeader("contact").uri)}));break;case e.C.NOTIFY:t.hasHeader("contact")&&t.server_transaction.on("stateChanged",(function(){this.state===e.Transactions.C.STATUS_COMPLETED&&(s.remote_target=t.parseHeader("contact").uri)}))}return t.cseq>this.remote_seqnum&&(this.remote_seqnum=t.cseq),!0},sendRequest:function(e,t,s){var n=((s=s||{}).extraHeaders||[]).slice(),r=null;s.body&&(s.body.body?r=s.body:((r={}).body=s.body,s.contentType&&(r.contentType=s.contentType)));var o=this.createRequest(t,n,r);return new i(this,e,o).send(),o},receiveRequest:function(e){this.checkInDialogRequest(e)&&this.owner.receiveRequest(e)}},t.C=n,e.Dialog=t}},function(e,t,s){"use strict";e.exports=function(e){var t;return(t=function(e,t,s){this.dialog=e,this.applicant=t,this.request=s,this.reattempt=!1,this.reattemptTimer=null}).prototype={send:function(){var t=this,s=new e.RequestSender(this,this.dialog.owner.ua);s.send(),this.request.method===e.C.INVITE&&s.clientTransaction.state!==e.Transactions.C.STATUS_TERMINATED&&(this.dialog.uac_pending_reply=!0,s.clientTransaction.on("stateChanged",(function s(){this.state!==e.Transactions.C.STATUS_ACCEPTED&&this.state!==e.Transactions.C.STATUS_COMPLETED&&this.state!==e.Transactions.C.STATUS_TERMINATED||(this.removeListener("stateChanged",s),t.dialog.uac_pending_reply=!1)})))},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(t){var s=this;408===t.status_code||481===t.status_code?this.applicant.onDialogError(t):t.method===e.C.INVITE&&491===t.status_code?this.reattempt?this.applicant.receiveResponse(t):(this.request.cseq.value=this.dialog.local_seqnum+=1,this.reattemptTimer=e.Timers.setTimeout((function(){s.applicant.owner.status!==e.Session.C.STATUS_TERMINATED&&(s.reattempt=!0,s.request_sender.send())}),this.getReattemptTimeout())):this.applicant.receiveResponse(t)}},t}},function(e,t,s){"use strict";e.exports=function(e){var t;(t=function(t,s){this.logger=s.getLogger("sip.requestsender"),this.ua=s,this.applicant=t,this.method=t.request.method,this.request=t.request,this.credentials=null,this.challenged=!1,this.staled=!1,s.status!==e.UA.C.STATUS_USER_CLOSED||this.method===e.C.BYE&&this.method===e.C.ACK||this.onTransportError()}).prototype={send:function(){switch(this.method){case"INVITE":this.clientTransaction=new e.Transactions.InviteClientTransaction(this,this.request,this.ua.transport);break;case"ACK":this.clientTransaction=new e.Transactions.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new e.Transactions.NonInviteClientTransaction(this,this.request,this.ua.transport)}return this.clientTransaction.send(),this.clientTransaction},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(t){var s,i,n,r=t.status_code;if(401===r||407===r){if(401===t.status_code?(i=t.parseHeader("www-authenticate"),n="authorization"):(i=t.parseHeader("proxy-authenticate"),n="proxy-authorization"),!i)return this.logger.warn(t.status_code+" with wrong or missing challenge, cannot authenticate"),void this.applicant.receiveResponse(t);if(!this.challenged||!this.staled&&!0===i.stale){if(this.credentials||(this.credentials=this.ua.configuration.authenticationFactory(this.ua)),!this.credentials.authenticate(this.request,i))return void this.applicant.receiveResponse(t);this.challenged=!0,i.stale&&(this.staled=!0),t.method===e.C.REGISTER?s=this.applicant.cseq+=1:this.request.dialog?s=this.request.dialog.local_seqnum+=1:(s=this.request.cseq+1,this.request.cseq=s),this.request.setHeader("cseq",s+" "+this.method),this.request.setHeader(n,this.credentials.toString()),this.send()}else this.applicant.receiveResponse(t)}else this.applicant.receiveResponse(t)}},e.RequestSender=t}},function(e,t,s){"use strict";e.exports=function(e){var t;(t=function(t){var s={};this.registrar=t.configuration.registrarServer,this.expires=t.configuration.registerExpires,this.contact=t.contact.toString(),this.contact+=";reg-id=1",this.contact+=';+sip.instance="<urn:uuid:'+t.configuration.instanceId+'>"',this.call_id=e.Utils.createRandomToken(22),this.cseq=Math.floor(1e4*Math.random()),this.to_uri=t.configuration.uri,s.to_uri=this.to_uri,s.to_displayName=t.configuration.displayName,s.call_id=this.call_id,s.cseq=this.cseq,e.Utils.augment(this,e.ClientContext,[t,"REGISTER",this.registrar,{params:s}]),this.registrationTimer=null,this.registrationExpiredTimer=null,this.registered=!1,this.logger=t.getLogger("sip.registercontext"),t.on("transportCreated",function(e){e.on("disconnected",this.onTransportDisconnected.bind(this))}.bind(this))}).prototype=Object.create({},{register:{writable:!0,value:function(t){var s,i=this;this.options=t||{},(s=(this.options.extraHeaders||[]).slice()).push("Contact: "+this.contact+";expires="+this.expires),s.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.closeHeaders=this.options.closeWithHeaders?(this.options.extraHeaders||[]).slice():[],this.receiveResponse=function(t){var s,n,r,o=t.getHeaders("contact").length;if(t.cseq===this.cseq)switch(null!==this.registrationTimer&&(e.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null),!0){case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",t);break;case/^2[0-9]{2}$/.test(t.status_code):if(this.emit("accepted",t),t.hasHeader("expires")&&(n=t.getHeader("expires")),null!==this.registrationExpiredTimer&&(e.Timers.clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=null),!o){this.logger.warn("no Contact header in response to REGISTER, response ignored");break}for(;o--;){if((s=t.parseHeader("contact",o)).uri.user===this.ua.contact.uri.user){n=s.getParam("expires");break}s=null}if(!s){this.logger.warn("no Contact header pointing to us, response ignored");break}n||(n=this.expires),this.registrationTimer=e.Timers.setTimeout((function(){i.registrationTimer=null,i.register(i.options)}),1e3*n-3e3),this.registrationExpiredTimer=e.Timers.setTimeout((function(){i.logger.warn("registration expired"),i.registered&&i.unregistered(null,e.C.causes.EXPIRES)}),1e3*n),s.hasParam("temp-gruu")&&(this.ua.contact.temp_gruu=e.URI.parse(s.getParam("temp-gruu").replace(/"/g,""))),s.hasParam("pub-gruu")&&(this.ua.contact.pub_gruu=e.URI.parse(s.getParam("pub-gruu").replace(/"/g,""))),this.registered=!0,this.emit("registered",t||null);break;case/^423$/.test(t.status_code):t.hasHeader("min-expires")?(this.expires=t.getHeader("min-expires"),this.register(this.options)):(this.logger.warn("423 response received for REGISTER without Min-Expires"),this.registrationFailure(t,e.C.causes.SIP_FAILURE_CODE));break;default:r=e.Utils.sipErrorCause(t.status_code),this.registrationFailure(t,r)}},this.onRequestTimeout=function(){this.registrationFailure(null,e.C.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.registrationFailure(null,e.C.causes.CONNECTION_ERROR)},this.cseq++,this.request.cseq=this.cseq,this.request.setHeader("cseq",this.cseq+" REGISTER"),this.request.extraHeaders=s,this.send()}},registrationFailure:{writable:!0,value:function(e,t){this.emit("failed",e||null,t||null)}},onTransportDisconnected:{writable:!0,value:function(){this.registered_before=this.registered,null!==this.registrationTimer&&(e.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null),null!==this.registrationExpiredTimer&&(e.Timers.clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=null),this.registered&&this.unregistered(null,e.C.causes.CONNECTION_ERROR)}},onTransportConnected:{writable:!0,value:function(){this.register(this.options)}},close:{writable:!0,value:function(){var e={all:!1,extraHeaders:this.closeHeaders};this.registered_before=this.registered,this.registered&&this.unregister(e)}},unregister:{writable:!0,value:function(t){var s;t=t||{},this.registered||t.all||this.logger.warn("Already unregistered, but sending an unregister anyways."),s=(t.extraHeaders||[]).slice(),this.registered=!1,null!==this.registrationTimer&&(e.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null),t.all?(s.push("Contact: *"),s.push("Expires: 0")):s.push("Contact: "+this.contact+";expires=0"),this.receiveResponse=function(t){var s;switch(!0){case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",t);break;case/^2[0-9]{2}$/.test(t.status_code):this.emit("accepted",t),null!==this.registrationExpiredTimer&&(e.Timers.clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=null),this.unregistered(t);break;default:s=e.Utils.sipErrorCause(t.status_code),this.unregistered(t,s)}},this.onRequestTimeout=function(){},this.cseq++,this.request.cseq=this.cseq,this.request.setHeader("cseq",this.cseq+" REGISTER"),this.request.extraHeaders=s,this.send()}},unregistered:{writable:!0,value:function(e,t){this.registered=!1,this.emit("unregistered",e||null,t||null)}}}),e.RegisterContext=t}},function(e,t,s){"use strict";e.exports=function(e){var t=function(){};return t.prototype=Object.create(e.prototype,{close:{value:function(){}},getDescription:{value:function(e,t){}},hasDescription:{value:function(e){}},holdModifier:{value:function(e){}},setDescription:{value:function(e,t,s){}},sendDtmf:{value:function(e,t){}},getDirection:{value:function(){}}}),t}},function(e,t,s){"use strict";e.exports=function(e){var t;((t=function(t,s,i,n){var r=i;if(void 0===i)throw new TypeError("Not enough arguments");if(this.ua=t,this.logger=t.getLogger("sip.clientcontext"),this.method=s,!(i=t.normalizeTarget(i)))throw new TypeError("Invalid target: "+r);(n=Object.create(n||Object.prototype)).extraHeaders=(n.extraHeaders||[]).slice(),this.request=new e.OutgoingRequest(this.method,i,this.ua,n.params,n.extraHeaders),n.body&&(this.body={},this.body.body=n.body,n.contentType&&(this.body.contentType=n.contentType),this.request.body=this.body),this.localIdentity=this.request.from,this.remoteIdentity=this.request.to,this.data={}}).prototype=Object.create(e.EventEmitter.prototype)).send=function(){return new e.RequestSender(this,this.ua).send(),this},t.prototype.cancel=function(t){(t=t||{}).extraHeaders=(t.extraHeaders||[]).slice();var s=e.Utils.getCancelReason(t.status_code,t.reason_phrase);this.request.cancel(s,t.extraHeaders),this.emit("cancel")},t.prototype.receiveResponse=function(t){var s=e.Utils.getReasonPhrase(t.status_code);switch(!0){case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",t,s);break;case/^2[0-9]{2}$/.test(t.status_code):this.ua.applicants[this]&&delete this.ua.applicants[this],this.emit("accepted",t,s);break;default:this.ua.applicants[this]&&delete this.ua.applicants[this],this.emit("rejected",t,s),this.emit("failed",t,s)}},t.prototype.onRequestTimeout=function(){this.emit("failed",null,e.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){this.emit("failed",null,e.C.causes.CONNECTION_ERROR)},e.ClientContext=t}},function(e,t,s){"use strict";e.exports=function(e){var t;((t=function(t,s){this.ua=t,this.logger=t.getLogger("sip.servercontext"),this.request=s,s.method===e.C.INVITE?this.transaction=new e.Transactions.InviteServerTransaction(s,t):this.transaction=new e.Transactions.NonInviteServerTransaction(s,t),s.body&&(this.body=s.body),s.hasHeader("Content-Type")&&(this.contentType=s.getHeader("Content-Type")),this.method=s.method,this.data={},this.localIdentity=s.to,this.remoteIdentity=s.from,s.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=new e.NameAddrHeader.parse(s.getHeader("P-Asserted-Identity")))}).prototype=Object.create(e.EventEmitter.prototype)).progress=function(e){return(e=Object.create(e||Object.prototype)).statusCode||(e.statusCode=180),e.minCode=100,e.maxCode=199,e.events=["progress"],this.reply(e)},t.prototype.accept=function(e){return(e=Object.create(e||Object.prototype)).statusCode||(e.statusCode=200),e.minCode=200,e.maxCode=299,e.events=["accepted"],this.reply(e)},t.prototype.reject=function(e){return(e=Object.create(e||Object.prototype)).statusCode||(e.statusCode=480),e.minCode=300,e.maxCode=699,e.events=["rejected","failed"],this.reply(e)},t.prototype.reply=function(t){var s,i=(t=t||{}).statusCode||100,n=t.minCode||100,r=t.maxCode||699,o=e.Utils.getReasonPhrase(i,t.reasonPhrase),a=t.extraHeaders||[],c=t.body,u=t.events||[];if(i<n||i>r)throw new TypeError("Invalid statusCode: "+i);return s=this.request.reply(i,o,a,c),u.forEach((function(e){this.emit(e,s,o)}),this),this},t.prototype.onRequestTimeout=function(){this.emit("failed",null,e.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){this.emit("failed",null,e.C.causes.CONNECTION_ERROR)},e.ServerContext=t}},function(e,t,s){"use strict";e.exports=function(e){var t,i,n,r,o,a=s(25)(e),c={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_PRACK:6,STATUS_WAITING_FOR_ACK:7,STATUS_CANCELED:8,STATUS_TERMINATED:9,STATUS_ANSWERED_WAITING_FOR_PRACK:10,STATUS_EARLY_MEDIA:11,STATUS_CONFIRMED:12};(t=function(t){if(this.status=c.STATUS_NULL,this.dialog=null,this.pendingReinvite=!1,this.earlyDialogs={},!t)throw new e.Exceptions.SessionDescriptionHandlerMissing("A session description handler is required for the session to function");this.sessionDescriptionHandlerFactory=t,this.hasOffer=!1,this.hasAnswer=!1,this.timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null,rel1xxTimer:null,prackTimer:null},this.startTime=null,this.endTime=null,this.tones=null,this.local_hold=!1,this.early_sdp=null,this.rel100=e.C.supported.UNSUPPORTED}).prototype={dtmf:function(t,s){var i=[],n=this,r=this.ua.configuration.dtmfType;if(s=s||{},void 0===t)throw new TypeError("Not enough arguments");if(this.status!==c.STATUS_CONFIRMED&&this.status!==c.STATUS_WAITING_FOR_ACK)throw new e.Exceptions.InvalidStateError(this.status);if("string"!=typeof t&&"number"!=typeof t||!t.toString().match(/^[0-9A-D#*,]+$/i))throw new TypeError("Invalid tones: "+t);var o=function(){var t,i;if(n.status===c.STATUS_TERMINATED||!n.tones||0===n.tones.length)return n.tones=null,this;(t=n.tones.shift()).on("failed",(function(){n.tones=null})),t.send(s),i=t.duration+t.interToneGap,e.Timers.setTimeout(o,i)};if(t=t.toString(),r===e.C.dtmfType.RTP&&(this.sessionDescriptionHandler.sendDtmf(t,s)||(this.logger.warn("Attempt to use dtmfType 'RTP' has failed, falling back to INFO packet method"),r=e.C.dtmfType.INFO)),r===e.C.dtmfType.INFO){for(t=t.split("");t.length>0;)i.push(new a(this,t.shift(),s));if(this.tones)return this.tones=this.tones.concat(i),this;this.tones=i,o()}return this},bye:function(t){var s=(t=Object.create(t||Object.prototype)).statusCode;if(this.status===c.STATUS_TERMINATED)return this.logger.error("Error: Attempted to send BYE in a terminated session."),this;if(this.logger.log("terminating Session"),s&&(s<200||s>=700))throw new TypeError("Invalid statusCode: "+s);return t.receiveResponse=function(){},this.sendRequest(e.C.BYE,t).terminated()},refer:function(t,s){if(s=s||{},this.status!==c.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);this.referContext=new e.ReferClientContext(this.ua,this,t,s),this.emit("referRequested",this.referContext),this.referContext.refer(s)},sendRequest:function(t,s){s=s||{};var i=this,n=new e.OutgoingRequest(t,this.dialog.remote_target,this.ua,{cseq:s.cseq||(this.dialog.local_seqnum+=1),call_id:this.dialog.id.call_id,from_uri:this.dialog.local_uri,from_tag:this.dialog.id.local_tag,to_uri:this.dialog.remote_uri,to_tag:this.dialog.id.remote_tag,route_set:this.dialog.route_set,statusCode:s.statusCode,reasonPhrase:s.reasonPhrase},s.extraHeaders||[],s.body);return new e.RequestSender({request:n,onRequestTimeout:function(){i.onRequestTimeout()},onTransportError:function(){i.onTransportError()},receiveResponse:s.receiveResponse||function(e){i.receiveNonInviteResponse(e)}},this.ua).send(),this.emit(t.toLowerCase(),n),this},close:function(){var t;if(this.status===c.STATUS_TERMINATED)return this;for(t in this.logger.log("closing INVITE session "+this.id),this.sessionDescriptionHandler&&this.sessionDescriptionHandler.close(),this.timers)e.Timers.clearTimeout(this.timers[t]);for(t in this.dialog&&(this.dialog.terminate(),delete this.dialog),this.earlyDialogs)this.earlyDialogs[t].terminate(),delete this.earlyDialogs[t];return this.status=c.STATUS_TERMINATED,this.ua.transport.removeListener("transportError",this.errorListener),delete this.ua.sessions[this.id],this},createDialog:function(t,s,i){var n,r,o=t["UAS"===s?"to_tag":"from_tag"],a=t["UAS"===s?"from_tag":"to_tag"],c=t.call_id+o+a;if(r=this.earlyDialogs[c],i)return!!r||((r=new e.Dialog(this,t,s,e.Dialog.C.STATUS_EARLY)).error?(this.logger.error(r.error),this.failed(t,e.C.causes.INTERNAL_ERROR),!1):(this.earlyDialogs[c]=r,!0));if(r){for(var u in r.update(t,s),this.dialog=r,delete this.earlyDialogs[c],this.earlyDialogs)this.earlyDialogs[u].terminate(),delete this.earlyDialogs[u];return!0}return(n=new e.Dialog(this,t,s)).error?(this.logger.error(n.error),this.failed(t,e.C.causes.INTERNAL_ERROR),!1):(this.to_tag=t.to_tag,this.dialog=n,!0)},hold:function(t,s){if(this.status!==c.STATUS_WAITING_FOR_ACK&&this.status!==c.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);this.local_hold?this.logger.log("Session is already on hold, cannot put it on hold again"):((t=t||{}).modifiers=s||[],t.modifiers.push(this.sessionDescriptionHandler.holdModifier),this.local_hold=!0,this.sendReinvite(t))},unhold:function(t,s){if(this.status!==c.STATUS_WAITING_FOR_ACK&&this.status!==c.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);this.local_hold?(t=t||{},s&&(t.modifiers=s),this.local_hold=!1,this.sendReinvite(t)):this.logger.log("Session is not on hold, cannot unhold it")},reinvite:function(e,t){return e=e||{},t&&(e.modifiers=t),this.sendReinvite(e)},receiveReinvite:function(t){var s,i=this;if(i.emit("reinvite",this),t.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=new e.NameAddrHeader.parse(t.getHeader("P-Asserted-Identity"))),"0"!==t.getHeader("Content-Length")||t.getHeader("Content-Type")){if(!this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type")))return t.reply(415),void this.emit("reinviteFailed",i);s=this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(this.sessionDescriptionHandler.getDescription.bind(this.sessionDescriptionHandler,this.sessionDescriptionHandlerOptions,this.modifiers))}else s=this.sessionDescriptionHandler.getDescription(this.sessionDescriptionHandlerOptions,this.modifiers);this.receiveRequest=function(t){t.method===e.C.ACK&&this.status===c.STATUS_WAITING_FOR_ACK?this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type"))?(this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){e.Timers.clearTimeout(this.timers.ackTimer),e.Timers.clearTimeout(this.timers.invite2xxTimer),this.status=c.STATUS_CONFIRMED,this.emit("confirmed",t)}.bind(this))):(e.Timers.clearTimeout(this.timers.ackTimer),e.Timers.clearTimeout(this.timers.invite2xxTimer),this.status=c.STATUS_CONFIRMED,this.emit("confirmed",t)):e.Session.prototype.receiveRequest.apply(this,[t])}.bind(this),s.catch((function(s){var n;throw s instanceof e.Exceptions.SessionDescriptionHandlerError?n=500:s instanceof e.Exceptions.RenegotiationError?(i.emit("renegotiationError",s),i.logger.warn(s),n=488):(i.logger.error(s),n=488),t.reply(n),i.emit("reinviteFailed",i),s})).then((function(e){var s=["Contact: "+i.contact];t.reply(200,null,s,e,(function(){i.status=c.STATUS_WAITING_FOR_ACK,i.setACKTimer(),i.emit("reinviteAccepted",i)}))}))},sendReinvite:function(t){if(this.pendingReinvite)this.logger.warn("Reinvite in progress. Please wait until complete, then try again.");else{this.pendingReinvite=!0,(t=t||{}).modifiers=t.modifiers||[];var s=this,i=(t.extraHeaders||[]).slice();i.push("Contact: "+this.contact),i.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.sessionDescriptionHandler.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers).then((function(t){s.sendRequest(e.C.INVITE,{extraHeaders:i,body:t,receiveResponse:s.receiveReinviteResponse.bind(s)})})).catch((function(t){if(t instanceof e.Exceptions.RenegotiationError)return s.pendingReinvite=!1,s.emit("renegotiationError",t),s.logger.warn("Renegotiation Error"),void s.logger.warn(t);s.logger.error("sessionDescriptionHandler error"),s.logger.error(t)}))}},receiveRequest:function(t){switch(t.method){case e.C.BYE:t.reply(200),this.status===c.STATUS_CONFIRMED&&(this.emit("bye",t),this.terminated(t,e.C.causes.BYE));break;case e.C.INVITE:this.status===c.STATUS_CONFIRMED&&(this.logger.log("re-INVITE received"),this.receiveReinvite(t));break;case e.C.INFO:if(this.status===c.STATUS_CONFIRMED||this.status===c.STATUS_WAITING_FOR_ACK){if(this.onInfo)return this.onInfo(t);var s,i,n,r=t.getHeader("content-type"),o=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,u=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;r&&(r.match(/^application\/dtmf-relay/i)?(t.body&&2===(s=t.body.split("\r\n",2)).length&&(o.test(s[0])&&(i=s[0].replace(o,"$2")),u.test(s[1])&&(n=parseInt(s[1].replace(u,"$2"),10))),new a(this,i,{duration:n}).init_incoming(t)):t.reply(415,null,["Accept: application/dtmf-relay"]))}break;case e.C.REFER:if(this.status===c.STATUS_CONFIRMED)if(this.logger.log("REFER received"),this.referContext=new e.ReferServerContext(this.ua,t),this.listeners("referRequested").length)this.emit("referRequested",this.referContext);else{this.logger.log("No referRequested listeners, automatically accepting and following the refer");var h={followRefer:!0};this.passedOptions&&(h.inviteOptions=this.passedOptions),this.referContext.accept(h,this.modifiers)}break;case e.C.NOTIFY:if(this.referContext&&this.referContext instanceof e.ReferClientContext&&t.hasHeader("event")&&/^refer(;.*)?$/.test(t.getHeader("event")))return void this.referContext.receiveNotify(t);t.reply(200,"OK"),this.emit("notify",t)}},receiveReinviteResponse:function(t){var s=this;if(this.status!==c.STATUS_TERMINATED)if(this.pendingReinvite)switch(!0){case/^1[0-9]{2}$/.test(t.status_code):break;case/^2[0-9]{2}$/.test(t.status_code):if(this.status=c.STATUS_CONFIRMED,this.emit("ack",t.transaction.sendACK()),this.pendingReinvite=!1,e.Timers.clearTimeout(s.timers.invite2xxTimer),!this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type"))){this.logger.error("2XX response received to re-invite but did not have a description"),this.emit("reinviteFailed",s),this.emit("renegotiationError",new e.Exceptions.RenegotiationError("2XX response received to re-invite but did not have a description"));break}this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).catch((function(t){s.logger.error("Could not set the description in 2XX response"),s.logger.error(t),s.emit("reinviteFailed",s),s.emit("renegotiationError",t),s.sendRequest(e.C.BYE,{extraHeaders:["Reason: "+e.Utils.getReasonHeaderValue(488,"Not Acceptable Here")]}),s.terminated(null,e.C.causes.INCOMPATIBLE_SDP)})).then((function(){s.emit("reinviteAccepted",s)}));break;default:this.pendingReinvite=!1,this.logger.log("Received a non 1XX or 2XX response to a re-invite"),this.emit("reinviteFailed",s),this.emit("renegotiationError",new e.Exceptions.RenegotiationError("Invalid response to a re-invite"))}else this.logger.error("Received reinvite response, but have no pending reinvite");else this.logger.error("Received reinvite response, but in STATUS_TERMINATED")},acceptAndTerminate:function(t,s,i){var n=[];return s&&n.push("Reason: "+e.Utils.getReasonHeaderValue(s,i)),(this.dialog||this.createDialog(t,"UAC"))&&(this.emit("ack",t.transaction.sendACK()),this.sendRequest(e.C.BYE,{extraHeaders:n})),this},setInvite2xxTimer:function(t,s){var i=this,n=e.Timers.T1;this.timers.invite2xxTimer=e.Timers.setTimeout((function r(){if(i.status===c.STATUS_WAITING_FOR_ACK){i.logger.log("no ACK received, attempting to retransmit OK");var o=["Contact: "+i.contact];t.reply(200,null,o,s),n=Math.min(2*n,e.Timers.T2),i.timers.invite2xxTimer=e.Timers.setTimeout(r,n)}}),n)},setACKTimer:function(){var t=this;this.timers.ackTimer=e.Timers.setTimeout((function(){t.status===c.STATUS_WAITING_FOR_ACK&&(t.logger.log("no ACK received for an extended period of time, terminating the call"),e.Timers.clearTimeout(t.timers.invite2xxTimer),t.sendRequest(e.C.BYE),t.terminated(null,e.C.causes.NO_ACK))}),e.Timers.TIMER_H)},onTransportError:function(){this.status!==c.STATUS_CONFIRMED&&this.status!==c.STATUS_TERMINATED&&this.failed(null,e.C.causes.CONNECTION_ERROR)},onRequestTimeout:function(){this.status===c.STATUS_CONFIRMED?this.terminated(null,e.C.causes.REQUEST_TIMEOUT):this.status!==c.STATUS_TERMINATED&&(this.failed(null,e.C.causes.REQUEST_TIMEOUT),this.terminated(null,e.C.causes.REQUEST_TIMEOUT))},onDialogError:function(t){this.status===c.STATUS_CONFIRMED?this.terminated(t,e.C.causes.DIALOG_ERROR):this.status!==c.STATUS_TERMINATED&&(this.failed(t,e.C.causes.DIALOG_ERROR),this.terminated(t,e.C.causes.DIALOG_ERROR))},failed:function(e,t){return this.status===c.STATUS_TERMINATED||this.emit("failed",e||null,t||null),this},rejected:function(e,t){return this.emit("rejected",e||null,t||null),this},canceled:function(){return this.sessionDescriptionHandler&&this.sessionDescriptionHandler.close(),this.emit("cancel"),this},accepted:function(t,s){return s=e.Utils.getReasonPhrase(t&&t.status_code,s),this.startTime=new Date,this.replacee&&(this.replacee.emit("replaced",this),this.replacee.terminate()),this.emit("accepted",t,s),this},terminated:function(e,t){return this.status===c.STATUS_TERMINATED||(this.endTime=new Date,this.close(),this.emit("terminated",e||null,t||null)),this},connecting:function(e){return this.emit("connecting",{request:e}),this}},t.C=c,e.Session=t,(i=function(t,s){var i,n=this,r=s.getHeader("Content-Type"),o=s.parseHeader("Content-Disposition");function a(e,t){s.hasHeader(e)&&s.getHeader(e).toLowerCase().indexOf("100rel")>=0&&(n.rel100=t)}if(e.Utils.augment(this,e.ServerContext,[t,s]),e.Utils.augment(this,e.Session,[t.configuration.sessionDescriptionHandlerFactory]),o&&"render"===o.type&&(this.renderbody=s.body,this.rendertype=r),this.status=c.STATUS_INVITE_RECEIVED,this.from_tag=s.from_tag,this.id=s.call_id+this.from_tag,this.request=s,this.contact=this.ua.contact.toString(),this.receiveNonInviteResponse=function(){},this.logger=t.getLogger("sip.inviteservercontext",this.id),this.ua.sessions[this.id]=this,s.hasHeader("expires")&&(i=1e3*s.getHeader("expires")),a("require",e.C.supported.REQUIRED),a("supported",e.C.supported.SUPPORTED),s.to_tag=e.Utils.newTag(),this.createDialog(s,"UAS",!0)){var u={extraHeaders:["Contact: "+n.contact]};n.rel100!==e.C.supported.REQUIRED&&n.progress(u),n.status=c.STATUS_WAITING_FOR_ANSWER,n.timers.userNoAnswerTimer=e.Timers.setTimeout((function(){s.reply(408),n.failed(s,e.C.causes.NO_ANSWER),n.terminated(s,e.C.causes.NO_ANSWER)}),n.ua.configuration.noAnswerTimeout),i&&(n.timers.expiresTimer=e.Timers.setTimeout((function(){n.status===c.STATUS_WAITING_FOR_ANSWER&&(s.reply(487),n.failed(s,e.C.causes.EXPIRES),n.terminated(s,e.C.causes.EXPIRES))}),i)),this.errorListener=this.onTransportError.bind(this),t.transport.on("transportError",this.errorListener)}else s.reply(500,"Missing Contact header field")}).prototype=Object.create({},{reject:{writable:!0,value:function(t){if(this.status===c.STATUS_TERMINATED)throw new e.Exceptions.InvalidStateError(this.status);return this.logger.log("rejecting RTCSession"),e.ServerContext.prototype.reject.call(this,t),this.terminated()}},terminate:{writable:!0,value:function(t){var s,i=((t=t||{}).extraHeaders||[]).slice(),n=t.body,r=this;return this.status===c.STATUS_WAITING_FOR_ACK&&this.request.server_transaction.state!==e.Transactions.C.STATUS_TERMINATED?(s=this.dialog,this.receiveRequest=function(t){t.method===e.C.ACK&&(this.sendRequest(e.C.BYE,{extraHeaders:i,body:n}),s.terminate())},this.request.server_transaction.on("stateChanged",(function(){this.state===e.Transactions.C.STATUS_TERMINATED&&this.dialog&&(this.request=new e.OutgoingRequest(e.C.BYE,this.dialog.remote_target,this.ua,{cseq:this.dialog.local_seqnum+=1,call_id:this.dialog.id.call_id,from_uri:this.dialog.local_uri,from_tag:this.dialog.id.local_tag,to_uri:this.dialog.remote_uri,to_tag:this.dialog.id.remote_tag,route_set:this.dialog.route_set},i,n),new e.RequestSender({request:this.request,onRequestTimeout:function(){r.onRequestTimeout()},onTransportError:function(){r.onTransportError()},receiveResponse:function(){}},this.ua).send(),s.terminate())})),this.emit("bye",this.request),this.terminated(),this.dialog=s,this.ua.dialogs[s.id.toString()]=s):this.status===c.STATUS_CONFIRMED?this.bye(t):this.reject(t),this}},progress:{writable:!0,value:function(t){var s,i=(t=t||{}).statusCode||180,n=t.reasonPhrase,r=(t.extraHeaders||[]).slice(),o=t.body;if(i<100||i>199)throw new TypeError("Invalid statusCode: "+i);if(this.isCanceled||this.status===c.STATUS_TERMINATED)return this;function a(){i=t.statusCode||183,this.status=c.STATUS_WAITING_FOR_PRACK,r.push("Contact: "+this.contact),r.push("Require: 100rel"),r.push("RSeq: "+Math.floor(1e4*Math.random())),this.sessionDescriptionHandler.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers).then(function(t){if(!this.isCanceled&&this.status!==c.STATUS_TERMINATED){this.early_sdp=t.body,this[this.hasOffer?"hasAnswer":"hasOffer"]=!0;var o=e.Timers.T1;this.timers.rel1xxTimer=e.Timers.setTimeout(function s(){this.request.reply(i,null,r,t),o*=2,this.timers.rel1xxTimer=e.Timers.setTimeout(s.bind(this),o)}.bind(this),o),this.timers.prackTimer=e.Timers.setTimeout(function(){this.status===c.STATUS_WAITING_FOR_PRACK&&(this.logger.log("no PRACK received, rejecting the call"),e.Timers.clearTimeout(this.timers.rel1xxTimer),this.request.reply(504),this.terminated(null,e.C.causes.NO_PRACK))}.bind(this),64*e.Timers.T1),s=this.request.reply(i,n,r,t),this.emit("progress",s,n)}}.bind(this),function(){this.request.reply(480),this.failed(null,e.C.causes.WEBRTC_ERROR),this.terminated(null,e.C.causes.WEBRTC_ERROR)}.bind(this))}return 100!==t.statusCode&&(this.rel100===e.C.supported.REQUIRED||this.rel100===e.C.supported.SUPPORTED&&t.rel100||this.rel100===e.C.supported.SUPPORTED&&this.ua.configuration.rel100===e.C.supported.REQUIRED)?(this.sessionDescriptionHandler=this.setupSessionDescriptionHandler(),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),this.sessionDescriptionHandler.hasDescription(this.request.getHeader("Content-Type"))?(this.hasOffer=!0,this.sessionDescriptionHandler.setDescription(this.request.body,t.sessionDescriptionHandlerOptions,t.modifiers).then(a.apply(this)).catch(function(t){this.logger.warn("invalid description"),this.logger.warn(t),this.failed(null,e.C.causes.WEBRTC_ERROR),this.terminated(null,e.C.causes.WEBRTC_ERROR)}.bind(this))):a.apply(this)):function(){s=this.request.reply(i,n,r,o),this.emit("progress",s,n)}.apply(this),this}},accept:{writable:!0,value:function(t){t=t||{},this.onInfo=t.onInfo;var s=this,i=this.request,n=(t.extraHeaders||[]).slice(),r=function(t){var r;n.push("Contact: "+s.contact),n.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),s.hasOffer?s.hasAnswer=!0:s.hasOffer=!0,r=i.reply(200,null,n,t,(function(){s.status=c.STATUS_WAITING_FOR_ACK,s.setInvite2xxTimer(i,t),s.setACKTimer()}),(function(){s.failed(null,e.C.causes.CONNECTION_ERROR),s.terminated(null,e.C.causes.CONNECTION_ERROR)})),s.status!==c.STATUS_TERMINATED&&s.accepted(r,e.Utils.getReasonPhrase(200))},o=function(t){t instanceof e.Exceptions.SessionDescriptionHandlerError&&(s.logger.log(t.message),s.logger.log(t.error)),s.status!==c.STATUS_TERMINATED&&(s.request.reply(480),s.failed(null,e.C.causes.WEBRTC_ERROR),s.terminated(null,e.C.causes.WEBRTC_ERROR))};if(this.status===c.STATUS_WAITING_FOR_PRACK)return this.status=c.STATUS_ANSWERED_WAITING_FOR_PRACK,this;if(this.status===c.STATUS_WAITING_FOR_ANSWER)this.status=c.STATUS_ANSWERED;else if(this.status!==c.STATUS_EARLY_MEDIA)throw new e.Exceptions.InvalidStateError(this.status);if(!this.createDialog(i,"UAS"))return i.reply(500,"Missing Contact header field"),this;if(e.Timers.clearTimeout(this.timers.userNoAnswerTimer),this.status===c.STATUS_EARLY_MEDIA)r({});else if(this.sessionDescriptionHandler=this.setupSessionDescriptionHandler(),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),"0"!==this.request.getHeader("Content-Length")||this.request.getHeader("Content-Type")){if(!this.sessionDescriptionHandler.hasDescription(this.request.getHeader("Content-Type")))return void this.request.reply(415);this.hasOffer=!0,this.sessionDescriptionHandler.setDescription(this.request.body,t.sessionDescriptionHandlerOptions,t.modifiers).then(function(){return this.sessionDescriptionHandler.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers)}.bind(this)).catch(o).then(r)}else this.sessionDescriptionHandler.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers).catch(o).then(r);return this}},receiveRequest:{writable:!0,value:function(s){function i(){var t,i;e.Timers.clearTimeout(this.timers.ackTimer),e.Timers.clearTimeout(this.timers.invite2xxTimer),this.status=c.STATUS_CONFIRMED,t=s.getHeader("Content-Type"),(i=s.getHeader("Content-Disposition"))&&"render"===i.type&&(this.renderbody=s.body,this.rendertype=t),this.emit("confirmed",s)}switch(s.method){case e.C.CANCEL:this.status!==c.STATUS_WAITING_FOR_ANSWER&&this.status!==c.STATUS_WAITING_FOR_PRACK&&this.status!==c.STATUS_ANSWERED_WAITING_FOR_PRACK&&this.status!==c.STATUS_EARLY_MEDIA&&this.status!==c.STATUS_ANSWERED||(this.status=c.STATUS_CANCELED,this.request.reply(487),this.canceled(s),this.rejected(s,e.C.causes.CANCELED),this.failed(s,e.C.causes.CANCELED),this.terminated(s,e.C.causes.CANCELED));break;case e.C.ACK:this.status===c.STATUS_WAITING_FOR_ACK&&(this.sessionDescriptionHandler.hasDescription(s.getHeader("Content-Type"))?(this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(s.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(i.bind(this),function(t){this.logger.warn(t),this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(s,e.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(s,e.C.causes.BAD_MEDIA_DESCRIPTION)}.bind(this))):i.apply(this));break;case e.C.PRACK:this.status===c.STATUS_WAITING_FOR_PRACK||this.status===c.STATUS_ANSWERED_WAITING_FOR_PRACK?this.hasAnswer?(e.Timers.clearTimeout(this.timers.rel1xxTimer),e.Timers.clearTimeout(this.timers.prackTimer),s.reply(200),this.status===c.STATUS_ANSWERED_WAITING_FOR_PRACK&&(this.status=c.STATUS_EARLY_MEDIA,this.accept()),this.status=c.STATUS_EARLY_MEDIA):(this.sessionDescriptionHandler=this.setupSessionDescriptionHandler(),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),this.sessionDescriptionHandler.hasDescription(s.getHeader("Content-Type"))?(this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(s.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){e.Timers.clearTimeout(this.timers.rel1xxTimer),e.Timers.clearTimeout(this.timers.prackTimer),s.reply(200),this.status===c.STATUS_ANSWERED_WAITING_FOR_PRACK&&(this.status=c.STATUS_EARLY_MEDIA,this.accept()),this.status=c.STATUS_EARLY_MEDIA}.bind(this),function(t){this.logger.warn(t),this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(s,e.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(s,e.C.causes.BAD_MEDIA_DESCRIPTION)}.bind(this))):(this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(s,e.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(s,e.C.causes.BAD_MEDIA_DESCRIPTION))):this.status===c.STATUS_EARLY_MEDIA&&s.reply(200);break;default:t.prototype.receiveRequest.apply(this,[s])}}},setupSessionDescriptionHandler:{writable:!0,value:function(){return this.sessionDescriptionHandler?this.sessionDescriptionHandler:this.sessionDescriptionHandlerFactory(this,this.ua.configuration.sessionDescriptionHandlerFactoryOptions)}},onTransportError:{writable:!0,value:function(){this.status!==c.STATUS_CONFIRMED&&this.status!==c.STATUS_TERMINATED&&this.failed(null,e.C.causes.CONNECTION_ERROR)}},onRequestTimeout:{writable:!0,value:function(){this.status===c.STATUS_CONFIRMED?this.terminated(null,e.C.causes.REQUEST_TIMEOUT):this.status!==c.STATUS_TERMINATED&&(this.failed(null,e.C.causes.REQUEST_TIMEOUT),this.terminated(null,e.C.causes.REQUEST_TIMEOUT))}}}),e.InviteServerContext=i,(n=function(t,s,i,n){i=i||{},this.passedOptions=i,i.params=Object.create(i.params||Object.prototype);var r=(i.extraHeaders||[]).slice(),o=t.configuration.sessionDescriptionHandlerFactory;if(this.sessionDescriptionHandlerFactoryOptions=t.configuration.sessionDescriptionHandlerFactoryOptions||{},this.sessionDescriptionHandlerOptions=i.sessionDescriptionHandlerOptions||{},this.modifiers=n,this.inviteWithoutSdp=i.inviteWithoutSdp||!1,this.anonymous=i.anonymous||!1,this.renderbody=i.renderbody||null,this.rendertype=i.rendertype||"text/plain",this.from_tag=e.Utils.newTag(),i.params.from_tag=this.from_tag,this.contact=t.contact.toString({anonymous:this.anonymous,outbound:this.anonymous?!t.contact.temp_gruu:!t.contact.pub_gruu}),this.anonymous&&(i.params.from_displayName="Anonymous",i.params.from_uri="sip:anonymous@anonymous.invalid",r.push("P-Preferred-Identity: "+t.configuration.uri.toString()),r.push("Privacy: id")),r.push("Contact: "+this.contact),r.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.inviteWithoutSdp&&this.renderbody&&(r.push("Content-Type: "+this.rendertype),r.push("Content-Disposition: render;handling=optional")),t.configuration.rel100===e.C.supported.REQUIRED&&r.push("Require: 100rel"),t.configuration.replaces===e.C.supported.REQUIRED&&r.push("Require: replaces"),i.extraHeaders=r,e.Utils.augment(this,e.ClientContext,[t,e.C.INVITE,s,i]),e.Utils.augment(this,e.Session,[o]),this.status!==c.STATUS_NULL)throw new e.Exceptions.InvalidStateError(this.status);this.isCanceled=!1,this.received_100=!1,this.method=e.C.INVITE,this.receiveNonInviteResponse=this.receiveResponse,this.receiveResponse=this.receiveInviteResponse,this.logger=t.getLogger("sip.inviteclientcontext"),t.applicants[this]=this,this.id=this.request.call_id+this.from_tag,this.onInfo=i.onInfo,this.errorListener=this.onTransportError.bind(this),t.transport.on("transportError",this.errorListener)}).prototype=Object.create({},{invite:{writable:!0,value:function(){var t=this;return this.ua.sessions[this.id]=this,e.Utils.Promise.resolve().then(function(){this.inviteWithoutSdp?(this.request.body=t.renderbody,this.status=c.STATUS_INVITE_SENT,this.send()):(this.sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.sessionDescriptionHandlerFactoryOptions),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),this.sessionDescriptionHandler.getDescription(this.sessionDescriptionHandlerOptions,this.modifiers).then((function(e){t.isCanceled||t.status===c.STATUS_TERMINATED||(t.hasOffer=!0,t.request.body=e,t.status=c.STATUS_INVITE_SENT,t.send())}),(function(s){s instanceof e.Exceptions.SessionDescriptionHandlerError&&(t.logger.log(s.message),t.logger.log(s.error)),t.status!==c.STATUS_TERMINATED&&(t.failed(null,e.C.causes.WEBRTC_ERROR),t.terminated(null,e.C.causes.WEBRTC_ERROR))})))}.bind(this)),this}},receiveInviteResponse:{writable:!0,value:function(t){var s,i=this,n=t.call_id+t.from_tag+t.to_tag,r=[],o={};if(this.status!==c.STATUS_TERMINATED&&t.method===e.C.INVITE){if(this.dialog&&t.status_code>=200&&t.status_code<=299){if(n!==this.dialog.id.toString()){if(!this.createDialog(t,"UAC",!0))return;return this.emit("ack",t.transaction.sendACK({body:e.Utils.generateFakeSDP(t.body)})),this.earlyDialogs[n].sendRequest(this,e.C.BYE),void(this.status!==c.STATUS_CONFIRMED&&(this.failed(t,e.C.causes.WEBRTC_ERROR),this.terminated(t,e.C.causes.WEBRTC_ERROR)))}if(this.status===c.STATUS_CONFIRMED)return void this.emit("ack",t.transaction.sendACK());if(!this.hasAnswer)return}if(this.dialog&&t.status_code<200){if(-1!==this.dialog.pracked.indexOf(t.getHeader("rseq"))||this.dialog.pracked[this.dialog.pracked.length-1]>=t.getHeader("rseq")&&this.dialog.pracked.length>0)return;if(!this.earlyDialogs[n]&&!this.createDialog(t,"UAC",!0))return;if(-1!==this.earlyDialogs[n].pracked.indexOf(t.getHeader("rseq"))||this.earlyDialogs[n].pracked[this.earlyDialogs[n].pracked.length-1]>=t.getHeader("rseq")&&this.earlyDialogs[n].pracked.length>0)return;return r.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq")),this.earlyDialogs[n].pracked.push(t.getHeader("rseq")),void this.earlyDialogs[n].sendRequest(this,e.C.PRACK,{extraHeaders:r,body:e.Utils.generateFakeSDP(t.body)})}if(this.isCanceled)t.status_code>=100&&t.status_code<200?(this.request.cancel(this.cancelReason,r),this.canceled(null)):t.status_code>=200&&t.status_code<299?(this.acceptAndTerminate(t),this.emit("bye",this.request)):t.status_code>=300&&(s=e.C.REASON_PHRASE[t.status_code]||e.C.causes.CANCELED,this.rejected(t,s),this.failed(t,s),this.terminated(t,s));else switch(!0){case/^100$/.test(t.status_code):this.received_100=!0,this.emit("progress",t);break;case/^1[0-9]{2}$/.test(t.status_code):if(!t.to_tag){this.logger.warn("1xx response received without to tag");break}if(t.hasHeader("contact")&&!this.createDialog(t,"UAC",!0))break;if(this.status=c.STATUS_1XX_RECEIVED,t.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=new e.NameAddrHeader.parse(t.getHeader("P-Asserted-Identity"))),t.hasHeader("require")&&-1!==t.getHeader("require").indexOf("100rel")){if(this.dialog||!this.earlyDialogs[n])break;if(-1!==this.earlyDialogs[n].pracked.indexOf(t.getHeader("rseq"))||this.earlyDialogs[n].pracked[this.earlyDialogs[n].pracked.length-1]>=t.getHeader("rseq")&&this.earlyDialogs[n].pracked.length>0)return;if(this.sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.sessionDescriptionHandlerFactoryOptions),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type")))if(this.hasOffer){if(!this.createDialog(t,"UAC"))break;this.hasAnswer=!0,this.dialog.pracked.push(t.getHeader("rseq")),this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then((function(){r.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq")),i.sendRequest(e.C.PRACK,{extraHeaders:r,receiveResponse:function(){}}),i.status=c.STATUS_EARLY_MEDIA,i.emit("progress",t)}),(function(s){i.logger.warn(s),i.acceptAndTerminate(t,488,"Not Acceptable Here"),i.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION)}))}else{var a=this.earlyDialogs[n],u=a.sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.sessionDescriptionHandlerFactoryOptions);this.emit("SessionDescriptionHandler-created",u),a.pracked.push(t.getHeader("rseq")),u.setDescription(t.body,i.sessionDescriptionHandlerOptions,i.modifers).then(u.getDescription.bind(u,i.sessionDescriptionHandlerOptions,i.modifiers)).then((function(s){r.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq")),a.sendRequest(i,e.C.PRACK,{extraHeaders:r,body:s}),i.status=c.STATUS_EARLY_MEDIA,i.emit("progress",t)})).catch((function(s){if(s instanceof e.Exceptions.SessionDescriptionHandlerError){if(a.pracked.push(t.getHeader("rseq")),i.status===c.STATUS_TERMINATED)return;i.failed(null,e.C.causes.WEBRTC_ERROR),i.terminated(null,e.C.causes.WEBRTC_ERROR)}else a.pracked.splice(a.pracked.indexOf(t.getHeader("rseq")),1),i.logger.warn("invalid description"),i.logger.warn(s)}))}else r.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq")),this.earlyDialogs[n].pracked.push(t.getHeader("rseq")),this.earlyDialogs[n].sendRequest(this,e.C.PRACK,{extraHeaders:r}),this.emit("progress",t)}else this.emit("progress",t);break;case/^2[0-9]{2}$/.test(t.status_code):if(this.request.cseq+" "+this.request.method!==t.getHeader("cseq"))break;if(t.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=new e.NameAddrHeader.parse(t.getHeader("P-Asserted-Identity"))),this.status===c.STATUS_EARLY_MEDIA&&this.dialog){this.status=c.STATUS_CONFIRMED,o={},this.renderbody&&(r.push("Content-Type: "+this.rendertype),o.extraHeaders=r,o.body=this.renderbody),this.emit("ack",t.transaction.sendACK(o)),this.accepted(t);break}if(this.dialog)break;if(this.hasOffer)if(this.hasAnswer)this.renderbody&&(r.push("Content-Type: "+i.rendertype),o.extraHeaders=r,o.body=this.renderbody),this.emit("ack",t.transaction.sendACK(o));else{if(!this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type"))){this.acceptAndTerminate(t,400,"Missing session description"),this.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(t,"UAC"))break;this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then((function(){var e={};i.status=c.STATUS_CONFIRMED,i.renderbody&&(r.push("Content-Type: "+i.rendertype),e.extraHeaders=r,e.body=i.renderbody),i.emit("ack",t.transaction.sendACK(e)),i.accepted(t)}),(function(s){i.logger.warn(s),i.acceptAndTerminate(t,488,"Not Acceptable Here"),i.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION)}))}else if(this.earlyDialogs[n]&&this.earlyDialogs[n].sessionDescriptionHandler){if(this.hasOffer=!0,this.hasAnswer=!0,this.sessionDescriptionHandler=this.earlyDialogs[n].sessionDescriptionHandler,!this.createDialog(t,"UAC"))break;this.status=c.STATUS_CONFIRMED,this.emit("ack",t.transaction.sendACK()),this.accepted(t)}else{if(this.sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.sessionDescriptionHandlerFactoryOptions),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),!this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type"))){this.acceptAndTerminate(t,400,"Missing session description"),this.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(t,"UAC"))break;this.hasOffer=!0,this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(this.sessionDescriptionHandler.getDescription.bind(this.sessionDescriptionHandler,this.sessionDescriptionHandlerOptions,this.modifiers)).then((function(e){i.isCanceled||i.status===c.STATUS_TERMINATED||(i.status=c.STATUS_CONFIRMED,i.hasAnswer=!0,i.emit("ack",t.transaction.sendACK({body:e})),i.accepted(t))})).catch((function(s){s instanceof e.Exceptions.SessionDescriptionHandlerError&&(i.logger.warn("invalid description"),i.logger.warn(s),i.acceptAndTerminate(t,488,"Invalid session description"),i.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION))}))}break;default:s=e.Utils.sipErrorCause(t.status_code),this.rejected(t,s),this.failed(t,s),this.terminated(t,s)}}}},cancel:{writable:!0,value:function(t){if((t=t||{}).extraHeaders=(t.extraHeaders||[]).slice(),this.isCanceled)throw new e.Exceptions.InvalidStateError("CANCELED");if(this.status===c.STATUS_TERMINATED||this.status===c.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);this.logger.log("canceling RTCSession"),this.isCanceled=!0;var s=e.Utils.getCancelReason(t.status_code,t.reason_phrase);return this.status===c.STATUS_NULL||this.status===c.STATUS_INVITE_SENT&&!this.received_100?this.cancelReason=s:this.status!==c.STATUS_INVITE_SENT&&this.status!==c.STATUS_1XX_RECEIVED&&this.status!==c.STATUS_EARLY_MEDIA||this.request.cancel(s,t.extraHeaders),this.canceled()}},terminate:{writable:!0,value:function(e){return this.status===c.STATUS_TERMINATED||(this.status===c.STATUS_WAITING_FOR_ACK||this.status===c.STATUS_CONFIRMED?this.bye(e):this.cancel(e)),this}},receiveRequest:{writable:!0,value:function(s){return s.method,e.C.CANCEL,s.method===e.C.ACK&&this.status===c.STATUS_WAITING_FOR_ACK&&(e.Timers.clearTimeout(this.timers.ackTimer),e.Timers.clearTimeout(this.timers.invite2xxTimer),this.status=c.STATUS_CONFIRMED,this.accepted()),t.prototype.receiveRequest.apply(this,[s])}},onTransportError:{writable:!0,value:function(){this.status!==c.STATUS_CONFIRMED&&this.status!==c.STATUS_TERMINATED&&this.failed(null,e.C.causes.CONNECTION_ERROR)}},onRequestTimeout:{writable:!0,value:function(){this.status===c.STATUS_CONFIRMED?this.terminated(null,e.C.causes.REQUEST_TIMEOUT):this.status!==c.STATUS_TERMINATED&&(this.failed(null,e.C.causes.REQUEST_TIMEOUT),this.terminated(null,e.C.causes.REQUEST_TIMEOUT))}}}),e.InviteClientContext=n,(o=function(t,s,i,n){if(this.options=n||{},this.extraHeaders=(this.options.extraHeaders||[]).slice(),void 0===t||void 0===s||void 0===i)throw new TypeError("Not enough arguments");if(e.Utils.augment(this,e.ClientContext,[t,e.C.REFER,s.remoteIdentity.uri.toString(),n]),this.applicant=s,i instanceof e.InviteServerContext||i instanceof e.InviteClientContext)this.target='"'+i.remoteIdentity.friendlyName+'" <'+i.dialog.remote_target.toString()+"?Replaces="+i.dialog.id.call_id+"%3Bto-tag%3D"+i.dialog.id.remote_tag+"%3Bfrom-tag%3D"+i.dialog.id.local_tag+">";else{try{this.target=e.Grammar.parse(i,"Refer_To").uri||i}catch(e){this.logger.debug(".refer() cannot parse Refer_To from",i),this.logger.debug("...falling through to normalizeTarget()")}if(this.target=this.ua.normalizeTarget(this.target),!this.target)throw new TypeError("Invalid target: "+i)}this.ua&&this.extraHeaders.push("Referred-By: <"+this.ua.configuration.uri+">"),this.extraHeaders.push("Contact: "+s.contact),this.extraHeaders.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.extraHeaders.push("Refer-To: "+this.target),this.errorListener=this.onTransportError.bind(this),t.transport.on("transportError",this.errorListener)}).prototype=Object.create({},{refer:{writable:!0,value:function(t){t=t||{};var s=(this.extraHeaders||[]).slice();return t.extraHeaders&&s.concat(t.extraHeaders),this.applicant.sendRequest(e.C.REFER,{extraHeaders:this.extraHeaders,receiveResponse:function(e){/^1[0-9]{2}$/.test(e.status_code)?this.emit("referRequestProgress",this):/^2[0-9]{2}$/.test(e.status_code)?this.emit("referRequestAccepted",this):/^[4-6][0-9]{2}$/.test(e.status_code)&&this.emit("referRequestRejected",this),t.receiveResponse&&t.receiveResponse(e)}.bind(this)}),this}},receiveNotify:{writable:!0,value:function(t){if(t.hasHeader("Content-Type")&&-1!==t.getHeader("Content-Type").search(/^message\/sipfrag/)){var s=e.Grammar.parse(t.body,"sipfrag");if(-1===s)return void t.reply(489,"Bad Event");switch(!0){case/^1[0-9]{2}$/.test(s.status_code):this.emit("referProgress",this);break;case/^2[0-9]{2}$/.test(s.status_code):this.emit("referAccepted",this),!this.options.activeAfterTransfer&&this.applicant.terminate&&this.applicant.terminate();break;default:this.emit("referRejected",this)}return t.reply(200),void this.emit("notify",t)}t.reply(489,"Bad Event")}}}),e.ReferClientContext=o,(r=function(t,s){if(e.Utils.augment(this,e.ServerContext,[t,s]),this.ua=t,this.status=c.STATUS_INVITE_RECEIVED,this.from_tag=s.from_tag,this.id=s.call_id+this.from_tag,this.request=s,this.contact=this.ua.contact.toString(),this.logger=t.getLogger("sip.referservercontext",this.id),!this.request.hasHeader("refer-to"))return this.logger.warn("Invalid REFER packet. A refer-to header is required. Rejecting refer."),void this.reject();this.referTo=this.request.parseHeader("refer-to"),this.referredSession=this.ua.findSession(s),this.cseq=Math.floor(1e4*Math.random()),this.call_id=this.request.call_id,this.from_uri=this.request.to.uri,this.from_tag=this.request.to.parameters.tag,this.remote_target=this.request.headers.Contact[0].parsed.uri,this.to_uri=this.request.from.uri,this.to_tag=this.request.from_tag,this.route_set=this.request.getHeaders("record-route"),this.receiveNonInviteResponse=function(){},this.request.hasHeader("referred-by")&&(this.referredBy=this.request.getHeader("referred-by")),this.referTo.uri.hasHeader("replaces")&&(this.replaces=this.referTo.uri.getHeader("replaces")),this.errorListener=this.onTransportError.bind(this),t.transport.on("transportError",this.errorListener),this.status=c.STATUS_WAITING_FOR_ANSWER}).prototype=Object.create({},{progress:{writable:!0,value:function(){if(this.status!==c.STATUS_WAITING_FOR_ANSWER)throw new e.Exceptions.InvalidStateError(this.status);this.request.reply(100)}},reject:{writable:!0,value:function(t){if(this.status===c.STATUS_TERMINATED)throw new e.Exceptions.InvalidStateError(this.status);this.logger.log("Rejecting refer"),this.status=c.STATUS_TERMINATED,e.ServerContext.prototype.reject.call(this,t),this.emit("referRequestRejected",this)}},accept:{writable:!0,value:function(t,s){if(t=t||{},this.status!==c.STATUS_WAITING_FOR_ANSWER)throw new e.Exceptions.InvalidStateError(this.status);if(this.status=c.STATUS_ANSWERED,this.request.reply(202,"Accepted"),this.emit("referRequestAccepted",this),t.followRefer){this.logger.log("Accepted refer, attempting to automatically follow it");var i=this.referTo.uri;if(!i.scheme.match("^sips?$"))return this.logger.error("SIP.js can only automatically follow SIP refer target"),void this.reject();var n=t.inviteOptions||{},r=(n.extraHeaders||[]).slice();this.replaces&&r.push("Replaces: "+decodeURIComponent(this.replaces)),this.referredBy&&r.push("Referred-By: "+this.referredBy),n.extraHeaders=r,i.clearHeaders(),this.targetSession=this.ua.invite(i,n,s),this.emit("referInviteSent",this),this.targetSession.once("progress",function(){this.sendNotify("SIP/2.0 100 Trying"),this.emit("referProgress",this),this.referredSession&&this.referredSession.emit("referProgress",this)}.bind(this)),this.targetSession.once("accepted",function(){this.logger.log("Successfully followed the refer"),this.sendNotify("SIP/2.0 200 OK"),this.emit("referAccepted",this),this.referredSession&&this.referredSession.emit("referAccepted",this)}.bind(this));var o=function(e){if(this.status!==c.STATUS_TERMINATED){if(this.logger.log("Refer was not successful. Resuming session"),e&&429===e.status_code)return this.logger.log("Alerting referrer that identity is required."),void this.sendNotify("SIP/2.0 429 Provide Referrer Identity");this.sendNotify("SIP/2.0 603 Declined"),this.status=c.STATUS_TERMINATED,this.emit("referRejected",this),this.referredSession&&this.referredSession.emit("referRejected")}};this.targetSession.once("rejected",o.bind(this)),this.targetSession.once("failed",o.bind(this))}else this.logger.log("Accepted refer, but did not automatically follow it"),this.sendNotify("SIP/2.0 200 OK"),this.emit("referAccepted",this),this.referredSession&&this.referredSession.emit("referAccepted",this)}},sendNotify:{writable:!0,value:function(t){if(this.status!==c.STATUS_ANSWERED)throw new e.Exceptions.InvalidStateError(this.status);if(-1===e.Grammar.parse(t,"sipfrag"))throw new Error("sipfrag body is required to send notify for refer");var s=new e.OutgoingRequest(e.C.NOTIFY,this.remote_target,this.ua,{cseq:this.cseq+=1,call_id:this.call_id,from_uri:this.from_uri,from_tag:this.from_tag,to_uri:this.to_uri,to_tag:this.to_tag,route_set:this.route_set},["Event: refer","Subscription-State: terminated","Content-Type: message/sipfrag"],t);new e.RequestSender({request:s,onRequestTimeout:function(){},onTransportError:function(){},receiveResponse:function(){}},this.ua).send()}}}),e.ReferServerContext=r}},function(e,t,s){"use strict";e.exports=function(e){var t;return(t=function(s,i,n){var r,o;if(void 0===i)throw new TypeError("Not enough arguments");if(this.logger=s.ua.getLogger("sip.invitecontext.dtmf",s.id),this.owner=s,this.direction=null,r=(n=n||{}).duration||null,o=n.interToneGap||null,"string"==typeof i)i=i.toUpperCase();else{if("number"!=typeof i)throw new TypeError("Invalid tone: "+i);i=i.toString()}if(!i.match(/^[0-9A-D#*]$/))throw new TypeError("Invalid tone: "+i);if(this.tone=i,r&&!e.Utils.isDecimal(r))throw new TypeError("Invalid tone duration: "+r);if(r?r<t.C.MIN_DURATION?(this.logger.warn('"duration" value is lower than the minimum allowed, setting it to '+t.C.MIN_DURATION+" milliseconds"),r=t.C.MIN_DURATION):r>t.C.MAX_DURATION?(this.logger.warn('"duration" value is greater than the maximum allowed, setting it to '+t.C.MAX_DURATION+" milliseconds"),r=t.C.MAX_DURATION):r=Math.abs(r):r=t.C.DEFAULT_DURATION,this.duration=r,o&&!e.Utils.isDecimal(o))throw new TypeError("Invalid interToneGap: "+o);o?o<t.C.MIN_INTER_TONE_GAP?(this.logger.warn('"interToneGap" value is lower than the minimum allowed, setting it to '+t.C.MIN_INTER_TONE_GAP+" milliseconds"),o=t.C.MIN_INTER_TONE_GAP):o=Math.abs(o):o=t.C.DEFAULT_INTER_TONE_GAP,this.interToneGap=o}).prototype=Object.create(e.EventEmitter.prototype),t.prototype.send=function(t){var s,i={};if(this.direction="outgoing",this.owner.status!==e.Session.C.STATUS_CONFIRMED&&this.owner.status!==e.Session.C.STATUS_WAITING_FOR_ACK)throw new e.Exceptions.InvalidStateError(this.owner.status);s=(t=t||{}).extraHeaders?t.extraHeaders.slice():[],i.contentType="application/dtmf-relay",i.body="Signal= "+this.tone+"\r\n",i.body+="Duration= "+this.duration,this.request=this.owner.dialog.sendRequest(this,e.C.INFO,{extraHeaders:s,body:i}),this.owner.emit("dtmf",this.request,this)},t.prototype.receiveResponse=function(t){var s;switch(!0){case/^1[0-9]{2}$/.test(t.status_code):break;case/^2[0-9]{2}$/.test(t.status_code):this.emit("succeeded",{originator:"remote",response:t});break;default:s=e.Utils.sipErrorCause(t.status_code),this.emit("failed",t,s)}},t.prototype.onRequestTimeout=function(){this.emit("failed",null,e.C.causes.REQUEST_TIMEOUT),this.owner.onRequestTimeout()},t.prototype.onTransportError=function(){this.emit("failed",null,e.C.causes.CONNECTION_ERROR),this.owner.onTransportError()},t.prototype.onDialogError=function(t){this.emit("failed",t,e.C.causes.DIALOG_ERROR),this.owner.onDialogError(t)},t.prototype.init_incoming=function(e){this.direction="incoming",this.request=e,e.reply(200),this.tone&&this.duration?this.owner.emit("dtmf",e,this):this.logger.warn("invalid INFO DTMF received, discarded")},t.C={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500},t}},function(e,t,s){"use strict";e.exports=function(e){e.Subscription=function(t,s,i,n){if(n=Object.create(n||Object.prototype),this.extraHeaders=n.extraHeaders=(n.extraHeaders||[]).slice(),this.id=null,this.state="init",!i)throw new TypeError("Event necessary to create a subscription.");this.event=i,"number"!=typeof n.expires?(t.logger.warn("expires must be a number. Using default of 3600."),this.expires=3600):this.expires=n.expires,this.requestedExpires=this.expires,n.extraHeaders.push("Event: "+this.event),n.extraHeaders.push("Expires: "+this.expires),n.body&&(this.body=n.body),this.contact=t.contact.toString(),n.extraHeaders.push("Contact: "+this.contact),n.extraHeaders.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),e.Utils.augment(this,e.ClientContext,[t,e.C.SUBSCRIBE,s,n]),this.logger=t.getLogger("sip.subscription"),this.dialog=null,this.timers={N:null,sub_duration:null},this.errorCodes=[404,405,410,416,480,481,482,483,484,485,489,501,604]},e.Subscription.prototype={subscribe:function(){return"active"===this.state?(this.refresh(),this):("notify_wait"===this.state||(e.Timers.clearTimeout(this.timers.sub_duration),e.Timers.clearTimeout(this.timers.N),this.timers.N=e.Timers.setTimeout(this.timer_fire.bind(this),e.Timers.TIMER_N),this.ua.earlySubscriptions[this.request.call_id+this.request.from.parameters.tag+this.event]=this,this.send(),this.state="notify_wait"),this)},refresh:function(){"terminated"!==this.state&&"pending"!==this.state&&"notify_wait"!==this.state&&this.dialog.sendRequest(this,e.C.SUBSCRIBE,{extraHeaders:this.extraHeaders,body:this.body})},receiveResponse:function(t){var s,i=e.Utils.getReasonPhrase(t.status_code);"notify_wait"===this.state&&t.status_code>=300||"notify_wait"!==this.state&&-1!==this.errorCodes.indexOf(t.status_code)?this.failed(t,null):/^2[0-9]{2}$/.test(t.status_code)?(this.emit("accepted",t,i),(s=t.getHeader("Expires"))&&s<=this.requestedExpires?(this.expires=s,this.timers.sub_duration=e.Timers.setTimeout(this.refresh.bind(this),900*s)):s?(this.logger.warn("Expires header in a 200-class response to SUBSCRIBE with a higher value than the one in the request"),this.failed(t,e.C.INVALID_EXPIRES_HEADER)):(this.logger.warn("Expires header missing in a 200-class response to SUBSCRIBE"),this.failed(t,e.C.EXPIRES_HEADER_MISSING))):t.statusCode>300&&(this.emit("failed",t,i),this.emit("rejected",t,i))},unsubscribe:function(){var t=[];this.state="terminated",t.push("Event: "+this.event),t.push("Expires: 0"),t.push("Contact: "+this.contact),t.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.receiveResponse=function(){},this.dialog.sendRequest(this,this.method,{extraHeaders:t,body:this.body}),e.Timers.clearTimeout(this.timers.sub_duration),e.Timers.clearTimeout(this.timers.N),this.timers.N=e.Timers.setTimeout(this.timer_fire.bind(this),e.Timers.TIMER_N)},timer_fire:function(){"terminated"===this.state?(this.terminateDialog(),e.Timers.clearTimeout(this.timers.N),e.Timers.clearTimeout(this.timers.sub_duration),delete this.ua.subscriptions[this.id]):"notify_wait"===this.state||"pending"===this.state?this.close():this.refresh()},close:function(){"notify_wait"===this.state?(this.state="terminated",e.Timers.clearTimeout(this.timers.N),e.Timers.clearTimeout(this.timers.sub_duration),this.receiveResponse=function(){},delete this.ua.earlySubscriptions[this.request.call_id+this.request.from.parameters.tag+this.event]):"terminated"!==this.state&&this.unsubscribe()},createConfirmedDialog:function(t,s){var i;return this.terminateDialog(),(i=new e.Dialog(this,t,s)).invite_seqnum=this.request.cseq,i.local_seqnum=this.request.cseq,!i.error&&(this.dialog=i,!0)},terminateDialog:function(){this.dialog&&(delete this.ua.subscriptions[this.id],this.dialog.terminate(),delete this.dialog)},receiveRequest:function(t){var s,i=this;function n(){s.expires&&(e.Timers.clearTimeout(i.timers.sub_duration),s.expires=Math.min(i.expires,Math.max(s.expires,0)),i.timers.sub_duration=e.Timers.setTimeout(i.refresh.bind(i),900*s.expires))}if(this.matchEvent(t))if(this.dialog||this.createConfirmedDialog(t,"UAS")&&(this.id=this.dialog.id.toString(),delete this.ua.earlySubscriptions[this.request.call_id+this.request.from.parameters.tag+this.event],this.ua.subscriptions[this.id]=this),s=t.parseHeader("Subscription-State"),t.reply(200,e.C.REASON_200),e.Timers.clearTimeout(this.timers.N),this.emit("notify",{request:t}),"terminated"!==this.state)switch(s.state){case"active":this.state="active",n();break;case"pending":"notify_wait"===this.state&&n(),this.state="pending";break;case"terminated":if(e.Timers.clearTimeout(this.timers.sub_duration),s.reason)switch(this.logger.log("terminating subscription with reason "+s.reason),s.reason){case"deactivated":case"timeout":return void this.subscribe();case"probation":case"giveup":return void(s.params&&s.params["retry-after"]?this.timers.sub_duration=e.Timers.setTimeout(i.subscribe.bind(i),s.params["retry-after"]):this.subscribe())}this.close()}else"terminated"===s.state&&(this.terminateDialog(),e.Timers.clearTimeout(this.timers.N),e.Timers.clearTimeout(this.timers.sub_duration),delete this.ua.subscriptions[this.id]);else t.reply(489)},failed:function(e,t){return this.close(),this.emit("failed",e,t),this.emit("rejected",e,t),this},onDialogError:function(t){this.failed(t,e.C.causes.DIALOG_ERROR)},matchEvent:function(e){var t;return e.hasHeader("Event")?e.hasHeader("Subscription-State")?(t=e.parseHeader("event").event,this.event===t||(this.logger.warn("event match failed"),e.reply(481,"Event Match Failed"),!1)):(this.logger.warn("missing Subscription-State header"),!1):(this.logger.warn("missing Event header"),!1)}}}},function(e,t,s){"use strict";e.exports=function(e){var t;((t=function(t,s,i,n){if(this.options=n=n||{},this.options.extraHeaders=(n.extraHeaders||[]).slice(),this.options.contentType=n.contentType||"text/plain","number"!=typeof n.expires||n.expires%1!=0?this.options.expires=3600:this.options.expires=Number(n.expires),"boolean"!=typeof n.unpublishOnClose?this.options.unpublishOnClose=!0:this.options.unpublishOnClose=n.unpublishOnClose,null==s||""===s)throw new e.Exceptions.MethodParameterError("Publish","Target",s);if(this.target=t.normalizeTarget(s),null==i||""===i)throw new e.Exceptions.MethodParameterError("Publish","Event",i);this.event=i,e.ClientContext.call(this,t,e.C.PUBLISH,this.target,this.options),this.logger=this.ua.getLogger("sip.publish"),this.pubRequestBody=null,this.pubRequestExpires=this.options.expires,this.pubRequestEtag=null,this.publish_refresh_timer=null,t.on("transportCreated",function(e){e.on("transportError",this.onTransportError.bind(this))}.bind(this))}).prototype=Object.create(e.ClientContext.prototype)).constructor=t,t.prototype.publish=function(t){if(this.request=null,e.Timers.clearTimeout(this.publish_refresh_timer),null!=t&&""!==t)this.options.body=t,this.pubRequestBody=this.options.body,0===this.pubRequestExpires&&(this.pubRequestExpires=this.options.expires,this.pubRequestEtag=null),this.ua.publishers[this.target.toString()+":"+this.event]||(this.ua.publishers[this.target.toString()+":"+this.event]=this);else{if(this.pubRequestBody=null,null===this.pubRequestEtag)throw new e.Exceptions.MethodParameterError("Publish","Body",t);if(0===this.pubRequestExpires)throw new e.Exceptions.MethodParameterError("Publish","Expire",this.pubRequestExpires)}this.sendPublishRequest()},t.prototype.unpublish=function(){this.request=null,e.Timers.clearTimeout(this.publish_refresh_timer),this.pubRequestBody=null,this.pubRequestExpires=0,null!==this.pubRequestEtag&&this.sendPublishRequest()},t.prototype.close=function(){this.options.unpublishOnClose?this.unpublish():(this.request=null,e.Timers.clearTimeout(this.publish_refresh_timer),this.pubRequestBody=null,this.pubRequestExpires=0,this.pubRequestEtag=null),this.ua.publishers[this.target.toString()+":"+this.event]&&delete this.ua.publishers[this.target.toString()+":"+this.event]},t.prototype.sendPublishRequest=function(){var t;(t=Object.create(this.options||Object.prototype)).extraHeaders=(this.options.extraHeaders||[]).slice(),t.extraHeaders.push("Event: "+this.event),t.extraHeaders.push("Expires: "+this.pubRequestExpires),null!==this.pubRequestEtag&&t.extraHeaders.push("SIP-If-Match: "+this.pubRequestEtag),this.request=new e.OutgoingRequest(e.C.PUBLISH,this.target,this.ua,this.options.params,t.extraHeaders),null!==this.pubRequestBody&&(this.request.body={},this.request.body.body=this.pubRequestBody,this.request.body.contentType=this.options.contentType),this.send()},t.prototype.receiveResponse=function(t){var s,i,n=e.Utils.getReasonPhrase(t.status_code);switch(!0){case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",t,n);break;case/^2[0-9]{2}$/.test(t.status_code):t.hasHeader("SIP-ETag")?this.pubRequestEtag=t.getHeader("SIP-ETag"):this.logger.warn("SIP-ETag header missing in a 200-class response to PUBLISH"),t.hasHeader("Expires")?"number"==typeof(s=Number(t.getHeader("Expires")))&&s>=0&&s<=this.pubRequestExpires?this.pubRequestExpires=s:this.logger.warn("Bad Expires header in a 200-class response to PUBLISH"):this.logger.warn("Expires header missing in a 200-class response to PUBLISH"),0!==this.pubRequestExpires?(this.publish_refresh_timer=e.Timers.setTimeout(this.publish.bind(this),900*this.pubRequestExpires),this.emit("published",t,n)):this.emit("unpublished",t,n);break;case/^412$/.test(t.status_code):null!==this.pubRequestEtag&&0!==this.pubRequestExpires?(this.logger.warn("412 response to PUBLISH, recovering"),this.pubRequestEtag=null,this.emit("progress",t,n),this.publish(this.options.body)):(this.logger.warn("412 response to PUBLISH, recovery failed"),this.pubRequestExpires=0,this.emit("failed",t,n),this.emit("unpublished",t,n));break;case/^423$/.test(t.status_code):0!==this.pubRequestExpires&&t.hasHeader("Min-Expires")?"number"==typeof(i=Number(t.getHeader("Min-Expires")))||i>this.pubRequestExpires?(this.logger.warn("423 code in response to PUBLISH, adjusting the Expires value and trying to recover"),this.pubRequestExpires=i,this.emit("progress",t,n),this.publish(this.options.body)):(this.logger.warn("Bad 423 response Min-Expires header received for PUBLISH"),this.pubRequestExpires=0,this.emit("failed",t,n),this.emit("unpublished",t,n)):(this.logger.warn("423 response to PUBLISH, recovery failed"),this.pubRequestExpires=0,this.emit("failed",t,n),this.emit("unpublished",t,n));break;default:this.pubRequestExpires=0,this.emit("failed",t,n),this.emit("unpublished",t,n)}0===this.pubRequestExpires&&(e.Timers.clearTimeout(this.publish_refresh_timer),this.pubRequestBody=null,this.pubRequestEtag=null)},t.prototype.onRequestTimeout=function(){e.ClientContext.prototype.onRequestTimeout.call(this),this.emit("unpublished",null,e.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){e.ClientContext.prototype.onTransportError.call(this),this.emit("unpublished",null,e.C.causes.CONNECTION_ERROR)},e.PublishContext=t}},function(e,t,s){"use strict";(function(t){e.exports=function(e,i){var n,r={STATUS_INIT:0,STATUS_STARTING:1,STATUS_READY:2,STATUS_USER_CLOSED:3,STATUS_NOT_READY:4,CONFIGURATION_ERROR:1,NETWORK_ERROR:2,ALLOWED_METHODS:["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"],ACCEPTED_BODY_TYPES:["application/sdp","application/dtmf-relay"],MAX_FORWARDS:70,TAG_LENGTH:10};function o(t){if(t instanceof Function)return t.initialize||(t.initialize=function(){return e.Utils.Promise.resolve()}),t}((n=function(t){var s=this;function i(e){return s.emit.bind(s,e)}r.ACCEPTED_BODY_TYPES=r.ACCEPTED_BODY_TYPES.toString(),this.log=new e.LoggerFactory,this.logger=this.getLogger("sip.ua"),this.cache={credentials:{}},this.configuration={},this.dialogs={},this.applicants={},this.data={},this.sessions={},this.subscriptions={},this.earlySubscriptions={},this.publishers={},this.transport=null,this.contact=null,this.status=r.STATUS_INIT,this.error=null,this.transactions={nist:{},nict:{},ist:{},ict:{}},Object.defineProperties(this,{transactionsCount:{get:function(){var e,t=["nist","nict","ist","ict"],s=0;for(e in t)s+=Object.keys(this.transactions[t[e]]).length;return s}},nictTransactionsCount:{get:function(){return Object.keys(this.transactions.nict).length}},nistTransactionsCount:{get:function(){return Object.keys(this.transactions.nist).length}},ictTransactionsCount:{get:function(){return Object.keys(this.transactions.ict).length}},istTransactionsCount:{get:function(){return Object.keys(this.transactions.ist).length}}}),void 0===t?t={}:("string"==typeof t||t instanceof String)&&(t={uri:t}),t.log&&(t.log.hasOwnProperty("builtinEnabled")&&(this.log.builtinEnabled=t.log.builtinEnabled),t.log.hasOwnProperty("level")&&(this.log.level=t.log.level),t.log.hasOwnProperty("connector")&&(this.log.connector=t.log.connector));try{this.loadConfig(t)}catch(e){throw this.status=r.STATUS_NOT_READY,this.error=r.CONFIGURATION_ERROR,e}this.registerContext=new e.RegisterContext(this),this.registerContext.on("failed",i("registrationFailed")),this.registerContext.on("registered",i("registered")),this.registerContext.on("unregistered",i("unregistered")),this.configuration.autostart&&this.start()}).prototype=Object.create(e.EventEmitter.prototype)).register=function(e){return this.configuration.register=!0,this.registerContext.register(e),this},n.prototype.unregister=function(e){this.configuration.register=!1;var t=this.registerContext;return this.transport.afterConnected(t.unregister.bind(t,e)),this},n.prototype.isRegistered=function(){return this.registerContext.registered},n.prototype.invite=function(t,s,i){var n=new e.InviteClientContext(this,t,s,i);return this.transport.afterConnected(function(){n.invite(),this.emit("inviteSent",n)}.bind(this)),n},n.prototype.subscribe=function(t,s,i){var n=new e.Subscription(this,t,s,i);return this.transport.afterConnected(n.subscribe.bind(n)),n},n.prototype.publish=function(t,s,i,n){var r=new e.PublishContext(this,t,s,n);return this.transport.afterConnected(r.publish.bind(r,i)),r},n.prototype.message=function(t,s,i){if(void 0===s)throw new TypeError("Not enough arguments");return(i=Object.create(i||Object.prototype)).contentType||(i.contentType="text/plain"),i.body=s,this.request(e.C.MESSAGE,t,i)},n.prototype.request=function(t,s,i){var n=new e.ClientContext(this,t,s,i);return this.transport.afterConnected(n.send.bind(n)),n},n.prototype.stop=function(){var e,s,n,o,a=this;if(this.logger.log("user requested closure..."),this.status===r.STATUS_USER_CLOSED)return this.logger.warn("UA already closed"),this;for(e in this.logger.log("closing registerContext"),this.registerContext.close(),this.sessions)this.logger.log("closing session "+e),this.sessions[e].terminate();for(s in this.subscriptions)this.logger.log("unsubscribing from subscription "+s),this.subscriptions[s].close();for(s in this.earlySubscriptions)this.logger.log("unsubscribing from early subscription "+s),this.earlySubscriptions[s].close();for(o in this.publishers)this.logger.log("unpublish "+o),this.publishers[o].close();for(n in this.applicants)this.applicants[n].close();return this.status=r.STATUS_USER_CLOSED,0===this.nistTransactionsCount&&0===this.nictTransactionsCount?this.transport.disconnect():this.on("transactionDestroyed",(function e(){0===a.nistTransactionsCount&&0===a.nictTransactionsCount&&(a.removeListener("transactionDestroyed",e),a.transport.disconnect())})),"function"==typeof i.removeEventListener&&(t.chrome&&t.chrome.app&&t.chrome.app.runtime||i.removeEventListener("unload",this.environListener)),this},n.prototype.start=function(){if(this.logger.log("user requested startup..."),this.status===r.STATUS_INIT){if(this.status=r.STATUS_STARTING,!this.configuration.transportConstructor)throw new e.Exceptions.TransportError("Transport constructor not set");this.transport=new this.configuration.transportConstructor(this.getLogger("sip.transport"),this.configuration.transportOptions),this.setTransportListeners(),this.emit("transportCreated",this.transport),this.transport.connect()}else this.status===r.STATUS_USER_CLOSED?(this.logger.log("resuming"),this.status=r.STATUS_READY,this.transport.connect()):this.status===r.STATUS_STARTING?this.logger.log("UA is in STARTING status, not opening new connection"):this.status===r.STATUS_READY?this.logger.log("UA is in READY status, not resuming"):this.logger.error("Connection is down. Auto-Recovery system is trying to connect");return this.configuration.autostop&&"function"==typeof i.addEventListener&&(t.chrome&&t.chrome.app&&t.chrome.app.runtime||(this.environListener=this.stop.bind(this),i.addEventListener("unload",this.environListener))),this},n.prototype.normalizeTarget=function(t){return e.Utils.normalizeTarget(t,this.configuration.hostportParams)},n.prototype.saveCredentials=function(e){return this.cache.credentials[e.realm]=this.cache.credentials[e.realm]||{},this.cache.credentials[e.realm][e.uri]=e,this},n.prototype.getCredentials=function(e){var t,s;return t=e.ruri.host,this.cache.credentials[t]&&this.cache.credentials[t][e.ruri]&&((s=this.cache.credentials[t][e.ruri]).method=e.method),s},n.prototype.getLogger=function(e,t){return this.log.getLogger(e,t)},n.prototype.onTransportError=function(){this.status!==r.STATUS_USER_CLOSED&&(this.error&&this.error===r.NETWORK_ERROR||(this.status=r.STATUS_NOT_READY,this.error=r.NETWORK_ERROR))},n.prototype.setTransportListeners=function(){this.transport.on("connected",this.onTransportConnected.bind(this)),this.transport.on("message",this.onTransportReceiveMsg.bind(this)),this.transport.on("transportError",this.onTransportError.bind(this))},n.prototype.onTransportConnected=function(){this.configuration.register&&this.configuration.authenticationFactory.initialize().then(function(){this.registerContext.onTransportConnected()}.bind(this))},n.prototype.onTransportReceiveMsg=function(t){var s;if(t=e.Parser.parseMessage(t,this),this.status===e.UA.C.STATUS_USER_CLOSED&&t instanceof e.IncomingRequest)this.logger.warn("UA received message when status = USER_CLOSED - aborting");else if(e.sanityCheck(t,this,this.transport))if(t instanceof e.IncomingRequest)t.transport=this.transport,this.receiveRequest(t);else if(t instanceof e.IncomingResponse)switch(t.method){case e.C.INVITE:(s=this.transactions.ict[t.via_branch])&&s.receiveResponse(t);break;case e.C.ACK:break;default:(s=this.transactions.nict[t.via_branch])&&s.receiveResponse(t)}},n.prototype.newTransaction=function(e){this.transactions[e.type][e.id]=e,this.emit("newTransaction",{transaction:e})},n.prototype.destroyTransaction=function(e){delete this.transactions[e.type][e.id],this.emit("transactionDestroyed",{transaction:e})},n.prototype.receiveRequest=function(t){var s,i,n,o,a,c,u=t.method;function h(e){return e&&e.user===t.ruri.user}if(!(h(this.configuration.uri)||h(this.contact.uri)||h(this.contact.pub_gruu)||h(this.contact.temp_gruu)))return this.logger.warn("Request-URI does not point to us"),void(t.method!==e.C.ACK&&t.reply_sl(404));if(t.ruri.scheme!==e.C.SIPS){if(!e.Transactions.checkTransaction(this,t))if(u===e.C.OPTIONS?(new e.Transactions.NonInviteServerTransaction(t,this),t.reply(200,null,["Allow: "+e.UA.C.ALLOWED_METHODS.toString(),"Accept: "+r.ACCEPTED_BODY_TYPES])):u===e.C.MESSAGE?((n=new e.ServerContext(this,t)).body=t.body,n.content_type=t.getHeader("Content-Type")||"text/plain",t.reply(200,null),this.emit("message",n)):u!==e.C.INVITE&&u!==e.C.ACK&&new e.ServerContext(this,t),t.to_tag)(s=this.findDialog(t))?(u===e.C.INVITE&&new e.Transactions.InviteServerTransaction(t,this),s.receiveRequest(t)):u===e.C.NOTIFY?(i=this.findSession(t),o=this.findEarlySubscription(t),i?i.receiveRequest(t):o?o.receiveRequest(t):(this.logger.warn("received NOTIFY request for a non existent session or subscription"),t.reply(481,"Subscription does not exist"))):u!==e.C.ACK&&t.reply(481);else switch(u){case e.C.INVITE:if(a=this.configuration.replaces!==e.C.supported.UNSUPPORTED&&t.parseHeader("replaces")){if(!(c=this.dialogs[a.call_id+a.replaces_to_tag+a.replaces_from_tag]))return void t.reply_sl(481,null);if(c.owner.status===e.Session.C.STATUS_TERMINATED)return void t.reply_sl(603,null);if(c.state===e.Dialog.C.STATUS_CONFIRMED&&a.early_only)return void t.reply_sl(486,null)}(i=new e.InviteServerContext(this,t)).replacee=c&&c.owner,this.emit("invite",i);break;case e.C.BYE:t.reply(481);break;case e.C.CANCEL:(i=this.findSession(t))?i.receiveRequest(t):this.logger.warn("received CANCEL request for a non existent session");break;case e.C.ACK:break;case e.C.NOTIFY:this.configuration.allowLegacyNotifications&&this.listeners("notify").length>0?(t.reply(200,null),this.emit("notify",{request:t})):t.reply(481,"Subscription does not exist");break;case e.C.REFER:if(this.logger.log("Received an out of dialog refer"),this.configuration.allowOutOfDialogRefers){this.logger.log("Allow out of dialog refers is enabled on the UA");var l=new e.ReferServerContext(this,t);this.listeners("outOfDialogReferRequested").length?this.emit("outOfDialogReferRequested",l):(this.logger.log("No outOfDialogReferRequest listeners, automatically accepting and following the out of dialog refer"),l.accept({followRefer:!0}));break}t.reply(405);break;default:t.reply(405)}}else t.reply_sl(416)},n.prototype.findSession=function(e){return this.sessions[e.call_id+e.from_tag]||this.sessions[e.call_id+e.to_tag]||null},n.prototype.findDialog=function(e){return this.dialogs[e.call_id+e.from_tag+e.to_tag]||this.dialogs[e.call_id+e.to_tag+e.from_tag]||null},n.prototype.findEarlySubscription=function(e){return this.earlySubscriptions[e.call_id+e.to_tag+e.getHeader("event")]||null},n.prototype.loadConfig=function(t){var i,n,r,a,c,u={viaHost:e.Utils.createRandomToken(12)+".invalid",uri:new e.URI("sip","anonymous."+e.Utils.createRandomToken(6),"anonymous.invalid",null,null),custom:{},displayName:"",password:null,registerExpires:600,register:!0,registrarServer:null,transportConstructor:s(29)(e),transportOptions:{},userAgentString:e.C.USER_AGENT,noAnswerTimeout:60,hackViaTcp:!1,hackIpInContact:!1,hackWssInTransport:!1,hackAllowUnregisteredOptionTags:!1,sessionDescriptionHandlerFactoryOptions:{constraints:{},peerConnectionOptions:{}},contactName:e.Utils.createRandomToken(8),contactTransport:"ws",forceRport:!1,autostart:!0,autostop:!0,rel100:e.C.supported.UNSUPPORTED,dtmfType:e.C.dtmfType.INFO,replaces:e.C.supported.UNSUPPORTED,sessionDescriptionHandlerFactory:s(30)(e).defaultFactory,authenticationFactory:o((function(t){return new e.DigestAuthentication(t)})),allowLegacyNotifications:!1,allowOutOfDialogRefers:!1};function h(e,s){var i=e.replace(/([a-z][A-Z])/g,(function(e){return e[0]+"_"+e[1].toLowerCase()}));if(e!==i){var n=t.hasOwnProperty(e);t.hasOwnProperty(i)&&(s.warn(i+" is deprecated, please use "+e),n&&s.warn(e+" overriding "+i)),t[e]=n?t[e]:t[i]}}var l=this.getConfigurationCheck();for(i in l.mandatory){if(h(i,this.logger),!t.hasOwnProperty(i))throw new e.Exceptions.ConfigurationError(i);if(n=t[i],void 0===(r=l.mandatory[i](n)))throw new e.Exceptions.ConfigurationError(i,n);u[i]=r}for(i in l.optional)if(h(i,this.logger),t.hasOwnProperty(i)){if((n=t[i])instanceof Array&&0===n.length)continue;if(null===n||""===n||void 0===n)continue;if("number"==typeof n&&isNaN(n))continue;if(void 0===(r=l.optional[i](n)))throw new e.Exceptions.ConfigurationError(i,n);u[i]=r}0===u.displayName&&(u.displayName="0"),u.instanceId||(u.instanceId=e.Utils.newUUID()),u.sipjsId=e.Utils.createRandomToken(5),(a=u.uri.clone()).user=null,u.hostportParams=a.toRaw().replace(/^sip:/i,""),u.authorizationUser||(u.authorizationUser=u.uri.user),u.registrarServer||((c=u.uri.clone()).user=null,u.registrarServer=c),u.noAnswerTimeout=1e3*u.noAnswerTimeout,u.hackIpInContact&&("boolean"==typeof u.hackIpInContact?u.viaHost=e.Utils.getRandomTestNetIP():"string"==typeof u.hackIpInContact&&(u.viaHost=u.hackIpInContact)),u.hackWssInTransport&&(u.contactTransport="wss"),this.contact={pub_gruu:null,temp_gruu:null,uri:new e.URI("sip",u.contactName,u.viaHost,null,{transport:u.contactTransport}),toString:function(e){var t=(e=e||{}).anonymous||null,s=e.outbound||null,i="<";return i+=t?(this.temp_gruu||"sip:anonymous@anonymous.invalid;transport="+u.contactTransport).toString():(this.pub_gruu||this.uri).toString(),s&&(i+=";ob"),i+">"}};var d={};for(i in u)d[i]=u[i];for(i in Object.assign(this.configuration,d),this.logger.log("configuration parameters after validation:"),u)switch(i){case"uri":case"registrarServer":case"sessionDescriptionHandlerFactory":this.logger.log("· "+i+": "+u[i]);break;case"password":this.logger.log("· "+i+": NOT SHOWN");break;case"transportConstructor":this.logger.log("· "+i+": "+u[i].name);break;default:this.logger.log("· "+i+": "+JSON.stringify(u[i]))}},n.prototype.getConfigurationCheck=function(){return{mandatory:{},optional:{uri:function(t){var s;return/^sip:/i.test(t)||(t=e.C.SIP+":"+t),(s=e.URI.parse(t))&&s.user?s:void 0},transportConstructor:function(e){if(e instanceof Function)return e},transportOptions:function(e){if("object"==typeof e)return e},authorizationUser:function(t){return-1===e.Grammar.parse('"'+t+'"',"quoted_string")?void 0:t},displayName:function(t){return-1===e.Grammar.parse('"'+t+'"',"displayName")?void 0:t},dtmfType:function(t){switch(t){case e.C.dtmfType.RTP:return e.C.dtmfType.RTP;case e.C.dtmfType.INFO:default:return e.C.dtmfType.INFO}},hackViaTcp:function(e){if("boolean"==typeof e)return e},hackIpInContact:function(t){return"boolean"==typeof t||"string"==typeof t&&-1!==e.Grammar.parse(t,"host")?t:void 0},hackWssInTransport:function(e){if("boolean"==typeof e)return e},hackAllowUnregisteredOptionTags:function(e){if("boolean"==typeof e)return e},contactTransport:function(e){if("string"==typeof e)return e},forceRport:function(e){if("boolean"==typeof e)return e},instanceId:function(t){if("string"==typeof t)return/^uuid:/i.test(t)&&(t=t.substr(5)),-1===e.Grammar.parse(t,"uuid")?void 0:t},noAnswerTimeout:function(t){var s;if(e.Utils.isDecimal(t)&&(s=Number(t))>0)return s},password:function(e){return String(e)},rel100:function(t){return t===e.C.supported.REQUIRED?e.C.supported.REQUIRED:t===e.C.supported.SUPPORTED?e.C.supported.SUPPORTED:e.C.supported.UNSUPPORTED},replaces:function(t){return t===e.C.supported.REQUIRED?e.C.supported.REQUIRED:t===e.C.supported.SUPPORTED?e.C.supported.SUPPORTED:e.C.supported.UNSUPPORTED},register:function(e){if("boolean"==typeof e)return e},registerExpires:function(t){var s;if(e.Utils.isDecimal(t)&&(s=Number(t))>0)return s},registrarServer:function(t){var s;if("string"==typeof t)return/^sip:/i.test(t)||(t=e.C.SIP+":"+t),(s=e.URI.parse(t))?s.user?void 0:s:void 0},userAgentString:function(e){if("string"==typeof e)return e},autostart:function(e){if("boolean"==typeof e)return e},autostop:function(e){if("boolean"==typeof e)return e},sessionDescriptionHandlerFactory:function(e){if(e instanceof Function)return e},sessionDescriptionHandlerFactoryOptions:function(e){if("object"==typeof e)return e},authenticationFactory:o,allowLegacyNotifications:function(e){if("boolean"==typeof e)return e},custom:function(e){if("object"==typeof e)return e},contactName:function(e){if("string"==typeof e)return e}}}},n.C=r,e.UA=n}}).call(this,s(0))},function(e,t,s){"use strict";(function(t){e.exports=function(e){var s,i={STATUS_CONNECTING:0,STATUS_OPEN:1,STATUS_CLOSING:2,STATUS_CLOSED:3},n=(t.window||t).WebSocket;return(s=function(t,s){s=e.Utils.defaultOptions({},s),this.logger=t,this.ws=null,this.server=null,this.connectionPromise=null,this.connectDeferredResolve=null,this.connectionTimeout=null,this.disconnectionPromise=null,this.disconnectDeferredResolve=null,this.boundOnOpen=null,this.boundOnMessage=null,this.boundOnClose=null,this.boundOnError=null,this.reconnectionAttempts=0,this.reconnectTimer=null,this.keepAliveInterval=null,this.keepAliveDebounceTimeout=null,this.status=i.STATUS_CONNECTING,this.configuration={},this.loadConfig(s)}).prototype=Object.create(e.Transport.prototype,{isConnected:{writable:!0,value:function(){return this.status===i.STATUS_OPEN}},sendPromise:{writable:!0,value:function(t,s){if(s=s||{},!this.statusAssert(i.STATUS_OPEN,s.force))return this.onError("unable to send message - WebSocket not open"),e.Utils.Promise.reject();var n=t.toString();return this.ws?(!0===this.configuration.traceSip&&this.logger.log("sending WebSocket message:\n\n"+n+"\n"),this.ws.send(n),e.Utils.Promise.resolve({msg:n})):(this.onError("unable to send message - WebSocket does not exist"),e.Utils.Promise.reject())}},disconnectPromise:{writable:!0,value:function(t){return this.disconnectionPromise?this.disconnectionPromise:(t=t||{},this.statusTransition(i.STATUS_CLOSING,t.force)?(this.disconnectionPromise=new e.Utils.Promise(function(s,i){this.disconnectDeferredResolve=s,this.reconnectTimer&&(e.Timers.clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.ws?(this.stopSendingKeepAlives(),this.logger.log("closing WebSocket "+this.server.ws_uri),this.ws.close(t.code,t.reason)):i("Attempted to disconnect but the websocket doesn't exist")}.bind(this)),this.disconnectionPromise):e.Utils.Promise.reject("Failed status transition - attempted to disconnect a socket that was not open"))}},connectPromise:{writable:!0,value:function(t){return this.connectionPromise||(t=t||{},this.server=this.server||this.getNextWsServer(t.force),this.connectionPromise=new e.Utils.Promise(function(s,r){if((this.status===i.STATUS_OPEN||this.status===i.STATUS_CLOSING)&&!t.force)return this.logger.warn("WebSocket "+this.server.ws_uri+" is already connected"),void r("Failed status check - attempted to open a connection but already open/closing");this.connectDeferredResolve=s,this.status=i.STATUS_CONNECTING,this.logger.log("connecting to WebSocket "+this.server.ws_uri),this.disposeWs();try{this.ws=new n(this.server.ws_uri,"sip")}catch(e){return this.ws=null,this.status=i.STATUS_CLOSED,this.onError("error connecting to WebSocket "+this.server.ws_uri+":"+e),void r("Failed to create a websocket")}this.ws?(this.connectionTimeout=e.Timers.setTimeout(function(){this.onError("took too long to connect - exceeded time set in configuration.connectionTimeout: "+this.configuration.connectionTimeout+"s")}.bind(this),1e3*this.configuration.connectionTimeout),this.boundOnOpen=this.onOpen.bind(this),this.boundOnMessage=this.onMessage.bind(this),this.boundOnClose=this.onClose.bind(this),this.boundOnError=this.onError.bind(this),this.ws.addEventListener("open",this.boundOnOpen),this.ws.addEventListener("message",this.boundOnMessage),this.ws.addEventListener("close",this.boundOnClose),this.ws.addEventListener("error",this.boundOnError)):r("Unexpected instance websocket not set")}.bind(this))),this.connectionPromise}},onOpen:{writable:!0,value:function(){this.status=i.STATUS_OPEN,this.emit("connected"),e.Timers.clearTimeout(this.connectionTimeout),this.logger.log("WebSocket "+this.server.ws_uri+" connected"),null!==this.reconnectTimer&&(e.Timers.clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.reconnectionAttempts=0,this.disconnectionPromise=null,this.disconnectDeferredResolve=null,this.startSendingKeepAlives(),this.connectDeferredResolve?this.connectDeferredResolve({overrideEvent:!0}):this.logger.warn("Unexpected websocket.onOpen with no connectDeferredResolve")}},onClose:{writable:!0,value:function(t){if(this.logger.log("WebSocket disconnected (code: "+t.code+(t.reason?"| reason: "+t.reason:"")+")"),this.emit("disconnected",{code:t.code,reason:t.reason}),this.status!==i.STATUS_CLOSING&&(this.logger.warn("WebSocket abrupt disconnection"),this.emit("transportError")),this.stopSendingKeepAlives(),e.Timers.clearTimeout(this.connectionTimeout),this.connectionTimeout=null,this.connectionPromise=null,this.connectDeferredResolve=null,this.disconnectDeferredResolve)return this.disconnectDeferredResolve({overrideEvent:!0}),this.statusTransition(i.STATUS_CLOSED),void(this.disconnectDeferredResolve=null);this.status=i.STATUS_CLOSED,this.reconnect()}},disposeWs:{writable:!0,value:function(){this.ws&&(this.ws.removeEventListener("open",this.boundOnOpen),this.ws.removeEventListener("message",this.boundOnMessage),this.ws.removeEventListener("close",this.boundOnClose),this.ws.removeEventListener("error",this.boundOnError),this.boundOnOpen=null,this.boundOnMessage=null,this.boundOnClose=null,this.boundOnError=null,this.ws=null)}},onMessage:{writable:!0,value:function(e){var t=e.data;if(/^(\r\n)+$/.test(t))return this.clearKeepAliveTimeout(),void(!0===this.configuration.traceSip&&this.logger.log("received WebSocket message with CRLF Keep Alive response"));if(t){if("string"!=typeof t){try{t=String.fromCharCode.apply(null,new Uint8Array(t))}catch(e){return void this.logger.warn("received WebSocket binary message failed to be converted into string, message discarded")}!0===this.configuration.traceSip&&this.logger.log("received WebSocket binary message:\n\n"+t+"\n")}else!0===this.configuration.traceSip&&this.logger.log("received WebSocket text message:\n\n"+t+"\n");this.emit("message",t)}else this.logger.warn("received empty message, message discarded")}},onError:{writable:!0,value:function(e){this.logger.warn("Transport error: "+e),this.emit("transportError")}},reconnect:{writable:!0,value:function(){if(this.reconnectionAttempts>0&&this.logger.log("Reconnection attempt "+this.reconnectionAttempts+" failed"),this.noAvailableServers())return this.logger.warn("no available ws servers left - going to closed state"),this.status=i.STATUS_CLOSED,this.emit("closed"),void this.resetServerErrorStatus();this.isConnected()&&(this.logger.warn("attempted to reconnect while connected - forcing disconnect"),this.disconnect({force:!0})),this.reconnectionAttempts+=1,this.reconnectionAttempts>this.configuration.maxReconnectionAttempts?(this.logger.warn("maximum reconnection attempts for WebSocket "+this.server.ws_uri),this.logger.log("transport "+this.server.ws_uri+" failed | connection state set to 'error'"),this.server.isError=!0,this.emit("transportError"),this.server=this.getNextWsServer(),this.reconnectionAttempts=0,this.reconnect()):(this.logger.log("trying to reconnect to WebSocket "+this.server.ws_uri+" (reconnection attempt "+this.reconnectionAttempts+")"),this.reconnectTimer=e.Timers.setTimeout(function(){this.connect(),this.reconnectTimer=null}.bind(this),1===this.reconnectionAttempts?0:1e3*this.configuration.reconnectionTimeout))}},resetServerErrorStatus:{writable:!0,value:function(){var e,t=this.configuration.wsServers.length;for(e=0;e<t;e++)this.configuration.wsServers[e].isError=!1}},getNextWsServer:{writable:!0,value:function(e){if(!this.noAvailableServers()){var t,s,i,n=[];for(s=this.configuration.wsServers.length,t=0;t<s;t++)(i=this.configuration.wsServers[t]).isError&&!e||(0===n.length?n.push(i):i.weight>n[0].weight?n=[i]:i.weight===n[0].weight&&n.push(i));return n[t=Math.floor(Math.random()*n.length)]}this.logger.warn("attempted to get next ws server but there are no available ws servers left")}},noAvailableServers:{writable:!0,value:function(){var e;for(e in this.configuration.wsServers)if(!this.configuration.wsServers[e].isError)return!1;return!0}},sendKeepAlive:{writable:!0,value:function(){if(!this.keepAliveDebounceTimeout)return this.keepAliveDebounceTimeout=e.Timers.setTimeout(function(){this.emit("keepAliveDebounceTimeout"),this.clearKeepAliveTimeout()}.bind(this),1e3*this.configuration.keepAliveDebounce),this.send("\r\n\r\n")}},clearKeepAliveTimeout:{writable:!0,value:function(){e.Timers.clearTimeout(this.keepAliveDebounceTimeout),this.keepAliveDebounceTimeout=null}},startSendingKeepAlives:{writable:!0,value:function(){this.configuration.keepAliveInterval&&!this.keepAliveInterval&&(this.keepAliveInterval=e.Timers.setInterval(function(){this.sendKeepAlive(),this.startSendingKeepAlives()}.bind(this),function(e){var t=.8*e;return 1e3*(Math.random()*(e-t)+t)}(this.configuration.keepAliveInterval)))}},stopSendingKeepAlives:{writable:!0,value:function(){e.Timers.clearInterval(this.keepAliveInterval),e.Timers.clearTimeout(this.keepAliveDebounceTimeout),this.keepAliveInterval=null,this.keepAliveDebounceTimeout=null}},statusAssert:{writable:!0,value:function(e,t){return e===this.status||(t?(this.logger.warn("Attempted to assert "+Object.keys(i)[this.status]+" as "+Object.keys(i)[e]+"- continuing with option: 'force'"),!0):(this.logger.warn("Tried to assert "+Object.keys(i)[e]+" but is currently "+Object.keys(i)[this.status]),!1))}},statusTransition:{writable:!0,value:function(e,t){return this.logger.log("Attempting to transition status from "+Object.keys(i)[this.status]+" to "+Object.keys(i)[e]),e===i.STATUS_OPEN&&this.statusAssert(i.STATUS_CONNECTING,t)||e===i.STATUS_CLOSING&&this.statusAssert(i.STATUS_OPEN,t)||e===i.STATUS_CLOSED&&this.statusAssert(i.STATUS_CLOSING,t)?(this.status=e,!0):(this.logger.warn("Status transition failed - result: no-op - reason: either gave an nonexistent status or attempted illegal transition"),!1)}},loadConfig:{writable:!0,value:function(t){var s,i,n,r={wsServers:[{scheme:"WSS",sip_uri:"<sip:edge.sip.onsip.com;transport=ws;lr>",weight:0,ws_uri:"wss://edge.sip.onsip.com",isError:!1}],connectionTimeout:5,maxReconnectionAttempts:3,reconnectionTimeout:4,keepAliveInterval:0,keepAliveDebounce:10,traceSip:!1};function o(e,s){var i=e.replace(/([a-z][A-Z])/g,(function(e){return e[0]+"_"+e[1].toLowerCase()}));if(e!==i){var n=t.hasOwnProperty(e);t.hasOwnProperty(i)&&(s.warn(i+" is deprecated, please use "+e),n&&s.warn(e+" overriding "+i)),t[e]=n?t[e]:t[i]}}var a=this.getConfigurationCheck();for(s in a.mandatory){if(o(s,this.logger),!t.hasOwnProperty(s))throw new e.Exceptions.ConfigurationError(s);if(i=t[s],void 0===(n=a.mandatory[s](i)))throw new e.Exceptions.ConfigurationError(s,i);r[s]=n}for(s in a.optional)if(o(s,this.logger),t.hasOwnProperty(s)){if((i=t[s])instanceof Array&&0===i.length)continue;if(null===i||""===i||void 0===i)continue;if("number"==typeof i&&isNaN(i))continue;if(void 0===(n=a.optional[s](i)))throw new e.Exceptions.ConfigurationError(s,i);r[s]=n}var c={};for(s in r)c[s]={value:r[s]};for(s in Object.defineProperties(this.configuration,c),this.logger.log("configuration parameters after validation:"),r)this.logger.log("· "+s+": "+JSON.stringify(r[s]))}},getConfigurationCheck:{writable:!0,value:function(){return{mandatory:{},optional:{wsServers:function(t){var s,i,n;if("string"==typeof t)t=[{ws_uri:t}];else{if(!(t instanceof Array))return;for(i=t.length,s=0;s<i;s++)"string"==typeof t[s]&&(t[s]={ws_uri:t[s]})}if(0===t.length)return!1;for(i=t.length,s=0;s<i;s++){if(!t[s].ws_uri)return;if(t[s].weight&&!Number(t[s].weight))return;if(-1===(n=e.Grammar.parse(t[s].ws_uri,"absoluteURI")))return;if(["wss","ws","udp"].indexOf(n.scheme)<0)return;t[s].sip_uri="<sip:"+n.host+(n.port?":"+n.port:"")+";transport="+n.scheme.replace(/^wss$/i,"ws")+";lr>",t[s].weight||(t[s].weight=0),t[s].isError=!1,t[s].scheme=n.scheme.toUpperCase()}return t},keepAliveInterval:function(t){var s;if(e.Utils.isDecimal(t)&&(s=Number(t))>0)return s},keepAliveDebounce:function(t){var s;if(e.Utils.isDecimal(t)&&(s=Number(t))>0)return s},traceSip:function(e){if("boolean"==typeof e)return e},connectionTimeout:function(t){var s;if(e.Utils.isDecimal(t)&&(s=Number(t))>0)return s},maxReconnectionAttempts:function(t){var s;if(e.Utils.isDecimal(t)&&(s=Number(t))>=0)return s},reconnectionTimeout:function(t){var s;if(e.Utils.isDecimal(t)&&(s=Number(t))>0)return s}}}}}}),s.C=i,e.Web.Transport=s,s}}).call(this,s(0))},function(e,t,s){"use strict";(function(t){e.exports=function(e){var i=function(e,s,i){this.options=i||{},this.logger=e,this.observer=s,this.dtmfSender=null,this.shouldAcquireMedia=!0,this.CONTENT_TYPE="application/sdp",this.C={},this.C.DIRECTION={NULL:null,SENDRECV:"sendrecv",SENDONLY:"sendonly",RECVONLY:"recvonly",INACTIVE:"inactive"},this.logger.log("SessionDescriptionHandlerOptions: "+JSON.stringify(this.options)),this.direction=this.C.DIRECTION.NULL,this.modifiers=this.options.modifiers||[],Array.isArray(this.modifiers)||(this.modifiers=[this.modifiers]);var n=t.window||t;this.WebRTC={MediaStream:n.MediaStream,getUserMedia:n.navigator.mediaDevices.getUserMedia.bind(n.navigator.mediaDevices),RTCPeerConnection:n.RTCPeerConnection},this.iceGatheringDeferred=null,this.iceGatheringTimeout=!1,this.iceGatheringTimer=null,this.initPeerConnection(this.options.peerConnectionOptions),this.constraints=this.checkAndDefaultConstraints(this.options.constraints)};return i.defaultFactory=function(e,t){var n=e.ua.getLogger("sip.invitecontext.sessionDescriptionHandler",e.id),r=new(s(31))(e,t);return new i(n,r,t)},i.prototype=Object.create(e.SessionDescriptionHandler.prototype,{close:{writable:!0,value:function(){this.logger.log("closing PeerConnection"),this.peerConnection&&"closed"!==this.peerConnection.signalingState&&(this.peerConnection.getSenders?this.peerConnection.getSenders().forEach((function(e){e.track&&e.track.stop()})):(this.logger.warn("Using getLocalStreams which is deprecated"),this.peerConnection.getLocalStreams().forEach((function(e){e.getTracks().forEach((function(e){e.stop()}))}))),this.peerConnection.getReceivers?this.peerConnection.getReceivers().forEach((function(e){e.track&&e.track.stop()})):(this.logger.warn("Using getRemoteStreams which is deprecated"),this.peerConnection.getRemoteStreams().forEach((function(e){e.getTracks().forEach((function(e){e.stop()}))}))),this.resetIceGatheringComplete(),this.peerConnection.close())}},getDescription:{writable:!0,value:function(t,s){(t=t||{}).peerConnectionOptions&&this.initPeerConnection(t.peerConnectionOptions);var i=Object.assign({},this.constraints,t.constraints);return i=this.checkAndDefaultConstraints(i),JSON.stringify(i)!==JSON.stringify(this.constraints)&&(this.constraints=i,this.shouldAcquireMedia=!0),s=s||[],Array.isArray(s)||(s=[s]),s=s.concat(this.modifiers),e.Utils.Promise.resolve().then(function(){if(this.shouldAcquireMedia)return this.acquire(this.constraints).then(function(){this.shouldAcquireMedia=!1}.bind(this))}.bind(this)).then(function(){return this.createOfferOrAnswer(t.RTCOfferOptions,s)}.bind(this)).then(function(e){return this.emit("getDescription",e),{body:e.sdp,contentType:this.CONTENT_TYPE}}.bind(this))}},hasDescription:{writable:!0,value:function(e){return e===this.CONTENT_TYPE}},holdModifier:{writable:!0,value:function(t){return/a=(sendrecv|sendonly|recvonly|inactive)/.test(t.sdp)?(t.sdp=t.sdp.replace(/a=sendrecv\r\n/g,"a=sendonly\r\n"),t.sdp=t.sdp.replace(/a=recvonly\r\n/g,"a=inactive\r\n")):t.sdp=t.sdp.replace(/(m=[^\r]*\r\n)/g,"$1a=sendonly\r\n"),e.Utils.Promise.resolve(t)}},setDescription:{writable:!0,value:function(t,s,i){var n=this,r=this;(s=s||{}).peerConnectionOptions&&this.initPeerConnection(s.peerConnectionOptions),i=i||[],Array.isArray(i)||(i=[i]),i=i.concat(this.modifiers);var o={type:this.hasOffer("local")?"answer":"offer",sdp:t};return e.Utils.Promise.resolve().then(function(){if(this.shouldAcquireMedia&&this.options.alwaysAcquireMediaFirst)return this.acquire(this.constraints).then(function(){this.shouldAcquireMedia=!1}.bind(this))}.bind(this)).then((function(){return e.Utils.reducePromises(i,o)})).catch((function(t){if(t instanceof e.Exceptions.SessionDescriptionHandlerError)throw t;var s=new e.Exceptions.SessionDescriptionHandlerError("setDescription",t,"The modifiers did not resolve successfully");throw n.logger.error(s.message),r.emit("peerConnection-setRemoteDescriptionFailed",s),s})).then((function(e){return r.emit("setDescription",e),r.peerConnection.setRemoteDescription(e)})).catch((function(r){if(r instanceof e.Exceptions.SessionDescriptionHandlerError)throw r;if(/^m=video.+$/gm.test(t)&&!s.disableAudioFallback)return s.disableAudioFallback=!0,n.setDescription(t,s,[e.Web.Modifiers.stripVideo].concat(i));var o=new e.Exceptions.SessionDescriptionHandlerError("setDescription",r);throw n.logger.error(o.error),n.emit("peerConnection-setRemoteDescriptionFailed",o),o})).then((function(){r.peerConnection.getReceivers?r.emit("setRemoteDescription",r.peerConnection.getReceivers()):r.emit("setRemoteDescription",r.peerConnection.getRemoteStreams()),r.emit("confirmed",r)}))}},sendDtmf:{writable:!0,value:function(e,t){if(!this.dtmfSender&&this.hasBrowserGetSenderSupport()){var s=this.peerConnection.getSenders();s.length>0&&(this.dtmfSender=s[0].dtmf)}if(!this.dtmfSender&&this.hasBrowserTrackSupport()){var i=this.peerConnection.getLocalStreams();if(i.length>0){var n=i[0].getAudioTracks();n.length>0&&(this.dtmfSender=this.peerConnection.createDTMFSender(n[0]))}}if(!this.dtmfSender)return!1;try{this.dtmfSender.insertDTMF(e,t.duration,t.interToneGap)}catch(e){if("InvalidStateError"===e.type||"InvalidCharacterError"===e.type)return this.logger.error(e),!1;throw e}return this.logger.log("DTMF sent via RTP: "+e.toString()),!0}},getDirection:{writable:!0,value:function(){return this.direction}},createOfferOrAnswer:{writable:!0,value:function(t,s){var i,n=this,r=this,o=this.peerConnection;return t=t||{},i=r.hasOffer("remote")?"createAnswer":"createOffer",o[i](t).catch((function(t){if(t instanceof e.Exceptions.SessionDescriptionHandlerError)throw t;var s=new e.Exceptions.SessionDescriptionHandlerError("createOfferOrAnswer",t,"peerConnection-"+i+"Failed");throw n.emit("peerConnection-"+i+"Failed",s),s})).then((function(t){return e.Utils.reducePromises(s,r.createRTCSessionDescriptionInit(t))})).then((function(e){return r.resetIceGatheringComplete(),o.setLocalDescription(e)})).catch((function(t){if(t instanceof e.Exceptions.SessionDescriptionHandlerError)throw t;var s=new e.Exceptions.SessionDescriptionHandlerError("createOfferOrAnswer",t,"peerConnection-SetLocalDescriptionFailed");throw n.emit("peerConnection-SetLocalDescriptionFailed",s),s})).then((function(){return r.waitForIceGatheringComplete()})).then((function(){var t=r.createRTCSessionDescriptionInit(r.peerConnection.localDescription);return e.Utils.reducePromises(s,t)})).then((function(e){return r.setDirection(e.sdp),e})).catch((function(t){if(t instanceof e.Exceptions.SessionDescriptionHandlerError)throw t;var s=new e.Exceptions.SessionDescriptionHandlerError("createOfferOrAnswer",t);throw n.logger.error(s),s}))}},createRTCSessionDescriptionInit:{writable:!0,value:function(e){return{type:e.type,sdp:e.sdp}}},addDefaultIceCheckingTimeout:{writable:!0,value:function(e){return void 0===e.iceCheckingTimeout&&(e.iceCheckingTimeout=5e3),e}},addDefaultIceServers:{writable:!0,value:function(e){return e.iceServers||(e.iceServers=[{urls:"stun:stun.l.google.com:19302"}]),e}},checkAndDefaultConstraints:{writable:!0,value:function(e){var t={audio:!0,video:!this.options.alwaysAcquireMediaFirst};return e=e||t,0===Object.keys(e).length&&e.constructor===Object?t:e}},hasBrowserTrackSupport:{writable:!0,value:function(){return Boolean(this.peerConnection.addTrack)}},hasBrowserGetSenderSupport:{writable:!0,value:function(){return Boolean(this.peerConnection.getSenders)}},initPeerConnection:{writable:!0,value:function(t){var s=this;t=t||{},(t=this.addDefaultIceCheckingTimeout(t)).rtcConfiguration=t.rtcConfiguration||{},t.rtcConfiguration=this.addDefaultIceServers(t.rtcConfiguration),this.logger.log("initPeerConnection"),this.peerConnection&&(this.logger.log("Already have a peer connection for this session. Tearing down."),this.resetIceGatheringComplete(),this.peerConnection.close()),this.peerConnection=new this.WebRTC.RTCPeerConnection(t.rtcConfiguration),this.logger.log("New peer connection created"),"ontrack"in this.peerConnection?this.peerConnection.addEventListener("track",(function(e){s.logger.log("track added"),s.observer.trackAdded(),s.emit("addTrack",e)})):(this.logger.warn("Using onaddstream which is deprecated"),this.peerConnection.onaddstream=function(e){s.logger.log("stream added"),s.emit("addStream",e)}),this.peerConnection.onicecandidate=function(e){s.emit("iceCandidate",e),e.candidate?s.logger.log("ICE candidate received: "+(null===e.candidate.candidate?null:e.candidate.candidate.trim())):null===e.candidate&&(s.logger.log("ICE candidate gathering complete"),s.triggerIceGatheringComplete())},this.peerConnection.onicegatheringstatechange=function(){switch(s.logger.log("RTCIceGatheringState changed: "+this.iceGatheringState),this.iceGatheringState){case"gathering":s.emit("iceGathering",this),!s.iceGatheringTimer&&t.iceCheckingTimeout&&(s.iceGatheringTimeout=!1,s.iceGatheringTimer=e.Timers.setTimeout((function(){s.logger.log("RTCIceChecking Timeout Triggered after "+t.iceCheckingTimeout+" milliseconds"),s.iceGatheringTimeout=!0,s.triggerIceGatheringComplete()}),t.iceCheckingTimeout));break;case"complete":s.triggerIceGatheringComplete()}},this.peerConnection.oniceconnectionstatechange=function(){var e;switch(this.iceConnectionState){case"new":e="iceConnection";break;case"checking":e="iceConnectionChecking";break;case"connected":e="iceConnectionConnected";break;case"completed":e="iceConnectionCompleted";break;case"failed":e="iceConnectionFailed";break;case"disconnected":e="iceConnectionDisconnected";break;case"closed":e="iceConnectionClosed";break;default:return void s.logger.warn("Unknown iceConnection state:",this.iceConnectionState)}s.emit(e,this)}}},acquire:{writable:!0,value:function(t){var s=this;return t=this.checkAndDefaultConstraints(t),new e.Utils.Promise(function(e,s){this.logger.log("acquiring local media"),this.emit("userMediaRequest",t),t.audio||t.video?this.WebRTC.getUserMedia(t).then(function(t){this.observer.trackAdded(),this.emit("userMedia",t),e(t)}.bind(this)).catch(function(e){this.emit("userMediaFailed",e),s(e)}.bind(this)):e([])}.bind(this)).catch((function(t){if(t instanceof e.Exceptions.SessionDescriptionHandlerError)throw t;var i=new e.Exceptions.SessionDescriptionHandlerError("acquire",t,"unable to acquire streams");throw s.logger.error(i.message),s.logger.error(i.error),i})).then(function(t){this.logger.log("acquired local media streams");try{return this.peerConnection.removeTrack&&this.peerConnection.getSenders().forEach((function(e){this.peerConnection.removeTrack(e)}),this),t}catch(t){return e.Utils.Promise.reject(t)}}.bind(this)).catch((function(t){if(t instanceof e.Exceptions.SessionDescriptionHandlerError)throw t;var i=new e.Exceptions.SessionDescriptionHandlerError("acquire",t,"error removing streams");throw s.logger.error(i.message),s.logger.error(i.error),i})).then(function(t){try{(t=[].concat(t)).forEach((function(e){this.peerConnection.addTrack?e.getTracks().forEach((function(t){this.peerConnection.addTrack(t,e)}),this):this.peerConnection.addStream(e)}),this)}catch(t){return e.Utils.Promise.reject(t)}return e.Utils.Promise.resolve()}.bind(this)).catch((function(t){if(t instanceof e.Exceptions.SessionDescriptionHandlerError)throw t;var i=new e.Exceptions.SessionDescriptionHandlerError("acquire",t,"error adding stream");throw s.logger.error(i.message),s.logger.error(i.error),i}))}},hasOffer:{writable:!0,value:function(e){var t="have-"+e+"-offer";return this.peerConnection.signalingState===t}},isIceGatheringComplete:{writable:!0,value:function(){return"complete"===this.peerConnection.iceGatheringState||this.iceGatheringTimeout}},resetIceGatheringComplete:{writable:!0,value:function(){this.iceGatheringTimeout=!1,this.iceGatheringTimer&&(e.Timers.clearTimeout(this.iceGatheringTimer),this.iceGatheringTimer=null),this.iceGatheringDeferred&&(this.iceGatheringDeferred.reject(),this.iceGatheringDeferred=null)}},setDirection:{writable:!0,value:function(e){var t=e.match(/a=(sendrecv|sendonly|recvonly|inactive)/);if(null===t)return this.direction=this.C.DIRECTION.NULL,void this.observer.directionChanged();var s=t[1];switch(s){case this.C.DIRECTION.SENDRECV:case this.C.DIRECTION.SENDONLY:case this.C.DIRECTION.RECVONLY:case this.C.DIRECTION.INACTIVE:this.direction=s;break;default:this.direction=this.C.DIRECTION.NULL}this.observer.directionChanged()}},triggerIceGatheringComplete:{writable:!0,value:function(){this.isIceGatheringComplete()&&(this.emit("iceGatheringComplete",this),this.iceGatheringTimer&&(e.Timers.clearTimeout(this.iceGatheringTimer),this.iceGatheringTimer=null),this.iceGatheringDeferred&&(this.iceGatheringDeferred.resolve(),this.iceGatheringDeferred=null))}},waitForIceGatheringComplete:{writable:!0,value:function(){return this.isIceGatheringComplete()?e.Utils.Promise.resolve():(this.isIceGatheringDeferred||(this.iceGatheringDeferred=e.Utils.defer()),this.iceGatheringDeferred.promise)}}}),i}}).call(this,s(0))},function(e,t,s){"use strict";var i=function(e,t){this.session=e||{},this.options=t||{}};i.prototype={trackAdded:function(){this.session.emit("trackAdded")},directionChanged:function(){this.session.emit("directionChanged")}},e.exports=i},function(e,t,s){"use strict";e.exports=function(e){var t,s=[],i=[],n=[];function r(t,s,i){for(var n,r=e.Utils.buildStatusLine(t),o=s.getHeaders("via"),a=o.length,c=0;c<a;c++)r+="Via: "+o[c]+"\r\n";n=s.getHeader("To"),s.to_tag||(n+=";tag="+e.Utils.newTag()),r+="To: "+n+"\r\n",r+="From: "+s.getHeader("From")+"\r\n",r+="Call-ID: "+s.call_id+"\r\n",r+="CSeq: "+s.cseq+" "+s.method+"\r\n",r+="\r\n",i.send(r)}s.push((function(e,t,s){if(!e.ruri||"sip"!==e.ruri.scheme)return r(416,e,s),!1})),s.push((function(e,t,s){if(!e.to_tag&&e.call_id.substr(0,5)===t.configuration.sipjsId)return r(482,e,s),!1})),s.push((function(t,s,i){if(e.Utils.str_utf8_length(t.body)<t.getHeader("content-length"))return r(400,t,i),!1})),s.push((function(t,s,i){var n,o,a=t.from_tag,c=t.call_id,u=t.cseq;if(!t.to_tag)if(t.method===e.C.INVITE){if(n=s.transactions.ist[t.via_branch])return;for(o in s.transactions.ist)if((n=s.transactions.ist[o]).request.from_tag===a&&n.request.call_id===c&&n.request.cseq===u)return r(482,t,i),!1}else{if(n=s.transactions.nist[t.via_branch])return;for(o in s.transactions.nist)if((n=s.transactions.nist[o]).request.from_tag===a&&n.request.call_id===c&&n.request.cseq===u)return r(482,t,i),!1}})),i.push((function(e,t){if(e.getHeaders("via").length>1)return t.getLogger("sip.sanitycheck").warn("More than one Via header field present in the response. Dropping the response"),!1})),i.push((function(e,t){var s=t.configuration.viaHost;if(e.via.host!==s||void 0!==e.via.port)return t.getLogger("sip.sanitycheck").warn("Via sent-by in the response does not match UA Via host value. Dropping the response"),!1})),i.push((function(t,s){if(e.Utils.str_utf8_length(t.body)<t.getHeader("content-length"))return s.getLogger("sip.sanitycheck").warn("Message body length is lower than the value in Content-Length header field. Dropping the response"),!1})),n.push((function(e,t){for(var s=["from","to","call_id","cseq","via"],i=s.length;i--;)if(!e.hasHeader(s[i]))return t.getLogger("sip.sanitycheck").warn("Missing mandatory header field : "+s[i]+". Dropping the response"),!1})),t=function(t,r,o){var a;for(a=n.length;a--;)if(!1===n[a](t,r,o))return!1;if(t instanceof e.IncomingRequest){for(a=s.length;a--;)if(!1===s[a](t,r,o))return!1}else if(t instanceof e.IncomingResponse)for(a=i.length;a--;)if(!1===i[a](t,r,o))return!1;return!0},e.sanityCheck=t}},function(e,t,s){"use strict";var i=s(34);e.exports=function(e){var t;return(t=function(e){this.logger=e.getLogger("sipjs.digestauthentication"),this.username=e.configuration.authorizationUser,this.password=e.configuration.password,this.cnonce=null,this.nc=0,this.ncHex="00000000",this.response=null}).prototype.authenticate=function(t,s){if(this.algorithm=s.algorithm,this.realm=s.realm,this.nonce=s.nonce,this.opaque=s.opaque,this.stale=s.stale,this.algorithm){if("MD5"!==this.algorithm)return this.logger.warn('challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this.algorithm="MD5";if(!this.realm)return this.logger.warn("challenge without Digest realm, authentication aborted"),!1;if(!this.nonce)return this.logger.warn("challenge without Digest nonce, authentication aborted"),!1;if(s.qop)if(s.qop.indexOf("auth")>-1)this.qop="auth";else{if(!(s.qop.indexOf("auth-int")>-1))return this.logger.warn('challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;this.qop="auth-int"}else this.qop=null;return this.method=t.method,this.uri=t.ruri,this.cnonce=e.createRandomToken(12),this.nc+=1,this.updateNcHex(),4294967296===this.nc&&(this.nc=1,this.ncHex="00000001"),this.calculateResponse(),!0},t.prototype.calculateResponse=function(){var e,t;e=i(this.username+":"+this.realm+":"+this.password),"auth"===this.qop?(t=i(this.method+":"+this.uri),this.response=i(e+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+t)):"auth-int"===this.qop?(t=i(this.method+":"+this.uri+":"+i(this.body?this.body:"")),this.response=i(e+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+t)):null===this.qop&&(t=i(this.method+":"+this.uri),this.response=i(e+":"+this.nonce+":"+t))},t.prototype.toString=function(){var e=[];if(!this.response)throw new Error("response field does not exist, cannot generate Authorization header");return e.push("algorithm="+this.algorithm),e.push('username="'+this.username+'"'),e.push('realm="'+this.realm+'"'),e.push('nonce="'+this.nonce+'"'),e.push('uri="'+this.uri+'"'),e.push('response="'+this.response+'"'),this.opaque&&e.push('opaque="'+this.opaque+'"'),this.qop&&(e.push("qop="+this.qop),e.push('cnonce="'+this.cnonce+'"'),e.push("nc="+this.ncHex)),"Digest "+e.join(", ")},t.prototype.updateNcHex=function(){var e=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-e.length)+e},t}},function(e,t,s){e.exports=function(e){return function(t){var s=e,i=s.lib,n=i.WordArray,r=i.Hasher,o=s.algo,a=[];!function(){for(var e=0;e<64;e++)a[e]=4294967296*t.abs(t.sin(e+1))|0}();var c=o.MD5=r.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var s=0;s<16;s++){var i=t+s,n=e[i];e[i]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8)}var r=this._hash.words,o=e[t+0],c=e[t+1],p=e[t+2],g=e[t+3],f=e[t+4],T=e[t+5],m=e[t+6],S=e[t+7],_=e[t+8],E=e[t+9],I=e[t+10],v=e[t+11],R=e[t+12],C=e[t+13],A=e[t+14],y=e[t+15],b=r[0],N=r[1],D=r[2],O=r[3];N=d(N=d(N=d(N=d(N=l(N=l(N=l(N=l(N=h(N=h(N=h(N=h(N=u(N=u(N=u(N=u(N,D=u(D,O=u(O,b=u(b,N,D,O,o,7,a[0]),N,D,c,12,a[1]),b,N,p,17,a[2]),O,b,g,22,a[3]),D=u(D,O=u(O,b=u(b,N,D,O,f,7,a[4]),N,D,T,12,a[5]),b,N,m,17,a[6]),O,b,S,22,a[7]),D=u(D,O=u(O,b=u(b,N,D,O,_,7,a[8]),N,D,E,12,a[9]),b,N,I,17,a[10]),O,b,v,22,a[11]),D=u(D,O=u(O,b=u(b,N,D,O,R,7,a[12]),N,D,C,12,a[13]),b,N,A,17,a[14]),O,b,y,22,a[15]),D=h(D,O=h(O,b=h(b,N,D,O,c,5,a[16]),N,D,m,9,a[17]),b,N,v,14,a[18]),O,b,o,20,a[19]),D=h(D,O=h(O,b=h(b,N,D,O,T,5,a[20]),N,D,I,9,a[21]),b,N,y,14,a[22]),O,b,f,20,a[23]),D=h(D,O=h(O,b=h(b,N,D,O,E,5,a[24]),N,D,A,9,a[25]),b,N,g,14,a[26]),O,b,_,20,a[27]),D=h(D,O=h(O,b=h(b,N,D,O,C,5,a[28]),N,D,p,9,a[29]),b,N,S,14,a[30]),O,b,R,20,a[31]),D=l(D,O=l(O,b=l(b,N,D,O,T,4,a[32]),N,D,_,11,a[33]),b,N,v,16,a[34]),O,b,A,23,a[35]),D=l(D,O=l(O,b=l(b,N,D,O,c,4,a[36]),N,D,f,11,a[37]),b,N,S,16,a[38]),O,b,I,23,a[39]),D=l(D,O=l(O,b=l(b,N,D,O,C,4,a[40]),N,D,o,11,a[41]),b,N,g,16,a[42]),O,b,m,23,a[43]),D=l(D,O=l(O,b=l(b,N,D,O,E,4,a[44]),N,D,R,11,a[45]),b,N,y,16,a[46]),O,b,p,23,a[47]),D=d(D,O=d(O,b=d(b,N,D,O,o,6,a[48]),N,D,S,10,a[49]),b,N,A,15,a[50]),O,b,T,21,a[51]),D=d(D,O=d(O,b=d(b,N,D,O,R,6,a[52]),N,D,g,10,a[53]),b,N,I,15,a[54]),O,b,c,21,a[55]),D=d(D,O=d(O,b=d(b,N,D,O,_,6,a[56]),N,D,y,10,a[57]),b,N,m,15,a[58]),O,b,C,21,a[59]),D=d(D,O=d(O,b=d(b,N,D,O,f,6,a[60]),N,D,v,10,a[61]),b,N,p,15,a[62]),O,b,E,21,a[63]),r[0]=r[0]+b|0,r[1]=r[1]+N|0,r[2]=r[2]+D|0,r[3]=r[3]+O|0},_doFinalize:function(){var e=this._data,s=e.words,i=8*this._nDataBytes,n=8*e.sigBytes;s[n>>>5]|=128<<24-n%32;var r=t.floor(i/4294967296),o=i;s[15+(n+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),s[14+(n+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),e.sigBytes=4*(s.length+1),this._process();for(var a=this._hash,c=a.words,u=0;u<4;u++){var h=c[u];c[u]=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8)}return a},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});function u(e,t,s,i,n,r,o){var a=e+(t&s|~t&i)+n+o;return(a<<r|a>>>32-r)+t}function h(e,t,s,i,n,r,o){var a=e+(t&i|s&~i)+n+o;return(a<<r|a>>>32-r)+t}function l(e,t,s,i,n,r,o){var a=e+(t^s^i)+n+o;return(a<<r|a>>>32-r)+t}function d(e,t,s,i,n,r,o){var a=e+(s^(t|~i))+n+o;return(a<<r|a>>>32-r)+t}s.MD5=r._createHelper(c),s.HmacMD5=r._createHmacHelper(c)}(Math),e.MD5}(s(35))},function(e,t,s){e.exports=function(){var e=e||function(e,t){var s=Object.create||function(){function e(){}return function(t){var s;return e.prototype=t,s=new e,e.prototype=null,s}}(),i={},n=i.lib={},r=n.Base={extend:function(e){var t=s(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=n.WordArray=r.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,s=e.words,i=this.sigBytes,n=e.sigBytes;if(this.clamp(),i%4)for(var r=0;r<n;r++){var o=s[r>>>2]>>>24-r%4*8&255;t[i+r>>>2]|=o<<24-(i+r)%4*8}else for(r=0;r<n;r+=4)t[i+r>>>2]=s[r>>>2];return this.sigBytes+=n,this},clamp:function(){var t=this.words,s=this.sigBytes;t[s>>>2]&=4294967295<<32-s%4*8,t.length=e.ceil(s/4)},clone:function(){var e=r.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var s,i=[],n=function(t){t=t;var s=987654321,i=4294967295;return function(){var n=((s=36969*(65535&s)+(s>>16)&i)<<16)+(t=18e3*(65535&t)+(t>>16)&i)&i;return n/=4294967296,(n+=.5)*(e.random()>.5?1:-1)}},r=0;r<t;r+=4){var a=n(4294967296*(s||e.random()));s=987654071*a(),i.push(4294967296*a()|0)}return new o.init(i,t)}}),a=i.enc={},c=a.Hex={stringify:function(e){for(var t=e.words,s=e.sigBytes,i=[],n=0;n<s;n++){var r=t[n>>>2]>>>24-n%4*8&255;i.push((r>>>4).toString(16)),i.push((15&r).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,s=[],i=0;i<t;i+=2)s[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new o.init(s,t/2)}},u=a.Latin1={stringify:function(e){for(var t=e.words,s=e.sigBytes,i=[],n=0;n<s;n++){var r=t[n>>>2]>>>24-n%4*8&255;i.push(String.fromCharCode(r))}return i.join("")},parse:function(e){for(var t=e.length,s=[],i=0;i<t;i++)s[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new o.init(s,t)}},h=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},l=n.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var s=this._data,i=s.words,n=s.sigBytes,r=this.blockSize,a=n/(4*r),c=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*r,u=e.min(4*c,n);if(c){for(var h=0;h<c;h+=r)this._doProcessBlock(i,h);var l=i.splice(0,c);s.sigBytes-=u}return new o.init(l,u)},clone:function(){var e=r.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),d=(n.Hasher=l.extend({cfg:r.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,s){return new e.init(s).finalize(t)}},_createHmacHelper:function(e){return function(t,s){return new d.HMAC.init(e,s).finalize(t)}}}),i.algo={});return i}(Math);return e}()},function(e,t,s){"use strict";var i=s(37);e.exports=function(e){return{parse:function(t,s){var n={startRule:s,SIP:e};try{i.parse(t,n)}catch(e){n.data=-1}return n.data}}}},function(e,t,s){"use strict";function i(e,t,s,n){this.message=e,this.expected=t,this.found=s,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,i)}!function(e,t){function s(){this.constructor=e}s.prototype=t.prototype,e.prototype=new s}(i,Error),i.buildMessage=function(e,t){var s={literal:function(e){return'"'+n(e.text)+'"'},class:function(e){var t,s="";for(t=0;t<e.parts.length;t++)s+=e.parts[t]instanceof Array?r(e.parts[t][0])+"-"+r(e.parts[t][1]):r(e.parts[t]);return"["+(e.inverted?"^":"")+s+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function i(e){return e.charCodeAt(0).toString(16).toUpperCase()}function n(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}function r(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}function o(e){return s[e.type](e)}return"Expected "+function(e){var t,s,i=new Array(e.length);for(t=0;t<e.length;t++)i[t]=o(e[t]);if(i.sort(),i.length>0){for(t=1,s=1;t<i.length;t++)i[t-1]!==i[t]&&(i[s]=i[t],s++);i.length=s}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(e)+" but "+function(e){return e?'"'+n(e)+'"':"end of input"}(t)+" found."},e.exports={SyntaxError:i,parse:function(e,t){t=void 0!==t?t:{};var s,n={},r={Contact:119,Name_Addr_Header:156,Record_Route:176,Request_Response:81,SIP_URI:45,Subscription_State:186,Supported:191,Require:182,Via:194,absoluteURI:84,Call_ID:118,Content_Disposition:130,Content_Length:135,Content_Type:136,CSeq:146,displayName:122,Event:149,From:151,host:52,Max_Forwards:154,Min_SE:213,Proxy_Authenticate:157,quoted_string:40,Refer_To:178,Replaces:179,Session_Expires:210,stun_URI:217,To:192,turn_URI:223,uuid:226,WWW_Authenticate:209,challenge:158,sipfrag:230,Referred_By:231},o=119,a=["\r\n",m("\r\n",!1),/^[0-9]/,S([["0","9"]],!1,!1),/^[a-zA-Z]/,S([["a","z"],["A","Z"]],!1,!1),/^[0-9a-fA-F]/,S([["0","9"],["a","f"],["A","F"]],!1,!1),/^[\0-\xFF]/,S([["\0","ÿ"]],!1,!1),/^["]/,S(['"'],!1,!1)," ",m(" ",!1),"\t",m("\t",!1),/^[a-zA-Z0-9]/,S([["a","z"],["A","Z"],["0","9"]],!1,!1),";",m(";",!1),"/",m("/",!1),"?",m("?",!1),":",m(":",!1),"@",m("@",!1),"&",m("&",!1),"=",m("=",!1),"+",m("+",!1),"$",m("$",!1),",",m(",",!1),"-",m("-",!1),"_",m("_",!1),".",m(".",!1),"!",m("!",!1),"~",m("~",!1),"*",m("*",!1),"'",m("'",!1),"(",m("(",!1),")",m(")",!1),"%",m("%",!1),function(){return" "},function(){return":"},/^[!-~]/,S([["!","~"]],!1,!1),/^[\x80-\uFFFF]/,S([["","￿"]],!1,!1),/^[\x80-\xBF]/,S([["","¿"]],!1,!1),/^[a-f]/,S([["a","f"]],!1,!1),"`",m("`",!1),"<",m("<",!1),">",m(">",!1),"\\",m("\\",!1),"[",m("[",!1),"]",m("]",!1),"{",m("{",!1),"}",m("}",!1),function(){return"*"},function(){return"/"},function(){return"="},function(){return"("},function(){return")"},function(){return">"},function(){return"<"},function(){return","},function(){return";"},function(){return":"},function(){return'"'},/^[!-']/,S([["!","'"]],!1,!1),/^[*-[]/,S([["*","["]],!1,!1),/^[\]-~]/,S([["]","~"]],!1,!1),function(e){return e},/^[#-[]/,S([["#","["]],!1,!1),/^[\0-\t]/,S([["\0","\t"]],!1,!1),/^[\x0B-\f]/,S([["\v","\f"]],!1,!1),/^[\x0E-\x7F]/,S([["",""]],!1,!1),function(){t.data.uri=new t.SIP.URI(t.data.scheme,t.data.user,t.data.host,t.data.port),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port},function(){t.data.uri=new t.SIP.URI(t.data.scheme,t.data.user,t.data.host,t.data.port,t.data.uri_params,t.data.uri_headers),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port,delete t.data.uri_params,"SIP_URI"===t.startRule&&(t.data=t.data.uri)},"sips",m("sips",!0),"sip",m("sip",!0),function(e){t.data.scheme=e},function(){t.data.user=decodeURIComponent(f().slice(0,-1))},function(){t.data.password=f()},function(){return t.data.host=f(),t.data.host},function(){return t.data.host_type="domain",f()},/^[a-zA-Z0-9_\-]/,S([["a","z"],["A","Z"],["0","9"],"_","-"],!1,!1),/^[a-zA-Z0-9\-]/,S([["a","z"],["A","Z"],["0","9"],"-"],!1,!1),function(){return t.data.host_type="IPv6",f()},"::",m("::",!1),function(){return t.data.host_type="IPv6",f()},function(){return t.data.host_type="IPv4",f()},"25",m("25",!1),/^[0-5]/,S([["0","5"]],!1,!1),"2",m("2",!1),/^[0-4]/,S([["0","4"]],!1,!1),"1",m("1",!1),/^[1-9]/,S([["1","9"]],!1,!1),function(e){return e=parseInt(e.join("")),t.data.port=e,e},"transport=",m("transport=",!0),"udp",m("udp",!0),"tcp",m("tcp",!0),"sctp",m("sctp",!0),"tls",m("tls",!0),function(e){t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.transport=e.toLowerCase()},"user=",m("user=",!0),"phone",m("phone",!0),"ip",m("ip",!0),function(e){t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.user=e.toLowerCase()},"method=",m("method=",!0),function(e){t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.method=e},"ttl=",m("ttl=",!0),function(e){t.data.params||(t.data.params={}),t.data.params.ttl=e},"maddr=",m("maddr=",!0),function(e){t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.maddr=e},"lr",m("lr",!0),function(){t.data.uri_params||(t.data.uri_params={}),t.data.uri_params.lr=void 0},function(e,s){t.data.uri_params||(t.data.uri_params={}),s=null===s?void 0:s[1],t.data.uri_params[e.toLowerCase()]=s},function(e,s){e=e.join("").toLowerCase(),s=s.join(""),t.data.uri_headers||(t.data.uri_headers={}),t.data.uri_headers[e]?t.data.uri_headers[e].push(s):t.data.uri_headers[e]=[s]},function(){"Refer_To"===t.startRule&&(t.data.uri=new t.SIP.URI(t.data.scheme,t.data.user,t.data.host,t.data.port,t.data.uri_params,t.data.uri_headers),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port,delete t.data.uri_params)},"//",m("//",!1),function(){t.data.scheme=f()},m("SIP",!0),function(){t.data.sip_version=f()},"INVITE",m("INVITE",!1),"ACK",m("ACK",!1),"VXACH",m("VXACH",!1),"OPTIONS",m("OPTIONS",!1),"BYE",m("BYE",!1),"CANCEL",m("CANCEL",!1),"REGISTER",m("REGISTER",!1),"SUBSCRIBE",m("SUBSCRIBE",!1),"NOTIFY",m("NOTIFY",!1),"REFER",m("REFER",!1),"PUBLISH",m("PUBLISH",!1),function(){return t.data.method=f(),t.data.method},function(e){t.data.status_code=parseInt(e.join(""))},function(){t.data.reason_phrase=f()},function(){t.data=f()},function(){var e,s;for(s=t.data.multi_header.length,e=0;e<s;e++)if(null===t.data.multi_header[e].parsed){t.data=null;break}null!==t.data?t.data=t.data.multi_header:t.data=-1},function(){var e;t.data.multi_header||(t.data.multi_header=[]);try{e=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),delete t.data.uri,delete t.data.displayName,delete t.data.params}catch(t){e=null}t.data.multi_header.push({position:u,offset:T().start.offset,parsed:e})},function(e){'"'===(e=f().trim())[0]&&(e=e.substring(1,e.length-1)),t.data.displayName=e},"q",m("q",!0),function(e){t.data.params||(t.data.params={}),t.data.params.q=e},"expires",m("expires",!0),function(e){t.data.params||(t.data.params={}),t.data.params.expires=e},function(e){return parseInt(e.join(""))},"0",m("0",!1),function(){return parseFloat(f())},function(e,s){t.data.params||(t.data.params={}),s=null===s?void 0:s[1],t.data.params[e.toLowerCase()]=s},"render",m("render",!0),"session",m("session",!0),"icon",m("icon",!0),"alert",m("alert",!0),function(){"Content_Disposition"===t.startRule&&(t.data.type=f().toLowerCase())},"handling",m("handling",!0),"optional",m("optional",!0),"required",m("required",!0),function(e){t.data=parseInt(e.join(""))},function(){t.data=f()},"text",m("text",!0),"image",m("image",!0),"audio",m("audio",!0),"video",m("video",!0),"application",m("application",!0),"message",m("message",!0),"multipart",m("multipart",!0),"x-",m("x-",!0),function(e){t.data.value=parseInt(e.join(""))},function(e){t.data=e},function(e){t.data.event=e.toLowerCase()},function(){var e=t.data.tag;t.data=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),e&&t.data.setParam("tag",e)},"tag",m("tag",!0),function(e){t.data.tag=e},function(e){t.data=parseInt(e.join(""))},function(e){t.data=e},function(){t.data=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params)},"digest",m("Digest",!0),"realm",m("realm",!0),function(e){t.data.realm=e},"domain",m("domain",!0),"nonce",m("nonce",!0),function(e){t.data.nonce=e},"opaque",m("opaque",!0),function(e){t.data.opaque=e},"stale",m("stale",!0),"true",m("true",!0),function(){t.data.stale=!0},"false",m("false",!0),function(){t.data.stale=!1},"algorithm",m("algorithm",!0),"md5",m("MD5",!0),"md5-sess",m("MD5-sess",!0),function(e){t.data.algorithm=e.toUpperCase()},"qop",m("qop",!0),"auth-int",m("auth-int",!0),"auth",m("auth",!0),function(e){t.data.qop||(t.data.qop=[]),t.data.qop.push(e.toLowerCase())},function(e){t.data.value=parseInt(e.join(""))},function(){var e,s;for(s=t.data.multi_header.length,e=0;e<s;e++)if(null===t.data.multi_header[e].parsed){t.data=null;break}null!==t.data?t.data=t.data.multi_header:t.data=-1},function(){var e;t.data.multi_header||(t.data.multi_header=[]);try{e=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),delete t.data.uri,delete t.data.displayName,delete t.data.params}catch(t){e=null}t.data.multi_header.push({position:u,offset:T().start.offset,parsed:e})},function(){t.data=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params)},function(){t.data.replaces_from_tag&&t.data.replaces_to_tag||(t.data=-1)},function(){t.data={call_id:t.data}},"from-tag",m("from-tag",!0),function(e){t.data.replaces_from_tag=e},"to-tag",m("to-tag",!0),function(e){t.data.replaces_to_tag=e},"early-only",m("early-only",!0),function(){t.data.early_only=!0},function(e,t){return t},function(e,t){return function(e,t){return[e].concat(t)}(e,t)},function(e){"Require"===t.startRule&&(t.data=e||[])},function(e){t.data.value=parseInt(e.join(""))},"active",m("active",!0),"pending",m("pending",!0),"terminated",m("terminated",!0),function(){t.data.state=f()},"reason",m("reason",!0),function(e){void 0!==e&&(t.data.reason=e)},function(e){void 0!==e&&(t.data.expires=e)},"retry_after",m("retry_after",!0),function(e){void 0!==e&&(t.data.retry_after=e)},"deactivated",m("deactivated",!0),"probation",m("probation",!0),"rejected",m("rejected",!0),"timeout",m("timeout",!0),"giveup",m("giveup",!0),"noresource",m("noresource",!0),"invariant",m("invariant",!0),function(e){"Supported"===t.startRule&&(t.data=e||[])},function(){var e=t.data.tag;t.data=new t.SIP.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),e&&t.data.setParam("tag",e)},"ttl",m("ttl",!0),function(e){t.data.ttl=e},"maddr",m("maddr",!0),function(e){t.data.maddr=e},"received",m("received",!0),function(e){t.data.received=e},"branch",m("branch",!0),function(e){t.data.branch=e},"rport",m("rport",!0),function(){"undefined"!=typeof response_port&&(t.data.rport=response_port.join(""))},function(e){t.data.protocol=e},m("UDP",!0),m("TCP",!0),m("TLS",!0),m("SCTP",!0),function(e){t.data.transport=e},function(){t.data.host=f()},function(e){t.data.port=parseInt(e.join(""))},function(e){return parseInt(e.join(""))},function(e){"Session_Expires"===t.startRule&&(t.data.deltaSeconds=e)},"refresher",m("refresher",!1),"uas",m("uas",!1),"uac",m("uac",!1),function(e){"Session_Expires"===t.startRule&&(t.data.refresher=e)},function(e){"Min_SE"===t.startRule&&(t.data=e)},"stuns",m("stuns",!0),"stun",m("stun",!0),function(e){t.data.scheme=e},function(e){t.data.host=e},"?transport=",m("?transport=",!1),"turns",m("turns",!0),"turn",m("turn",!0),function(){t.data.transport=transport},function(){t.data=f()},"Referred-By",m("Referred-By",!1),"b",m("b",!1),"cid",m("cid",!1)],c=[v('2 ""6 7!'),v('4"""5!7#'),v('4$""5!7%'),v('4&""5!7\''),v(";'.# &;("),v('4(""5!7)'),v('4*""5!7+'),v('2,""6,7-'),v('2.""6.7/'),v('40""5!71'),v('22""6273. &24""6475.} &26""6677.q &28""6879.e &2:""6:7;.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E'),v(";).# &;,"),v('2F""6F7G.} &2H""6H7I.q &2J""6J7K.e &2L""6L7M.Y &2N""6N7O.M &2P""6P7Q.A &2R""6R7S.5 &2T""6T7U.) &2V""6V7W'),v('%%2X""6X7Y/5#;#/,$;#/#$+#)(#\'#("\'#&\'#/"!&,)'),v('%%$;$0#*;$&/,#; /#$+")("\'#&\'#." &"/=#$;$/&#0#*;$&&&#/\'$8":Z" )("\'#&\'#'),v(';.." &"'),v("%$;'.# &;(0)*;'.# &;(&/?#28\"\"6879/0$;//'$8#:[# )(#'#(\"'#&'#"),v('%%$;2/&#0#*;2&&&#/g#$%$;.0#*;.&/,#;2/#$+")("\'#&\'#0=*%$;.0#*;.&/,#;2/#$+")("\'#&\'#&/#$+")("\'#&\'#/"!&,)'),v('4\\""5!7].# &;3'),v('4^""5!7_'),v('4`""5!7a'),v(';!.) &4b""5!7c'),v('%$;). &2F""6F7G. &2J""6J7K.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O/#0*;). &2F""6F7G. &2J""6J7K.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O&&&#/"!&,)'),v('%$;). &2F""6F7G.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O/#0*;). &2F""6F7G.} &2L""6L7M.q &2X""6X7Y.e &2P""6P7Q.Y &2H""6H7I.M &2@""6@7A.A &2d""6d7e.5 &2R""6R7S.) &2N""6N7O&&&#/"!&,)'),v('2T""6T7U.ã &2V""6V7W.× &2f""6f7g.Ë &2h""6h7i.¿ &2:""6:7;.³ &2D""6D7E.§ &22""6273. &28""6879. &2j""6j7k. &;&.} &24""6475.q &2l""6l7m.e &2n""6n7o.Y &26""6677.M &2>""6>7?.A &2p""6p7q.5 &2r""6r7s.) &;\'.# &;('),v('%$;).ī &2F""6F7G.ğ &2J""6J7K.ē &2L""6L7M.ć &2X""6X7Y.û &2P""6P7Q.ï &2H""6H7I.ã &2@""6@7A.× &2d""6d7e.Ë &2R""6R7S.¿ &2N""6N7O.³ &2T""6T7U.§ &2V""6V7W. &2f""6f7g. &2h""6h7i. &28""6879.w &2j""6j7k.k &;&.e &24""6475.Y &2l""6l7m.M &2n""6n7o.A &26""6677.5 &2p""6p7q.) &2r""6r7s/Ĵ#0ı*;).ī &2F""6F7G.ğ &2J""6J7K.ē &2L""6L7M.ć &2X""6X7Y.û &2P""6P7Q.ï &2H""6H7I.ã &2@""6@7A.× &2d""6d7e.Ë &2R""6R7S.¿ &2N""6N7O.³ &2T""6T7U.§ &2V""6V7W. &2f""6f7g. &2h""6h7i. &28""6879.w &2j""6j7k.k &;&.e &24""6475.Y &2l""6l7m.M &2n""6n7o.A &26""6677.5 &2p""6p7q.) &2r""6r7s&&&#/"!&,)'),v("%;//?#2P\"\"6P7Q/0$;//'$8#:t# )(#'#(\"'#&'#"),v("%;//?#24\"\"6475/0$;//'$8#:u# )(#'#(\"'#&'#"),v("%;//?#2>\"\"6>7?/0$;//'$8#:v# )(#'#(\"'#&'#"),v("%;//?#2T\"\"6T7U/0$;//'$8#:w# )(#'#(\"'#&'#"),v("%;//?#2V\"\"6V7W/0$;//'$8#:x# )(#'#(\"'#&'#"),v('%2h""6h7i/0#;//\'$8":y" )("\'#&\'#'),v('%;//6#2f""6f7g/\'$8":z" )("\'#&\'#'),v("%;//?#2D\"\"6D7E/0$;//'$8#:{# )(#'#(\"'#&'#"),v("%;//?#22\"\"6273/0$;//'$8#:|# )(#'#(\"'#&'#"),v("%;//?#28\"\"6879/0$;//'$8#:}# )(#'#(\"'#&'#"),v("%;//0#;&/'$8\":~\" )(\"'#&'#"),v("%;&/0#;//'$8\":~\" )(\"'#&'#"),v("%;=/T#$;G.) &;K.# &;F0/*;G.) &;K.# &;F&/,$;>/#$+#)(#'#(\"'#&'#"),v('4""5!7.A &4""5!7.5 &4""5!7.) &;3.# &;.'),v("%%;//Q#;&/H$$;J.# &;K0)*;J.# &;K&/,$;&/#$+$)($'#(#'#(\"'#&'#/\"!&,)"),v("%;//]#;&/T$%$;J.# &;K0)*;J.# &;K&/\"!&,)/1$;&/($8$:$!!)($'#(#'#(\"'#&'#"),v(';..G &2L""6L7M.; &4""5!7./ &4""5!7.# &;3'),v('%2j""6j7k/J#4""5!7.5 &4""5!7.) &4""5!7/#$+")("\'#&\'#'),v("%;N/M#28\"\"6879/>$;O.\" &\"/0$;S/'$8$:$ )($'#(#'#(\"'#&'#"),v("%;N/d#28\"\"6879/U$;O.\" &\"/G$;S/>$;_/5$;l.\" &\"/'$8&:& )(&'#(%'#($'#(#'#(\"'#&'#"),v('%3""5$7.) &3""5#7/\' 8!:!! )'),v('%;P/]#%28""6879/,#;R/#$+")("\'#&\'#." &"/6$2:""6:7;/\'$8#:# )(#\'#("\'#&\'#'),v("$;+.) &;-.# &;Q/2#0/*;+.) &;-.# &;Q&&&#"),v('2<""6<7=.q &2>""6>7?.e &2@""6@7A.Y &2B""6B7C.M &2D""6D7E.A &22""6273.5 &26""6677.) &24""6475'),v('%$;+._ &;-.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E0e*;+._ &;-.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E&/& 8!:! )'),v('%;T/J#%28""6879/,#;^/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),v("%;U.) &;\\.# &;X/& 8!:! )"),v('%$%;V/2#2J""6J7K/#$+")("\'#&\'#0<*%;V/2#2J""6J7K/#$+")("\'#&\'#&/D#;W/;$2J""6J7K." &"/\'$8#:# )(#\'#("\'#&\'#'),v('$4""5!7/,#0)*4""5!7&&&#'),v('%4$""5!7%/?#$4""5!70)*4""5!7&/#$+")("\'#&\'#'),v('%2l""6l7m/?#;Y/6$2n""6n7o/\'$8#:# )(#\'#("\'#&\'#'),v('%%;Z/³#28""6879/¤$;Z/$28""6879/$;Z/$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+-)(-\'#(,\'#(+\'#(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ސ &%2""67/¤#;Z/$28""6879/$;Z/$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+,)(,\'#(+\'#(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.۹ &%2""67/#;Z/$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+*)(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ٺ &%2""67/t#;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ؓ &%2""67/\\#;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+&)(&\'#(%\'#($\'#(#\'#("\'#&\'#.ׄ &%2""67/D#;Z/;$28""6879/,$;[/#$+$)($\'#(#\'#("\'#&\'#.֍ &%2""67/,#;[/#$+")("\'#&\'#.ծ &%2""67/,#;Z/#$+")("\'#&\'#.Տ &%;Z/#2""67/$;Z/$28""6879/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$++)(+\'#(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.Ӈ &%;Z/ª#%28""6879/,#;Z/#$+")("\'#&\'#." &"/$2""67/t$;Z/k$28""6879/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+*)(*\'#()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.а &%;Z/¹#%28""6879/,#;Z/#$+")("\'#&\'#." &"/$%28""6879/,#;Z/#$+")("\'#&\'#." &"/k$2""67/\\$;Z/S$28""6879/D$;Z/;$28""6879/,$;[/#$+))()\'#((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.Ί &%;Z/È#%28""6879/,#;Z/#$+")("\'#&\'#." &"/¡$%28""6879/,#;Z/#$+")("\'#&\'#." &"/z$%28""6879/,#;Z/#$+")("\'#&\'#." &"/S$2""67/D$;Z/;$28""6879/,$;[/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.˕ &%;Z/×#%28""6879/,#;Z/#$+")("\'#&\'#." &"/°$%28""6879/,#;Z/#$+")("\'#&\'#." &"/$%28""6879/,#;Z/#$+")("\'#&\'#." &"/b$%28""6879/,#;Z/#$+")("\'#&\'#." &"/;$2""67/,$;[/#$+\')(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.ȑ &%;Z/þ#%28""6879/,#;Z/#$+")("\'#&\'#." &"/×$%28""6879/,#;Z/#$+")("\'#&\'#." &"/°$%28""6879/,#;Z/#$+")("\'#&\'#." &"/$%28""6879/,#;Z/#$+")("\'#&\'#." &"/b$%28""6879/,#;Z/#$+")("\'#&\'#." &"/;$2""67/,$;Z/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#.Ħ &%;Z/Ĝ#%28""6879/,#;Z/#$+")("\'#&\'#." &"/õ$%28""6879/,#;Z/#$+")("\'#&\'#." &"/Î$%28""6879/,#;Z/#$+")("\'#&\'#." &"/§$%28""6879/,#;Z/#$+")("\'#&\'#." &"/$%28""6879/,#;Z/#$+")("\'#&\'#." &"/Y$%28""6879/,#;Z/#$+")("\'#&\'#." &"/2$2""67/#$+()((\'#(\'\'#(&\'#(%\'#($\'#(#\'#("\'#&\'#/& 8!: ! )'),v('%;#/M#;#." &"/?$;#." &"/1$;#." &"/#$+$)($\'#(#\'#("\'#&\'#'),v("%;Z/;#28\"\"6879/,$;Z/#$+#)(#'#(\"'#&'#.# &;\\"),v("%;]/o#2J\"\"6J7K/`$;]/W$2J\"\"6J7K/H$;]/?$2J\"\"6J7K/0$;]/'$8':¡' )(''#(&'#(%'#($'#(#'#(\"'#&'#"),v('%2¢""6¢7£/2#4¤""5!7¥/#$+")("\'#&\'#. &%2¦""6¦7§/;#4¨""5!7©/,$;!/#$+#)(#\'#("\'#&\'#.j &%2ª""6ª7«/5#;!/,$;!/#$+#)(#\'#("\'#&\'#.B &%4¬""5!7­/,#;!/#$+")("\'#&\'#.# &;!'),v('%%;!." &"/[#;!." &"/M$;!." &"/?$;!." &"/1$;!." &"/#$+%)(%\'#($\'#(#\'#("\'#&\'#/\' 8!:®!! )'),v('$%22""6273/,#;`/#$+")("\'#&\'#0<*%22""6273/,#;`/#$+")("\'#&\'#&'),v(";a.A &;b.; &;c.5 &;d./ &;e.) &;f.# &;g"),v('%3¯""5*7°/a#3±""5#7².G &3³""5#7´.; &3µ""5$7¶./ &3·""5#7¸.# &;6/($8":¹"! )("\'#&\'#'),v('%3º""5%7»/I#3¼""5%7½./ &3¾""5"7¿.# &;6/($8":À"! )("\'#&\'#'),v('%3Á""5\'7Â/1#;/($8":Ã"! )("\'#&\'#'),v('%3Ä""5$7Å/1#;ð/($8":Æ"! )("\'#&\'#'),v('%3Ç""5&7È/1#;T/($8":É"! )("\'#&\'#'),v('%3Ê""5"7Ë/N#%2>""6>7?/,#;6/#$+")("\'#&\'#." &"/\'$8":Ì" )("\'#&\'#'),v('%;h/P#%2>""6>7?/,#;i/#$+")("\'#&\'#." &"/)$8":Í""! )("\'#&\'#'),v('%$;j/&#0#*;j&&&#/"!&,)'),v('%$;j/&#0#*;j&&&#/"!&,)'),v(";k.) &;+.# &;-"),v('2l""6l7m.e &2n""6n7o.Y &24""6475.M &28""6879.A &2<""6<7=.5 &2@""6@7A.) &2B""6B7C'),v('%26""6677/n#;m/e$$%2<""6<7=/,#;m/#$+")("\'#&\'#0<*%2<""6<7=/,#;m/#$+")("\'#&\'#&/#$+#)(#\'#("\'#&\'#'),v('%;n/A#2>""6>7?/2$;o/)$8#:Î#"" )(#\'#("\'#&\'#'),v("$;p.) &;+.# &;-/2#0/*;p.) &;+.# &;-&&&#"),v("$;p.) &;+.# &;-0/*;p.) &;+.# &;-&"),v('2l""6l7m.e &2n""6n7o.Y &24""6475.M &26""6677.A &28""6879.5 &2@""6@7A.) &2B""6B7C'),v(";.# &;r"),v("%;/G#;'/>$;s/5$;'/,$;/#$+%)(%'#($'#(#'#(\"'#&'#"),v(";M.# &;t"),v("%;/E#28\"\"6879/6$;u.# &;x/'$8#:Ï# )(#'#(\"'#&'#"),v('%;v.# &;w/J#%26""6677/,#;/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),v('%2Ð""6Ð7Ñ/:#;/1$;w." &"/#$+#)(#\'#("\'#&\'#'),v('%24""6475/,#;{/#$+")("\'#&\'#'),v("%;z/3#$;y0#*;y&/#$+\")(\"'#&'#"),v(";*.) &;+.# &;-"),v(';+. &;-. &22""6273.} &26""6677.q &28""6879.e &2:""6:7;.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E'),v('%;|/e#$%24""6475/,#;|/#$+")("\'#&\'#0<*%24""6475/,#;|/#$+")("\'#&\'#&/#$+")("\'#&\'#'),v('%$;~0#*;~&/e#$%22""6273/,#;}/#$+")("\'#&\'#0<*%22""6273/,#;}/#$+")("\'#&\'#&/#$+")("\'#&\'#'),v("$;~0#*;~&"),v(';+.w &;-.q &28""6879.e &2:""6:7;.Y &2<""6<7=.M &2>""6>7?.A &2@""6@7A.5 &2B""6B7C.) &2D""6D7E'),v('%%;"/#$;".G &;!.A &2@""6@7A.5 &2F""6F7G.) &2J""6J7K0M*;".G &;!.A &2@""6@7A.5 &2F""6F7G.) &2J""6J7K&/#$+")("\'#&\'#/& 8!:Ò! )'),v(";.# &;"),v('%%;O/2#2:""6:7;/#$+")("\'#&\'#." &"/,#;S/#$+")("\'#&\'#." &"'),v('$;+. &;-.} &2B""6B7C.q &2D""6D7E.e &22""6273.Y &28""6879.M &2:""6:7;.A &2<""6<7=.5 &2>""6>7?.) &2@""6@7A/#0*;+. &;-.} &2B""6B7C.q &2D""6D7E.e &22""6273.Y &28""6879.M &2:""6:7;.A &2<""6<7=.5 &2>""6>7?.) &2@""6@7A&&&#'),v("$;y0#*;y&"),v('%3""5#7Ó/q#24""6475/b$$;!/&#0#*;!&&&#/L$2J""6J7K/=$$;!/&#0#*;!&&&#/\'$8%:Ô% )(%\'#($\'#(#\'#("\'#&\'#'),v('2Õ""6Õ7Ö'),v('2×""6×7Ø'),v('2Ù""6Ù7Ú'),v('2Û""6Û7Ü'),v('2Ý""6Ý7Þ'),v('2ß""6ß7à'),v('2á""6á7â'),v('2ã""6ã7ä'),v('2å""6å7æ'),v('2ç""6ç7è'),v('2é""6é7ê'),v("%;.Y &;.S &;.M &;.G &;.A &;.; &;.5 &;./ &;.) &;.# &;6/& 8!:ë! )"),v("%;/G#;'/>$;/5$;'/,$;/#$+%)(%'#($'#(#'#(\"'#&'#"),v("%;/' 8!:ì!! )"),v("%;!/5#;!/,$;!/#$+#)(#'#(\"'#&'#"),v("%$;*.A &;+.; &;-.5 &;3./ &;4.) &;'.# &;(0G*;*.A &;+.; &;-.5 &;3./ &;4.) &;'.# &;(&/& 8!:í! )"),v("%;¶/Y#$%;A/,#;¶/#$+\")(\"'#&'#06*%;A/,#;¶/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),v('%;9/N#%2:""6:7;/,#;9/#$+")("\'#&\'#." &"/\'$8":î" )("\'#&\'#'),v("%;:.c &%;/Y#$%;A/,#;/#$+\")(\"'#&'#06*%;A/,#;/#$+\")(\"'#&'#&/#$+\")(\"'#&'#/& 8!:ï! )"),v("%;L.# &;/]#$%;B/,#;/#$+\")(\"'#&'#06*%;B/,#;/#$+\")(\"'#&'#&/'$8\":ð\" )(\"'#&'#"),v("%;.\" &\"/>#;@/5$;M/,$;?/#$+$)($'#(#'#(\"'#&'#"),v("%%;6/Y#$%;./,#;6/#$+\")(\"'#&'#06*%;./,#;6/#$+\")(\"'#&'#&/#$+\")(\"'#&'#.# &;H/' 8!:ñ!! )"),v(";.) &;.# &; "),v("%3ò\"\"5!7ó/:#;</1$;/($8#:ô#! )(#'#(\"'#&'#"),v("%3õ\"\"5'7ö/:#;</1$;/($8#:÷#! )(#'#(\"'#&'#"),v("%$;!/&#0#*;!&&&#/' 8!:ø!! )"),v('%2ù""6ù7ú/o#%2J""6J7K/M#;!." &"/?$;!." &"/1$;!." &"/#$+$)($\'#(#\'#("\'#&\'#." &"/\'$8":û" )("\'#&\'#'),v('%;6/J#%;</,#;¡/#$+")("\'#&\'#." &"/)$8":ü""! )("\'#&\'#'),v(";6.) &;T.# &;H"),v("%;£/Y#$%;B/,#;¤/#$+\")(\"'#&'#06*%;B/,#;¤/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),v('%3ý""5&7þ.G &3ÿ""5\'7Ā.; &3ā""5$7Ă./ &3ă""5%7Ą.# &;6/& 8!:ą! )'),v(";¥.# &; "),v('%3Ć""5(7ć/M#;</D$3Ĉ""5(7ĉ./ &3Ċ""5(7ċ.# &;6/#$+#)(#\'#("\'#&\'#'),v("%;6/Y#$%;A/,#;6/#$+\")(\"'#&'#06*%;A/,#;6/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),v("%$;!/&#0#*;!&&&#/' 8!:Č!! )"),v("%;©/& 8!:č! )"),v("%;ª/k#;;/b$;¯/Y$$%;B/,#;°/#$+\")(\"'#&'#06*%;B/,#;°/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#"),v(";«.# &;¬"),v('3Ď""5$7ď.S &3Đ""5%7đ.G &3Ē""5%7ē.; &3Ĕ""5%7ĕ./ &3Ė""5+7ė.# &;­'),v('3Ę""5\'7ę./ &3Ě""5)7ě.# &;­'),v(";6.# &;®"),v('%3Ĝ""5"7ĝ/,#;6/#$+")("\'#&\'#'),v(";­.# &;6"),v("%;6/5#;</,$;±/#$+#)(#'#(\"'#&'#"),v(";6.# &;H"),v("%;³/5#;./,$;/#$+#)(#'#(\"'#&'#"),v("%$;!/&#0#*;!&&&#/' 8!:Ğ!! )"),v("%;/' 8!:ğ!! )"),v('%;¶/^#$%;B/,#; /#$+")("\'#&\'#06*%;B/,#; /#$+")("\'#&\'#&/($8":Ġ"!!)("\'#&\'#'),v('%%;7/e#$%2J""6J7K/,#;7/#$+")("\'#&\'#0<*%2J""6J7K/,#;7/#$+")("\'#&\'#&/#$+")("\'#&\'#/"!&,)'),v("%;L.# &;/]#$%;B/,#;¸/#$+\")(\"'#&'#06*%;B/,#;¸/#$+\")(\"'#&'#&/'$8\":ġ\" )(\"'#&'#"),v(";¹.# &; "),v("%3Ģ\"\"5#7ģ/:#;</1$;6/($8#:Ĥ#! )(#'#(\"'#&'#"),v("%$;!/&#0#*;!&&&#/' 8!:ĥ!! )"),v("%;/' 8!:Ħ!! )"),v("%$;0#*;&/x#;@/o$;M/f$;?/]$$%;B/,#; /#$+\")(\"'#&'#06*%;B/,#; /#$+\")(\"'#&'#&/'$8%:ħ% )(%'#($'#(#'#(\"'#&'#"),v(";¾"),v("%3Ĩ\"\"5&7ĩ/k#;./b$;Á/Y$$%;A/,#;Á/#$+\")(\"'#&'#06*%;A/,#;Á/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#.# &;¿"),v("%;6/k#;./b$;À/Y$$%;A/,#;À/#$+\")(\"'#&'#06*%;A/,#;À/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#"),v("%;6/;#;</2$;6.# &;H/#$+#)(#'#(\"'#&'#"),v(";Â.G &;Ä.A &;Æ.; &;È.5 &;É./ &;Ê.) &;Ë.# &;À"),v("%3Ī\"\"5%7ī/5#;</,$;Ã/#$+#)(#'#(\"'#&'#"),v("%;I/' 8!:Ĭ!! )"),v("%3ĭ\"\"5&7Į/#;</$;D/$;Å/|$$%$;'/&#0#*;'&&&#/,#;Å/#$+\")(\"'#&'#0C*%$;'/&#0#*;'&&&#/,#;Å/#$+\")(\"'#&'#&/,$;E/#$+&)(&'#(%'#($'#(#'#(\"'#&'#"),v(";t.# &;w"),v("%3į\"\"5%7İ/5#;</,$;Ç/#$+#)(#'#(\"'#&'#"),v("%;I/' 8!:ı!! )"),v("%3Ĳ\"\"5&7ĳ/:#;</1$;I/($8#:Ĵ#! )(#'#(\"'#&'#"),v('%3ĵ""5%7Ķ/]#;</T$%3ķ""5$7ĸ/& 8!:Ĺ! ).4 &%3ĺ""5%7Ļ/& 8!:ļ! )/#$+#)(#\'#("\'#&\'#'),v('%3Ľ""5)7ľ/R#;</I$3Ŀ""5#7ŀ./ &3Ł""5(7ł.# &;6/($8#:Ń#! )(#\'#("\'#&\'#'),v('%3ń""5#7Ņ/#;</$;D/$%;Ì/e#$%2D""6D7E/,#;Ì/#$+")("\'#&\'#0<*%2D""6D7E/,#;Ì/#$+")("\'#&\'#&/#$+")("\'#&\'#/,$;E/#$+%)(%\'#($\'#(#\'#("\'#&\'#'),v('%3ņ""5(7Ň./ &3ň""5$7ŉ.# &;6/\' 8!:Ŋ!! )'),v("%;6/Y#$%;A/,#;6/#$+\")(\"'#&'#06*%;A/,#;6/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),v("%;Ï/G#;./>$;Ï/5$;./,$;/#$+%)(%'#($'#(#'#(\"'#&'#"),v("%$;!/&#0#*;!&&&#/' 8!:ŋ!! )"),v("%;Ñ/]#$%;A/,#;Ñ/#$+\")(\"'#&'#06*%;A/,#;Ñ/#$+\")(\"'#&'#&/'$8\":Ō\" )(\"'#&'#"),v("%;/]#$%;B/,#; /#$+\")(\"'#&'#06*%;B/,#; /#$+\")(\"'#&'#&/'$8\":ō\" )(\"'#&'#"),v('%;L.O &;.I &%;@." &"/:#;t/1$;?." &"/#$+#)(#\'#("\'#&\'#/]#$%;B/,#; /#$+")("\'#&\'#06*%;B/,#; /#$+")("\'#&\'#&/\'$8":Ŏ" )("\'#&\'#'),v("%;Ô/]#$%;B/,#;Õ/#$+\")(\"'#&'#06*%;B/,#;Õ/#$+\")(\"'#&'#&/'$8\":ŏ\" )(\"'#&'#"),v("%;/& 8!:Ő! )"),v('%3ő""5(7Œ/:#;</1$;6/($8#:œ#! )(#\'#("\'#&\'#.g &%3Ŕ""5&7ŕ/:#;</1$;6/($8#:Ŗ#! )(#\'#("\'#&\'#.: &%3ŗ""5*7Ř/& 8!:ř! ).# &; '),v('%%;6/k#$%;A/2#;6/)$8":Ś""$ )("\'#&\'#0<*%;A/2#;6/)$8":Ś""$ )("\'#&\'#&/)$8":ś""! )("\'#&\'#." &"/\' 8!:Ŝ!! )'),v("%;Ø/Y#$%;A/,#;Ø/#$+\")(\"'#&'#06*%;A/,#;Ø/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),v("%;/Y#$%;B/,#; /#$+\")(\"'#&'#06*%;B/,#; /#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),v("%$;!/&#0#*;!&&&#/' 8!:ŝ!! )"),v("%;Û/Y#$%;B/,#;Ü/#$+\")(\"'#&'#06*%;B/,#;Ü/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),v('%3Ş""5&7ş.; &3Š""5\'7š./ &3Ţ""5*7ţ.# &;6/& 8!:Ť! )'),v("%3ť\"\"5&7Ŧ/:#;</1$;Ý/($8#:ŧ#! )(#'#(\"'#&'#.} &%3õ\"\"5'7ö/:#;</1$;/($8#:Ũ#! )(#'#(\"'#&'#.P &%3ũ\"\"5+7Ū/:#;</1$;/($8#:ū#! )(#'#(\"'#&'#.# &; "),v('3Ŭ""5+7ŭ.k &3Ů""5)7ů._ &3Ű""5(7ű.S &3Ų""5\'7ų.G &3Ŵ""5&7ŵ.; &3Ŷ""5*7ŷ./ &3Ÿ""5)7Ź.# &;6'),v(';1." &"'),v('%%;6/k#$%;A/2#;6/)$8":Ś""$ )("\'#&\'#0<*%;A/2#;6/)$8":Ś""$ )("\'#&\'#&/)$8":ś""! )("\'#&\'#." &"/\' 8!:ź!! )'),v("%;L.# &;/]#$%;B/,#;á/#$+\")(\"'#&'#06*%;B/,#;á/#$+\")(\"'#&'#&/'$8\":Ż\" )(\"'#&'#"),v(";¹.# &; "),v("%;ã/Y#$%;A/,#;ã/#$+\")(\"'#&'#06*%;A/,#;ã/#$+\")(\"'#&'#&/#$+\")(\"'#&'#"),v("%;ê/k#;./b$;í/Y$$%;B/,#;ä/#$+\")(\"'#&'#06*%;B/,#;ä/#$+\")(\"'#&'#&/#$+$)($'#(#'#(\"'#&'#"),v(";å.; &;æ.5 &;ç./ &;è.) &;é.# &; "),v("%3ż\"\"5#7Ž/:#;</1$;ð/($8#:ž#! )(#'#(\"'#&'#"),v("%3ſ\"\"5%7ƀ/:#;</1$;T/($8#:Ɓ#! )(#'#(\"'#&'#"),v("%3Ƃ\"\"5(7ƃ/F#;</=$;\\.) &;Y.# &;X/($8#:Ƅ#! )(#'#(\"'#&'#"),v("%3ƅ\"\"5&7Ɔ/:#;</1$;6/($8#:Ƈ#! )(#'#(\"'#&'#"),v('%3ƈ""5%7Ɖ/O#%;</3#$;!0#*;!&/#$+")("\'#&\'#." &"/\'$8":Ɗ" )("\'#&\'#'),v("%;ë/G#;;/>$;6/5$;;/,$;ì/#$+%)(%'#($'#(#'#(\"'#&'#"),v('%3""5#7Ó.# &;6/\' 8!:Ƌ!! )'),v('%3±""5#7ƌ.G &3³""5#7ƍ.; &3·""5#7Ǝ./ &3µ""5$7Ə.# &;6/\' 8!:Ɛ!! )'),v('%;î/D#%;C/,#;ï/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),v("%;U.) &;\\.# &;X/& 8!:Ƒ! )"),v('%%;!." &"/[#;!." &"/M$;!." &"/?$;!." &"/1$;!." &"/#$+%)(%\'#($\'#(#\'#("\'#&\'#/\' 8!:ƒ!! )'),v('%%;!/?#;!." &"/1$;!." &"/#$+#)(#\'#("\'#&\'#/\' 8!:Ɠ!! )'),v(";¾"),v('%;/^#$%;B/,#;ó/#$+")("\'#&\'#06*%;B/,#;ó/#$+")("\'#&\'#&/($8":Ɣ"!!)("\'#&\'#'),v(";ô.# &; "),v('%2ƕ""6ƕ7Ɩ/L#;</C$2Ɨ""6Ɨ7Ƙ.) &2ƙ""6ƙ7ƚ/($8#:ƛ#! )(#\'#("\'#&\'#'),v('%;/^#$%;B/,#; /#$+")("\'#&\'#06*%;B/,#; /#$+")("\'#&\'#&/($8":Ɯ"!!)("\'#&\'#'),v("%;6/5#;0/,$;÷/#$+#)(#'#(\"'#&'#"),v("$;2.) &;4.# &;.0/*;2.) &;4.# &;.&"),v("$;%0#*;%&"),v("%;ú/;#28\"\"6879/,$;û/#$+#)(#'#(\"'#&'#"),v('%3Ɲ""5%7ƞ.) &3Ɵ""5$7Ơ/\' 8!:ơ!! )'),v('%;ü/J#%28""6879/,#;^/#$+")("\'#&\'#." &"/#$+")("\'#&\'#'),v("%;\\.) &;X.# &;/' 8!:Ƣ!! )"),v(';".S &;!.M &2F""6F7G.A &2J""6J7K.5 &2H""6H7I.) &2N""6N7O'),v('2L""6L7M. &2B""6B7C. &2<""6<7=.} &2R""6R7S.q &2T""6T7U.e &2V""6V7W.Y &2P""6P7Q.M &2@""6@7A.A &2D""6D7E.5 &22""6273.) &2>""6>7?'),v('%;Ā/b#28""6879/S$;û/J$%2ƣ""6ƣ7Ƥ/,#;ì/#$+")("\'#&\'#." &"/#$+$)($\'#(#\'#("\'#&\'#'),v('%3ƥ""5%7Ʀ.) &3Ƨ""5$7ƨ/\' 8!:ơ!! )'),v('%;ì/O#3±""5#7².6 &3³""5#7´.* &$;+0#*;+&/\'$8":Ʃ" )("\'#&\'#'),v("%;Ą/#2F\"\"6F7G/x$;ă/o$2F\"\"6F7G/`$;ă/W$2F\"\"6F7G/H$;ă/?$2F\"\"6F7G/0$;ą/'$8):ƪ) )()'#(('#(''#(&'#(%'#($'#(#'#(\"'#&'#"),v("%;#/>#;#/5$;#/,$;#/#$+$)($'#(#'#(\"'#&'#"),v("%;ă/,#;ă/#$+\")(\"'#&'#"),v("%;ă/5#;ă/,$;ă/#$+#)(#'#(\"'#&'#"),v("%;/U#;'/L$;/C$;'/:$;/1$; .\" &\"/#$+&)(&'#(%'#($'#(#'#(\"'#&'#"),v('%2ƫ""6ƫ7Ƭ.) &2ƭ""6ƭ7Ʈ/w#;0/n$;Ĉ/e$$%;B/2#;ĉ.# &; /#$+")("\'#&\'#0<*%;B/2#;ĉ.# &; /#$+")("\'#&\'#&/#$+$)($\'#(#\'#("\'#&\'#'),v(";.# &;L"),v("%2Ư\"\"6Ư7ư/5#;</,$;Ċ/#$+#)(#'#(\"'#&'#"),v("%;D/S#;,/J$2:\"\"6:7;/;$;,.# &;T/,$;E/#$+%)(%'#($'#(#'#(\"'#&'#")],u=0,h=0,l=[{line:1,column:1}],d=0,p=[],g=0;if("startRule"in t){if(!(t.startRule in r))throw new Error("Can't start parsing from rule \""+t.startRule+'".');o=r[t.startRule]}function f(){return e.substring(h,u)}function T(){return E(h,u)}function m(e,t){return{type:"literal",text:e,ignoreCase:t}}function S(e,t,s){return{type:"class",parts:e,inverted:t,ignoreCase:s}}function _(t){var s,i=l[t];if(i)return i;for(s=t-1;!l[s];)s--;for(i={line:(i=l[s]).line,column:i.column};s<t;)10===e.charCodeAt(s)?(i.line++,i.column=1):i.column++,s++;return l[t]=i,i}function E(e,t){var s=_(e),i=_(t);return{start:{offset:e,line:s.line,column:s.column},end:{offset:t,line:i.line,column:i.column}}}function I(e){u<d||(u>d&&(d=u,p=[]),p.push(e))}function v(e){var t,s=new Array(e.length);for(t=0;t<e.length;t++)s[t]=e.charCodeAt(t)-32;return s}if(t.data={},(s=function t(s){for(var i,r,o=c[s],l=0,d=[],p=o.length,f=[],T=[];;){for(;l<p;)switch(o[l]){case 0:T.push(a[o[l+1]]),l+=2;break;case 1:T.push(void 0),l++;break;case 2:T.push(null),l++;break;case 3:T.push(n),l++;break;case 4:T.push([]),l++;break;case 5:T.push(u),l++;break;case 6:T.pop(),l++;break;case 7:u=T.pop(),l++;break;case 8:T.length-=o[l+1],l+=2;break;case 9:T.splice(-2,1),l++;break;case 10:T[T.length-2].push(T.pop()),l++;break;case 11:T.push(T.splice(T.length-o[l+1],o[l+1])),l+=2;break;case 12:T.push(e.substring(T.pop(),u)),l++;break;case 13:f.push(p),d.push(l+3+o[l+1]+o[l+2]),T[T.length-1]?(p=l+3+o[l+1],l+=3):(p=l+3+o[l+1]+o[l+2],l+=3+o[l+1]);break;case 14:f.push(p),d.push(l+3+o[l+1]+o[l+2]),T[T.length-1]===n?(p=l+3+o[l+1],l+=3):(p=l+3+o[l+1]+o[l+2],l+=3+o[l+1]);break;case 15:f.push(p),d.push(l+3+o[l+1]+o[l+2]),T[T.length-1]!==n?(p=l+3+o[l+1],l+=3):(p=l+3+o[l+1]+o[l+2],l+=3+o[l+1]);break;case 16:T[T.length-1]!==n?(f.push(p),d.push(l),p=l+2+o[l+1],l+=2):l+=2+o[l+1];break;case 17:f.push(p),d.push(l+3+o[l+1]+o[l+2]),e.length>u?(p=l+3+o[l+1],l+=3):(p=l+3+o[l+1]+o[l+2],l+=3+o[l+1]);break;case 18:f.push(p),d.push(l+4+o[l+2]+o[l+3]),e.substr(u,a[o[l+1]].length)===a[o[l+1]]?(p=l+4+o[l+2],l+=4):(p=l+4+o[l+2]+o[l+3],l+=4+o[l+2]);break;case 19:f.push(p),d.push(l+4+o[l+2]+o[l+3]),e.substr(u,a[o[l+1]].length).toLowerCase()===a[o[l+1]]?(p=l+4+o[l+2],l+=4):(p=l+4+o[l+2]+o[l+3],l+=4+o[l+2]);break;case 20:f.push(p),d.push(l+4+o[l+2]+o[l+3]),a[o[l+1]].test(e.charAt(u))?(p=l+4+o[l+2],l+=4):(p=l+4+o[l+2]+o[l+3],l+=4+o[l+2]);break;case 21:T.push(e.substr(u,o[l+1])),u+=o[l+1],l+=2;break;case 22:T.push(a[o[l+1]]),u+=a[o[l+1]].length,l+=2;break;case 23:T.push(n),0===g&&I(a[o[l+1]]),l+=2;break;case 24:h=T[T.length-1-o[l+1]],l+=2;break;case 25:h=u,l++;break;case 26:for(i=o.slice(l+4,l+4+o[l+3]),r=0;r<o[l+3];r++)i[r]=T[T.length-1-i[r]];T.splice(T.length-o[l+2],o[l+2],a[o[l+1]].apply(null,i)),l+=4+o[l+3];break;case 27:T.push(t(o[l+1])),l+=2;break;case 28:g++,l++;break;case 29:g--,l++;break;default:throw new Error("Invalid opcode: "+o[l]+".")}if(!(f.length>0))break;p=f.pop(),l=d.pop()}return T[0]}(o))!==n&&u===e.length)return s;throw s!==n&&u<e.length&&I({type:"end"}),function(e,t,s){return new i(i.buildMessage(e,t),e,t,s)}(p,d<e.length?e.charAt(d):null,d<e.length?E(d,d+1):E(d,d))}}},function(e,t,s){"use strict";e.exports=function(e){function t(e,t){var s,i,n=[],r=e.split(/\r\n/);for(s=0;s<r.length;){var o=r[s];if(/^m=(?:audio|video)/.test(o))i={index:s,stripped:[]},n.push(i);else if(i){var a=/^a=rtpmap:(\d+) ([^/]+)\//.exec(o);if(a&&t===a[2]){r.splice(s,1),i.stripped.push(a[1]);continue}}s++}for(s=0;s<n.length;s++){for(var c=r[n[s].index].split(" "),u=3;u<c.length;)-1===n[s].stripped.indexOf(c[u])?u++:c.splice(u,1);r[n[s].index]=c.join(" ")}return r.join("\r\n")}return{stripTcpCandidates:function(t){return t.sdp=t.sdp.replace(/^a=candidate:\d+ \d+ tcp .*?\r\n/gim,""),e.Utils.Promise.resolve(t)},stripTelephoneEvent:function(s){return s.sdp=t(s.sdp,"telephone-event"),e.Utils.Promise.resolve(s)},cleanJitsiSdpImageattr:function(t){return t.sdp=t.sdp.replace(/^(a=imageattr:.*?)(x|y)=\[0-/gm,"$1$2=[1:"),e.Utils.Promise.resolve(t)},stripG722:function(s){return s.sdp=t(s.sdp,"G722"),e.Utils.Promise.resolve(s)},stripRtpPayload:function(s){return function(i){return i.sdp=t(i.sdp,s),e.Utils.Promise.resolve(i)}},stripVideo:function(t){return t.sdp=function(e,t){var s=new RegExp("m=video.*$","gm"),i=new RegExp("^a=group:.*$","gm");if(s.test(e)){var n,r=(e=e.split(/^m=/gm).filter((function(e){return e.substr(0,t.length)!==t||((n=e.match(/^a=mid:.*$/gm))&&(n=n[0].match(/:.+$/g)[0].substr(1)),!1)})).join("m=")).match(i);if(r&&1===r.length){r=r[0];var o=new RegExp(" *"+n+"[^ ]*","g");r=r.replace(o,""),e=e.split(i).join(r)}}return e}(t.sdp,"video"),e.Utils.Promise.resolve(t)},addMidLines:function(t){var s=t.sdp;if(-1===s.search(/^a=mid.*$/gm)){var i=s.match(/^m=.*$/gm);s=s.split(/^m=.*$/gm),i.forEach((function(e,t){i[t]=e+"\na=mid:"+t})),s.forEach((function(e,t){i[t]&&(s[t]=e+i[t])})),s=s.join(""),t.sdp=s}return e.Utils.Promise.resolve(t)}}}},function(e,t,s){"use strict";(function(t){e.exports=function(e){var s={STATUS_NULL:0,STATUS_NEW:1,STATUS_CONNECTING:2,STATUS_CONNECTED:3,STATUS_COMPLETED:4},i=function(i){if(i.media.remote.video?this.video=!0:this.video=!1,i.media.remote.audio?this.audio=!0:this.audio=!1,!this.audio&&!this.video)throw new Error("At least one remote audio or video element is required for Simple.");this.options=i;var n=t.navigator.userAgent.toLowerCase(),r=!1,o=!1;n.indexOf("safari")>-1&&n.indexOf("chrome")<0?r=!0:n.indexOf("firefox")>-1&&n.indexOf("chrome")<0&&(o=!0);var a={};return r&&(a.modifiers=[e.Web.Modifiers.stripG722]),o&&(a.alwaysAcquireMediaFirst=!0),this.options.ua.uri||(this.anonymous=!0),this.ua=new e.UA({uri:this.options.ua.uri,authorizationUser:this.options.ua.authorizationUser,password:this.options.ua.password,displayName:this.options.ua.displayName,userAgentString:this.options.ua.userAgentString,register:!0,sessionDescriptionHandlerFactoryOptions:a,transportOptions:{traceSip:this.options.ua.traceSip,wsServers:this.options.ua.wsServers}}),this.state=s.STATUS_NULL,this.logger=this.ua.getLogger("sip.simple"),this.ua.on("registered",function(){this.emit("registered",this.ua)}.bind(this)),this.ua.on("unregistered",function(){this.emit("unregistered",this.ua)}.bind(this)),this.ua.on("failed",function(){this.emit("unregistered",this.ua)}.bind(this)),this.ua.on("invite",function(e){if(this.state!==s.STATUS_NULL&&this.state!==s.STATUS_COMPLETED)return this.logger.warn("Rejecting incoming call. Simple only supports 1 call at a time"),void e.reject();this.session=e,this.setupSession(),this.emit("ringing",this.session)}.bind(this)),this.ua.on("message",function(e){this.emit("message",e)}.bind(this)),this};return i.prototype=Object.create(e.EventEmitter.prototype),i.C=s,i.prototype.call=function(e){if(this.ua&&this.checkRegistration()){if(this.state===s.STATUS_NULL||this.state===s.STATUS_COMPLETED)return this.options.media.remote.audio&&(this.options.media.remote.audio.autoplay=!0),this.options.media.remote.video&&(this.options.media.remote.video.autoplay=!0),this.options.media.local&&this.options.media.local.video&&(this.options.media.local.video.autoplay=!0,this.options.media.local.video.volume=0),this.session=this.ua.invite(e,{sessionDescriptionHandlerOptions:{constraints:{audio:this.audio,video:this.video}}}),this.setupSession(),this.session;this.logger.warn("Cannot make more than a single call with Simple")}else this.logger.warn("A registered UA is required for calling")},i.prototype.answer=function(){if(this.state===s.STATUS_NEW||this.state===s.STATUS_CONNECTING)return this.options.media.remote.audio&&(this.options.media.remote.audio.autoplay=!0),this.options.media.remote.video&&(this.options.media.remote.video.autoplay=!0),this.session.accept({sessionDescriptionHandlerOptions:{constraints:{audio:this.audio,video:this.video}}});this.logger.warn("No call to answer")},i.prototype.reject=function(){if(this.state===s.STATUS_NEW||this.state===s.STATUS_CONNECTING)return this.session.reject();this.logger.warn("Call is already answered")},i.prototype.hangup=function(){if(this.state===s.STATUS_CONNECTED||this.state===s.STATUS_CONNECTING||this.state===s.STATUS_NEW)return this.state!==s.STATUS_CONNECTED?this.session.cancel():this.session.bye();this.logger.warn("No active call to hang up on")},i.prototype.hold=function(){if(this.state===s.STATUS_CONNECTED&&!this.session.local_hold)return this.mute(),this.logger.log("Placing session on hold"),this.session.hold();this.logger.warn("Cannot put call on hold")},i.prototype.unhold=function(){if(this.state===s.STATUS_CONNECTED&&this.session.local_hold)return this.unmute(),this.logger.log("Placing call off hold"),this.session.unhold();this.logger.warn("Cannot unhold a call that is not on hold")},i.prototype.mute=function(){this.state===s.STATUS_CONNECTED?(this.logger.log("Muting Audio"),this.toggleMute(!0),this.emit("mute",this)):this.logger.warn("An acitve call is required to mute audio")},i.prototype.unmute=function(){this.state===s.STATUS_CONNECTED?(this.logger.log("Unmuting Audio"),this.toggleMute(!1),this.emit("unmute",this)):this.logger.warn("An active call is required to unmute audio")},i.prototype.sendDTMF=function(e){this.state===s.STATUS_CONNECTED?(this.logger.log("Sending DTMF tone: "+e),this.session.dtmf(e)):this.logger.warn("An active call is required to send a DTMF tone")},i.prototype.message=function(e,t){this.ua&&this.checkRegistration()?e&&t?this.ua.message(e,t):this.logger.warn("A destination and message are required to send a message"):this.logger.warn("A registered UA is required to send a message")},i.prototype.checkRegistration=function(){return this.anonymous||this.ua&&this.ua.isRegistered()},i.prototype.setupRemoteMedia=function(){var e,s=this.session.sessionDescriptionHandler.peerConnection;s.getReceivers?(e=new t.window.MediaStream,s.getReceivers().forEach((function(t){var s=t.track;s&&e.addTrack(s)}))):e=s.getRemoteStreams()[0],this.video?(this.options.media.remote.video.srcObject=e,this.options.media.remote.video.play().catch(function(){this.logger.log("play was rejected")}.bind(this))):this.audio&&(this.options.media.remote.audio.srcObject=e,this.options.media.remote.audio.play().catch(function(){this.logger.log("play was rejected")}.bind(this)))},i.prototype.setupLocalMedia=function(){if(this.video&&this.options.media.local&&this.options.media.local.video){var e,s=this.session.sessionDescriptionHandler.peerConnection;s.getSenders?(e=new t.window.MediaStream,s.getSenders().forEach((function(t){var s=t.track;s&&"video"===s.kind&&e.addTrack(s)}))):e=s.getLocalStreams()[0],this.options.media.local.video.srcObject=e,this.options.media.local.video.volume=0,this.options.media.local.video.play()}},i.prototype.cleanupMedia=function(){this.video&&(this.options.media.remote.video.srcObject=null,this.options.media.remote.video.pause(),this.options.media.local&&this.options.media.local.video&&(this.options.media.local.video.srcObject=null,this.options.media.local.video.pause())),this.audio&&(this.options.media.remote.audio.srcObject=null,this.options.media.remote.audio.pause())},i.prototype.setupSession=function(){this.state=s.STATUS_NEW,this.emit("new",this.session),this.session.on("progress",this.onProgress.bind(this)),this.session.on("accepted",this.onAccepted.bind(this)),this.session.on("rejected",this.onEnded.bind(this)),this.session.on("failed",this.onFailed.bind(this)),this.session.on("terminated",this.onEnded.bind(this))},i.prototype.destroyMedia=function(){this.session.sessionDescriptionHandler.close()},i.prototype.toggleMute=function(e){var t=this.session.sessionDescriptionHandler.peerConnection;t.getSenders?t.getSenders().forEach((function(t){t.track&&(t.track.enabled=!e)})):t.getLocalStreams().forEach((function(t){t.getAudioTracks().forEach((function(t){t.enabled=!e})),t.getVideoTracks().forEach((function(t){t.enabled=!e}))}))},i.prototype.onAccepted=function(){this.state=s.STATUS_CONNECTED,this.emit("connected",this.session),this.setupLocalMedia(),this.setupRemoteMedia(),this.session.sessionDescriptionHandler.on("addTrack",function(){this.logger.log("A track has been added, triggering new remoteMedia setup"),this.setupRemoteMedia()}.bind(this)),this.session.sessionDescriptionHandler.on("addStream",function(){this.logger.log("A stream has been added, trigger new remoteMedia setup"),this.setupRemoteMedia()}.bind(this)),this.session.on("hold",function(){this.emit("hold",this.session)}.bind(this)),this.session.on("unhold",function(){this.emit("unhold",this.session)}.bind(this)),this.session.on("dtmf",function(e){this.emit("dtmf",e)}.bind(this)),this.session.on("bye",this.onEnded.bind(this))},i.prototype.onProgress=function(){this.state=s.STATUS_CONNECTING,this.emit("connecting",this.session)},i.prototype.onFailed=function(){this.onEnded()},i.prototype.onEnded=function(){this.state=s.STATUS_COMPLETED,this.emit("ended",this.session),this.cleanupMedia()},i}}).call(this,s(0))},function(e,t,s){"use strict";(function(t){var i=t.window||t;function n(e,t){if(null!=e){var s=t.charAt(0).toUpperCase()+t.slice(1),i=[t,"webkit"+s,"moz"+s];for(var n in i){var r=e[i[n]];if(r)return r.bind(e)}}}e.exports={WebSocket:i.WebSocket,Transport:s(1),open:i.open,Promise:i.Promise,timers:i,console:i.console||{debug:function(){},log:function(){},warn:function(){},error:function(){}},addEventListener:n(i,"addEventListener"),removeEventListener:n(i,"removeEventListener")}}).call(this,s(0))}]),function(){"use strict";var e={STATUS_NULL:0,STATUS_NEW:1,STATUS_CONNECTING:2,STATUS_CONNECTED:3,STATUS_COMPLETED:4},t=function(t){if(t.media.remote.video?this.video=!0:this.video=!1,t.media.remote.audio?this.audio=!0:this.audio=!1,!this.audio&&!this.video)throw new Error("At least one remote audio or video element is required for CFSimpleSip.");this.options=t;var s=window.navigator.userAgent.toLowerCase(),i=!1,n=!1;s.indexOf("safari")>-1&&s.indexOf("chrome")<0?i=!0:s.indexOf("firefox")>-1&&s.indexOf("chrome")<0&&(n=!0);var r={};return i&&(r.modifiers=[SIP.Web.Modifiers.stripG722]),n&&(r.alwaysAcquireMediaFirst=!0,r.modifiers=[SIP.Web.Modifiers.addMidLines]),this.options.ua.uri||(this.anonymous=!0),this.ua=new SIP.UA({uri:this.options.ua.uri,authorizationUser:this.options.ua.authorizationUser,password:this.options.ua.password,displayName:this.options.ua.displayName,userAgentString:SIP.C.USER_AGENT+";"+s,register:!0,registerExpires:this.options.ua.registerExpires||600,sessionDescriptionHandlerFactoryOptions:r,transportOptions:{traceSip:this.options.ua.traceSip,wsServers:this.options.ua.wsServers,maxReconnectionAttempts:1e3}}),this.state=e.STATUS_NULL,this.logger=this.ua.getLogger("sip.simple"),this.ua.on("registered",function(){this.emit("registered",this.ua)}.bind(this)),this.ua.on("unregistered",function(){this.emit("unregistered",this.ua)}.bind(this)),this.ua.on("failed",function(){this.emit("unregistered",this.ua)}.bind(this)),this.ua.on("invite",function(t){if(this.state!==e.STATUS_NULL&&this.state!==e.STATUS_COMPLETED)return this.logger.warn("Rejecting incoming call. CFSimpleSip only supports 1 call at a time"),void t.reject();this.session=t,this.setupSession(),this.emit("ringing",this.session)}.bind(this)),this.ua.on("message",function(e){this.emit("message",e)}.bind(this)),this};t.prototype=Object.create(SIP.EventEmitter.prototype),t.C=e,t.prototype.call=function(t){if(this.ua&&this.checkRegistration()){if(this.state===e.STATUS_NULL||this.state===e.STATUS_COMPLETED)return this.options.media.remote.audio&&(this.options.media.remote.audio.autoplay=!0),this.options.media.remote.video&&(this.options.media.remote.video.autoplay=!0),this.options.media.local&&this.options.media.local.video&&(this.options.media.local.video.autoplay=!0,this.options.media.local.video.volume=0),this.session=this.ua.invite(t,{sessionDescriptionHandlerOptions:{constraints:{audio:this.audio,video:this.video}}}),this.setupSession(),this.session;this.logger.warn("Cannot make more than a single call with CFSimpleSip")}else this.logger.warn("A registered UA is required for calling")},t.prototype.answer=function(){if(this.state===e.STATUS_NEW||this.state===e.STATUS_CONNECTING)return this.options.media.remote.audio&&(this.options.media.remote.audio.autoplay=!0),this.options.media.remote.video&&(this.options.media.remote.video.autoplay=!0),this.session.accept({sessionDescriptionHandlerOptions:{constraints:{audio:this.audio,video:this.video}}});this.logger.warn("No call to answer")},t.prototype.reject=function(){if(this.state===e.STATUS_NEW||this.state===e.STATUS_CONNECTING)return this.session.reject();this.logger.warn("Call is already answered")},t.prototype.hangup=function(){if(this.state===e.STATUS_CONNECTED||this.state===e.STATUS_CONNECTING||this.state===e.STATUS_NEW)return this.state!==e.STATUS_CONNECTED?this.session.cancel():this.session.bye();this.logger.warn("No active call to hang up on")},t.prototype.hold=function(){if(this.state===e.STATUS_CONNECTED&&!this.session.local_hold)return this.mute(),this.logger.log("Placing session on hold"),this.session.hold();this.logger.warn("Cannot put call on hold")},t.prototype.unhold=function(){if(this.state===e.STATUS_CONNECTED&&this.session.local_hold)return this.unmute(),this.logger.log("Placing call off hold"),this.session.unhold();this.logger.warn("Cannot unhold a call that is not on hold")},t.prototype.mute=function(){this.state===e.STATUS_CONNECTED?(this.logger.log("Muting Audio"),this.toggleMute(!0),this.emit("mute",this)):this.logger.warn("An acitve call is required to mute audio")},t.prototype.unmute=function(){this.state===e.STATUS_CONNECTED?(this.logger.log("Unmuting Audio"),this.toggleMute(!1),this.emit("unmute",this)):this.logger.warn("An active call is required to unmute audio")},t.prototype.sendDTMF=function(t){this.state===e.STATUS_CONNECTED?(this.logger.log("Sending DTMF tone: "+t),this.session.dtmf(t)):this.logger.warn("An active call is required to send a DTMF tone")},t.prototype.message=function(e,t){this.ua&&this.checkRegistration()?e&&t?this.ua.message(e,t):this.logger.warn("A destination and message are required to send a message"):this.logger.warn("A registered UA is required to send a message")},t.prototype.checkRegistration=function(){return this.anonymous||this.ua&&this.ua.isRegistered()},t.prototype.setupRemoteMedia=function(){var e,t=this.session.sessionDescriptionHandler.peerConnection;t.getReceivers?(e=new window.window.MediaStream,t.getReceivers().forEach((function(t){var s=t.track;s&&e.addTrack(s)}))):e=t.getRemoteStreams()[0],this.video?(this.options.media.remote.video.srcObject=e,this.options.media.remote.video.play().catch(function(){this.logger.log("play was rejected")}.bind(this))):this.audio&&(this.options.media.remote.audio.srcObject=e,this.options.media.remote.audio.play().catch(function(){this.logger.log("play was rejected")}.bind(this)))},t.prototype.setupLocalMedia=function(){if(this.video&&this.options.media.local&&this.options.media.local.video){var e,t=this.session.sessionDescriptionHandler.peerConnection;t.getSenders?(e=new window.window.MediaStream,t.getSenders().forEach((function(t){var s=t.track;s&&"video"===s.kind&&e.addTrack(s)}))):e=t.getLocalStreams()[0],this.options.media.local.video.srcObject=e,this.options.media.local.video.volume=0,this.options.media.local.video.play()}},t.prototype.cleanupMedia=function(){this.video&&(this.options.media.remote.video.srcObject=null,this.options.media.remote.video.pause(),this.options.media.local&&this.options.media.local.video&&(this.options.media.local.video.srcObject=null,this.options.media.local.video.pause())),this.audio&&(this.options.media.remote.audio.srcObject=null,this.options.media.remote.audio.pause())},t.prototype.setupSession=function(){this.state=e.STATUS_NEW,this.emit("new",this.session),this.session.on("progress",this.onProgress.bind(this)),this.session.on("accepted",this.onAccepted.bind(this)),this.session.on("rejected",this.onEnded.bind(this)),this.session.on("failed",this.onFailed.bind(this)),this.session.on("terminated",this.onEnded.bind(this))},t.prototype.destroyMedia=function(){this.session.sessionDescriptionHandler.close()},t.prototype.toggleMute=function(e){var t=this.session.sessionDescriptionHandler.peerConnection;t.getSenders?t.getSenders().forEach((function(t){t.track&&(t.track.enabled=!e)})):t.getLocalStreams().forEach((function(t){t.getAudioTracks().forEach((function(t){t.enabled=!e})),t.getVideoTracks().forEach((function(t){t.enabled=!e}))}))},t.prototype.onAccepted=function(){this.state=e.STATUS_CONNECTED,this.emit("connected",this.session),this.setupLocalMedia(),this.setupRemoteMedia(),this.session.sessionDescriptionHandler.on("addTrack",function(){this.logger.log("A track has been added, triggering new remoteMedia setup"),this.setupRemoteMedia()}.bind(this)),this.session.sessionDescriptionHandler.on("addStream",function(){this.logger.log("A stream has been added, trigger new remoteMedia setup"),this.setupRemoteMedia()}.bind(this)),this.session.on("hold",function(){this.emit("hold",this.session)}.bind(this)),this.session.on("unhold",function(){this.emit("unhold",this.session)}.bind(this)),this.session.on("dtmf",function(e){this.emit("dtmf",e)}.bind(this)),this.session.on("bye",this.onEnded.bind(this))},t.prototype.onProgress=function(){this.state=e.STATUS_CONNECTING,this.emit("connecting",this.session)},t.prototype.onFailed=function(){this.onEnded()},t.prototype.onEnded=function(){this.state=e.STATUS_COMPLETED,this.emit("ended",this.session),this.cleanupMedia()},window.CFSimpleSip=t}(),function(n){var r=function(){};r.prototype.processResponse=function(e){var t=Qe.buildDefaultResponse(e),s=Ke.getInstance(),i=e.ui_notification,n=Qe.getText(i,"agent_id");"AGENT"===Qe.getText(i,"session_type")&&s.incrementTotalCalls(),n===s.agentSettings.agentId?s.currentCall.sessionId=Qe.getText(i,"session_id"):""!=n&&(s.currentCall.monitorAgentId=n);var r=Qe.getText(i,"session_type"),o=Qe.getText(i,"allow_control"),a=Qe.getText(i,"session_id"),c=Qe.getText(i,"uii"),u=s.currentCall.isMonitoring,h=s.currentCall.monitoringType,l=u&&"FULL"===h,d=n!==s.agentSettings.agentId,p=!1;if("1"!==a&&d&&(l?p=!0:o&&("OUTBOUND"!==r&&"AGENT"!==r||(p=!0))),p){var g=Qe.getText(i,"phone");"AGENT"!==r&&""===n||(g=Qe.getText(i,"agent_name")),s.transferSessions[a]={sessionId:a,destination:g,uii:c}}return"2"===i.session_id&&(s.agentSettings.onCall=!0),t.status="OK",t.message="Received ADD-SESSION notification",t.sessionId=Qe.getText(i,"session_id"),t.uii=Qe.getText(i,"uii"),t.phone=Qe.getText(i,"phone"),t.sessionType=Qe.getText(i,"session_type"),t.sessionLabel=Qe.getText(i,"session_label"),t.allowControl=Qe.getText(i,"allow_control"),t.monitoring=Qe.getText(i,"monitoring"),t.agentId=Qe.getText(i,"agent_id"),t.transferSessions=s.transferSessions,t};var o=function(){};o.prototype.processResponse=function(e){var t=Qe.buildDefaultResponse(e),s=e.ui_notification;return t.status="OK",t.message="Received AGENT-DEBUG-EMAIL notification",t.emailTo=Qe.getText(s,"email_to"),t.requestedBy=Qe.getText(s,"requested_by"),t};var a=function(){};a.prototype.processResponse=function(e){var t=Ke.getInstance(),s=e.ui_notification,i=t.loginRequest.loginType,n=Qe.getText(s,"dial_group_id");return t.dialGroupChangeNotification=e,t.loginRequest.loginType=!n||""===n||"INBOUND"!==i&&"BLENDED"!==i?n&&""!==n?"OUTBOUND":"INBOUND"===i?"INBOUND":"NO-SELECTION":"BLENDED",Ke.getInstance().loginRequest.dialGroupId=n,{message:"Dial Group Updated Successfully.",detail:"Dial Group changed to ["+n+"].",dialGroupId:Qe.getText(s,"dial_group_id"),dialGroupName:Qe.getText(s,"dialGroupName"),dialGroupDesc:Qe.getText(s,"dial_group_desc"),agentId:Qe.getText(s,"agent_id")}};var c=function(){};c.prototype.processResponse=function(e){var t=Ke.getInstance(),s=e.ui_notification;return t.agentSettings.pendingDialGroupChange=parseInt(Qe.getText(s,"dial_group_id"),10),s.update_from_adminui?t.agentSettings.updateDGFromAdminUI=!0===Qe.getText(s,"update_from_adminui"):t.agentSettings.updateDGFromAdminUI=!1,{message:"Dial Group Change Pending notification received.",detail:"DialGroup switch for existing session pending until active call ends.",agentId:Qe.getText(s,"agent_id"),dialGroupId:Qe.getText(s,"dial_group_id"),updateFromAdminUI:Qe.getText(s,"update_from_adminui")}};var u=function(){};u.prototype.processResponse=function(e){var t=Qe.buildDefaultResponse(e),s=e.ui_notification;return t.message="Received DIRECT-AGENT-ROUTE notification",t.status=Qe.getText(s,"status"),t.agentId=Qe.getText(s,"agent_id"),t.uii=Qe.getText(s,"uii"),t.ani=Qe.getText(s,"ani"),t.dnis=Qe.getText(s,"dnis"),t.sourceType=Qe.getText(s,"source_type"),t.sourceId=Qe.getText(s,"source_id"),t.sourceName=Qe.getText(s,"source_name"),t.voicemailUrl=Qe.getText(s,"voicemail_url"),t};var h=function(){};h.prototype.processResponse=function(e){var t=Qe.buildDefaultResponse(e),s=e.ui_notification,i=Qe.getText(s,"session_id"),n=Ke.getInstance().transferSessions[i];return n&&(Qe.logMessage(Xe.DEBUG,"Transfer to "+n.destination+" has terminated",""),delete Ke.getInstance().transferSessions[i],t.transferEnd=n),t.message="Received DROP-SESSION Notification",t.status="OK",t.sessionId=Qe.getText(s,"session_id"),t.uii=Qe.getText(s,"uii"),t};var l=function(){};l.prototype.processResponse=function(e){var t=Qe.buildDefaultResponse(e),s=e.ui_notification;return t.message="Received EARLY_UII notification",t.status="OK",t.agentId=Qe.getText(s,"agent_id"),t.uii=Qe.getText(s,"uii"),t};var d=function(e){this.libInstance=e};d.prototype.processResponse=function(e){var t=Ke.getInstance(),s=e.ui_notification;return t.endCallNotification=e,t.currentCall.duration=Qe.getText(s,"call_duration"),t.currentCall.termParty=Qe.getText(s,"term_party"),t.currentCall.termReason=Qe.getText(s,"term_reason"),t.agentSettings.callState="CALL-ENDED",t.agentSettings.onCall=!1,t.agentSettings.onManualOutdial=!1,t.transferSessions={},(t.agentSettings.pendingDialGroupChange>0||-1==t.agentSettings.pendingDialGroupChange)&&(t.loginRequest.dialGroupId=t.agentSettings.pendingDialGroupChange,this.libInstance.loginAgent(t.loginRequest.queueIds,t.configRequest.chatIds,t.configRequest.skillProfileId,t.configRequest.dialGroupId,t.configRequest.dialDest,t.agentSettings.updateDGFromAdminUI),t.agentSettings.pendingDialGroupChange=0,t.agentSettings.updateDGFromAdminUI=!1),t.currentCall.outdialDispositions&&t.currentCall.outdialDispositions.dispositions&&t.currentCall.outdialDispositions.dispositions.length>0&&"SUPPRESS"!==t.currentCall.surveyPopType&&(t.pingIntervalId=setInterval(Qe.sendPingCallMessage,3e4)),{message:"End Call Notification Received.",detail:"",uii:Qe.getText(s,"uii"),sessionId:Qe.getText(s,"session_id"),agentId:Qe.getText(s,"agent_id"),callDts:Qe.getText(s,"call_dts"),duration:t.currentCall.duration,termParty:t.currentCall.termParty,termReason:t.currentCall.termReason,recordingUrl:Qe.getText(s,"recording_url"),dispositionTimeout:Qe.getText(s,"disposition_timeout")}};var p=function(){};p.prototype.processResponse=function(e){var t=Ke.getInstance(),s=e.ui_notification,i=[],n=t.inboundSettings.availableQueues,r=Qe.getText(s,"gate_ids");""!==r&&(r=r.split(","));for(var o=0;o<r.length;o++){var a=r[o],c=Qe.findObjById(n,a,"gateId");if(c)i.push(c);else{var u={gateId:a,gateName:"",gateDesc:"",defaultDestOverride:"",isAgentSelectable:!1};i.push(u)}}return t.inboundSettings.queues=JSON.parse(JSON.stringify(i)),{agentId:Qe.getText(s,"agent_id"),message:"Gates Change notification received.",queues:i}};var g=function(){};g.prototype.processResponse=function(e){var t=Qe.buildDefaultResponse(e);return t.messageCode=Qe.getText(e.ui_notification,"message_code"),t};var f=function(){};f.prototype.processResponse=function(e){var t=Ke.getInstance(),s=e.ui_notification,i={uii:Qe.getText(s,"uii"),agentId:Qe.getText(s,"agent_id"),dialDest:Qe.getText(s,"dial_dest"),queueDts:Qe.getText(s,"queue_dts"),queueTime:Qe.getText(s,"queue_time"),ani:Qe.getText(s,"ani"),dnis:Qe.getText(s,"dnis"),callType:Qe.getText(s,"call_type"),appUrl:Qe.getText(s,"app_url"),isMonitoring:Qe.getText(s,"is_monitoring"),allowHold:Qe.getText(s,"allow_hold"),allowTransfer:Qe.getText(s,"allow_transfer"),allowManualInternationalTransfer:Qe.getText(s,"allow_manual_international_transfer"),allowDirectAgentTransfer:Qe.getText(s,"allow_direct_agent_transfer"),allowHangup:Qe.getText(s,"allow_hangup"),allowRequeue:Qe.getText(s,"allow_requeue"),allowEndCallForEveryone:Qe.getText(s,"allow_endcallforeveryone"),scriptId:Qe.getText(s,"script_id"),scriptVersion:Qe.getText(s,"script_version"),surveyId:Qe.getText(s,"survey_id"),surveyPopType:Qe.getText(s,"survey_pop_type"),requeueType:Qe.getText(s,"requeue_type"),hangupOnDisposition:Qe.getText(s,"hangup_on_disposition")};i.isMonitoring&&(i.monitoringType=Qe.getText(s,"monitoring_type")),i.queue=Qe.processResponseCollection(e,"ui_notification","gate")[0],i.agentRecording=Qe.processResponseCollection(e,"ui_notification","agent_recording","agentRecording")[0],i.outdialDispositions=Qe.processResponseCollection(e,"ui_notification","outdial_dispositions","disposition")[0],i.requeueShortcuts=Qe.processResponseCollection(e,"ui_notification","requeue_shortcuts","requeueShortcut")[0]||[],i.baggage=Qe.processResponseCollection(e,"ui_notification","baggage")[0],i.surveyResponse=Qe.processResponseCollection(e,"ui_notification","survey_response","detail")[0],i.scriptResponse={},i.transferPhoneBook=Qe.processResponseCollection(e,"ui_notification","transfer_phone_book")[0],i.lead=Qe.processResponseCollection(e,"ui_notification","lead")[0];try{if(s.lead&&s.lead.extra_data)for(var n in delete i.lead.extraDatas,i.lead.extraData={},s.lead.extra_data)i.lead.extraData[n]=s.lead.extra_data[n]["#text"]}catch(e){console.warn("error parsing new call lead extra data: "+e)}if(i.baggage){i.baggage.customLabels={};var r=s.baggage.custom_labels;for(var n in r){var o="";r&&r[n]&&r[n]["#text"]&&(o=r[n]["#text"]),i.baggage.customLabels[n]=o}}try{for(var a=JSON.parse(s.script_result["#text"]).model,c={},u=Object.keys(a),h=0;h<u.length;h++){var l=a[n=u[h]].value;c[n]=l}i.scriptResponse=c}catch(e){}if(i.transferPhoneBook&&i.transferPhoneBook.entrys&&(i.transferPhoneBook=i.transferPhoneBook.entrys),i.requeueShortcuts&&i.requeueShortcuts.requeueShortcuts&&(i.requeueShortcuts=i.requeueShortcuts.requeueShortcuts),i.outdialDispositions&&i.outdialDispositions.disposition&&(i.outdialDispositions.dispositions=[i.outdialDispositions]),i.queue.isCampaign="1"===i.queue.isCampaign,i.outdialDispositions&&i.outdialDispositions.dispositions)for(var d=0;d<i.outdialDispositions.dispositions.length;d++){var p=i.outdialDispositions.dispositions[d];p.isComplete="1"===p.isComplete,p.requireNote="1"===p.requireNote,p.saveSurvey="1"===p.saveSurvey,p.xfer="1"===p.xfer,p.isDefault="1"===p.isDefault}return t.callTokens=function(e,t){var s=Ke.getInstance(),i=t.baggage||{};if(e.baggage&&e.baggage.generic_key_value_pairs){var n=[],r=Qe.getText(e.baggage,"generic_key_value_pairs");for(var o in r.length>0&&(n=Qe.parseKeyValuePairsFromString(r,"|","::")),n)i[o]=n[o]}i.ani=t.ani,i.dnis=t.dnis,i.uii=t.uii;try{t.queue.number?(i.sourceId=t.queue.number||"",i.sourceName=t.queue.name||"",i.sourceDesc=t.queue.description||"","1"===t.queue.isCampaign||!0===t.queue.isCampaign?i.sourceType="OUTBOUND":i.sourceType="INBOUND"):(i.sourceId="0",i.sourceType="MANUAL",i.sourceName="",i.sourceDesc="")}catch(e){console.error("There was an error processing source tokenization",+e)}try{i.agentFirstName=s.agentSettings.firstName,i.agentLastName=s.agentSettings.lastName,i.agentExternalId=s.agentSettings.externalAgentId,i.agentType=s.agentSettings.agentType,i.agentEmail=s.agentSettings.email,i.agentUserName=s.agentSettings.username}catch(e){console.error("There was an error parsing tokens for agent info. ",e)}return i}(s,i),i.baggage=t.callTokens,i.isMonitoring?t.agentSettings.callState="ACTIVE-MONITORING":(t.agentSettings.callState="ACTIVE",i.baggage&&""!=i.baggage.auxPhone&&(t.transferNumber=i.baggage.auxPhone)),t.agentDailyStats.currCallTime=0,t.currentCall=i,i};var T=function(){};T.prototype.processResponse=function(e){var t={};return t.agentId=Qe.getText(e.ui_notification,"agent_id"),t.uii=Qe.getText(e.ui_notification,"uii"),t.status="true"===Qe.getText(e.ui_notification,"status"),t};var m=function(){};m.prototype.processResponse=function(e){var t={};return t.agentId=Qe.getText(e.ui_notification,"agent_id"),t.status=Qe.getText(e.ui_notification,"status"),t};var S=function(){};S.prototype.processResponse=function(e){var t=e.ui_notification;return Ke.getInstance().agentSettings.onManualOutdial=!0,{callType:t["@call_type"],messageId:t["@message_id"],requestId:Qe.getText(t,"request_id"),leadState:Qe.getText(t,"lead_state"),callback:Qe.getText(t,"callback")}};var _=function(){};_.prototype.processResponse=function(e){var t=e.ui_notification,s=Ke.getInstance();return s.tokens.first_name=Qe.getText(t,"first_name"),s.tokens.mid_name=Qe.getText(t,"mid_name"),s.tokens.last_name=Qe.getText(t,"last_name"),s.tokens.address1=Qe.getText(t,"address1"),s.tokens.address2=Qe.getText(t,"address2"),s.tokens.suffix=Qe.getText(t,"suffix"),s.tokens.title=Qe.getText(t,"title"),s.tokens.city=Qe.getText(t,"city"),s.tokens.state=Qe.getText(t,"state"),s.tokens.zip=Qe.getText(t,"zip"),s.tokens.business_name=Qe.getText(t,"business_name"),s.tokens};var E=function(){};E.prototype.processResponse=function(e){var t=e.ui_notification;return{callType:t["@call_type"],messageId:t["@message_id"],requestId:Qe.getText(t,"request_id"),leadState:Qe.getText(t,"lead_state"),callback:Qe.getText(t,"callback")}};var I=function(e,t,s,i){this.audioType=e||"FULL",this.agentId=t,this.uii=s,this.monitorAgentId=i};I.prototype.processResponse=function(e){var t=e.ui_response,s=Qe.buildDefaultResponse(e);return s.type=Qe.getText(t,"type"),"OK"===s.status?Qe.logMessage(Xe.DEBUG,s.message,e):Qe.logMessage(Xe.WARN,s.message+": "+s.detail,e),s};var v=function(e,t){"ON-BREAK"==e.toUpperCase()&&1==Ke.getInstance().onCall?(this.agentState="BREAK-AFTER-CALL",this.agentAuxState=""):(this.agentState=e.toUpperCase()||"",this.agentAuxState=t||"")};v.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":et.AGENT_STATE,"@message_id":Qe.getMessageId(),response_to:"",agent_id:{"#text":Ke.getInstance().agentSettings.agentId},state:{"#text":this.agentState},agent_aux_state:{"#text":this.agentAuxState}}};return JSON.stringify(e)},v.prototype.processResponse=function(e){var t=e.ui_response,s=Qe.getText(t,"status"),i=Qe.getText(t,"prev_state"),n=Qe.getText(t,"current_state"),r=Qe.getText(t,"prev_aux_state"),o=Qe.getText(t,"agent_aux_state"),a=Ke.getInstance(),c=Qe.buildDefaultResponse(e);if(c.agentId=e.ui_response.agent_id["#text"]||"",c.previousState=i,c.currentState=n,c.previousAuxState=r,c.currentAuxState=o,"OK"==s){r.length>0&&r,o.length>0&&o,a.agentSettings.currentState=n,a.agentSettings.currentStateLabel=o,a.agentStatePacket=e}else{""===c.message&&(c.message="Unable to change agent state");var u="Unable to change agent state. "+c.detail;Qe.logMessage(Xe.WARN,u,e)}return c};var R=function(e){this.username=e.username,this.password=e.password,this.platformId=e.platformId,this.rcAccessToken=e.rcAccessToken,this.tokenType=e.tokenType,this.engageAccessToken=e.engageAccessToken,this.authType=e.authType};function C(e,t,s){var i=Ke.getInstance(),n=i.authHost+i.baseAuthUri,r={headers:{"Content-Type":"application/json"}};switch(e){case Ze.USERNAME_PASSWORD:case Ze.RC_TOKEN:r.queryParams=s;var o="Error on agent authenticate POST to engage-auth. URL: "+n+t;new Ve(n).httpPost(t,r).then((function(e){try{e=JSON.parse(e.response);var t=Ke.getInstance().authenticateRequest.processResponse(e);Qe.fireCallback(Ke.getInstance().libraryInstance,ze.AUTHENTICATE,t)}catch(e){Qe.logMessage(Xe.WARN,o,e)}}),(function(e){var t={type:"Authenticate Error",message:o};Qe.logMessage(Xe.WARN,o,e),Qe.fireCallback(Ke.getInstance().libraryInstance,ze.AUTHENTICATE,t)}));break;case Ze.ENGAGE_TOKEN:var a="Error on agent authenticate GET to engage-auth. URL: "+n+t;r.headers.Authorization="Bearer "+Qe.toString(Ke.getInstance().authenticateRequest.engageAccessToken),new Ve(n).httpGet(t,r).then((function(e){try{e=JSON.parse(e.response);var t=Ke.getInstance().authenticateRequest.processResponse(e);Qe.fireCallback(Ke.getInstance().libraryInstance,ze.AUTHENTICATE,t)}catch(e){Qe.logMessage(Xe.WARN,a,e)}}),(function(e){Qe.logMessage(Xe.WARN,a,e),Qe.fireCallback(Ke.getInstance().libraryInstance,ze.AUTHENTICATE,e)}))}}R.prototype.sendHttpRequest=function(){switch(Ke.getInstance().authenticateRequest=this,this.authType){case Ze.USERNAME_PASSWORD:C(this.authType,"login/agent",{username:this.username,password:this.password,platformId:this.platformId});break;case Ze.RC_TOKEN:C(this.authType,"login/rc/accesstoken",{rcAccessToken:this.rcAccessToken,rcTokenType:this.tokenType});break;case Ze.ENGAGE_TOKEN:C(this.authType,"login",{})}},R.prototype.processResponse=function(e){var t=Ke.getInstance();return t.authenticatePacket=e,t.authenticateRequest.accessToken=e.accessToken,t.authenticateRequest.refreshToken=e.refreshToken,t.authenticateRequest.tokenType=e.tokenType,t.authenticateRequest.socketUrl=e.iqUrl,t.authenticateRequest.socketPort=e.port,t.authenticateRequest.agents=e.agentDetails,t.authenticateRequest.platformId=e.platformId,t.authenticateRequest};var A=function(e,t,s,i){this.audioType=e||"FULL",this.agentId=t,this.uii=s,this.monitorAgentId=i};A.prototype.formatJSON=function(){Ke.getInstance();var e={ui_request:{"@destination":"IQ","@type":et.BARGE_IN,"@message_id":Qe.getMessageId(),"@response_to":"",agent_id:{"#text":Qe.toString(this.agentId)},uii:{"#text":Qe.toString(this.uii)},audio_state:{"#text":Qe.toString(this.audioType)},monitor_agent_id:{"#text":Qe.toString(this.monitorAgentId)}}};return JSON.stringify(e)},A.prototype.processResponse=function(e){var t=e.ui_response,s=Qe.buildDefaultResponse(e);return s.agentId=Qe.getText(t,"agent_id"),s.uii=Qe.getText(t,"uii"),"OK"===s.status?Qe.logMessage(Xe.DEBUG,s.message,e):Qe.logMessage(Xe.WARN,"There was an error processing the Barge-In request. "+s.detail,e),s};var y=function(e){this.notes=e};y.prototype.formatJSON=function(){var e=Ke.getInstance(),t={ui_request:{"@destination":"IQ","@message_id":Qe.getMessageId(),response_to:"","@type":et.CALL_NOTES,agent_id:{"#text":Qe.toString(e.agentSettings.agentId)},uii:{"#text":Qe.toString(e.currentCall.uii)},notes:{"#text":Qe.toString(this.notes)}}};return JSON.stringify(t)},y.prototype.processResponse=function(e){var t=Qe.buildDefaultResponse(e);return"OK"===t.status?(t.message="Call notes have been updated.",t.type="INFO_EVENT"):(t.type="ERROR_EVENT",t.message="Unable to update notes."),t};var b=function(e,t){this.agentId=t||Ke.getInstance().agentSettings.agentId,this.leadId=e};b.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":et.CALLBACK_CANCEL,"@message_id":Qe.getMessageId(),response_to:"",agent_id:{"#text":this.agentId},lead_id:{"#text":this.leadId}}};return JSON.stringify(e)};var N=function(e){this.agentId=e||Ke.getInstance().agentSettings.agentId};function D(e){return{auxData1:e["@aux_data1"],auxData2:e["@aux_data2"],auxData3:e["@aux_data3"],auxData4:e["@aux_data4"],auxData5:e["@aux_data5"],destination:e["@destination"],dialGroupId:e["@dial_group_id"],dialGroupName:e["@dial_group_name"],dialTime:e["@dial_time"],externId:e["@extern_id"],leadId:e["@lead_id"],firstName:Qe.getText(e,"first_name"),midName:Qe.getText(e,"mid_name"),lastName:Qe.getText(e,"last_name"),sufix:Qe.getText(e,"suffix"),title:Qe.getText(e,"title"),address1:Qe.getText(e,"address1"),address2:Qe.getText(e,"address2"),city:Qe.getText(e,"city"),state:Qe.getText(e,"state"),zip:Qe.getText(e,"zip"),gateKeeper:Qe.getText(e,"gate_keeper")}}N.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":et.CALLBACK_PENDING,"@message_id":Qe.getMessageId(),response_to:"",agent_id:{"#text":this.agentId}}};return JSON.stringify(e)},N.prototype.processResponse=function(e){var t=e.ui_response.lead,s=[];Array.isArray(t)||(t=[t]);for(var i=0;i<t.length;i++){var n=t[i];null!=n&&s.push(D(n))}return Ke.getInstance().agentSettings.pendingCallbacks=JSON.parse(JSON.stringify(s)),Ke.getInstance().agentSettings.pendingCallbacks};var O=function(e){this.agentId=Ke.getInstance().agentSettings.agentId,this.campaignId=e};O.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":et.CAMPAIGN_DISPOSITIONS,"@message_id":Qe.getMessageId(),response_to:"",agent_id:{"#text":Qe.toString(this.agentId)},campaign_id:{"#text":Qe.toString(this.campaignId)}}};return JSON.stringify(e)},O.prototype.processResponse=function(e){var t=e.ui_response,s=Ke.getInstance(),i=Qe.processResponseCollection(t,"outdial_dispositions","disposition","disposition");return s.outboundSettings.campaignDispositions=i,i};var w=function(e){this.chatState=e&&e.toUpperCase()||""};w.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":et.CHAT_STATE,"@message_id":Qe.getMessageId(),response_to:"",agent_id:{"#text":Ke.getInstance().agentSettings.agentId},state:{"#text":this.chatState}}};return JSON.stringify(e)},w.prototype.processResponse=function(e){var t=e.ui_response,s=Qe.getText(t,"status"),i=Qe.getText(t,"prev_state"),n=Qe.getText(t,"current_state"),r=Ke.getInstance(),o=Qe.buildDefaultResponse(e);if(o.agentId=e.ui_response.agent_id["#text"]||"",o.previousState=i,o.currentState=n,"OK"==s)r.agentSettings.currentChatState=n,r.chatStatePacket=e;else{""===o.message&&(o.message="Unable to change chat state");var a="Unable to change chat state. "+o.detail;Qe.logMessage(Xe.WARN,a,e)}return o};var x=function(e,t,s,i){this.dialDest=e,this.callerId=t||"",this.sipHeaders=s||[],this.countryId=i||""};x.prototype.formatJSON=function(){for(var e=[],t=0;t<this.sipHeaders.length;t++){var s=this.sipHeaders[t];e.push({"@name":Qe.toString(s.name),"@value":Qe.toString(s.value)})}var i={ui_request:{"@destination":"IQ","@type":et.XFER_COLD,"@message_id":Qe.getMessageId(),"@response_to":"",agent_id:{"#text":Ke.getInstance().agentSettings.agentId},uii:{"#text":Ke.getInstance().currentCall.uii},dial_dest:{"#text":Qe.toString(this.dialDest)},caller_id:{"#text":Qe.toString(this.callerId)},country_id:{"#text":Qe.toString(this.countryId)},xfer_header:e}};return JSON.stringify(i)},x.prototype.processResponse=function(e){var t=e.ui_response,s=Qe.buildDefaultResponse(e);if(s.agentId=Qe.getText(t,"agent_id"),s.uii=Qe.getText(t,"uii"),s.sessionId=Qe.getText(t,"session_id"),s.dialDest=Qe.getText(t,"dial_dest"),"OK"===s.status);else{var i="There was an error processing the Cold Xfer request. "+s.message+" : "+s.detail;Qe.logMessage(Xe.WARN,i,e)}return s};var U=function(e,t,s){this.targetAgentId=e,this.transferType=t,this.uii=s||Ke.getInstance().currentCall.uii};U.prototype.formatJSON=function(){var e=Ke.getInstance(),t={ui_request:{"@destination":"IQ","@type":et.DIRECT_AGENT_TRANSFER,"@message_id":Qe.getMessageId(),"@response_to":"",agent_id:{"#text":Qe.toString(e.agentSettings.agentId)},uii:{"#text":Qe.toString(this.uii)},target_agent_id:{"#text":Qe.toString(this.targetAgentId)},transfer_type:{"#text":Qe.toString(this.transferType)}}};return JSON.stringify(t)},U.prototype.processResponse=function(e){var t=e.ui_response,s=Qe.buildDefaultResponse(e);if(s.type=Qe.getText(t,"type"),"OK"!==s.status){var i="There was an error processing the Direct Agent Transfer request. "+s.message+" : "+s.detail;Qe.logMessage(Xe.WARN,i,e)}return s};var q=function(){};q.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":et.DIRECT_AGENT_TRANSFER_LIST,"@message_id":Qe.getMessageId(),"@response_to":"",agent_id:{"#text":Ke.getInstance().agentSettings.agentId}}};return JSON.stringify(e)},q.prototype.processResponse=function(e){var t=Qe.buildDefaultResponse(e);if(t.agents=Qe.processResponseCollection(e,"ui_response","agents"),"OK"!==t.status){var s="There was an error processing the Direct Agent Transfer List request. "+t.message+" : "+t.detail;Qe.logMessage(Xe.WARN,s,e)}return t};var P=function(e,t,s,i,n,r,o,a,c,u){this.uii=e,this.dispId=t,this.notes=s,this.callback=i,this.callbackDTS=n||"",this.contactForwardNumber=r||null,this.externId=a||null,this.leadId=c||null,this.requestId=u||null,this.survey=o||null};P.prototype.formatJSON=function(){var e=Ke.getInstance(),t={ui_request:{"@destination":"IQ","@message_id":Qe.getMessageId(),"@response_to":"","@type":et.OUTDIAL_DISPOSITION,agent_id:{"#text":Qe.toString(e.agentSettings.agentId)},session_id:{"#text":""},uii:{"#text":Qe.toString(this.uii)},disposition_id:{"#text":Qe.toString(this.dispId)},notes:{"#text":Qe.toString(this.notes)},call_back:{"#text":!0===this.callback?"TRUE":"FALSE"},call_back_DTS:{"#text":Qe.toString(this.callbackDTS)},contact_forwarding:{"#text":Qe.toString(this.contactForwardNumber)},outbound_externid:{"#text":Qe.toString(this.externId)},lead_id:{"#text":Qe.toString(this.leadId)},pending_request_id:{"#text":Qe.toString(this.requestId)}}};if(e.currentCall.outdialDispositions&&"GATE"===e.currentCall.outdialDispositions.type&&(t.ui_request["@type"]=et.INBOUND_DISPOSITION),e.currentCall.sessionId&&(t.ui_request.session_id={"#text":e.currentCall.sessionId}),null!==this.survey){for(var s=[],i=Object.keys(this.survey),n=0;n<i.length;n++){var r=i[n],o={"@extern_id":r,"@lead_update_column":Qe.toString(this.survey[r].leadField),"#text":Qe.toString(this.survey[r].value)};s.push(o)}t.ui_request.survey={response:s}}return JSON.stringify(t)};var H=function(e,t,s,i,n,r,o){this.dispId=e,this.notes=t,this.callback=s,this.callbackDTS=i||"",this.leadId=n||null,this.requestId=r||null,this.externId=o||null};H.prototype.formatJSON=function(){var e=Ke.getInstance(),t={ui_request:{"@destination":"IQ","@message_id":Qe.getMessageId(),"@response_to":"","@type":et.OUTDIAL_DISPOSITION,manual_disp:{"#text":"TRUE"},agent_id:{"#text":Qe.toString(e.agentSettings.agentId)},request_key:{"#text":Qe.toString(this.requestId)},disposition_id:{"#text":Qe.toString(this.dispId)},notes:{"#text":Qe.toString(this.notes)},call_back:{"#text":!0===this.callback?"TRUE":"FALSE"},call_back_DTS:{"#text":Qe.toString(this.callbackDTS)},lead_id:{"#text":Qe.toString(this.leadId)},extern_id:{"#text":Qe.toString(this.externId)},contact_forwarding:{"#text":"null"},session_id:{},uii:{}}};return JSON.stringify(t)};var k=function(){};k.prototype.getExtensionPresenceInfo=function(e){Ke.getInstance().ExtensionPresenceRequest=this,function(e,t){var s=Ke.getInstance(),i=s.authHost+s.baseApiUri,n="Bearer "+Qe.toString(Ke.getInstance().authenticateRequest.engageAccessToken),r={headers:{"Content-Type":"application/json"}};r.headers.Authorization=n,r.queryParams=t;var o="Error while fetching extension presence response. URL: "+i+e;new Ve(i).httpGet(e,r).then((function(e){try{e=JSON.parse(e.response);var t=Ke.getInstance().extensionPresenceRequest.processResponse(e);Qe.fireCallback(Ke.getInstance().libraryInstance,ze.EXTENSION_PRESENCE,t)}catch(e){Qe.logMessage(Xe.WARN,o,e)}}),(function(e){var t={type:"Error while fetching extension presence response.",message:o};Qe.logMessage(Xe.WARN,o,e),Qe.fireCallback(Ke.getInstance().libraryInstance,ze.EXTENSION_PRESENCE,t)}))}("rcdirectory/getExtensionPresenceStatus",{extensionIds:e})},k.prototype.processResponse=function(e){return Ke.getInstance().extensionPresenceResponse=e,Ke.getInstance().extensionPresenceResponse};var $=function(e,t){this.sessionId=e||null,this.resetPendingDisp=t||!1};$.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":et.HANGUP,"@message_id":Qe.getMessageId(),response_to:"",agent_id:{"#text":Qe.toString(Ke.getInstance().agentSettings.agentId)},uii:{"#text":Qe.toString(Ke.getInstance().currentCall.uii)},session_id:{"#text":Qe.toString(null===this.sessionId?Ke.getInstance().currentCall.sessionId:this.sessionId)},cancel_pending_disp:{"#text":!0===this.resetPendingDisp?"TRUE":"FALSE"}}};return JSON.stringify(e)};var L=function(e,t){this.holdState=e,this.sessionId=t||"1"};L.prototype.formatJSON=function(){var e=Ke.getInstance(),t={ui_request:{"@destination":"IQ","@type":et.HOLD,"@message_id":Qe.getMessageId(),"@response_to":"",agent_id:{"#text":Qe.toString(e.currentCall.agentId)},uii:{"#text":Qe.toString(e.currentCall.uii)},session_id:{"#text":Qe.toString(this.sessionId)},hold_state:{"#text":!0===this.holdState||"true"===this.holdState?"ON":"OFF"}}};return JSON.stringify(t)},L.prototype.processResponse=function(e){var t=e.ui_response,s=Qe.buildDefaultResponse(e),i="";Ke.getInstance().currentCall.uii&&(i=Ke.getInstance().currentCall.uii),s.holdState="ON"===Qe.getText(t,"hold_state"),s.sessionId=Qe.getText(t,"session_id"),s.uii=Qe.getText(t,"uii"),"OK"===s.status?s.uii===i?(""===s.message&&(s.message="Broadcasting new hold state of "+s.holdState),Qe.logMessage(Xe.DEBUG,"Broadcasting new hold state of "+s.holdState,e)):Qe.logMessage(Xe.DEBUG,"Hold Response is for a different call...discarding",e):(""===s.message&&(s.message="Error processing HOLD request. "+ +s.message+"\n"+s.detail),Qe.logMessage(Xe.WARN,"Error processing HOLD request. "+s.detail,e));var n=Ke.getInstance();return"1"!==s.sessionId&&n.transferSessions[s.sessionId]&&(n.transferSessions[s.sessionId].onHold=s.holdState),s};var M=function(e){this.leadId=e};M.prototype.formatJSON=function(){var e=Ke.getInstance(),t={ui_request:{"@destination":"IQ","@type":et.LEAD_HISTORY,"@message_id":Qe.getMessageId(),"@response_to":"",agent_id:{"#text":Qe.toString(e.agentSettings.agentId)},lead_id:{"#text":Qe.toString(this.leadId)}}};return JSON.stringify(t)},M.prototype.processResponse=function(e){var t={leadId:e.ui_response["@lead_id"]},s=Qe.processResponseCollection(e,"ui_response","previous_dial");return Array.isArray(s)||(s=[s]),t.leadHistory=s,t};var G=function(e){e.agent_reserved&&!0===e.agent_reserved?e.agent_reserved="1":e.agent_reserved="0",e.dialable&&!0===e.dialable?e.dialable="1":e.dialable="0",this.dataObj=e};G.prototype.formatJSON=function(){Ke.getInstance();var e={ui_request:{"@destination":"IQ","@type":et.LEAD_INSERT,"@message_id":Qe.getMessageId(),"@response_to":"",agent_id:{"#text":Qe.toString(this.dataObj.agent_id)},campaign_id:{"#text":Qe.toString(this.dataObj.campaign_id)},lead_phone:{"#text":Qe.toString(this.dataObj.lead_phone)},dialable:{"#text":Qe.toString(this.dataObj.dialable)},agent_reserved:{"#text":Qe.toString(this.dataObj.agent_reserved)},call_back_dts:{"#text":Qe.toString(this.dataObj.callback_dts)},first_name:{"#text":Qe.toString(this.dataObj.first_name)},mid_name:{"#text":Qe.toString(this.dataObj.mid_name)},last_name:{"#text":Qe.toString(this.dataObj.last_name)},suffix:{"#text":Qe.toString(this.dataObj.suffix)},title:{"#text":Qe.toString(this.dataObj.title)},address1:{"#text":Qe.toString(this.dataObj.address1)},address2:{"#text":Qe.toString(this.dataObj.address2)},city:{"#text":Qe.toString(this.dataObj.city)},state:{"#text":Qe.toString(this.dataObj.state)},zip:{"#text":Qe.toString(this.dataObj.zip)},email:{"#text":Qe.toString(this.dataObj.email)},gate_keeper:{"#text":Qe.toString(this.dataObj.gate_keeper)},aux_data1:{"#text":Qe.toString(this.dataObj.aux_data1)},aux_data2:{"#text":Qe.toString(this.dataObj.aux_data2)},aux_data3:{"#text":Qe.toString(this.dataObj.aux_data3)},aux_data4:{"#text":Qe.toString(this.dataObj.aux_data4)},aux_data5:{"#text":Qe.toString(this.dataObj.aux_data5)}}};return JSON.stringify(e)},G.prototype.processResponse=function(e){var t=e.ui_response,s=Qe.buildDefaultResponse(e);return s.message=t.msg["#text"],s};var F=function(e,t,s){this.leadId=e,this.leadPhone=t,this.baggage=s,this.agentId=Qe.toString(Ke.getInstance().agentSettings.agentId)};F.prototype.formatJSON=function(){this.baggage=_formatBaggage(this.baggage);var e={ui_request:{"@destination":"IQ","@type":et.LEAD_UPDATE,"@message_id":Qe.getMessageId(),"@response_to":"",agent_id:{"#text":this.agentId},lead_id:{"#text":Qe.toString(this.leadId)},lead_phone:{"#text":Qe.toString(this.leadPhone)},baggage:this.baggage}};return JSON.stringify(e)},F.prototype.processResponse=function(e){var t=e.ui_response,s=Qe.buildDefaultResponse(e);return s.message=t.msg["#text"],s},_formatBaggage=function(e){var t={};return t.first_name={"#text":e.first_name||""},t.mid_name={"#text":e.mid_name||""},t.last_name={"#text":e.last_name||""},t.suffix={"#text":e.suffix||""},t.title={"#text":e.title||""},t.address1={"#text":e.address1||""},t.address2={"#text":e.address2||""},t.city={"#text":e.city||""},t.state={"#text":e.state||""},t.zip={"#text":e.zip||""},t.email={"#text":e.email||""},t.gate_keeper={"#text":e.gate_keeper||""},t.extern_id={"#text":e.extern_id||""},t.aux_data1={"#text":e.aux_data1||""},t.aux_data2={"#text":e.aux_data2||""},t.aux_data3={"#text":e.aux_data3||""},t.aux_data4={"#text":e.aux_data4||""},t.aux_data5={"#text":e.aux_data5||""},t};var B=function(e,t,s,i,n,r,o){this.queueIds=t||[],this.chatIds=s||[],this.skillProfileId=i||"",this.dialGroupId=n||"",this.dialDest=e||"",this.updateFromAdminUI=r||!1,this.loginType="NO-SELECTION",this.updateLogin=!1,this.isForce=o;var a=Ke.getInstance();this.queueIds=Qe.checkExistingIds(a.inboundSettings.availableQueues,this.queueIds,"gateId"),this.chatIds=Qe.checkExistingIds(a.chatSettings.availableChatQueues,this.chatIds,"chatQueueId"),this.skillProfileId=Qe.checkExistingIds(a.inboundSettings.availableSkillProfiles,[this.skillProfileId],"profileId")[0]||"",this.dialGroupId=Qe.checkExistingIds(a.outboundSettings.availableOutdialGroups,[this.dialGroupId],"dialGroupId")[0]||"",this.queueIds.length>0&&""!==this.dialGroupId?this.loginType="BLENDED":this.queueIds.length>0?this.loginType="INBOUND":""!==this.dialGroupId?this.loginType="OUTBOUND":this.chatIds.length>0?this.loginType="CHAT":this.loginType="NO-SELECTION",a.agentSettings.isLoggedIn&&(this.updateLogin=!0,this.dialDest=Ke.getInstance().agentSettings.dialDest),Qe.validateDest(this.dialDest)||Qe.logMessage(Xe.WARN,"dialDest ["+this.dialDest+"] must be a valid sip or 10-digit DID","")};function j(e){var t=Ke.getInstance(),s=t.outboundSettings.availableOutdialGroups;t.outboundSettings.outdialGroup={};for(var i=0;i<s.length;i++){var n=s[i];n.dialGroupId===e.ui_response.outdial_group_id["#text"]&&(t.agentPermissions.allowLeadSearch=n.allowLeadSearch,t.agentPermissions.allowPreviewLeadFilters=n.allowPreviewLeadFilters,t.agentPermissions.progressiveEnabled=n.progressiveEnabled,t.outboundSettings.outdialGroup=JSON.parse(JSON.stringify(n)),t.agentPermissions.requireFetchedLeadsCalled=n.requireFetchedLeadsCalled)}}function W(e){var t=Ke.getInstance();t.inboundSettings.skillProfile={};for(var s=t.inboundSettings.availableSkillProfiles,i=0;i<s.length;i++){var n=s[i],r=Qe.getText(e.ui_response,"skill_profile_id");n.profileId===r&&(t.inboundSettings.skillProfile=JSON.parse(JSON.stringify(n)))}}function K(e){var t=Ke.getInstance(),s=t.inboundSettings.availableQueues,i=[],n=[],r=e.ui_response.gates.gate_id||[];Array.isArray(r)||(r=[r]);for(var o=0;o<r.length;o++){var a=r[o];i.push(a["#text"])}for(var c=0;c<s.length;c++){var u=s[c];i.indexOf(u.gateId)>-1&&n.push(u)}t.inboundSettings.queues=JSON.parse(JSON.stringify(n))}function J(e){var t=Ke.getInstance(),s=t.chatSettings.availableChatQueues,i=[],n=[],r=(e.ui_response.chat_queues||{}).chat_queue_id||[];Array.isArray(r)||(r=[r]);for(var o=0;o<r.length;o++){var a=r[o];i.push(a["#text"])}for(var c=0;c<s.length;c++){var u=s[c];i.indexOf(u.chatQueueId)>-1&&n.push(u)}t.chatSettings.chatQueues=JSON.parse(JSON.stringify(n))}B.prototype.formatJSON=function(){for(var e={ui_request:{"@destination":"IQ","@type":et.LOGIN,"@message_id":Qe.getMessageId(),response_to:"",agent_id:{"#text":Qe.toString(Ke.getInstance().agentSettings.agentId)},access_token:{"#text":Ke.getInstance().authenticateRequest.accessToken},hash_code:{"#text":Ke.getInstance().connectionSettings.hashCode},allow_multisocket:{"#text":Qe.toString(Ke.getInstance().applicationSettings.allowMultiSocket)},dial_dest:{"#text":Qe.toString(this.dialDest)},login_type:{"#text":this.loginType},update_login:{"#text":Qe.toString(this.updateLogin)},outdial_group_id:{"#text":Qe.toString(this.dialGroupId)},skill_profile_id:{"#text":Qe.toString(this.skillProfileId)},update_from_adminui:{"#text":Qe.toString(this.updateFromAdminUI)},agent_platform_id:{"#text":Qe.toString(2)},is_force:{"#text":Qe.toString(this.isForce)}}},t=[],s=0;s<this.queueIds.length;s++)""!==this.queueIds[s]&&t.push({"#text":Qe.toString(this.queueIds[s])});t.length>0?e.ui_request.gates={gate_id:t}:e.ui_request.gates={};var i=[];for(s=0;s<this.chatIds.length;s++)""!==this.chatIds[s]&&i.push({"#text":Qe.toString(this.chatIds[s])});return i.length>0?e.ui_request.chat_queues={chat_queue_id:i}:e.ui_request.chat_queues={},JSON.stringify(e)},B.prototype.processResponse=function(e){var t=e.ui_response,s=Qe.getText(t,"status"),i=Qe.getText(t,"detail"),n=Ke.getInstance(),r="",o=Qe.buildDefaultResponse(e),a=Ke.getInstance().libraryInstance;if("Logon Session Configuration Updated!"===i&&(n.agentSettings.updateLoginMode=!0,r="Logon Session Configuration Updated!",Qe.logMessage(Xe.INFO,r,e)),"SUCCESS"===s){if(n.agentSettings.isLoggedIn)if(n.agentSettings.updateLoginMode)n.agentSettings.dialDest=Qe.getText(t,"dial_dest"),n.agentSettings.loginType=Qe.getText(t,"login_type"),n.agentSettings.accountId=Qe.getText(t,"account_id"),n.agentSettings.updateLoginMode=!1,n.agentPermissions.allowLeadSearch=!1,n.agentPermissions.requireFetchedLeadsCalled=!1,n.agentPermissions.allowPreviewLeadFilters=!1,j(e),K(e),J(e),W(e);else{if(r="Processed a Layer 2 Reconnect Successfully",n.connectionSettings.isOnCall=Qe.getText(t,"is_on_call"),n.connectionSettings.activeCallUii=Qe.getText(t,"active_call_uii"),n.connectionSettings.isPendingDisp=Qe.getText(t,"is_pending_disp"),!1===n.connectionSettings.isOnCall){if(n.currentCall.uii){var c={ui_notification:{"@message_id":"","@type":"END-CALL",uii:{"#text":n.currentCall.uii},term_reason:{"#text":"SOCKET-DISCONNECT"}}};Qe.processNotification(a,c)}if(n.agentSettings.isOffhook){var u={ui_notification:{agent_id:{"#text":Ke.getInstance().agentSettings.agentId},"@type":"OFF-HOOK-TERM","@message_id":""}},h=Qe.processNotification(a,u);a.offhookTerm(h)}}else if(!n.connectionSettings.isOnCall||n.currentCall.uii===n.connectionSettings.activeCallUii&&!0!==a.waitingForAddSession){var l=a.getTransferSessions(),d=e.ui_response.active_call_sessions.call_session_id.map((function(e){return e["#text"]}));for(var p in l)-1===d.indexOf(p)&&delete Ke.getInstance().transferSessions[p]}else n.currentCall.uii=n.connectionSettings.activeCallUii,n.currentCall.pendingDisp=!1,a.hangup(1,!0);Qe.logMessage(Xe.INFO,r,e)}else n.loginPacket=e,n.agentSettings.isLoggedIn=!0,n.agentSettings.loginDTS=new Date,n.connectionSettings.reconnect=!0,n.agentPermissions.allowLeadSearch=!1,n.agentSettings.dialDest=Qe.getText(t,"dial_dest"),n.agentSettings.loginType=Qe.getText(t,"login_type"),n.agentSettings.accountId=Qe.getText(t,"account_id"),n.agentSettings.corporateDirectory=Qe.getText(t,"corporate_dir"),n.connectionSettings.isMultiSocket=Qe.getText(t,"is_multisocket"),j(e),K(e),J(e),W(e);n.connectionSettings.hashCode=Qe.getText(t,"hash_code")||n.connectionSettings.hashCode,n.agentSettings.guid=Qe.getText(t,"guid")||n.agentSettings.guid,n.dataStore.save("agent_id",Qe.getText(t,"agent_id")),n.dataStore.save("hash_code",Qe.getText(t,"hash_code")),o.agentSettings=n.agentSettings,o.agentPermissions=n.agentPermissions,o.applicationSettings=n.applicationSettings,o.chatSettings=n.chatSettings,o.connectionSettings=n.connectionSettings,o.inboundSettings=n.inboundSettings,o.outboundSettings=n.outboundSettings,o.scriptSettings=n.scriptSettings}else""===o.message&&(o.message="Agent configuration attempt failed (2nd layer login)"),Qe.logMessage(Xe.WARN,o.message,e);return o};var V=function(){};function Y(e){var t=e["@campaign_id"],s=e["@allow_lead_updates"];Ke.getInstance().agentPermissions.allowLeadUpdatesByCampaign[t]=s;var i=e.custom_labels,n=[];for(var r in i){var o={};o[r.replace(/@/,"")]=i[r],n.push(o)}return{campaignId:t,campaignName:e["@campaign_name"],surveyId:e["@survey_id"],surveyName:e["@survey_name"],customLabels:n,allowLeadUpdates:s}}V.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":et.LOGIN_PHASE_1,"@message_id":Qe.getMessageId(),response_to:"",reconnect:{"#text":Qe.toString(Ke.getInstance().connectionSettings.reconnect)},agent_id:{"#text":Qe.toString(Ke.getInstance().agentSettings.agentId)},access_token:{"#text":Qe.toString(Ke.getInstance().authenticateRequest.accessToken)}}};return JSON.stringify(e)},V.prototype.processResponse=function(e){var t=e.ui_response,s=Qe.getText(t,"status"),i=Ke.getInstance(),n=Qe.buildDefaultResponse(e);if("OK"===s&&!i.applicationSettings.isLoggedInIS){i.loginPhase1Packet=e,i.applicationSettings.isLoggedInIS=!0,i.applicationSettings.isSso=Qe.getText(t,"is_sso"),i.applicationSettings.isTcpaSafeMode="1"===Qe.getText(t,"tcpa_safe_mode"),i.applicationSettings.pciEnabled="1"===Qe.getText(t,"pci_enabled"),i.chatSettings.alias=Qe.getText(t,"first_name")+" "+Qe.getText(t,"last_name"),i.agentSettings.loginDTS=new Date,i.agentSettings.maxBreakTime=Qe.getText(t,"max_break_time"),i.agentSettings.maxLunchTime=Qe.getText(t,"max_lunch_time"),i.agentSettings.firstName=Qe.getText(t,"first_name"),i.agentSettings.lastName=Qe.getText(t,"last_name"),i.agentSettings.email=Qe.getText(t,"email"),i.agentSettings.agentId=Qe.getText(t,"agent_id"),i.agentSettings.externalAgentId=Qe.getText(t,"external_agent_id"),i.agentSettings.agentType=Qe.getText(t,"agent_type"),i.agentSettings.realAgentType=Qe.getText(t,"real_agent_type"),i.agentSettings.defaultLoginDest=Qe.getText(t,"default_login_dest"),i.agentSettings.altDefaultLoginDest=Qe.getText(t,"alt_default_login_dest"),i.agentSettings.initLoginState=Qe.getText(t,"init_login_state"),i.agentSettings.initLoginStateLabel=Qe.getText(t,"init_login_state_label"),i.agentSettings.outboundManualDefaultRingtime=Qe.getText(t,"outbound_manual_default_ringtime"),i.agentSettings.isOutboundPrepay="1"===Qe.getText(t,"outbound_prepay"),i.agentSettings.phoneLoginPin=Qe.getText(t,"phone_login_pin"),i.agentSettings.username=Qe.getText(t,"username"),i.agentSettings.agentPassword=Qe.getText(t,"agent_pwd"),i.agentPermissions.allowCallControl="1"===Qe.getText(t,"allow_call_control"),i.agentPermissions.allowChat="1"===Qe.getText(t,"allow_chat"),i.agentPermissions.showLeadHistory="1"===Qe.getText(t,"show_lead_history"),i.agentPermissions.allowManualOutboundGates="1"===Qe.getText(t,"allow_manual_outbound_gates"),i.agentPermissions.allowOffHook="1"===Qe.getText(t,"allow_off_hook"),i.agentPermissions.allowManualCalls="1"===Qe.getText(t,"allow_manual_calls"),i.agentPermissions.allowManualPass="1"===Qe.getText(t,"allow_manual_pass"),i.agentPermissions.allowManualIntlCalls="1"===Qe.getText(t,"allow_manual_intl_calls"),i.agentPermissions.allowLoginUpdates="1"===Qe.getText(t,"allow_login_updates"),i.agentPermissions.allowInbound="1"===Qe.getText(t,"allow_inbound"),i.agentPermissions.allowOutbound="1"===Qe.getText(t,"allow_outbound"),i.agentPermissions.allowBlended="1"===Qe.getText(t,"allow_blended"),i.agentPermissions.allowLoginControl="1"===Qe.getText(t,"allow_login_control"),i.agentPermissions.allowCrossQueueRequeue="1"===Qe.getText(t,"allow_cross_gate_requeue"),i.agentPermissions.disableSupervisorMonitoring="1"===Qe.getText(t,"disable_supervisor_monitoring"),i.agentPermissions.allowAutoAnswer="1"===Qe.getText(t,"allow_auto_answer"),i.agentPermissions.defaultAutoAnswerOn="1"===Qe.getText(t,"default_auto_answer_on"),i.agentPermissions.allowHistoricalDialing="1"===Qe.getText(t,"allow_historical_dialing"),i.agentPermissions.allowAgentStats="1"===Qe.getText(t,"allow_agent_stats"),i.agentPermissions.allowCampaignStats="1"===Qe.getText(t,"allow_camp_stats"),i.agentPermissions.allowGateStats="1"===Qe.getText(t,"allow_gate_stats"),i.agentPermissions.allowChatStats="1"===Qe.getText(t,"allow_chat_stats"),i.agentPermissions.enableFolderMode="1"===Qe.getText(t,"enable_folder_mode"),i.agentPermissions.enableTaskMode="1"===Qe.getText(t,"enable_task_mode"),i.outboundSettings.defaultDialGroup=Qe.getText(t,"phone_login_dial_group"),e.ui_response.allow_lead_inserts&&void 0!==t.insert_campaigns&&e.ui_response.insert_campaigns.campaign&&(i.agentPermissions.allowLeadInserts="1"===Qe.getText(t,"allow_lead_inserts")),i.outboundSettings.availableCampaigns=function(e){var t=[],s=null;void 0!==e.ui_response.campaigns.campaign&&(s=e.ui_response.campaigns.campaign);if(s){Array.isArray(s)||(s=[s]);for(var i=0;i<s.length;i++)t.push(Y(s[i]))}return t}(e),i.chatSettings.availableChatQueues=Qe.processResponseCollection(e.ui_response,"login_chat_queues","chat_queue"),function(e,t){var s=e.availableChatQueues,i=t.ui_response.login_chat_queues.chat_queue;Array.isArray(i)||(i=[i]);for(var n=0;n<s.length;n++){for(var r=s[n],o={},a=0;a<i.length;a++){var c=i[a];if(c["@chat_queue_id"]===r.chatQueueId){o=c;break}}o.dnis&&(Array.isArray(o.dnis)||(o.dnis=[o.dnis]),r.dnis=o.dnis.map((function(e){return e["#text"]})))}}(i.chatSettings,e),i.chatSettings.availableChatRequeueQueues=Qe.processResponseCollection(e.ui_response,"chat_requeue_queues","chat_group"),i.inboundSettings.availableQueues=Qe.processResponseCollection(e.ui_response,"login_gates","gate"),i.inboundSettings.availableSkillProfiles=Qe.processResponseCollection(e.ui_response,"skill_profiles","profile"),i.inboundSettings.availableRequeueQueues=Qe.processResponseCollection(e.ui_response,"requeue_gates","gate_group"),i.chatSettings.availableChatRooms=Qe.processResponseCollection(e.ui_response,"chat_rooms","room"),i.scriptSettings.availableScripts=Qe.processResponseCollection(e.ui_response,"scripts","script"),i.agentSettings.callerIds=Qe.processResponseCollection(e.ui_response,"caller_ids","caller_id"),i.agentSettings.availableAgentStates=Qe.processResponseCollection(e.ui_response,"agent_states","agent_state"),i.applicationSettings.availableCountries=Qe.processResponseCollection(e.ui_response,"account_countries","country"),i.outboundSettings.insertCampaigns=Qe.processResponseCollection(e.ui_response,"insert_campaigns","campaign");for(var r=Qe.processResponseCollection(e.ui_response,"outdial_groups","group"),o=0;o<r.length;o++){var a=r[o];a.allowLeadSearch="YES"===a.allowLeadSearch,a.allowPreviewLeadFilters="1"===a.allowPreviewLeadFilters,a.progressiveEnabled="1"===a.progressiveEnabled,a.requireFetchedLeadsCalled="1"===a.requireFetchedLeadsCalled,a.hciType=parseInt(a.hciEnabled)||0,a.hciEnabled="1"===a.hciEnabled||"2"===a.hciEnabled,a.hciClicker="1"===a.hciClicker}i.outboundSettings.availableOutdialGroups=r}return n.agentSettings=i.agentSettings,n.agentPermissions=i.agentPermissions,n.applicationSettings=i.applicationSettings,n.chatSettings=i.chatSettings,n.connectionSettings=i.connectionSettings,n.inboundSettings=i.inboundSettings,n.outboundSettings=i.outboundSettings,n.scriptSettings=i.scriptSettings,n};var Q=function(e,t){this.agentId=e,this.message=t||""};Q.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":et.LOGOUT,"@message_id":Qe.getMessageId(),response_to:"",agent_id:{"#text":this.agentId},message:{"#text":this.message}}};return JSON.stringify(e)},Q.prototype.processResponse=function(e){return Qe.buildDefaultResponse(e)};var X=function(){};X.prototype.formatJSON=function(){var e=Ke.getInstance(),t={ui_request:{"@destination":"IQ","@type":et.LOGIN_MULTISOCKET,"@message_id":Qe.getMessageId(),response_to:"",agent_id:{"#text":e.dataStore.get("agent_id")},hash_code:{"#text":e.dataStore.get("hash_code")}}};return JSON.stringify(t)};var Z=function(){};Z.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":et.OFFHOOK_INIT,"@message_id":Qe.getMessageId(),response_to:"",agent_id:{"#text":Ke.getInstance().agentSettings.agentId},dial_dest:{"#text":Ke.getInstance().agentSettings.dialDest}}};return JSON.stringify(e)},Z.prototype.processResponse=function(e){var t=e.ui_response.status["#text"],s=Qe.buildDefaultResponse(e);if("OK"===t){var i=Qe.getText(e.ui_response,"monitoring");Ke.getInstance().offhookInitPacket=e,Ke.getInstance().agentSettings.isOffhook=!0,Ke.getInstance().agentSettings.isMonitoring=i,s.monitoring=i,Ke.getInstance().softphoneSettings.attemptingSoftphoneReconnect=!1}else""===s.message&&(s.message="Unable to process offhook request"),Qe.logMessage(Xe.WARN,s.message+" "+s.detail,e);return s};var z=function(){};z.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":et.OFFHOOK_TERM,"@message_id":Qe.getMessageId(),response_to:"",agent_id:{"#text":Ke.getInstance().agentSettings.agentId}}};return JSON.stringify(e)},z.prototype.processResponse=function(e){var t=e.ui_notification,s="1"===Qe.getText(t,"monitoring"),i=Ke.getInstance();return i.agentSettings.wasMonitoring=s,i.offhookTermPacket=e,i.agentSettings.isOffhook=!1,i.agentSettings.isMonitoring=!1,{status:"OK",agentId:Qe.getText(t,"agent_id"),startDts:Qe.getText(t,"start_dts"),endDts:Qe.getText(t,"end_dts"),monitoring:s}};var ee=function(e,t,s,i,n){this.destination=e,this.callerId=t,this.ringTime=s||"60",this.countryId=i||"USA",this.gateId=n||""};ee.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":et.ONE_TO_ONE_OUTDIAL,"@message_id":Qe.getMessageId(),response_to:"",agent_id:{"#text":Qe.toString(Ke.getInstance().agentSettings.agentId)},destination:{"#text":Qe.toString(this.destination)},ring_time:{"#text":Qe.toString(this.ringTime)},caller_id:{"#text":Qe.toString(this.callerId)},country_id:{"#text":Qe.toString(this.countryId)},gate_id:{"#text":Qe.toString(this.gateId)}}};return JSON.stringify(e)};var te=function(e){this.uii=e};te.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":et.ONE_TO_ONE_OUTDIAL_CANCEL,"@message_id":Qe.getMessageId(),response_to:"",agent_id:{"#text":Qe.toString(Ke.getInstance().agentSettings.agentId)},uii:{"#text":Qe.toString(this.uii)}}};return JSON.stringify(e)};var se=function(e){this.record=e};se.prototype.formatJSON=function(){var e=Ke.getInstance(),t="10";e.currentCall.agentRecording&&e.currentCall.agentRecording.pause&&(t=e.currentCall.agentRecording.pause);var s={ui_request:{"@destination":"IQ","@type":et.PAUSE_RECORD,"@message_id":Qe.getMessageId(),"@response_to":"",agent_id:{"#text":Qe.toString(e.currentCall.agentId)},uii:{"#text":Qe.toString(e.currentCall.uii)},record:{"#text":Qe.toString(!0===this.record?"TRUE":"FALSE")},pause:{"#text":Qe.toString(t)}}};return JSON.stringify(s)},se.prototype.processResponse=function(e){var t=e.ui_response,s=Qe.buildDefaultResponse(e),i="";return Ke.getInstance().currentCall.uii&&(i=Ke.getInstance().currentCall.uii),s.uii=Qe.getText(t,"uii"),s.state=Qe.getText(t,"state"),s.pause=Qe.getText(t,"pause"),"OK"===s.status?s.uii===i?(""===s.message&&(s.message="Broadcasting new record state of "+s.state),Qe.logMessage(Xe.DEBUG,"Broadcasting new record state of "+s.state,e)):Qe.logMessage(Xe.DEBUG,"Pause Record Response is for a different call...discarding",e):(""===s.message&&(s.message="Error processing PAUSE-RECORD request."+s.message+"\n"+s.detail),Qe.logMessage(Xe.WARN,s.message,e)),s};var ie=function(){};ie.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":et.PING_CALL,"@message_id":Qe.getMessageId(),"@response_to":"",agent_id:{"#text":Ke.getInstance().currentCall.agentId},uii:{"#text":Ke.getInstance().currentCall.uii}}};return JSON.stringify(e)};var ne=function(e,t,s,i){this.agentId=Ke.getInstance().agentSettings.agentId,this.searchFields=t||[],this.requestId=s||"",this.action=e||"",this.leadPhone=i||""};ne.prototype.formatJSON=function(){for(var e={},t=0;t<this.searchFields.length;t++){var s=this.searchFields[t];e[s.key]={"#text":Qe.toString(s.value)}}var i={ui_request:{"@destination":"IQ","@type":et.PREVIEW_DIAL,"@message_id":Qe.getMessageId(),"@action":this.action,"@response_to":"",agent_id:{"#text":Qe.toString(Ke.getInstance().agentSettings.agentId)},pending_request_id:{"#text":Qe.toString(this.requestId)},lead_phone:{"#text":Qe.toString(this.leadPhone)},search_fields:e}};return JSON.stringify(i)},ne.prototype.processResponse=function(e){for(var t=e.dialer_request,s=Ke.getInstance(),i=Qe.processResponseCollection(t,"destinations","lead"),n=0;n<i.length;n++){(c=i[n]).requestId=c.requestKey,c.ani=c.destination,Array.isArray(t.destinations.lead)||(t.destinations.lead=[t.destinations.lead]);try{var r=t.destinations.lead[n];if(r.extra_data)for(var o in r["@lead_id"]!==c.leadId&&(r=t.destinations.lead.filter((function(e){return e["@lead_id"]===c.leadId}))),delete c.extraDatas,c.extraData={},r.extra_data)c.extraData[o]=r.extra_data[o]["#text"]}catch(e){console.warn("error parsing lead extra data: "+e)}}var a={action:t["@action"],callbacks:"TRUE"===t["@callbacks"],dialGroupId:Qe.getText(t,"dial_group_id"),accountId:Qe.getText(t,"account_id"),agentId:Qe.getText(t,"agent_id"),isInsert:Qe.getText(t,"is_insert"),leads:i};if("TRUE"===t["@callbacks"]){Qe.logMessage(Xe.INFO,"New CALLBACK packet request rec'd from dialer",e);for(n=0;n<i.length;n++){var c=i[n];s.callbacks.push(c)}}else s.outboundSettings.previewDialLeads=i;return a};var re=function(e){this.record=e};re.prototype.formatJSON=function(){var e=Ke.getInstance(),t={ui_request:{"@destination":"IQ","@type":et.RECORD,"@message_id":Qe.getMessageId(),"@response_to":"",agent_id:{"#text":Qe.toString(e.currentCall.agentId)},uii:{"#text":Qe.toString(e.currentCall.uii)},record:{"#text":!0===this.record?"TRUE":"FALSE"}}};return JSON.stringify(t)},re.prototype.processResponse=function(e){var t=e.ui_response,s=Qe.buildDefaultResponse(e),i="";return Ke.getInstance().currentCall.uii&&(i=Ke.getInstance().currentCall.uii),s.uii=Qe.getText(t,"uii"),s.state=Qe.getText(t,"state"),"OK"===s.status?s.uii===i?(""===s.message&&(s.message="Broadcasting new record state of "+s.state),Qe.logMessage(Xe.DEBUG,s.message,e)):Qe.logMessage(Xe.DEBUG,"Record Response is for a different call...discarding",e):(""===s.message&&(s.message="Error processing RECORD request."+s.message+"\n"+s.detail),Qe.logMessage(Xe.WARN,s.message,e)),s};var oe=function(e,t,s){this.queueId=e,this.skillId=t,this.maintain=s};oe.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":et.REQUEUE,"@message_id":Qe.getMessageId(),response_to:"",agent_id:{"#text":Ke.getInstance().agentSettings.agentId},uii:{"#text":Ke.getInstance().currentCall.uii},gate_number:{"#text":Qe.toString(this.queueId)},skill_id:{"#text":Qe.toString(this.skillId)},maintain_agent:{"#text":!0===this.maintain?"TRUE":"FALSE"}}};return JSON.stringify(e)},oe.prototype.processResponse=function(e){var t=e.ui_response,s=Qe.buildDefaultResponse(e);if(s.agentId=Qe.getText(t,"agent_id"),s.uii=Qe.getText(t,"uii"),s.queueId=Qe.getText(t,"gate_number"),"OK"===s.status);else{var i="There was an error processing the requeue request. "+s.detail;Qe.logMessage(Xe.WARN,i,e)}return s};var ae=function(e,t){this.scriptId=e,this.version=t||null};ae.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@message_id":Qe.getMessageId(),response_to:"","@type":et.SCRIPT_CONFIG,agent_id:{"#text":Qe.toString(Ke.getInstance().agentSettings.agentId)},script_id:{"#text":Qe.toString(this.scriptId)}}};return JSON.stringify(e)},ae.prototype.processResponse=function(e){var t=e.ui_response,s=Qe.buildDefaultResponse(e);return"true"===s.status?(s.status=!0,s.scriptId=Qe.getText(t,"script_id"),s.version=Qe.getText(t,"version"),s.json=Qe.getText(t,"json"),Ke.getInstance().scriptSettings.loadedScripts[s.scriptId]=s):s.status=!1,s};var ce=function(e,t,s){this.uii=e,this.scriptId=t,this.jsonResult=s};ce.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@message_id":Qe.getMessageId(),response_to:"","@type":et.SCRIPT_RESULT,agent_id:{"#text":Qe.toString(Ke.getInstance().agentSettings.agentId)},uii:{"#text":Qe.toString(this.uii)},script_id:{"#text":Qe.toString(this.scriptId)},json_result:{"#text":JSON.stringify(this.jsonResult)}}};return JSON.stringify(e)};var ue=function(){};ue.prototype.searchDirectory=function(e){Ke.getInstance().searchDirectoryRequest=this,function(e,t){var s=Ke.getInstance(),i=s.agentSettings.accountId,n=s.authHost+s.baseApiUri,r="Bearer "+Qe.toString(Ke.getInstance().authenticateRequest.engageAccessToken),o={headers:{"Content-Type":"application/json"},queryParams:{}};o.headers.Authorization=r,o.queryParams.searchString=t,o.queryParams.accountId=i;var a="Error on request to search Directory: "+n+e;new Ve(n).httpGet(e,o).then((function(e){try{e=JSON.parse(e.response);var t=Ke.getInstance().searchDirectoryRequest.processResponse(e);Qe.fireCallback(Ke.getInstance().libraryInstance,ze.SEARCH_DIR,t)}catch(e){Qe.logMessage(Xe.WARN,a,e)}}),(function(e){var t={type:"Error retrieving directory list",message:a};Qe.logMessage(Xe.WARN,a,e),Qe.fireCallback(Ke.getInstance().libraryInstance,ze.SEARCH_DIR,t)}))}("rcdirectory/getRcCorporateDirectory",e)},ue.prototype.processResponse=function(e){return Ke.getInstance().filteredDirectory=e,Ke.getInstance().filteredDirectory};var he=function(){};he.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IS","@type":et.STATS,"@message_id":Qe.getMessageId(),"@response_to":""}};return JSON.stringify(e)};var le=function(e,t,s,i){this.agentId=Ke.getInstance().agentSettings.agentId,this.searchFields=t||[],this.requestId=s||"",this.action=e||"",this.leadPhone=i||""};le.prototype.formatJSON=function(){for(var e={},t=0;t<this.searchFields.length;t++){var s=this.searchFields[t];e[s.key]={"#text":Qe.toString(s.value)}}var i={ui_request:{"@destination":"IQ","@type":et.TCPA_SAFE,"@message_id":Qe.getMessageId(),"@action":this.action,response_to:"",agent_id:{"#text":Qe.toString(Ke.getInstance().agentSettings.agentId)},pending_request_id:{"#text":Qe.toString(this.requestId)},lead_phone:{"#text":Qe.toString(this.leadPhone)},search_fields:e}};return JSON.stringify(i)},le.prototype.processResponse=function(e){for(var t=e.dialer_request,s=Ke.getInstance(),i=Qe.processResponseCollection(t,"destinations","lead"),n=0;n<i.length;n++){(c=i[n]).requestId=c.requestKey,c.ani=c.destination;try{var r=t.destinations.lead[n];if(r.extra_data)for(var o in r["@lead_id"]!==c.leadId&&(r=t.destinations.lead.filter((function(e){return e["@lead_id"]===c.leadId}))),delete c.extraDatas,c.extraData={},r.extra_data)c.extraData[o]=r.extra_data[o]["#text"]}catch(e){console.warn("error parsing lead extra data: "+e)}}var a={action:t["@action"],callbacks:"TRUE"===t["@callbacks"],dialGroupId:Qe.getText(t,"dial_group_id"),accountId:Qe.getText(t,"account_id"),agentId:Qe.getText(t,"agent_id"),isInsert:Qe.getText(t,"is_insert"),leads:i};if("TRUE"===t["@callbacks"]){Qe.logMessage(Xe.INFO,"New CALLBACK packet request rec'd from dialer",e);for(n=0;n<i.length;n++){var c=i[n];s.callbacks.push(c)}}else s.outboundSettings.tcpaSafeLeads=i;return a};var de=function(e,t){this.dialDest=e,this.isSoftphoneError=t||!1};de.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":et.UPDATE_DIAL_DESTINATION,"@message_id":Qe.getMessageId(),"@response_to":"",agent_id:{"#text":Qe.toString(Ke.getInstance().agentSettings.agentId)},dial_dest:{"#text":Qe.toString(this.dialDest)},log_softphone_error:{"#text":Qe.toString(!0===this.isSoftphoneError?"TRUE":"FALSE")}}};return JSON.stringify(e)};var pe=function(e,t,s,i){this.dialDest=e,this.callerId=t||"",this.sipHeaders=s||[],this.countryId=i};pe.prototype.formatJSON=function(){for(var e=[],t=0;t<this.sipHeaders.length;t++){var s=this.sipHeaders[t];e.push({"@name":Qe.toString(s.name),"@value":Qe.toString(s.value)})}var i={ui_request:{"@destination":"IQ","@type":et.XFER_WARM,"@message_id":Qe.getMessageId(),"@response_to":"",agent_id:{"#text":Ke.getInstance().agentSettings.agentId},uii:{"#text":Ke.getInstance().currentCall.uii},dial_dest:{"#text":Qe.toString(this.dialDest)},caller_id:{"#text":Qe.toString(this.callerId)},country_id:{"#text":Qe.toString(this.countryId)},xfer_header:e}};return JSON.stringify(i)},pe.prototype.processResponse=function(e){var t=e.ui_response,s=Qe.buildDefaultResponse(e);return s.agentId=Qe.getText(t,"agent_id"),s.uii=Qe.getText(t,"uii"),s.sessionId=Qe.getText(t,"session_id"),s.dialDest=Qe.getText(t,"dial_dest"),"OK"===s.status?Qe.logMessage(Xe.DEBUG,"Warm Xfer to "+s.dialDest+" processed successfully.",e):Qe.logMessage(Xe.WARN,"There was an error processing the Warm Xfer request. "+s.message+"\n"+s.detail,e),s};var ge=function(e){this.dialDest=e};ge.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":et.XFER_WARM_CANCEL,"@message_id":Qe.getMessageId(),"@response_to":"",agent_id:{"#text":Ke.getInstance().agentSettings.agentId},uii:{"#text":Ke.getInstance().currentCall.uii},dial_dest:{"#text":Qe.toString(this.dialDest)}}};return JSON.stringify(e)};var fe=function(){};fe.prototype.getSipRegistrationInfo=function(){Ke.getInstance().WebRTCRequest=this,function(e,t){var s=Ke.getInstance(),i=s.authHost+s.baseApiUri,n="Bearer "+Qe.toString(Ke.getInstance().authenticateRequest.engageAccessToken),r={headers:{"Content-Type":"application/json"}};r.headers.Authorization=n,r.queryParams=t;var o="Error on request get to sip registration info. URL: "+i+e;new Ve(i).httpGet(e,r).then((function(e){try{e=JSON.parse(e.response);var t=Ke.getInstance().WebRTCRequest.processResponse(e);Qe.fireCallback(Ke.getInstance().libraryInstance,ze.WEBRTC_INFO,t)}catch(e){Qe.logMessage(Xe.WARN,o,e)}}),(function(e){var t={type:"Error retrieving sip registration information",message:o};Qe.logMessage(Xe.WARN,o,e),Qe.fireCallback(Ke.getInstance().libraryInstance,ze.WEBRTC_INFO,t)}))}("sip/sipRegistrationInfo",{agentId:Ke.getInstance().agentSettings.agentId})},fe.prototype.processResponse=function(e){var t=Ke.getInstance().softphoneSettings;return t.sipInfo=e.sipInfo,t.sipInfo};var Te=function(e,t){this.uii=t,this.agentId=e};Te.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":et.CHAT_AGENT_END,uii:{"#text":Qe.toString(this.uii)},agent_id:{"#text":Qe.toString(this.agentId)}}};return JSON.stringify(e)};var me=function(e){this.alias=e};me.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IS","@type":et.CHAT_ALIAS,"@message_id":Qe.getMessageId(),"@response_to":"",alias:{"#text":Qe.toString(this.alias)}}};return JSON.stringify(e)};var Se=function(e,t,s,i,n,r,o){this.uii=e,this.agentId=t,this.dispositionId=s,this.notes=i||"",this.sendAcknowlegement=n||!1,this.sessionId=o,this.survey=r||null};Se.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":et.CHAT_DISPOSITION,"@message_id":Qe.getMessageId(),"@response_to":"",uii:{"#text":Qe.toString(this.uii)},agent_id:{"#text":Qe.toString(this.agentId)},session_id:{"#text":Qe.toString(this.sessionId)},disposition_id:{"#text":Qe.toString(this.dispositionId)},notes:{"#text":Qe.toString(this.notes)},do_ack:{"#text":!0===this.sendAcknowlegement?"TRUE":"FALSE"}}};if(null!==this.survey){for(var t=[],s=Object.keys(this.survey),i=0;i<s.length;i++){var n=s[i],r={"@extern_id":n,"#text":Qe.toString(this.survey[n].value)};t.push(r)}e.ui_request.survey={response:t}}return JSON.stringify(e)};var _e=function(e,t){this.agentId=e,this.monitorAgentId=t};_e.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":et.CHAT_LIST,"@message_id":Qe.getMessageId(),"@response_to":"",agent_id:{"#text":Qe.toString(this.agentId)},monitor_agent_id:{"#text":Qe.toString(this.monitorAgentId)}}};return JSON.stringify(e)},_e.prototype.processResponse=function(e){var t=e.ui_response;return Ke.getInstance().chatListResponse=e,{message:"Received CHAT-LIST notification",status:"OK",messageId:t["@message_id"],agentId:Qe.getText(t,"agent_id"),monitorAgentId:Qe.getText(t,"monitor_agent_id"),chatList:Qe.processResponseCollection(t,"chat_list","active_chat")}};var Ee=function(e,t,s,i){this.uii=e,this.agentId=t,this.message=s,this.whisper=i};Ee.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":et.CHAT_MESSAGE,"@message_id":Qe.getMessageId(),"@response_to":"",uii:{"#text":Qe.toString(this.uii)},agent_id:{"#text":Qe.toString(this.agentId)},message:{"#text":Qe.toString(this.message)},whisper:{"#text":Qe.toString(this.whisper)}}};return JSON.stringify(e)},Ee.prototype.processResponse=function(e){var t=e.ui_notification,s=Qe.getText(t,"dts").trim(),i=new Date(s.replace(" ","T")),n={uii:Qe.getText(t,"uii"),accountId:Qe.getText(t,"account_id"),from:Qe.getText(t,"from"),type:Qe.getText(t,"type"),message:Qe.getText(t,"message"),whisper:Qe.getText(t,"whisper"),dequeueAgentId:Qe.getText(t,"dequeue_agent_id"),dts:i,mediaLinks:Qe.processResponseCollection(t,"media_links","link")};return Qe.logMessage(Xe.DEBUG,"New CHAT-MESSAGE packet received from IntelliQueue",e),n};var Ie=function(e,t,s,i){this.uii=e,this.messageId=t,this.response=s,this.responseReason=i||""};Ie.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":et.CHAT_PRESENTED_RESPONSE,"@message_id":Qe.getMessageId(),"@response_to":this.messageId,uii:{"#text":Qe.toString(this.uii)},agent_id:{"#text":Ke.getInstance().agentSettings.agentId},response:{"#text":Qe.toString(this.response)},response_reason:{"#text":Qe.toString(this.responseReason)}}};return JSON.stringify(e)};var ve=function(e,t,s,i,n){this.uii=e,this.agentId=t,this.chatQueueId=s,this.skillId=i||"",this.maintainAgent=n||!1};ve.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":et.CHAT_REQUEUE,"@message_id":Qe.getMessageId(),"@response_to":"",uii:{"#text":Qe.toString(this.uii)},agent_id:{"#text":Qe.toString(this.agentId)},chat_queue_id:{"#text":Qe.toString(this.chatQueueId)},skill_id:{"#text":Qe.toString(this.skillId)},maintain_agent:{"#text":Qe.toString(this.maintainAgent)}}};return JSON.stringify(e)};var Re=function(e,t,s,i,n){this.action=e,this.roomType=t,this.roomId=s,this.agentOne=i||"",this.agentTwo=n||""};Re.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IS","@type":et.CHAT_ROOM,"@message_id":Qe.getMessageId(),"@response_to":"",action:{"#text":Qe.toString(this.action)}}};return"EXIT"!==this.action&&(e.ui_request["@room_type"]=this.roomType),"PRIVATE"===this.roomType&&"ENTER"===this.action?(e.ui_request.agent_one={"#text":Qe.toString(this.agentOne)},e.ui_request.agent_two={"#text":Qe.toString(this.agentTwo)}):e.ui_request.room_id={"#text":Qe.toString(this.roomId)},JSON.stringify(e)};var Ce=function(){};Ce.prototype.processResponse=function(e){var t=e.ui_request,s={roomId:Qe.getText(t,"room_id"),agentId:Qe.getText(t,"agent_id"),chatAlias:Qe.getText(t,"chat_alias"),state:Qe.getText(t,"state")};return Qe.logMessage(Xe.DEBUG,"Chat-Room-State update packet received for room #"+s.roomId,e),s};var Ae=function(e,t){this.roomId=e,this.message=t};Ae.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IS","@type":et.CHAT_SEND,"@message_id":Qe.getMessageId(),"@response_to":"",room_id:{"#text":Qe.toString(this.roomId)},message:{"#text":Qe.toString(this.message)}}};return JSON.stringify(e)},Ae.prototype.processResponse=function(e){var t=e.ui_request,s={roomType:Qe.getText(t,"room_type"),roomId:Qe.getText(t,"room_id"),message:Qe.getText(t,"message"),sender:Qe.getText(t,"sender"),senderId:Qe.getText(t,"sender_id"),roomName:Qe.getText(t,"room_name"),dynamicCreate:"TRUE"===Qe.getText(t,"dynamic_create")};return Qe.logMessage(Xe.DEBUG,"New CHAT packet received from IntelliServices",e),s};var ye=function(e,t){this.uii=e,this.message=t};ye.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":et.CHAT_TYPING,"@message_id":Qe.getMessageId(),"@response_to":"",uii:{"#text":Qe.toString(this.uii)},agent_id:{"#text":Ke.getInstance().agentSettings.agentId},message:{"#text":Qe.toString(this.message)}}};return JSON.stringify(e)};var be=function(e,t,s){this.uii=e,this.agentId=t,this.sessionId=s};be.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":et.LEAVE_CHAT,"@message_id":Qe.getMessageId(),"@response_to":"",uii:{"#text":Qe.toString(this.uii)},agent_id:{"#text":Ke.getInstance().agentSettings.agentId},session_id:{"#text":Qe.toString(this.sessionId)}}};return JSON.stringify(e)};var Ne=function(e,t,s,i,n){this.agentId=e,this.chatQueueId=t,this.ani=s,this.dnis=i,this.message=n};Ne.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":et.CHAT_MANUAL_SMS,"@message_id":Qe.getMessageId(),"@response_to":"",agent_id:{"#text":Qe.toString(this.agentId)},chat_queue_id:{"#text":Qe.toString(this.chatQueueId)},ani:{"#text":Qe.toString(this.ani)},dnis:{"#text":Qe.toString(this.dnis)},message:{"#text":Qe.toString(this.message)}}};return JSON.stringify(e)};var De=function(e){this.monitorAgentId=e};De.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":et.MONITOR_CHAT,"@message_id":Qe.getMessageId(),"@response_to":"",agent_id:{"#text":Ke.getInstance().agentSettings.agentId},monitor_agent_id:{"#text":Qe.toString(this.monitorAgentId)}}};return JSON.stringify(e)};var Oe=function(e){this.monitorAgentId=e||""};Oe.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":et.STOP_MONITOR_CHAT,"@message_id":Qe.getMessageId(),"@response_to":"",agent_id:{"#text":Ke.getInstance().agentSettings.agentId},monitor_agent_id:{"#text":Qe.toString(this.monitorAgentId)}}};return JSON.stringify(e)},Oe.prototype.processResponse=function(e){var t=e.ui_notification;return{monitoredAgentId:Qe.getText(t,"monitored_agent_id")}};var we=function(){};we.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IS","@type":et.SUPERVISOR_LIST,"@message_id":Qe.getMessageId(),"@response_to":"",agent_id:{"#text":Qe.toString(Ke.getInstance().agentSettings.agentId)}}};return JSON.stringify(e)},we.prototype.processResponse=function(e){for(var t=Ke.getInstance(),s=Qe.processResponseCollection(e,"ui_response","supervisor"),i=[],n=0;n<s.length;n++){var r=s[n];i.push({agentId:r.id,firstName:r.fname,lastName:r.lname,username:r.uname})}return Qe.logMessage(Xe.DEBUG,"New supervisor list received ",i),t.supervisors=i,t.supervisors};var xe=function(){};xe.prototype.processResponse=function(e){var t=e.ui_notification;return{message:"Received CHAT-CLIENT-RECONNECT notification",status:"OK",accountId:Qe.getText(t,"account_id"),uii:Qe.getText(t,"uii"),agentId:Qe.getText(t,"agent_id")}};var Ue=function(){};Ue.prototype.processResponse=function(e){var t=e.ui_notification,s=Qe.buildDefaultResponse(e);return s.status="OK",s.message="Received ADD-CHAT-SESSION notification",s.sessionId=Qe.getText(t,"session_id"),s.uii=Qe.getText(t,"uii"),s.sessionType=Qe.getText(t,"session_type"),s.agentId=Qe.getText(t,"agent_id"),s.transcript=Qe.processResponseCollection(e,"ui_notification","transcript")[0],s};var qe=function(){};qe.prototype.processResponse=function(e){var t=e.ui_notification;return{message:"Received CHAT-ACTIVE notification",status:"OK",accountId:Qe.getText(t,"account_id"),uii:Qe.getText(t,"uii"),isMonitoring:Qe.getText(t,"is_monitoring")}};var Pe=function(){};Pe.prototype.processResponse=function(e){var t=e.ui_notification;return{message:"Received CHAT-CANCELLED notification",status:"OK",messageId:t["@message_id"],accountId:Qe.getText(t,"account_id"),uii:Qe.getText(t,"uii")}};var He=function(){};He.prototype.processResponse=function(e){var t=e.ui_notification;return{message:"Received CHAT-INACTIVE notification",status:"OK",accountId:Qe.getText(t,"account_id"),uii:Qe.getText(t,"uii"),dispositionTimeout:Qe.getText(t,"disposition_timeout"),dequeueAgentId:Qe.getText(t,"dequeue_agent_id")}};var ke=function(){};ke.prototype.processResponse=function(e){var t=e.ui_notification;return{message:"Received CHAT-PRESENTED notification",status:"OK",messageId:t["@message_id"],accountId:Qe.getText(t,"account_id"),uii:Qe.getText(t,"uii"),channelType:Qe.getText(t,"channel_type"),chatQueueId:Qe.getText(t,"chat_queue_id"),chatQueueName:Qe.getText(t,"chat_queue_name"),allowAccept:Qe.getText(t,"allow_accept")}};var $e=function(){};$e.prototype.processResponse=function(e){var t=e.ui_notification;return{message:"Received CHAT-TYPING notification",status:"OK",accountId:Qe.getText(t,"account_id"),uii:Qe.getText(t,"uii"),from:Qe.getText(t,"from"),type:Qe.getText(t,"type"),pendingMessage:Qe.getText(t,"message"),dequeueAgentId:Qe.getText(t,"dequeue_agent_id")}};var Le=function(){};Le.prototype.processResponse=function(e){var t=e.ui_notification,s=Qe.getText(t,"queue_dts");s=new Date(s.replace(" ","T"));var i={uii:Qe.getText(t,"uii"),accountId:Qe.getText(t,"account_id"),sessionId:Qe.getText(t,"session_id"),agentId:Qe.getText(t,"agent_id"),queueDts:s,queueTime:Qe.getText(t,"queue_time"),chatQueueId:Qe.getText(t,"chat_queue_id"),chatQueueName:Qe.getText(t,"chat_queue_name"),chatRequeueType:Qe.getText(t,"chat_requeue_type"),appUrl:Qe.getText(t,"app_url"),channelType:Qe.getText(t,"channel_type"),ani:Qe.getText(t,"ani"),dnis:Qe.getText(t,"dnis"),surveyPopType:Qe.getText(t,"survey_pop_type"),scriptId:Qe.getText(t,"script_id"),scriptVersion:Qe.getText(t,"script_version"),idleTimeout:Qe.getText(t,"idle_timeout"),isMonitoring:Qe.getText(t,"is_monitoring"),monitoredAgentId:Qe.getText(t,"monitored_agent_id"),preChatData:Qe.getText(t,"json_baggage")};if(i.requeueShortcuts=Qe.processResponseCollection(e,"ui_notification","chat_requeue_shortcuts","shortcut")[0],i.chatDispositions=Qe.processResponseCollection(e,"ui_notification","chat_dispositions","disposition")[0],i.transcript=Qe.processResponseCollection(e,"ui_notification","transcript","message")[0],i.baggage=Qe.processResponseCollection(e,"ui_notification","json_baggage")[0],i.chatDispositions&&i.chatDispositions.disposition?i.chatDispositions.dispositions=[i.chatDispositions]:i.chatDispositions=i.chatDispositions.dispositions,i.transcript&&i.transcript.message?i.transcript=[i.transcript]:i.transcript=i.transcript.messages,i.preChatData)try{i.preChatData=JSON.parse(i.preChatData)}catch(e){Qe.logMessage(Xe.ERROR,"Error parsing the pre-form chat data.",t)}if(i.chatDispositions)for(var n=0;n<i.chatDispositions.length;n++){var r=i.chatDispositions[n];r.isComplete="1"===r.isComplete,r.isSuccess="1"===r.isSuccess,r.isDefault="1"===r.isDefault}if(i.transcript)for(var o=0;o<i.transcript.length;o++){var a=i.transcript[o];a.dts&&(a.dts=new Date(a.dts.replace(" ","T")))}return i.baggage=function(e,t){var s={},i=Ke.getInstance();if(t.preChatData)for(var n in t.preChatData)t.preChatData.hasOwnProperty(n)&&(s[n]=t.preChatData[n]);try{s.chatQueueId=t.chatQueueId,s.chatQueueName=t.chatQueueName,s.ani=t.ani,s.dnis=t.dnis,s.uii=t.uii}catch(e){console.error("There was an error parsing chat tokens for basic chat info. ",e)}try{s.agentFirstName=i.agentSettings.firstName,s.agentLastName=i.agentSettings.lastName,s.agentExternalId=i.agentSettings.externalAgentId,s.agentType=i.agentSettings.agentType,s.agentEmail=i.agentSettings.email,s.agentUserName=i.agentSettings.username}catch(e){console.error("There was an error parsing chat tokens for agent info. ",e)}return s}(0,i),i};var Me=function(){};Me.prototype.processResponse=function(e){var t=e.ui_stats.agent,s=[];Array.isArray(t)||(t=[t]);try{for(var i=0;i<t.length;i++)s.push({agentLoginType:t[i]["@alt"],agentType:t[i]["@atype"],avgTalkTime:t[i]["@avgtt"],calls:t[i]["@calls"],isDequeueAgent:t[i]["@da"],defaultRoute:t[i]["@droute"],firstName:t[i]["@f"],queueDesc:t[i]["@gdesc"],queueName:t[i]["@gname"],agentId:t[i]["@id"],lastName:t[i]["@l"],loginDuration:t[i]["@ldur"],loginType:t[i]["@ltype"],offHook:t[i]["@oh"],pendingDisp:t[i]["@pd"],pendingDispTime:t[i]["@pdt"],presented:t[i]["@pres"],rna:t[i]["@rna"],stateDuration:t[i]["@sdur"],skillProfileName:t[i]["@sp"],agentState:t[i]["@state"],totalTalkTime:t[i]["@ttt"],username:t[i]["@u"],uii:t[i]["@uii"],utilization:t[i]["@util"],callDuration:t[i]["@call_duration"]})}catch(e){}return Ke.getInstance().agentStats=s,s};var Ge=function(){};Ge.prototype.processResponse=function(e){var t=Ke.getInstance().agentDailyStats,s=e.ui_stats;return t.agentId=Qe.getText(s,"agent_id"),t.totalLoginSessions=Qe.getText(s,"total_login_sessions"),t.totalChatsHandled=Qe.getText(s,"total_chats_handled"),t.totalCallsHandled=Qe.getText(s,"total_calls_handled"),t.totalPreviewDials=Qe.getText(s,"total_preview_dials"),t.totalManualDials=Qe.getText(s,"total_manual_dials"),t.totalRna=Qe.getText(s,"total_rna"),t.totalSuccessDispositions=Qe.getText(s,"total_success_dispositions"),t.totalTalkTime||(t.totalLoginTime=Qe.getText(s,"total_login_time"),t.totalOffhookTime=Qe.getText(s,"total_offhook_time"),t.totalTalkTime=Qe.getText(s,"total_talk_time"),t.currCallTime="0"),t};var Fe=function(){};Fe.prototype.processResponse=function(e){var t=e.ui_stats,s=Qe.processResponseCollection(e,"ui_stats","totals")[0],i=[],n=null;Array.isArray(t.campaign)||(t.campaign=[t.campaign]);for(var r=0;r<t.campaign.length;r++)null!=(n=t.campaign[r])&&i.push({active:n["@a"],abandon:n["@aba"],answer:n["@an"],available:n["@av"],busy:n["@b"],complete:n["@c"],error:n["@e"],fax:n["@f"],campaignId:n["@id"],intercept:n["@int"],machine:n["@m"],noanswer:n["@na"],campaignName:n["@name"],pending:n["@p"],ready:n["@r"],staffed:n["@s"],totalConnects:n["@tc"],totalTalkTime:n["@ttt"]});var o={type:t["@type"],campaigns:i,totals:s};return Ke.getInstance().campaignStats=o,o};var Be=function(){};Be.prototype.processResponse=function(e){var t=e.ui_stats,s=Qe.processResponseCollection(e,"ui_stats","totals")[0],i=Qe.processResponseCollection(e,"ui_stats","chatQueue"),n={type:t["@type"],chatQueues:i,totals:s};return Ke.getInstance().chatQueueStats=n,n};var je=function(){};je.prototype.processResponse=function(e){var t=e.ui_stats,s=Qe.processResponseCollection(e,"ui_stats","totals")[0],i=[],n={};Array.isArray(t.gate)||(t.gate=[t.gate]);for(var r=0;r<t.gate.length;r++)null!=(n=t.gate[r])&&i.push({abandon:n["@aba"],active:n["@active"],answer:n["@ans"],asa:n["@asa"],available:n["@avail"],avgAbandon:n["@avga"],avgQueue:n["@avgq"],avgTalk:n["@avgt"],deflected:n["@def"],queueId:n["@id"],inQueue:n["@inq"],longCall:n["@long_c"],longestInQueue:n["@longq"],queueName:n["@name"],presented:n["@pres"],routing:n["@route"],shortAbandon:n["@short_aba"],shortCall:n["@short_c"],sla:n["@sla"],slaPass:n["@sla_p"],slaFail:n["@sla_f"],staffed:n["@staff"],tAbandonTime:n["@t_aba"],tQueueTime:n["@t_q"],tSpeedOfAnswer:n["@t_soa"],utilization:n["@util"]});var o={type:t["@type"],queues:i,totals:s};return Ke.getInstance().queueStats=o,o};var We,Ke={getInstance:function(){return We||(We={currentCall:{},pendingNewCallSessions:{},callTokens:{},callbacks:[],libraryInstance:null,pingIntervalId:null,statsIntervalId:null,pingStatIntervalId:null,agentDailyIntervalId:null,reconnectIntervalId:null,waitingForAddSession:null,authHost:window.location.origin,socketProtocol:"wss://",baseAuthUri:"/api/auth/",baseApiUri:"/api/v1/",chatAliasRequest:null,chatRoomRequest:null,chatSendRequest:null,supervisorListRequest:null,chatRoomStateRequest:new Ce,multiSocketRequest:new X,dataStore:new Je("agentSDK"),chatActiveNotification:new qe,chatInactiveNotification:new He,chatDispositionRequest:null,chatMessageRequest:new Ee,chatPresentedNotification:new ke,chatPresentedRequest:null,chatRequeueRequest:null,chatTypingNotification:new $e,chatTypingRequest:null,newChatNotification:new Le,chatClientReconnectNotification:new xe,agentStateRequest:null,chatStateRequest:null,ackRequest:new I,bargeInRequest:null,callNotesRequest:null,callbacksPendingRequest:null,campaignDispositionsRequest:null,loginRequest:null,coldXferRequest:null,dispositionRequest:null,dispositionManualPassRequest:null,hangupRequest:null,holdRequest:null,leadHistoryRequest:null,leadInsertRequest:null,leadUpdateRequest:null,logoutRequest:null,authenticateRequest:null,loginPhase1Request:null,offhookInitRequest:null,offhookTermRequest:null,oneToOneOutdialRequest:null,oneToOneOutdialCancelRequest:null,pauseRecordRequest:null,pingCallRequest:null,previewDialRequest:null,reconnectRequest:null,recordRequest:null,requeueRequest:null,statsRequest:null,tcpaSafeRequest:null,warmXferRequest:null,warmXferCancelRequest:null,chatListRequest:null,directAgentTransferListRequest:null,directAgentTransferRequest:null,webRTCRequest:null,searchDirectoryRequest:null,extensionPresenceRequest:null,agentStatePacket:null,chatStatePacket:null,loginPacket:null,currentCallPacket:null,authenticatePacket:null,loginPhase1Packet:null,offhookInitPacket:null,offhookTermPacket:null,transferSessions:{},chatListResponse:null,addSessionNotification:new r,dialGroupChangeNotification:new a,dialGroupChangePendingNotification:new c,dropSessionNotification:new h,earlyUiiNotification:new l,endCallNotification:new d,gatesChangeNotification:new p,genericNotification:new g,newCallNotification:new f,agentStatsPacket:new Me,agentDailyStatsPacket:new Ge,queueStatsPacket:new je,campaignStatsPacket:new Fe,chatQueueStatsPacket:new Be,applicationSettings:{availableCountries:[],isLoggedInIS:!1,socketConnected:!1,socketDest:"",isTcpaSafeMode:!1,isSso:!1,dialDestType:"",allowMultiSocket:!1},agentStats:[],agentDailyStats:{},campaignStats:{},queueStats:{},chatQueueStats:{},agentSettings:{accountId:null,agentId:0,agentPassword:"",agentType:"AGENT",altDefaultLoginDest:"",availableAgentStates:[],callerIds:[],callState:null,corporateDirectory:!1,currentState:"OFFLINE",currentStateLabel:"",defaultLoginDest:"",dialDest:"",email:"",externalAgentId:"",firstName:"",guid:"",isLoggedIn:!1,isOffhook:!1,isMonitoring:!1,initLoginState:"AVAILABLE",initLoginStateLabel:"Available",isOutboundPrepay:!1,lastName:"",loginDTS:null,loginType:"NO-SELECTION",maxBreakTime:-1,maxLunchTime:-1,onCall:!1,onManualOutdial:!1,outboundManualDefaultRingtime:"30",pendingCallbacks:[],pendingDialGroupChange:0,phoneLoginPin:"",realAgentType:"AGENT",supervisors:[],totalCalls:0,transferNumber:"",updateDGFromAdminUI:!1,updateLoginMode:!1,username:"",wasMonitoring:!1},agentPermissions:{allowBlended:!0,allowCallControl:!0,allowChat:!1,allowCrossQueueRequeue:!1,allowInbound:!0,allowLeadInserts:!1,allowLeadSearch:!1,allowLoginControl:!0,allowLoginUpdates:!0,allowManualCalls:!0,allowManualPass:!0,allowManualIntlCalls:!1,allowManualOutboundGates:!1,allowOffHook:!0,allowOutbound:!0,allowPreviewLeadFilters:!1,allowLeadUpdatesByCampaign:{},disableSupervisorMonitoring:!0,progressiveEnabled:!1,requireFetchedLeadsCalled:!1,showLeadHistory:!0,enableTaskMode:!1,enableFolderMode:!1},chatSettings:{availableChatQueues:[],availableChatRooms:[],chatQueues:[],alias:""},connectionSettings:{hashCode:"",reconnect:!1,isMultiSocket:!1},inboundSettings:{availableQueues:[],availableSkillProfiles:[],queues:[],skillProfile:{}},outboundSettings:{availableCampaigns:[],availableOutdialGroups:[],insertCampaigns:[],defaultDialGroup:0,outdialGroup:{},previewDialLeads:[],tcpaSafeLeads:[],campaignDispositions:[]},scriptSettings:{availableScripts:[],loadedScripts:{}},softphoneSettings:{webRtc:null,isRegistered:!1,muteActive:!1,registerPending:null,maintainOH:!1,autoStartOH:!1,wsServers:[],sipInfo:[],uri:"",displayName:"",authorizationUser:"",sipPassword:"",sipDialDest:"",attemptingSoftphoneReconnect:!1},filteredDirectory:{rcAccountId:"",records:[]},extensionPresenceResponse:[],incrementTotalCalls:function(){this.agentSettings.totalCalls=this.agentSettings.totalCalls+1}}),We},resetInstance:function(){We=null}},Je=function(e){window.localStorage||console.log("Browser does not support HTML5 Web Storage"),this.prefix=e+":"};function Ve(e){this.XMLHttpRequest=window.XMLHttpRequest,this.encodeURIComponent=window.encodeURIComponent,this.apiBase=e||"http://localhost:81";var t=this;function s(e){return"object"==typeof e&&null!==e}function i(e,t){if(s(e)){var i=e.headers;if(s(i))for(var n in i)t.setRequestHeader(n,i[n])}}function n(e,t,s){s.addEventListener("error",(function(e){t(e)})),s.addEventListener("timeout",(function(){t(new Error("request timeout"))})),s.addEventListener("load",(function(){200!==this.status?t({status:this.status,response:this.responseText}):e({status:this.status,response:this.responseText})}))}function r(e){if(s(e))return Object.keys(e).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])})).join("&")}this.httpGet=function(e,s){return new Promise((function(o,a){var c=new t.XMLHttpRequest,u="";s.queryParams&&(u="?"+r(s.queryParams)),c.open("GET",t.apiBase+e+u),i(s,c),n(o,a,c),c.send()}))},this.httpPost=function(e,o){return new Promise((function(a,c){var u=new t.XMLHttpRequest,h="";o.queryParams&&(h="?"+r(o.queryParams)),u.open("POST",t.apiBase+e+h),i(o,u),n(a,c,u),u.send(function(e){var t=e&&e.headers&&e.headers["Content-Type"],i=e&&e.body||"";"application/json"===t?i=JSON.stringify(i):s(i)&&(i=r(i));return i}(o))}))}}function Ye(e,t){this.instance=e,this.data=t;var s=this;function i(e,t){var s=(new r).processResponse(t);Qe.fireCallback(e,ze.ADD_SESSION,s)}this.setupAddSessionCallback=function(){var e=Qe.getText(t.ui_notification,"uii"),n=Qe.getText(t.ui_notification,"session_id");Ke.getInstance().currentCall.uii===e?i(s.instance,s.data):(Ke.getInstance().pendingNewCallSessions[e]=Ke.getInstance().pendingNewCallSessions[e]||{},Ke.getInstance().pendingNewCallSessions[e][n]=s)},this.processSessionsForCall=function(){var e=Ke.getInstance().currentCall.uii,t=Ke.getInstance().pendingNewCallSessions[e];if(t&&Object.keys(t).length>0){for(var s in t)if(t.hasOwnProperty(s)){var n=t[s];i(n.instance,n.data)}else console.error("error processing sessions for uii: "+e+" session: "+s);delete Ke.getInstance().pendingNewCallSessions[e]}}}Je.prototype.save=function(e,t){if(!e||!t)return console.log("Missing parameters key or value on add"),!1;localStorage.setItem(this.prefix+e,JSON.stringify(t))},Je.prototype.get=function(e){return e&&localStorage.getItem(this.prefix+e)?localStorage.getItem(this.prefix+e):(console.log("Missing parameter key on retrieve"),!1)},Je.prototype.remove=function(e){if(!e||!localStorage.getItem(this.prefix+e))return console.log("Missing parameter key on remove"),!1;localStorage.removeItem(this.prefix+e)};var Qe={logMessage:function(e,t,s){var i=Ke.getInstance().libraryInstance;if(i._db)try{var n=i._db.transaction(["logger"],"readwrite").objectStore("logger"),r={logLevel:e,message:t,dts:new Date,data:s};n.add(r)}catch(e){console.error("Error adding log message: "+e)}},sendMessage:function(e,t){var s=JSON.parse(t);if(e.socket&&1===e.socket.readyState){var i=s.ui_request["@type"],n="Sending "+i+" request message to "+s.ui_request["@destination"];e._requests.push({id:s.ui_request["@message_id"],type:s.ui_request["@type"],msg:s.ui_request}),e._requests.length>1e3&&e._requests.shift(),e.socket.send(t),"STATS"===i?Qe.logMessage(Xe.STATS,n,s):Qe.logMessage(Xe.INFO,n,s)}else e._queuedMsgs.push({dts:new Date,msg:t})},processResponse:function(e,t){var s=t.ui_response["@type"],i=t.ui_response["@message_id"],n=""!==i&&i?i.slice(0,2):"IS",r="Received "+s.toUpperCase()+" response message from "+n;switch(Qe.logMessage(Xe.INFO,r,t),Qe.fireCallback(e,ze.ON_MESSAGE,t),s.toUpperCase()){case et.AGENT_STATE:null===Ke.getInstance().agentStateRequest&&(Ke.getInstance().agentStateRequest=new v(t.ui_response.current_state["#text"],t.ui_response.agent_aux_state["#text"]));var o=Ke.getInstance().agentStateRequest.processResponse(t);Qe.fireCallback(e,ze.AGENT_STATE,o);break;case et.BARGE_IN:var a=Ke.getInstance().bargeInRequest.processResponse(t),c=t.ui_response["@response_to"];if(O=Qe.findRequestById(e,c)){var u=O.msg.audio_state["#text"];"MUTE"===u?Qe.fireCallback(e,ze.SILENT_MONITOR,a):"COACHING"===u?Qe.fireCallback(e,ze.COACH_CALL,a):Qe.fireCallback(e,ze.BARGE_IN,a)}else Qe.fireCallback(e,ze.BARGE_IN,a);break;case et.CAMPAIGN_DISPOSITIONS:var h=Ke.getInstance().campaignDispositionsRequest.processResponse(t);Qe.fireCallback(e,ze.CAMPAIGN_DISPOSITIONS,h);break;case et.CALL_NOTES:var l=Ke.getInstance().callNotesRequest.processResponse(t);Qe.fireCallback(e,ze.CALL_NOTES,l);break;case et.CALLBACK_PENDING:var d=Ke.getInstance().callbacksPendingRequest.processResponse(t);Qe.fireCallback(e,ze.CALLBACK_PENDING,d);break;case et.HOLD:var p=(null===Ke.getInstance().holdRequest?new L:Ke.getInstance().holdRequest).processResponse(t);Qe.fireCallback(e,ze.HOLD,p);break;case et.LEAD_HISTORY:var g=Ke.getInstance().leadHistoryRequest.processResponse(t);Qe.fireCallback(e,ze.LEAD_HISTORY,g);break;case et.LEAD_INSERT:var f=Ke.getInstance().leadInsertRequest.processResponse(t);Qe.fireCallback(e,ze.LEAD_INSERT,f);break;case et.LEAD_UPDATE:var T=Ke.getInstance().leadUpdateRequest.processResponse(t);Qe.fireCallback(e,ze.LEAD_UPDATE,T);break;case et.LOGIN_PHASE_1:var m=Ke.getInstance().loginPhase1Request.processResponse(t);Qe.fireCallback(e,ze.LOGIN_PHASE_1,m);break;case et.LOGIN:var S=Ke.getInstance().loginRequest.processResponse(t);Qe.fireCallback(e,ze.LOGIN,S);break;case et.OFFHOOK_INIT:var _=(new Z).processResponse(t);Qe.fireCallback(e,ze.OFFHOOK_INIT,_);break;case et.PAUSE_RECORD:var E=(null===Ke.getInstance().pauseRecordRequest?new se:Ke.getInstance().pauseRecordRequest).processResponse(t);Qe.fireCallback(e,ze.PAUSE_RECORD,E);break;case et.RECORD:var I=Ke.getInstance().recordRequest.processResponse(t);Qe.fireCallback(e,ze.RECORD,I);break;case et.REQUEUE:var R=Ke.getInstance().requeueRequest.processResponse(t);Qe.fireCallback(e,ze.REQUEUE,R);break;case et.SUPERVISOR_LIST:var C=Ke.getInstance().supervisorListRequest.processResponse(t);Qe.fireCallback(e,ze.SUPERVISOR_LIST,C);break;case et.SCRIPT_CONFIG:var A=Ke.getInstance().scriptConfigRequest.processResponse(t);Qe.fireCallback(e,ze.SCRIPT_CONFIG,A);break;case et.XFER_COLD:var y=Ke.getInstance().coldXferRequest.processResponse(t);Qe.fireCallback(e,ze.XFER_COLD,y);break;case et.XFER_WARM:var b=Ke.getInstance().warmXferRequest.processResponse(t);Qe.fireCallback(e,ze.XFER_WARM,b);break;case et.XFER_WARM_CANCEL:var N=Ke.getInstance().warmXferCancelRequest.processResponse(t);Qe.fireCallback(e,ze.XFER_WARM_CANCEL,N);break;case et.ACK:var D=Ke.getInstance().ackRequest.processResponse(t),O=(c=t.ui_response["@response_to"],Qe.findRequestById(e,c));D.uii=O.msg.uii&&O.msg.uii["#text"],Qe.fireCallback(e,ze.ACK,D);break;case et.CHAT_LIST:var x=(new _e).processResponse(t);Qe.fireCallback(e,ze.CHAT_LIST,x);break;case et.CHAT_STATE:var P=(new w).processResponse(t);Qe.fireCallback(e,ze.CHAT_STATE,P);break;case et.DIRECT_AGENT_TRANSFER_LIST:var H=(new q).processResponse(t);Qe.fireCallback(e,ze.DIRECT_AGENT_TRANSFER_LIST,H);break;case et.DIRECT_AGENT_TRANSFER:var k=(new U).processResponse(t);Qe.fireCallback(e,ze.DIRECT_AGENT_TRANSFER,k)}},processNotification:function(e,t){var s=t.ui_notification["@type"],i=t.ui_notification["@message_id"],n=""===i?"IS":i.slice(0,2),r="Received "+s.toUpperCase()+" notification message from "+n;switch(Qe.logMessage(Xe.INFO,r,t),s.toUpperCase()){case et.ADD_SESSION:new Ye(e,t).setupAddSessionCallback();break;case et.DIAL_GROUP_CHANGE:var I=(new a).processResponse(t);Qe.fireCallback(e,ze.DIAL_GROUP_CHANGE,I);break;case et.DIAL_GROUP_CHANGE_PENDING:var v=(new c).processResponse(t);Qe.fireCallback(e,ze.DIAL_GROUP_CHANGE_PENDING,v);break;case et.DROP_SESSION:var R=new h(e).processResponse(t);Qe.fireCallback(e,ze.DROP_SESSION,R);break;case et.EARLY_UII:var C=new l(e).processResponse(t);Qe.fireCallback(e,ze.EARLY_UII,C);break;case et.END_CALL:var A=new d(e).processResponse(t);Qe.fireCallback(e,ze.END_CALL,A);break;case et.GATES_CHANGE:var y=(new p).processResponse(t);Qe.fireCallback(e,ze.GATES_CHANGE,y);break;case et.GENERIC:var b=(new g).processResponse(t),N=t.ui_notification["@response_to"],D=Qe.findRequestById(e,N);if(D){s=D.type;var O=Qe.findCallbackBasedOnMessageType(s);O?(s===et.CALLBACK_CANCEL&&(b.leadId=D.msg.lead_id["#text"]),Qe.fireCallback(e,O,b)):Qe.fireCallback(e,ze.GENERIC_NOTIFICATION,b)}else"001"===b.messageCode&&Ke.getInstance().pingIntervalId&&clearInterval(Ke.getInstance().pingIntervalId),Qe.fireCallback(e,ze.GENERIC_NOTIFICATION,b);break;case et.NEW_CALL:var w=(new f).processResponse(t);Qe.fireCallback(e,ze.NEW_CALL,w),new Ye(e,t).processSessionsForCall();break;case et.OFFHOOK_TERM:null===Ke.getInstance().offhookTermRequest&&(Ke.getInstance().offhookTermRequest=new z);var x=Ke.getInstance().offhookTermRequest.processResponse(t);Qe.fireCallback(e,ze.OFFHOOK_TERM,x);break;case et.PREVIEW_LEAD_STATE:var U=(new S).processResponse(t);Qe.fireCallback(e,ze.PREVIEW_LEAD_STATE,U);break;case et.PENDING_DISP:var q=(new m).processResponse(t);Qe.fireCallback(e,ze.PENDING_DISP,q);break;case et.PENDING_CHAT_DISP:var P=(new T).processResponse(t);Qe.fireCallback(e,ze.PENDING_CHAT_DISP,P);break;case et.REVERSE_MATCH:var H=(new _).processResponse(t);Qe.fireCallback(e,ze.REVERSE_MATCH,H);break;case et.TCPA_SAFE_LEAD_STATE:var k=(new E).processResponse(t);Qe.fireCallback(e,ze.TCPA_SAFE_LEAD_STATE,k);break;case et.CHAT_ACTIVE:var $=(new qe).processResponse(t);Qe.fireCallback(e,ze.CHAT_ACTIVE,$);break;case et.CHAT_INACTIVE:var L=(new He).processResponse(t);Qe.fireCallback(e,ze.CHAT_INACTIVE,L);break;case et.CHAT_CLIENT_RECONNECT:var M=(new xe).processResponse(t);Qe.fireCallback(e,ze.CHAT_CLIENT_RECONNECT,M);break;case et.CHAT_PRESENTED:var G=(new ke).processResponse(t);Qe.fireCallback(e,ze.CHAT_PRESENTED,G);break;case et.CHAT_TYPING:var F=(new $e).processResponse(t);Qe.fireCallback(e,ze.CHAT_TYPING,F);break;case et.CHAT_NEW:var B=(new Le).processResponse(t);Qe.fireCallback(e,ze.CHAT_NEW,B);break;case et.CHAT_MESSAGE:var j=(new Ee).processResponse(t);Qe.fireCallback(e,ze.CHAT_MESSAGE,j);break;case et.CHAT_CANCELLED:var W=(new Pe).processResponse(t);Qe.fireCallback(e,ze.CHAT_CANCELLED,W);break;case et.CHAT_ADD_SESSION:var K=(new Ue).processResponse(t);Qe.fireCallback(e,ze.CHAT_ADD_SESSION,K);break;case et.STOP_MONITOR_CHAT:var J=(new Oe).processResponse(t);Qe.fireCallback(e,ze.CHAT_STOP_MONITOR,J);break;case et.DIRECT_AGENT_ROUTE:var V=(new u).processResponse(t);Qe.fireCallback(e,ze.DIRECT_AGENT_TRANSFER_NOTIF,V);break;case et.AGENT_DEBUG_EMAIL:var Y=(new o).processResponse(t);Qe.fireCallback(e,ze.AGENT_DEBUG_EMAIL_NOTIF,Y);break;case et.LOGOUT:var X=(new Q).processResponse(t);Qe.fireCallback(e,ze.LOGOUT,X);var Z=Ke.getInstance();Z.dataStore.remove("agent_id"),Z.dataStore.remove("hash_code"),(e=Z.libraryInstance).closeSocket();break;case et.MONITOR_CHAT:case et.LEAVE_CHAT:}},processDialerResponse:function(e,t){var s=t.dialer_request["@type"],i=t.dialer_request["@message_id"],n=""===i?"IS":i.slice(0,2),r="Received "+s.toUpperCase()+" dialer response message from "+n;switch(Qe.logMessage(Xe.INFO,r,t),Qe.fireCallback(e,ze.ON_MESSAGE,t),s.toUpperCase()){case et.PREVIEW_DIAL_ID:var o=(new ne).processResponse(t);"SEARCH"===o.action.toUpperCase()?Qe.fireCallback(e,ze.LEAD_SEARCH,o):Qe.fireCallback(e,ze.PREVIEW_FETCH,o);break;case et.TCPA_SAFE_ID:var a=(new le).processResponse(t);"SEARCH"===a.action.toUpperCase()?Qe.fireCallback(e,ze.SAFE_MODE_SEARCH,a):Qe.fireCallback(e,ze.SAFE_MODE_FETCH,a)}},processRequest:function(e,t){switch(t.ui_request["@type"].toUpperCase()){case et.CHAT_SEND:var s=(new Ae).processResponse(t);Qe.fireCallback(e,ze.CHAT,s);break;case et.CHAT_ROOM_STATE:var i=(new Ce).processResponse(t);Qe.fireCallback(e,ze.CHAT_ROOM_STATE,i)}},processStats:function(e,t){var s=t.ui_stats["@type"];s.toUpperCase();switch(s.toUpperCase()){case et.STATS_AGENT:var i=Ke.getInstance().agentStatsPacket.processResponse(t);Qe.fireCallback(e,ze.STATS_AGENT,i);break;case et.STATS_AGENT_DAILY:var n=Ke.getInstance().agentDailyStatsPacket.processResponse(t);Qe.fireCallback(e,ze.STATS_AGENT_DAILY,n),null===Ke.getInstance().agentDailyIntervalId&&(Ke.getInstance().agentDailyIntervalId=setInterval(Qe.onAgentDailyStats,1e3));break;case et.STATS_CAMPAIGN:var r=Ke.getInstance().campaignStatsPacket.processResponse(t);Qe.fireCallback(e,ze.STATS_CAMPAIGN,r);break;case et.STATS_QUEUE:var o=Ke.getInstance().queueStatsPacket.processResponse(t);Qe.fireCallback(e,ze.STATS_QUEUE,o);break;case et.STATS_CHAT:var a=Ke.getInstance().chatQueueStatsPacket.processResponse(t);Qe.fireCallback(e,ze.STATS_CHAT_QUEUE,a)}},processResponseCollection:function(e,t,s,i){if(i=i||"text",e[t]&&void 0!==e[t][s]){var n=e[t][s];return this._processItems(n,i)}return[]},escapeSoftphoneUsername:function(e){return e&&e.replace(/[@]/g,"_at_")},_processItems:function(e,t){var s=[];if(null==e)return s;Array.isArray(e)||(e=[e]);for(var i=0;i<e.length;i++)s.push(this._processItem(e[i],t));return s},_processItem:function(e,t){if("text"===t&&1===Object.keys(e).length&&null!=e["#text"])return this._tryConvertValueToBoolean(e["#text"]);var s={};for(var i in e){var n=this._convertToFormattedKey(i,t),r=e[i];"object"==typeof r?Array.isArray(r)&&0===r.length||0===Object.keys(r).length?s[n]="":Array.isArray(r)||Object.keys(r).length>1?s[n=this._convertKeyForCollection(n)]=this._processItems(r,t):1===Object.keys(r).length&&null!=r["#text"]?s[n]=r["#text"]:s[n]=this._processItems(r[Object.keys(r)[0]],"text"):s[n]=this._tryConvertValueToBoolean(r)}return s},_convertToFormattedKey:function(e,t){return e.match(/^#/)?t:e.replace(/@/,"").replace(/_([a-z])/g,(function(e){return e[1].toUpperCase()}))},_convertKeyForCollection:function(e){return"s"!==e.substr(e.length-1)?e+"s":e},_tryConvertValueToBoolean:function(e){return null===e?null:"TRUE"===e.toUpperCase()||"FALSE"!==e.toUpperCase()&&e},fireCallback:function(e,t,s){s=s||"",void 0!==t&&"function"==typeof e.callbacks[t]&&e.callbacks[t].call(e,s)},setCallback:function(e,t,s){void 0!==t&&void 0!==s&&(e.callbacks[t]=s)},getMessageId:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},checkExistingIds:function(e,t,s){for(var i=[],n=[],r=0;r<e.length;r++)i.push(parseInt(e[r][s],10));for(var o=0;o<t.length;o++)-1===i.indexOf(parseInt(t[o],10))&&n.push(parseInt(t[o],10));for(var a=t.length-1;a>=0;a--)n.indexOf(parseInt(t[a],10))>-1&&t.splice(a,1);return t},findObjById:function(e,t,s){for(var i=0;i<e.length;i++){var n=e[i];if(n[s]===t)return n}return null},validateDest:function(e){var t=!1;return(/^\d+$/.test(e)&&10===e.length||"sip:"===e.slice(0,4).toLowerCase()&&-1!==e.indexOf("@"))&&(t=!0),t},findCallbackBasedOnMessageType:function(e){var t="";for(var s in et)et[s]===e&&(t=ze[s]);return t},buildDefaultResponse:function(e){var t="",s="",i="",n="",r="",o="";return e.ui_response?(n=e.ui_response.message,r=e.ui_response.detail,o=e.ui_response.status):e.ui_notification&&(n=e.ui_notification.message,r=e.ui_notification.detail,o=e.ui_notification.status),n&&(t=n["#text"]||""),r&&(s=r["#text"]||""),o&&(i=o["#text"]||""),{message:t,detail:s,status:i}},toString:function(e){return e?e.toString():""},getText:function(e,t){var s=e[t];return s&&s["#text"]?"TRUE"===s["#text"].toUpperCase()||"FALSE"!==s["#text"].toUpperCase()&&(s["#text"]||""):""},getAttribute:function(e,t){var s=e[t];return s&&s[t]?"TRUE"===s[t].toUpperCase()||"FALSE"!==s[t].toUpperCase()&&(s[t]||""):""},parseKeyValuePairsFromString:function(e,t,s){return e?e.split(t).reduce((function(e,t){var i=t.split(s);return e[i[0]]=i[1],e}),{}):[]},findRequestById:function(e,t){for(var s=null,i=0;i<e._requests.length;i++)if(e._requests[i].id===t){s=e._requests[i];break}return s},sendPingCallMessage:function(){Ke.getInstance().pingCallRequest=new ie;var e=Ke.getInstance().pingCallRequest.formatJSON(),t=JSON.parse(e),s=Qe.getText(t.ui_request,"agent_id"),i=Qe.getText(t.ui_request,"uii");""===s||""===i?Qe.logMessage(Xe.WARN,"PING-CALL message failed, agentId or UII is empty",t):Qe.sendMessage(Ke.getInstance().libraryInstance,e)},sendStatsRequestMessage:function(){Ke.getInstance().statsRequest=new he;var e=Ke.getInstance().statsRequest.formatJSON();Qe.sendMessage(Ke.getInstance().libraryInstance,e)},sendPingRequestMessage:function(){var e=Ke.getInstance().libraryInstance;e.socket&&1===e.socket.readyState&&e.socket.send("BEAT")},onAgentDailyStats:function(){if(0!==Object.keys(Ke.getInstance().agentDailyStats).length){var e=Ke.getInstance().agentSettings,t=Ke.getInstance().agentDailyStats,s=t.totalLoginTime;if(t.totalLoginTime=Number(s)+1,e.isOffhook){var i=t.totalOffhookTime;t.totalOffhookTime=Number(i)+1}if("ENGAGED"==e.currentState){var n=t.totalTalkTime;t.totalTalkTime=Number(n)+1;var r=t.currCallTime;t.currCallTime=Number(r)+1}}},getDialDestination:function(){var e=Ke.getInstance(),t=e.softphoneSettings,s=e.applicationSettings.dialDestType,i="";if(t.sipInfo.length>0){var n=t.sipInfo[0];"LEGACY_SOFTPHONE"===s?i="sip:"+Qe.escapeSoftphoneUsername(n.username)+"@"+n.domain:"RC_SOFTPHONE"===s&&(i=Qe.escapeSoftphoneUsername(n.username)+"@RC_SOFTPHONE")}return i},refreshAccessToken:function(){var e=Ke.getInstance(),t=e.authHost+e.baseAuthUri,s="Error in opening WebSocket on retrieving access token",i={queryParams:{loginHashcode:e.connectionSettings.hashCode,agentId:e.agentSettings.agentId,platformId:e.authenticateRequest.platformId}};new Ve(t).httpPost("login/agent/hashcode",i).then((function(e){try{e=JSON.parse(e.response),Ke.getInstance().authenticateRequest.engageAccessToken=e.accessToken}catch(e){Qe.logMessage(Xe.WARN,s,e)}}),(function(e){Qe.logMessage(Xe.WARN,s,e)}))}};const Xe={DEBUG:"debug",STATS:"stats",INFO:"info",WARN:"warn",ERROR:"error"},Ze={USERNAME_PASSWORD:"USERNAME_PASSWORD",RC_TOKEN:"RC_TOKEN",ENGAGE_TOKEN:"ENGAGE_TOKEN"},ze={ACK:"acknowledgeResponse",ADD_SESSION:"addSessionNotification",AGENT_DEBUG_EMAIL_NOTIF:"agentDebugEmailNotification",AGENT_STATE:"agentStateResponse",AUTHENTICATE:"authenticateResponse",BARGE_IN:"bargeInResponse",CALLBACK_CANCEL:"callbackCancelResponse",CALLBACK_PENDING:"callbacksPendingResponse",CALL_NOTES:"callNotesResponse",CAMPAIGN_DISPOSITIONS:"campaignDispositionsResponse",CHAT:"chatResponse",CHAT_ACTIVE:"chatActiveNotification",CHAT_ADD_SESSION:"addChatSessionNotification",CHAT_CANCELLED:"chatCancelledNotification",CHAT_CLIENT_RECONNECT:"chatClientReconnectNotification",CHAT_INACTIVE:"chatInactiveNotification",CHAT_LIST:"chatListResponse",CHAT_MESSAGE:"chatMessageNotification",CHAT_NEW:"chatNewNotification",CHAT_PRESENTED:"chatPresentedNotification",CHAT_ROOM_STATE:"chatRoomStateResponse",CHAT_STATE:"chatStateResponse",CHAT_STOP_MONITOR:"stopAgentChatMonitorNotification",CHAT_TYPING:"chatTypingNotification",CLOSE_SOCKET:"closeResponse",COACH_CALL:"coachResponse",CONFIG:"configureResponse",DIAL_GROUP_CHANGE:"dialGroupChangeNotification",DIAL_GROUP_CHANGE_PENDING:"dialGroupChangePendingNotification",DIRECT_AGENT_TRANSFER:"directAgentTransferResponse",DIRECT_AGENT_TRANSFER_LIST:"directAgentTransferListResponse",DIRECT_AGENT_TRANSFER_NOTIF:"directAgentTransferNotification",DROP_SESSION:"dropSessionNotification",EARLY_UII:"earlyUiiNotification",END_CALL:"endCallNotification",GATES_CHANGE:"gatesChangeNotification",GENERIC_NOTIFICATION:"genericNotification",GENERIC_RESPONSE:"genericResponse",HOLD:"holdResponse",LEAD_HISTORY:"leadHistoryResponse",LEAD_INSERT:"leadInsertResponse",LEAD_SEARCH:"leadSearchResponse",LEAD_UPDATE:"leadUpdateResponse",LOGIN:"loginResponse",LOGIN_PHASE_1:"loginPhase1Response",LOGIN_MULTISOCKET:"multiSocketResponse",LOGOUT:"logoutResponse",LOG_CONSOLE_RESULTS:"logConsoleResultsResponse",LOG_RESULTS:"logResultsResponse",NEW_CALL:"newCallNotification",OFFHOOK_INIT:"offhookInitResponse",OFFHOOK_TERM:"offhookTermNotification",OPEN_SOCKET:"openResponse",PAUSE_RECORD:"pauseRecordResponse",PENDING_CHAT_DISP:"pendingChatDispNotification",PENDING_DISP:"pendingDispNotification",PREVIEW_FETCH:"previewFetchResponse",PREVIEW_LEAD_STATE:"previewLeadStateNotification",RECORD:"recordResponse",REQUEUE:"requeueResponse",REVERSE_MATCH:"reverseMatchNotification",SAFE_MODE_FETCH:"safeModeFetchResponse",SAFE_MODE_SEARCH:"safeModeSearchResponse",SCRIPT_CONFIG:"scriptConfigResponse",SILENT_MONITOR:"monitorResponse",STATS_AGENT:"agentStats",STATS_AGENT_DAILY:"agentDailyStats",STATS_CAMPAIGN:"campaignStats",STATS_CHAT_QUEUE:"chatQueueStats",STATS_QUEUE:"queueStats",SUPERVISOR_LIST:"supervisorListResponse",TCPA_SAFE_LEAD_STATE:"tcpaSafeLeadStateNotification",WEBRTC_INFO:"webRtcInfoResponse",XFER_COLD:"coldXferResponse",XFER_WARM:"warmXferResponse",SEARCH_DIR:"searchDirectoryResponse",EXTENSION_PRESENCE:"extensionPresenceInfo",SIP_CONNECTED:"sipConnectedNotification",SIP_DIAL_DEST_CHANGED:"sipDialDestChangedNotification",SIP_ENDED:"sipEndedNotification",SIP_MUTE:"sipMuteResponse",SIP_REGISTERED:"sipRegisteredNotification",SIP_REGISTRATION_FAILED:"sipRegistrationFailedNotification",SIP_RINGING:"sipRingingNotification",SIP_SWITCH_REGISTRAR:"sipSwitchRegistrarNotification",SIP_UNMUTE:"sipUnmuteResponse",SIP_UNREGISTERED:"sipUnregisteredNotification"},et={ACK:"ACK",ADD_SESSION:"ADD-SESSION",AGENT_DEBUG_EMAIL:"AGENT-DEBUG-EMAIL",AGENT_STATE:"AGENT-STATE",BARGE_IN:"BARGE-IN",CALLBACK_CANCEL:"CANCEL-CALLBACK",CALLBACK_PENDING:"PENDING-CALLBACKS",CALL_NOTES:"CALL-NOTES",CAMPAIGN_DISPOSITIONS:"CAMPAIGN-DISPOSITIONS",CHAT_ACTIVE:"CHAT-ACTIVE",CHAT_ADD_SESSION:"ADD-CHAT-SESSION",CHAT_AGENT_END:"CHAT-END",CHAT_ALIAS:"CHAT-ALIAS",CHAT_CANCELLED:"CHAT-CANCELLED",CHAT_CLIENT_RECONNECT:"CHAT-CLIENT-RECONNECT",CHAT_DISPOSITION:"CHAT-DISPOSITION",CHAT_INACTIVE:"CHAT-INACTIVE",CHAT_LIST:"CHAT-LIST",CHAT_MANUAL_SMS:"MANUAL-SMS",CHAT_MESSAGE:"CHAT-MESSAGE",CHAT_NEW:"NEW-CHAT",CHAT_PRESENTED:"CHAT-PRESENTED",CHAT_PRESENTED_RESPONSE:"CHAT-PRESENTED-RESPONSE",CHAT_REQUEUE:"CHAT-REQUEUE",CHAT_ROOM:"CHAT-ROOM",CHAT_ROOM_STATE:"CHAT-ROOM-STATE",CHAT_SEND:"CHAT",CHAT_STATE:"CHAT-STATE",CHAT_TYPING:"CHAT-TYPING",DIAL_GROUP_CHANGE:"DIAL_GROUP_CHANGE",DIAL_GROUP_CHANGE_PENDING:"DIAL_GROUP_CHANGE_PENDING",DIRECT_AGENT_ROUTE:"DIRECT-AGENT-ROUTE",DIRECT_AGENT_TRANSFER:"DIRECT-AGENT-TRANSFER",DIRECT_AGENT_TRANSFER_LIST:"DIRECT-AGENT-TRANSFER-LIST",DROP_SESSION:"DROP-SESSION",EARLY_UII:"EARLY_UII",END_CALL:"END-CALL",GATES_CHANGE:"GATES_CHANGE",GENERIC:"GENERIC",HANGUP:"HANGUP",HOLD:"HOLD",INBOUND_DISPOSITION:"INBOUND-DISPOSITION",LEAD_HISTORY:"LEAD-HISTORY",LEAD_INSERT:"LEAD-INSERT",LEAD_UPDATE:"LEAD-UPDATE",LEAVE_CHAT:"CHAT-DROP-SESSION",LOGIN:"LOGIN",LOGIN_PHASE_1:"LOGIN-PHASE-1",LOGIN_MULTISOCKET:"MULTISOCKET",LOGOUT:"LOGOUT",MONITOR_CHAT:"CHAT-MONITOR",NEW_CALL:"NEW-CALL",OFFHOOK_INIT:"OFF-HOOK-INIT",OFFHOOK_TERM:"OFF-HOOK-TERM",ONE_TO_ONE_OUTDIAL:"ONE-TO-ONE-OUTDIAL",ONE_TO_ONE_OUTDIAL_CANCEL:"ONE-TO-ONE-OUTDIAL-CANCEL",ON_MESSAGE:"ON-MESSAGE",OUTDIAL_DISPOSITION:"OUTDIAL-DISPOSITION",PAUSE_RECORD:"PAUSE-RECORD",PENDING_CHAT_DISP:"PENDING-CHAT-DISP",PENDING_DISP:"PENDING_DISP",PING_CALL:"PING-CALL",PREVIEW_DIAL:"PREVIEW-DIAL",PREVIEW_DIAL_ID:"PREVIEW_DIAL",PREVIEW_LEAD_STATE:"PREVIEW-LEAD-STATE",RECORD:"RECORD",REQUEUE:"RE-QUEUE",REVERSE_MATCH:"REVERSE_MATCH",SCRIPT_CONFIG:"SCRIPT-CONFIG",SCRIPT_RESULT:"SCRIPT-RESULT",STATS:"STATS",STATS_AGENT:"AGENT",STATS_AGENT_DAILY:"AGENTDAILY",STATS_CAMPAIGN:"CAMPAIGN",STATS_CHAT:"CHAT",STATS_QUEUE:"GATE",STOP_MONITOR_CHAT:"CHAT-DROP-MONITORING-SESSION",SUPERVISOR_LIST:"SUPERVISOR-LIST",TCPA_SAFE:"TCPA-SAFE",TCPA_SAFE_ID:"TCPA_SAFE",TCPA_SAFE_LEAD_STATE:"TCPA-SAFE-LEAD-STATE",UPDATE_DIAL_DESTINATION:"UPDATE_DIAL_DESTINATION",XFER_COLD:"COLD-XFER",XFER_WARM:"WARM-XFER",XFER_WARM_CANCEL:"WARM-XFER-CANCEL",SETUP_WEB_RTC_SERVER:"SETUP_WEB_RTC_SERVER",SIP_INIT:"SIP_INIT",SIP_ANSWER:"SIP_ANSWER",SIP_REJECT:"SIP_REJECT",SIP_REGISTER:"SIP_REGISTER",SIP_HANGUP:"SIP_HANGUP",SIP_SEND_DTMF:"SIP_SEND_DTMF",SIP_TOGGLE_MUTE:"SIP_TOGGLE_MUTE",SOFTPHONE_RESET_SESSION:"SOFTPHONE_RESET_SESSION",SWITCH_SOFTPHONE_REGISTRAR:"SWITCH_SOFTPHONE_REGISTRAR"};function tt(e){"use strict";var t=e.AgentLibrary;function s(){var e=Ke.getInstance(),t=e.applicationSettings.socketDest;return t=e.socketProtocol+e.authenticateRequest.socketUrl,t+=":"+e.authenticateRequest.socketPort,t+="?access_token="+e.authenticateRequest.accessToken,t+="&agent_id="+e.agentSettings.agentId,e.applicationSettings.socketDest=t,t}function i(e){var t=Ke.getInstance().applicationSettings.socketDest;Qe.logMessage(Xe.DEBUG,"Attempting to open socket connection to "+t,""),e.socket=new WebSocket(t),e.socket.onopen=function(){clearInterval(Ke.getInstance().reconnectIntervalId),Ke.getInstance().reconnectIntervalId=null,Ke.getInstance().applicationSettings.socketConnected=!0,Qe.fireCallback(e,ze.OPEN_SOCKET,{reconnect:e._isReconnect}),e.socketOpened()},e.socket.onerror=function(t){Qe.fireCallback(e,ze.OPEN_SOCKET,{error:t})},e.socket.onmessage=function(t){if("BOP"!==t.data){var s=JSON.parse(t.data);s.ui_response?Qe.processResponse(e,s):s.ui_notification?Qe.processNotification(e,s):s.dialer_request?Qe.processDialerResponse(e,s):s.ui_stats?Qe.processStats(e,s):s.ui_request&&Qe.processRequest(e,s)}},e.socket.onclose=function(){Qe.fireCallback(e,ze.CLOSE_SOCKET,""),Ke.getInstance().applicationSettings.socketConnected=!1,e.socket=null,clearInterval(Ke.getInstance().agentDailyIntervalId),Ke.getInstance().agentDailyIntervalId=null,clearInterval(Ke.getInstance().statsIntervalId),Ke.getInstance().statsIntervalId=null,clearInterval(Ke.getInstance().pingStatIntervalId),Ke.getInstance().pingStatIntervalId=null,Ke.getInstance().agentSettings.isLoggedIn&&(e._isReconnect=!0,console.warn("AgentLibrary: WebSocket is not connected, attempting to reconnect."),Ke.getInstance().reconnectIntervalId=setInterval((function(){e.openSocket(Ke.getInstance().agentSettings.agentId)}),5e3))}}t.prototype.openSocket=function(t,n){(Qe.setCallback(this,ze.OPEN_SOCKET,n),"WebSocket"in e)?this.socket||(Ke.getInstance().agentSettings.agentId=t,this._isReconnect?function(e){var t=Ke.getInstance(),n=t.authHost+t.baseAuthUri,r="Error in opening WebSocket on retrieving access token",o={queryParams:{loginHashcode:t.connectionSettings.hashCode,agentId:t.agentSettings.agentId,platformId:t.authenticateRequest.platformId}};new Ve(n).httpPost("login/agent/hashcode",o).then((function(t){try{t=JSON.parse(t.response),Ke.getInstance().authenticateRequest.accessToken=t.accessToken,s(),i(e)}catch(e){Qe.logMessage(Xe.WARN,r,e)}}),(function(e){Qe.logMessage(Xe.WARN,r,e)}))}(this):(s(),i(this))):Qe.logMessage(Xe.WARN,"WebSocket NOT supported by your Browser","")},t.prototype.closeSocket=function(){this.socket.close()},t.prototype.socketOpened=function(){var e,t=new Date;Ke.getInstance().loginPhase1Request=new V;var s=Ke.getInstance().loginPhase1Request.formatJSON();if(Qe.sendMessage(this,s),this._isReconnect){this._isReconnect=!1;var i=JSON.parse(Ke.getInstance().loginRequest.formatJSON()),n=Ke.getInstance().connectionSettings.hashCode;i.ui_request.hash_code={"#text":n},i.ui_request.update_login={"#text":"FALSE"},i.ui_request.reconnect={"#text":"TRUE"},this._queuedMsgs.unshift({dts:new Date,msg:JSON.stringify(i)})}for(var r=0;r<this._queuedMsgs.length;r++)e=this._queuedMsgs[r],t.getTime()-e.dts.getTime()<18e4?(Qe.logMessage(Xe.DEBUG,"Sending queued message to IntelliSocket.",e.msg),Qe.sendMessage(this,e.msg)):Qe.logMessage(Xe.DEBUG,"Queued message expired, discarding.",e.msg);this._queuedMsgs=[]}}function st(e){"use strict";var t=e.AgentLibrary;function s(e,t,s){Ke.getInstance().loginRequest=new B(e.dialDest,e.queueIds,e.chatIds,e.skillProfileId,e.dialGroupId,e.updateFromAdminUI,e.isForce);var i=Ke.getInstance().loginRequest.formatJSON();Qe.setCallback(s,ze.LOGIN,t),Qe.sendMessage(s,i)}t.prototype.authenticateAgentWithUsernamePassword=function(e,t,s,i){Ke.getInstance().authenticateRequest=new R({username:e,password:t,platformId:s,authType:Ze.USERNAME_PASSWORD}),Ke.getInstance().authenticateRequest.sendHttpRequest(),Qe.setCallback(this,ze.AUTHENTICATE,i)},t.prototype.authenticateAgentWithRcAccessToken=function(e,t,s){Ke.getInstance().authenticateRequest=new R({rcAccessToken:e,tokenType:t,authType:Ze.RC_TOKEN}),Ke.getInstance().authenticateRequest.sendHttpRequest(),Qe.setCallback(this,ze.AUTHENTICATE,s)},t.prototype.authenticateAgentWithEngageAccessToken=function(e,t){Ke.getInstance().authenticateRequest=new R({engageAccessToken:e,authType:Ze.ENGAGE_TOKEN}),Ke.getInstance().authenticateRequest.sendHttpRequest(),Qe.setCallback(this,ze.AUTHENTICATE,t)},t.prototype.getAgentConfig=function(e){Ke.getInstance().loginPhase1Request=new V;var t=Ke.getInstance().loginPhase1Request.formatJSON();Qe.setCallback(this,ze.LOGIN_PHASE_1,e),Qe.sendMessage(this,t)},t.prototype.getWebRtcInfo=function(e){var t=Ke.getInstance();t.webRTCRequest=new fe,t.webRTCRequest.getSipRegistrationInfo(),Qe.setCallback(this,ze.WEBRTC_INFO,e)},t.prototype.loginAgent=function(e,t,i,n,r,o,a,c){var u=Ke.getInstance(),h={dialDest:e,queueIds:t,chatIds:i,skillProfileId:n,dialGroupId:r,updateFromAdminUI:o,isForce:a},l=this;"integrated"===h.dialDest?(u.applicationSettings.isSso?u.applicationSettings.dialDestType="RC_SOFTPHONE":u.applicationSettings.dialDestType="LEGACY_SOFTPHONE",0===u.softphoneSettings.sipInfo.length?u.libraryInstance.getWebRtcInfo((function(){h.dialDest=Qe.getDialDestination(),s(h,c,l)})):(h.dialDest=Qe.getDialDestination(),s(h,c,l))):("RC_PHONE"===h.dialDest&&(u.applicationSettings.dialDestType="RC_PHONE"),s(h,c,l))},t.prototype.multiLoginRequest=function(e){var t=Ke.getInstance();t.multiSocketRequest=new X;var s=t.multiSocketRequest.formatJSON();t.dataStore.get("agent_id")&&t.dataStore.get("hash_code")?(Qe.setCallback(this,ze.LOGIN_MULTISOCKET,e),Qe.sendMessage(this,s)):this.getAgentConfig(e)},t.prototype.logoutAgent=function(e,t){var s=Ke.getInstance();if(s.agentSettings.isLoggedIn){s.agentSettings.isLoggedIn=!1,s.logoutRequest=new Q(e);var i=s.logoutRequest.formatJSON();Qe.setCallback(this,ze.LOGOUT,t),Qe.sendMessage(this,i)}},t.prototype.requestLogoutAgent=function(e,t,s){if("SUPERVISOR"===Ke.getInstance().agentSettings.agentType){Ke.getInstance().logoutRequest=new Q(e,t),Qe.setCallback(this,ze.LOGOUT,s);var i=Ke.getInstance().logoutRequest.formatJSON();Qe.sendMessage(this,i)}},t.prototype.setAgentState=function(e,t,s){Ke.getInstance().agentStateRequest=new v(e,t);var i=Ke.getInstance().agentStateRequest.formatJSON();Qe.setCallback(this,ze.AGENT_STATE,s),Qe.sendMessage(this,i)},t.prototype.offhookInit=function(e){Ke.getInstance().offhookInitRequest=new Z;var t=Ke.getInstance().offhookInitRequest.formatJSON();Qe.setCallback(this,ze.OFFHOOK_INIT,e),Qe.sendMessage(this,t)},t.prototype.offhookTerm=function(e){Ke.getInstance().offhookTermRequest=new z;var t=Ke.getInstance().offhookTermRequest.formatJSON();Qe.setCallback(this,ze.OFFHOOK_TERM,e),Qe.sendMessage(this,t)},t.prototype.getPendingCallbacks=function(e,t){Ke.getInstance().callbacksPendingRequest=new N(e);var s=Ke.getInstance().callbacksPendingRequest.formatJSON();Qe.setCallback(this,ze.CALLBACK_PENDING,t),Qe.sendMessage(this,s)},t.prototype.cancelCallback=function(e,t,s){Ke.getInstance().callbackCancelRequest=new b(e,t);var i=Ke.getInstance().callbackCancelRequest.formatJSON();Qe.setCallback(this,ze.CALLBACK_CANCEL,s),Qe.sendMessage(this,i)},t.prototype.requestStats=function(){null===Ke.getInstance().statsIntervalId&&(Ke.getInstance().statsIntervalId=setInterval(Qe.sendStatsRequestMessage,5e3),clearInterval(Ke.getInstance().pingStatIntervalId),Ke.getInstance().pingStatIntervalId=null)},t.prototype.terminateStats=function(){clearInterval(Ke.getInstance().statsIntervalId),Ke.getInstance().statsIntervalId=null,null===Ke.getInstance().pingStatIntervalId&&(Ke.getInstance().pingStatIntervalId=setInterval(Qe.sendPingRequestMessage,2e4))},t.prototype.updateDialDestination=function(e,t){Ke.getInstance().updateDialDestinationRequest=new de(e,t);var s=Ke.getInstance().updateDialDestinationRequest.formatJSON();Qe.sendMessage(this,s)},t.prototype.searchDirectory=function(e,t){var s=Ke.getInstance();s.searchDirectoryRequest=new ue(e),s.searchDirectoryRequest.searchDirectory(e),Qe.setCallback(this,ze.SEARCH_DIR,t)},t.prototype.getRefreshedToken=function(){Qe.refreshAccessToken()},t.prototype.getExtensionPresenceInfo=function(e,t){var s=Ke.getInstance();s.extensionPresenceRequest=new k(e),s.extensionPresenceRequest.getExtensionPresenceInfo(e),Qe.setCallback(this,ze.EXTENSION_PRESENCE,t)}}function it(e){"use strict";var t=e.AgentLibrary;function s(){!function(e){var s;s=Ke&&Ke.getInstance()&&Ke.getInstance().libraryInstance?Ke.getInstance().libraryInstance:new t;var i=Ke.getInstance().agentSettings;function n(e,t){s._consoleDb&&s._consoleDb.transaction(["consoleLogger"],"readwrite").objectStore("consoleLogger").add(function(e,t){if("function"==typeof t)t=t.toString();else if("object"==typeof t)try{t=JSON.stringify(t)}catch(e){}return{type:e,message:t,dts:new Date,agentId:i.agentId,agentName:i.firstName+" "+i.lastName}}(e,t))}window.console.log=function(t){e.log(t),n("LOG",t)},window.console.info=function(t){e.info(t),n("INFO",t)},window.console.warn=function(t){e.warn(t),n("WARN",t)},window.console.error=function(t){e.error(t),n("ERROR",t)}}(Object.assign({},window.console))}t.prototype.openConsoleLogger=function(){var t=this;if("indexedDB"in e){var i=indexedDB.open("AgentLibraryConsoleLogging",1);i.onerror=function(e){console.error("Error requesting DB access")},i.onsuccess=function(e){t._consoleDb=e.target.result,t.purgeLog(t._consoleDb,"consoleLogger"),t._consoleDb.onerror=function(e){console.error("AgentLibrary: Database error - "+e.target.errorCode)},t._consoleDb.onsuccess=function(e){console.log("AgentLibrary: Successful logging of record")},s()},i.onupgradeneeded=function(e){if(t._consoleDb=e.target.result,!t._consoleDb.objectStoreNames.contains("consoleLogger")){var i=t._consoleDb.createObjectStore("consoleLogger",{autoIncrement:!0});i.createIndex("type","type",{unique:!1}),i.createIndex("dts","dts",{unique:!1}),i.createIndex("agentId","agentId",{unique:!1});i.createIndex("typeAndAgent",["type","agentId"],{unique:!1})}s()}}else console.warn("AgentLibrary: indexedDB NOT supported by your Browser.")},t.prototype.getConsoleLogRecords=function(e,t){var s=Ke.getInstance().agentSettings.agentId,i=this,n=i._consoleDb.transaction(["consoleLogger"],"readonly").objectStore("consoleLogger"),r=null,o=null,a=null;Qe.setCallback(i,ze.LOG_CONSOLE_RESULTS,t);var c=[];e?(r=n.index("typeAndAgent"),a=IDBKeyRange.only([e.toUpperCase(),s])):(r=n.index("agentId"),a=IDBKeyRange.only(s));var u=0;r.openCursor(a,"prev").onsuccess=function(e){(o=e.target.result)&&u<5e3?(c.push(o.value),u++,o.continue()):Qe.fireCallback(i,ze.LOG_CONSOLE_RESULTS,c)}}}function nt(e){"use strict";var t=e.AgentLibrary;t.prototype.sipInit=function(){var e=Ke.getInstance().softphoneSettings;if(""!==e.uri&&0!==e.wsServers.length&&""!==e.displayName&&""!==e.authorizationUser||s.setupWebRtcServer(),e.wsServers.length>0){var t=new CFSimpleSip(function(){var e=document.getElementById("remoteAudio"),t=Ke.getInstance().softphoneSettings;return{media:{remote:{audio:e}},ua:{displayName:Qe.escapeSoftphoneUsername(t.displayName),authorizationUser:Qe.escapeSoftphoneUsername(t.authorizationUser),password:t.sipPassword,uri:t.uri,wsServers:t.wsServers,traceSip:!0,registerExpires:60,userAgentString:navigator.userAgent}}}());t.on("connected",a),t.on("ended",c),t.on("registered",u),t.on("unregistered",h),t.on("registrationFailed",l),t.on("ringing",d),t.on("mute",p),t.on("unmute",g),e.registerPending=setTimeout(i,15e3),e.webRtc=t}else console.error("Unable to setup WebRtc server")},t.prototype.sipAnswer=function(){var e=Ke.getInstance().softphoneSettings.webRtc;e&&e.answer()},t.prototype.sipReject=function(){var e=Ke.getInstance().softphoneSettings.webRtc;e&&e.reject&&e.reject()},t.prototype.sipRegister=function(){var e=Ke.getInstance(),t=e.softphoneSettings.webRtc;try{if(window.webkitNotifications&&0!==window.webkitNotifications.checkPermission()&&window.webkitNotifications.requestPermission(),!t)return;e.softphoneSettings.isRegistered&&e.libraryInstance.sipHangUp()}catch(e){console.error("sip reg error:"+e)}},t.prototype.sipHangUp=function(){var e=Ke.getInstance().softphoneSettings.webRtc;e&&e.hangup&&e.hangup()},t.prototype.sipSendDTMF=function(e){var t=Ke.getInstance().softphoneSettings.webRtc;t&&t.sendDTMF(e)},t.prototype.sipToggleMute=function(e){var t=Ke.getInstance().softphoneSettings,s=t.webRtc,i=t.muteActive;s&&(i||!1===e?(s.unmute(),Qe.fireCallback(Ke.getInstance().libraryInstance,ze.SIP_UNMUTE,{message:"Call unmuted"})):(s.mute(),Qe.fireCallback(Ke.getInstance().libraryInstance,ze.SIP_MUTE,{message:"Call muted"})))},t.prototype.switchSoftphoneRegistrar=function(e,t){var s=Ke.getInstance();void 0===t&&(t=!0),s.softphoneSettings.attemptingSoftphoneReconnect&&t?(r(e,t),Qe.fireCallback(Ke.getInstance().libraryInstance,ze.SIP_SWITCH_REGISTRAR,{message:"Updating offhook flags, set status message",status:"UPDATE"})):(s.libraryInstance.resetSoftphoneSession({maintainOH:e,autoStartOH:t}),Qe.fireCallback(Ke.getInstance().libraryInstance,ze.SIP_SWITCH_REGISTRAR,{message:"Triggering softphone registrar swap",status:"RESET"}))},t.prototype.resetSoftphoneSession=function(e){var t=Ke.getInstance(),i=t.softphoneSettings;i.isRegistered&&!i.attemptingSoftphoneReconnect&&(o(),function(){var e=Ke.getInstance().softphoneSettings,t=e.sipInfo;t.length>1&&(t.push(t.shift()),e.attemptingSoftphoneReconnect=!0)}(),s.setupWebRtcServer(),e&&("null"===e.maintainOH&&(e.maintainOH=i.maintainOH),r(e.maintainOH,e.autoStartOH)),t.libraryInstance.sipInit(),t.libraryInstance.sipRegister())};var s={setupWebRtcServer:function(){var e=Ke.getInstance().softphoneSettings,t=function(){var e=Ke.getInstance().softphoneSettings;return null!=e.sipInfo&&e.sipInfo.length>0?e.sipInfo[0]:null}();if(null!==t){var s=t.username.toLowerCase(),i=t.transport.toLowerCase()+"://"+t.outboundProxy;return e.uri=Qe.escapeSoftphoneUsername(s)+"@"+t.domain,e.wsServers=[i],e.displayName=s,e.authorizationUser=t.authorizationId,e.sipPassword=t.password,e.sipDialDest="sip:"+e.uri,{webRtcServer:i,username:s,password:e.sipPassword,domain:t.domain||null,dialDest:e.sipDialDest||null,uri:e.uri||null,wsServers:e.wsServers||[]}}return null}};function i(){var e=Ke.getInstance(),t=e.softphoneSettings;t.isRegistered=!0,e.libraryInstance.switchSoftphoneRegistrar(t.maintainOH,t.autoStartOH)}function n(){clearTimeout(Ke.getInstance().softphoneSettings.registerPending)}function r(e,t){var s=Ke.getInstance().softphoneSettings;s.maintainOH=e,s.autoStartOH=t}function o(){var e=Ke.getInstance(),t=e.softphoneSettings.webRtc;if(t&&t.ua){e.libraryInstance.offhookTerm(),t.hangup(),t.ua.unregister({all:!0}),t.removeAllListeners("connected"),t.removeAllListeners("ended"),t.removeAllListeners("registered"),t.removeAllListeners("unregistered"),t.removeAllListeners("registrationFailed"),t.removeAllListeners("ringing"),t.removeAllListeners("mute"),t.removeAllListeners("unmute"),t.ua.stop(),t=null,e.softphoneSettings.webRtc=t,e.softphoneSettings.isRegistered=!1,e.softphoneSettings.muteActive=!1,e.softphoneSettings.registerPending=null,e.softphoneSettings.uri=""}}function a(){Qe.fireCallback(Ke.getInstance().libraryInstance,ze.SIP_CONNECTED,{message:"SIP connected"})}function c(){Qe.fireCallback(Ke.getInstance().libraryInstance,ze.SIP_ENDED,{message:"SIP ended"})}function u(){var e=Ke.getInstance();if(n(),e.softphoneSettings.isRegistered=!0,e.agentSettings.dialDest!==e.softphoneSettings.sipDialDest&&-1===e.agentSettings.dialDest.indexOf("@RC_SOFTPHONE")){e.agentSettings.dialDest=JSON.parse(JSON.stringify(e.softphoneSettings.sipDialDest));var t={message:"SIP dial destination changed",dialDest:e.agentSettings.dialDest,maintainOH:e.softphoneSettings.maintainOH,autoStartOH:e.softphoneSettings.autoStartOH};e.softphoneSettings.autoStartOH||(e.softphoneSettings.attemptingSoftphoneReconnect=!1),Qe.fireCallback(Ke.getInstance().libraryInstance,ze.SIP_DIAL_DEST_CHANGED,t),e.libraryInstance.updateDialDestination(e.agentSettings.dialDest,!0)}Qe.fireCallback(e.libraryInstance,ze.SIP_REGISTERED,{message:"SIP registered"})}function h(){var e=Ke.getInstance();n(),e.softphoneSettings.isRegistered=!1,o(),e.libraryInstance.sipInit()}function l(){n(),Ke.getInstance().softphoneSettings.isRegistered=!1,o()}function d(e){Qe.fireCallback(Ke.getInstance().libraryInstance,ze.SIP_RINGING,{message:"SIP ringing",data:e})}function p(){Ke.getInstance().softphoneSettings.muteActive=!0}function g(){Ke.getInstance().softphoneSettings.muteActive=!1}}var rt=function(e){return function(e){"use strict";var t=e.AgentLibrary=function(e){return e=e||{},this.callbacks={},this._requests=[],this._queuedMsgs=[],this._isReconnect=!1,Ke.resetInstance(),Ke.getInstance().libraryInstance=this,this.openLogger(),this.openConsoleLogger(),void 0!==e.callbacks&&(this.callbacks=e.callbacks),void 0!==e.authHost&&(Ke.getInstance().authHost=e.authHost),"undefined"!==e.isSecureSocket&&("string"==typeof e.isSecureSocket&&(e.isSecureSocket="true"===e.isSecureSocket.toLowerCase()),Ke.getInstance().socketProtocol=e.isSecureSocket?"wss://":"ws://"),Ke.getInstance().applicationSettings.allowMultiSocket=!0===e.allowMultiSocket,this};t.prototype.setCallbacks=function(e){for(var t in e)this.callbacks[t]=e[t]},t.prototype.setCallback=function(e,t){this.callbacks[e]=t},t.prototype.getCallbacks=function(){return this.callbacks},t.prototype.getCallback=function(e){return this.callbacks[e]},t.prototype.getSocket=function(e){return this.socket},t.prototype.getAuthenticateRequest=function(){return Ke.getInstance().authenticateRequest},t.prototype.getLoginRequest=function(){return Ke.getInstance().loginRequest},t.prototype.getMultiSocketRequest=function(){return Ke.getInstance().multiSocketRequest},t.prototype.getAgentConfigRequest=function(){return Ke.getInstance().loginPhase1Request},t.prototype.getLogoutRequest=function(){return Ke.getInstance().logoutRequest},t.prototype.getAgentDailyStats=function(){return Ke.getInstance().agentDailyStats},t.prototype.getCallTokens=function(){return Ke.getInstance().callTokens},t.prototype.getAgentStateRequest=function(){return Ke.getInstance().agentStateRequest},t.prototype.getOffhookInitRequest=function(){return Ke.getInstance().offhookInitRequest},t.prototype.getOffhookTermRequest=function(){return Ke.getInstance().offhookTermRequest},t.prototype.getHangupRequest=function(){return Ke.getInstance().hangupRequest},t.prototype.getPreviewDialRequest=function(){return Ke.getInstance().previewDialRequest},t.prototype.getTcpaSafeRequest=function(){return Ke.getInstance().tcpaSafeRequest},t.prototype.getManualOutdialRequest=function(){return Ke.getInstance().oneToOneOutdialRequest},t.prototype.getManualOutdialCancelRequest=function(){return Ke.getInstance().oneToOneOutdialCancelRequest},t.prototype.getCallNotesRequest=function(){return Ke.getInstance().callNotesRequest},t.prototype.getCampaignDispositionsRequest=function(){return Ke.getInstance().campaignDispositionsRequest},t.prototype.getDispositionRequest=function(){return Ke.getInstance().dispositionRequest},t.prototype.getDispositionManualPassRequest=function(){return Ke.getInstance().dispositionManualPassRequest},t.prototype.getWarmTransferRequest=function(){return Ke.getInstance().warmXferRequest},t.prototype.getColdTransferRequest=function(){return Ke.getInstance().coldXferRequest},t.prototype.getWarmTransferCancelRequest=function(){return Ke.getInstance().warmXferCancelRequest},t.prototype.getRequeueRequest=function(){return Ke.getInstance().requeueRequest},t.prototype.getBargeInRequest=function(){return Ke.getInstance().bargeInRequest},t.prototype.getHoldRequest=function(){return Ke.getInstance().holdRequest},t.prototype.getPauseRecordRequest=function(){return Ke.getInstance().pauseRecordRequest},t.prototype.getRecordRequest=function(){return Ke.getInstance().recordRequest},t.prototype.getChatPresentedRequest=function(){return Ke.getInstance().chatPresentedRequest},t.prototype.getChatDispositionRequest=function(){return Ke.getInstance().chatDispositionRequest},t.prototype.getChatMessageRequest=function(){return Ke.getInstance().chatMessageRequest},t.prototype.getChatRequeueRequest=function(){return Ke.getInstance().chatRequeueRequest},t.prototype.getChatTypingRequest=function(){return Ke.getInstance().chatTypingRequest},t.prototype.getAgentStatsPacket=function(){return Ke.getInstance().agentStatsPacket},t.prototype.getAgentDailyStatsPacket=function(){return Ke.getInstance().agentDailyStatsPacket},t.prototype.getQueueStatsPacket=function(){return Ke.getInstance().queueStatsPacket},t.prototype.getChatQueueStatsPacket=function(){return Ke.getInstance().chatQueueStatsPacket},t.prototype.getCampaignStatsPacket=function(){return Ke.getInstance().campaignStatsPacket},t.prototype.getAgentConfigPacket=function(){return Ke.getInstance().loginPhase1Packet},t.prototype.getLoginPacket=function(){return Ke.getInstance().loginPacket},t.prototype.getAgentStatePacket=function(){return Ke.getInstance().agentStatePacket},t.prototype.getCurrentCallPacket=function(){return Ke.getInstance().currentCallPacket},t.prototype.getOffhookInitPacket=function(){return Ke.getInstance().offhookInitPacket},t.prototype.getOffhookTermPacket=function(){return Ke.getInstance().offhookTermPacket},t.prototype.getChatAgentEnd=function(){return Ke.getInstance().chatAgentEnd},t.prototype.getWebRTCRequest=function(){return Ke.getInstance().webRTCRequest},t.prototype.getChatListRequest=function(){return Ke.getInstance().chatListRequest},t.prototype.getSearchDirectoryRequest=function(){return Ke.getInstance().searchDirectoryRequest},t.prototype.getDialGroupChangeNotification=function(){return Ke.getInstance().dialGroupChangeNotification},t.prototype.getDialGroupChangePendingNotification=function(){return Ke.getInstance().dialGroupChangePendingNotification},t.prototype.getEndCallNotification=function(){return Ke.getInstance().endCallNotification},t.prototype.getGatesChangeNotification=function(){return Ke.getInstance().gatesChangeNotification},t.prototype.getGenericNotification=function(){return Ke.getInstance().genericNotification},t.prototype.getNewCallNotification=function(){return Ke.getInstance().newCallNotification},t.prototype.getCurrentCall=function(){return Ke.getInstance().currentCall},t.prototype.getAddSessionNotification=function(){return Ke.getInstance().addSessionNotification},t.prototype.getDropSessionNotification=function(){return Ke.getInstance().dropSessionNotification},t.prototype.getEarlyUiiNotification=function(){return Ke.getInstance().earlyUiiNotification},t.prototype.getChatActiveNotification=function(){return Ke.getInstance().chatActiveNotification},t.prototype.getChatInactiveNotification=function(){return Ke.getInstance().chatInactiveNotification},t.prototype.getChatClientReconnectNotification=function(){return Ke.getInstance().chatClientReconnectNotification},t.prototype.getChatPresentedNotification=function(){return Ke.getInstance().chatPresentedNotification},t.prototype.getChatTypingNotification=function(){return Ke.getInstance().chatTypingNotification},t.prototype.getNewChatNotification=function(){return Ke.getInstance().newChatNotification},t.prototype.getApplicationSettings=function(){return Ke.getInstance().applicationSettings},t.prototype.getSoftphoneSettings=function(){return Ke.getInstance().softphoneSettings},t.prototype.getChatSettings=function(){return Ke.getInstance().chatSettings},t.prototype.getConnectionSettings=function(){return Ke.getInstance().connectionSettings},t.prototype.getInboundSettings=function(){return Ke.getInstance().inboundSettings},t.prototype.getOutboundSettings=function(){return Ke.getInstance().outboundSettings},t.prototype.getAgentSettings=function(){return Ke.getInstance().agentSettings},t.prototype.getTransferSessions=function(){return Ke.getInstance().transferSessions},t.prototype.getPendingSessions=function(){return Ke.getInstance().pendingNewCallSessions},t.prototype.getAgentPermissions=function(){return Ke.getInstance().agentPermissions},t.prototype.getAgentStats=function(){return Ke.getInstance().agentStats},t.prototype.getAgentDailyStats=function(){return Ke.getInstance().agentDailyStats},t.prototype.getQueueStats=function(){return Ke.getInstance().queueStats},t.prototype.getChatQueueStats=function(){return Ke.getInstance().chatQueueStats},t.prototype.getCampaignStats=function(){return Ke.getInstance().campaignStats},t.prototype.getFilteredDirectory=function(){return Ke.getInstance().filteredDirectory},t.prototype.getExtensionPresenceResponse=function(){return Ke.getInstance().extensionPresenceResponse},t.prototype.getExtensionPresenceRequest=function(){return Ke.getInstance().extensionPresenceRequest},t.prototype._utils=Qe,t.prototype._NewCallUtils=Ye,t.prototype._HttpService=Ve,t.prototype._getUIModel=function(){return Ke}}(e),tt(e),st(e),function(e){"use strict";var t=e.AgentLibrary;t.prototype.bargeIn=function(e,t,s,i){Ke.getInstance().bargeInRequest=new A("FULL",e,t,s);var n=Ke.getInstance().bargeInRequest.formatJSON();Qe.setCallback(this,ze.BARGE_IN,i),Qe.sendMessage(this,n)},t.prototype.coach=function(e,t,s,i){Ke.getInstance().bargeInRequest=new A("COACHING",e,t,s);var n=Ke.getInstance().bargeInRequest.formatJSON();Qe.setCallback(this,ze.COACH_CALL,i),Qe.sendMessage(this,n)},t.prototype.coldXfer=function(e,t,s,i){Ke.getInstance().coldXferRequest=new x(e,t,s);var n=Ke.getInstance().coldXferRequest.formatJSON();Qe.setCallback(this,ze.XFER_COLD,i),Qe.sendMessage(this,n)},t.prototype.internationalColdXfer=function(e,t,s,i,n){Ke.getInstance().coldXferRequest=new x(e,t,s,i);var r=Ke.getInstance().coldXferRequest.formatJSON();Qe.setCallback(this,ze.XFER_COLD,n),Qe.sendMessage(this,r)},t.prototype.dispositionCall=function(e,t,s,i,n,r,o,a,c,u){var h=Ke.getInstance();h.dispositionRequest=new P(e,t,s,i,n,r,o,a,c,u);var l=h.dispositionRequest.formatJSON();Qe.sendMessage(this,l),h.pingIntervalId&&(clearInterval(h.pingIntervalId),h.pingIntervalId=null)},t.prototype.dispositionManualPass=function(e,t,s,i,n,r,o){Ke.getInstance().dispositionManualPassRequest=new H(e,t,s,i,n,r,o);var a=Ke.getInstance().dispositionManualPassRequest.formatJSON();Qe.sendMessage(this,a)},t.prototype.getCampaignDispositions=function(e,t){Ke.getInstance().campaignDispositionsRequest=new O(e);var s=Ke.getInstance().campaignDispositionsRequest.formatJSON();Qe.setCallback(this,ze.CAMPAIGN_DISPOSITIONS,t),Qe.sendMessage(this,s)},t.prototype.hangup=function(e,t){Ke.getInstance().hangupRequest=new $(e,t);var s=Ke.getInstance().hangupRequest.formatJSON();Qe.sendMessage(this,s)},t.prototype.hold=function(e,t){Ke.getInstance().holdRequest=new L(e);var s=Ke.getInstance().holdRequest.formatJSON();Qe.setCallback(this,ze.HOLD,t),Qe.sendMessage(this,s)},t.prototype.holdSession=function(e,t,s){Ke.getInstance().holdRequest=new L(e,t);var i=Ke.getInstance().holdRequest.formatJSON();Qe.setCallback(this,ze.HOLD,s),Qe.sendMessage(this,i)},t.prototype.manualOutdial=function(e,t,s,i,n){Ke.getInstance().oneToOneOutdialRequest=new ee(e,t,s,i,n);var r=Ke.getInstance().oneToOneOutdialRequest.formatJSON();Qe.sendMessage(this,r)},t.prototype.manualOutdialCancel=function(e){Ke.getInstance().oneToOneOutdialCancelRequest=new te(e);var t=Ke.getInstance().oneToOneOutdialCancelRequest.formatJSON();Qe.sendMessage(this,t)},t.prototype.pauseRecord=function(e,t){Ke.getInstance().pauseRecordRequest=new se(e);var s=Ke.getInstance().pauseRecordRequest.formatJSON();Qe.setCallback(this,ze.PAUSE_RECORD,t),Qe.sendMessage(this,s)},t.prototype.previewDial=function(e,t){Ke.getInstance().previewDialRequest=new ne("",[],e,t);var s=Ke.getInstance().previewDialRequest.formatJSON();Qe.sendMessage(this,s)},t.prototype.previewFetch=function(e,t){Ke.getInstance().previewDialRequest=new ne("",e,"");var s=Ke.getInstance().previewDialRequest.formatJSON();Qe.setCallback(this,ze.PREVIEW_FETCH,t),Qe.sendMessage(this,s)},t.prototype.searchLeads=function(e,t){Ke.getInstance().previewDialRequest=new ne("search",e,"");var s=Ke.getInstance().previewDialRequest.formatJSON();Qe.setCallback(this,ze.LEAD_SEARCH,t),Qe.sendMessage(this,s)},t.prototype.setCallNotes=function(e,t){Ke.getInstance().callNotesRequest=new y(e);var s=Ke.getInstance().callNotesRequest.formatJSON();Qe.setCallback(this,ze.CALL_NOTES,t),Qe.sendMessage(this,s)},t.prototype.monitor=function(e,t,s,i){Ke.getInstance().bargeInRequest=new A("MUTE",e,t,s);var n=Ke.getInstance().bargeInRequest.formatJSON();Qe.setCallback(this,ze.SILENT_MONITOR,i),Qe.sendMessage(this,n)},t.prototype.record=function(e,t){Ke.getInstance().recordRequest=new re(e);var s=Ke.getInstance().recordRequest.formatJSON();Qe.setCallback(this,ze.RECORD,t),Qe.sendMessage(this,s)},t.prototype.requeueCall=function(e,t,s,i){Ke.getInstance().requeueRequest=new oe(e,t,s);var n=Ke.getInstance().requeueRequest.formatJSON();Qe.setCallback(this,ze.REQUEUE,i),Qe.sendMessage(this,n)},t.prototype.safeModeCall=function(e,t){Ke.getInstance().tcpaSafeRequest=new le("",[],e,t);var s=Ke.getInstance().tcpaSafeRequest.formatJSON();Qe.sendMessage(this,s)},t.prototype.safeModeFetch=function(e,t){Ke.getInstance().tcpaSafeRequest=new le("",e,"");var s=Ke.getInstance().tcpaSafeRequest.formatJSON();Qe.setCallback(this,ze.SAFE_MODE_FETCH,t),Qe.sendMessage(this,s)},t.prototype.safeSearchLeads=function(e,t){Ke.getInstance().tcpaSafeRequest=new le("search",e,"");var s=Ke.getInstance().tcpaSafeRequest.formatJSON();Qe.setCallback(this,ze.SAFE_MODE_SEARCH,t),Qe.sendMessage(this,s)},t.prototype.internationalWarmXfer=function(e,t,s,i,n){Ke.getInstance().warmXferRequest=new pe(e,t,s,i);var r=Ke.getInstance().warmXferRequest.formatJSON();Qe.setCallback(this,ze.XFER_WARM,n),Qe.sendMessage(this,r)},t.prototype.warmXfer=function(e,t,s,i){Ke.getInstance().warmXferRequest=new pe(e,t,s);var n=Ke.getInstance().warmXferRequest.formatJSON();Qe.setCallback(this,ze.XFER_WARM,i),Qe.sendMessage(this,n)},t.prototype.warmXferCancel=function(e){Ke.getInstance().warmXferCancelRequest=new ge(e);var t=Ke.getInstance().warmXferCancelRequest.formatJSON();Qe.sendMessage(this,t)},t.prototype.corporateDirWarmXfer=function(e,t,s,i,n){Ke.getInstance().warmXferRequest=new pe(e,t,s,i);var r=Ke.getInstance().warmXferRequest.formatJSON();Qe.setCallback(this,ze.XFER_WARM,n),Qe.sendMessage(this,r)},t.prototype.corporateDirColdXfer=function(e,t,s,i,n){Ke.getInstance().coldXferRequest=new x(e,t,s,i);var r=Ke.getInstance().coldXferRequest.formatJSON();Qe.setCallback(this,ze.XFER_COLD,n),Qe.sendMessage(this,r)},t.prototype.getScript=function(e,t,s){var i=Ke.getInstance(),n=i.scriptSettings.loadedScripts[e];if(Qe.setCallback(this,ze.SCRIPT_CONFIG,s),n&&n.version===t){s(Ke.getInstance().scriptSettings.loadedScripts[e])}else{i.scriptConfigRequest=new ae(e);var r=Ke.getInstance().scriptConfigRequest.formatJSON();Qe.sendMessage(this,r)}},t.prototype.saveScriptResult=function(e,t,s){Ke.getInstance().scriptResultRequest=new ce(e,t,s);var i=Ke.getInstance().scriptResultRequest.formatJSON();Qe.sendMessage(this,i)},t.prototype.directAgentXferList=function(e){Ke.getInstance().directAgentTransferListRequest=new q;var t=Ke.getInstance().directAgentTransferListRequest.formatJSON();Qe.setCallback(this,ze.DIRECT_AGENT_TRANSFER_LIST,e),Qe.sendMessage(this,t)},t.prototype.warmDirectAgentXfer=function(e){Ke.getInstance().directAgentTransferRequest=new U(e,"WARM");var t=Ke.getInstance().directAgentTransferRequest.formatJSON();Qe.sendMessage(this,t)},t.prototype.coldDirectAgentXfer=function(e){Ke.getInstance().directAgentTransferRequest=new U(e,"COLD");var t=Ke.getInstance().directAgentTransferRequest.formatJSON();Qe.sendMessage(this,t)},t.prototype.cancelDirectAgentXfer=function(e){Ke.getInstance().directAgentTransferRequest=new U(e,"CANCEL");var t=Ke.getInstance().directAgentTransferRequest.formatJSON();Qe.sendMessage(this,t)},t.prototype.voicemailDirectAgentXfer=function(e){Ke.getInstance().directAgentTransferRequest=new U(e,"VOICEMAIL");var t=Ke.getInstance().directAgentTransferRequest.formatJSON();Qe.sendMessage(this,t)},t.prototype.rejectDirectAgentXfer=function(e){Ke.getInstance().directAgentTransferRequest=new U("0","REJECT",e);var t=Ke.getInstance().directAgentTransferRequest.formatJSON();Qe.sendMessage(this,t)}}(e),function(e){"use strict";var t=e.AgentLibrary;t.prototype.leadHistory=function(e,t){Ke.getInstance().leadHistoryRequest=new M(e);var s=Ke.getInstance().leadHistoryRequest.formatJSON();Qe.setCallback(this,ze.LEAD_HISTORY,t),Qe.sendMessage(this,s)},t.prototype.leadInsert=function(e,t){Ke.getInstance().leadInsertRequest=new G(e);var s=Ke.getInstance().leadInsertRequest.formatJSON();Qe.setCallback(this,ze.LEAD_INSERT,t),Qe.sendMessage(this,s)},t.prototype.leadUpdate=function(e,t,s,i){Ke.getInstance().leadUpdateRequest=new F(e,t,s);var n=Ke.getInstance().leadUpdateRequest.formatJSON();Qe.setCallback(this,ze.LEAD_UPDATE,i),Qe.sendMessage(this,n)}}(e),function(e){"use strict";var t=e.AgentLibrary;t.prototype.setChatAlias=function(e){Ke.getInstance().chatAliasRequest=new me(e);var t=Ke.getInstance().chatAliasRequest.formatJSON();Qe.sendMessage(this,t)},t.prototype.publicChatRoom=function(e,t){Ke.getInstance().chatRoomRequest=new Re(e,"PUBLIC",t);var s=Ke.getInstance().chatRoomRequest.formatJSON();Qe.sendMessage(this,s)},t.prototype.privateChatRoom=function(e,t,s,i){Ke.getInstance().chatRoomRequest=new Re(e,"PRIVATE",t,s,i);var n=Ke.getInstance().chatRoomRequest.formatJSON();Qe.sendMessage(this,n)},t.prototype.sendChat=function(e,t,s){Ke.getInstance().chatSendRequest=new Ae(e,t);var i=Ke.getInstance().chatSendRequest.formatJSON();Qe.setCallback(this,ze.CHAT,s),Qe.sendMessage(this,i)},t.prototype.getSupervisors=function(e){Ke.getInstance().supervisorListRequest=new we;var t=Ke.getInstance().supervisorListRequest.formatJSON();Qe.setCallback(this,ze.SUPERVISOR_LIST,e),Qe.sendMessage(this,t)},t.prototype.chatPresentedResponse=function(e,t,s,i){Ke.getInstance().chatPresentedRequest=new Ie(e,t,s,i);var n=Ke.getInstance().chatPresentedRequest.formatJSON();Qe.sendMessage(this,n)},t.prototype.chatMessage=function(e,t,s){Ke.getInstance().chatMessageRequest=new Ee(e,t,s,!1);var i=Ke.getInstance().chatMessageRequest.formatJSON();Qe.sendMessage(this,i)},t.prototype.chatWhisper=function(e,t,s){Ke.getInstance().chatMessageRequest=new Ee(e,t,s,!0);var i=Ke.getInstance().chatMessageRequest.formatJSON();Qe.sendMessage(this,i)},t.prototype.chatDisposition=function(e,t,s,i,n,r,o){Ke.getInstance().chatDispositionRequest=new Se(e,t,s,i,n,r,o);var a=Ke.getInstance().chatDispositionRequest.formatJSON();Qe.sendMessage(this,a)},t.prototype.chatRequeue=function(e,t,s,i,n){Ke.getInstance().chatRequeueRequest=new ve(e,t,s,i,n);var r=Ke.getInstance().chatRequeueRequest.formatJSON();Qe.sendMessage(this,r)},t.prototype.chatTyping=function(e,t){Ke.getInstance().chatTypingRequest=new ye(e,t);var s=Ke.getInstance().chatTypingRequest.formatJSON();Qe.sendMessage(this,s)},t.prototype.monitorAgentChats=function(e){Ke.getInstance().monitorChatRequest=new De(e);var t=Ke.getInstance().monitorChatRequest.formatJSON();Qe.sendMessage(this,t)},t.prototype.stopMonitoringChatsByAgent=function(e){Ke.getInstance().stopMonitorChatRequest=new Oe(e);var t=Ke.getInstance().stopMonitorChatRequest.formatJSON();Qe.sendMessage(this,t)},t.prototype.stopMonitoringAllAgentChats=function(){Ke.getInstance().stopMonitorChatRequest=new Oe;var e=Ke.getInstance().stopMonitorChatRequest.formatJSON();Qe.sendMessage(this,e)},t.prototype.leaveChat=function(e,t,s){Ke.getInstance().leaveChatRequest=new be(e,t,s);var i=Ke.getInstance().leaveChatRequest.formatJSON();Qe.sendMessage(this,i)},t.prototype.chatList=function(e,t,s){Ke.getInstance().chatListRequest=new _e(e,t);var i=Ke.getInstance().chatListRequest.formatJSON();Qe.setCallback(this,ze.CHAT_LIST,s),Qe.sendMessage(this,i)},t.prototype.chatAgentEnd=function(e,t){Ke.getInstance().chatAgentEnd=new Te(e,t);var s=Ke.getInstance().chatAgentEnd.formatJSON();Qe.sendMessage(this,s)},t.prototype.setChatState=function(e,t){Ke.getInstance().chatStateRequest=new w(e);var s=Ke.getInstance().chatStateRequest.formatJSON();Qe.setCallback(this,ze.CHAT_STATE,t),Qe.sendMessage(this,s)},t.prototype.sendManualOutboundSms=function(e,t,s,i,n){Ke.getInstance().chatManualSms=new Ne(e,t,s,i,n);var r=Ke.getInstance().chatManualSms.formatJSON();Qe.sendMessage(this,r)}}(e),function(e){"use strict";var t=e.AgentLibrary;t.prototype.openLogger=function(){var t=this;if("indexedDB"in e){var s=indexedDB.open("AgentLibraryLogging",6);s.onerror=function(e){console.error("Error requesting DB access")},s.onsuccess=function(e){t._db=e.target.result,t.purgeLog(t._db,"logger"),t._db.onerror=function(e){console.error("AgentLibrary: Database error - "+e.target.errorCode)},t._db.onsuccess=function(e){console.log("AgentLibrary: Successful logging of record")}},s.onupgradeneeded=function(e){if(t._db=e.target.result,!t._db.objectStoreNames.contains("logger")){var s=t._db.createObjectStore("logger",{autoIncrement:!0});s.createIndex("logLevel","logLevel",{unique:!1}),s.createIndex("dts","dts",{unique:!1});s.createIndex("levelAndDate",["logLevel","dts"],{unique:!1})}}}else console.warn("AgentLibrary: indexedDB NOT supported by your Browser.")},t.prototype.purgeLog=function(e,t){if(e)try{var s=e.transaction([t],"readwrite").objectStore(t),i=s.index("dts"),n=new Date;n.setDate(n.getDate()-2);var r=IDBKeyRange.upperBound(n);i.openCursor(r).onsuccess=function(e){var t=e.target.result;t&&(s.delete(t.primaryKey),t.continue())}}catch(e){}},t.prototype.clearLog=function(e){e.transaction(["logger"],"readwrite").objectStore("logger").clear().onsuccess=function(e){console.log("AgentLibrary: logger database cleared")}},t.prototype.deleteDB=function(e){e=e||"AgentLibraryLogging";var t=indexedDB.deleteDatabase(e);t.onerror=function(t){console.log("Error deleting database.",e)},t.onsuccess=function(t){console.log("Database",e,"deleted successfully")}},t.prototype.getLogRecords=function(e,t,s,i,n){e=e||"";var r=this,o=r._db.transaction(["logger"],"readonly").objectStore("logger"),a=null,c=null,u=i||100;if(Qe.setCallback(r,ze.LOG_RESULTS,n),""!==e&&"ALL"!==e.toUpperCase()&&"NO-STATS"!==e.toUpperCase()){if(t&&s){var h=[e.toLowerCase(),t],l=[e.toLowerCase(),s];c=IDBKeyRange.bound(h,l)}else t?c=IDBKeyRange.lowerBound([e.toLowerCase(),t]):s&&(c=IDBKeyRange.upperBound([e.toLowerCase(),s]));if(null!==c){var d=[],p=0;o.index("levelAndDate").openCursor(c,"prev").onsuccess=function(e){(a=e.target.result)&&p<u?(d.push(a.value),p+=1,a.continue()):Qe.fireCallback(r,ze.LOG_RESULTS,d)}}else{var g=[],f=0;o.index("logLevel").openCursor(e,"prev").onsuccess=function(e){(a=e.target.result)&&f<u?(g.push(a.value),f+=1,a.continue()):Qe.fireCallback(r,ze.LOG_RESULTS,g)}}}else if("NO-STATS"===e.toUpperCase())if(t&&s?c=IDBKeyRange.bound(t,s):t?c=IDBKeyRange.lowerBound(t):s&&(c=IDBKeyRange.upperBound(s)),null!==c){var T=[],m=0;o.index("dts").openCursor(c,"prev").onsuccess=function(e){(a=e.target.result)&&m<u?("stats"!==a.value.logLevel&&(T.push(a.value),m+=1),a.continue()):Qe.fireCallback(r,ze.LOG_RESULTS,T)}}else{var S=[],_=0;o.openCursor().onsuccess=function(e){(a=e.target.result)&&_<u?("stats"!==a.value.logLevel&&(S.push(a.value),_+=1),a.continue()):Qe.fireCallback(r,ze.LOG_RESULTS,S)}}else if(t&&s?c=IDBKeyRange.bound(t,s):t?c=IDBKeyRange.lowerBound(t):s&&(c=IDBKeyRange.upperBound(s)),null!==c){var E=[],I=0;o.index("dts").openCursor(c,"prev").onsuccess=function(e){(a=e.target.result)&&I<u?(E.push(a.value),I+=1,a.continue()):Qe.fireCallback(r,ze.LOG_RESULTS,E)}}else{var v=[],R=0;o.openCursor().onsuccess=function(e){(a=e.target.result)&&R<u?(v.push(a.value),R+=1,a.continue()):Qe.fireCallback(r,ze.LOG_RESULTS,v)}}return null}}(e),it(e),nt(e),e.AgentLibrary};void 0===(i=function(){return rt({})}.call(t,s,t,e))||(e.exports=i)}()}]);